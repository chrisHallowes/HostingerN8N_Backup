{"backupDate":"2026-01-18T03:00:18.135Z","totalWorkflows":36,"workflows":[{"updatedAt":"2025-12-08T07:37:13.000Z","createdAt":"2025-11-29T02:53:15.460Z","id":"0Xa2qCRKvMiPi97j","name":"AI News Summary","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":6}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[96,240],"id":"4a4eb31f-70a9-4e43-816a-f080b609eb38","name":"Schedule Trigger"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"=Chris' Daily AI News for {{ $now.format('dd-MM-yyyy') }}","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1840,224],"id":"ef36bb03-468a-495c-a8ba-550aaab67a78","name":"Send a message","webhookId":"0488d66a-8f81-4e75-818b-a98ce55a695f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[640,224],"id":"bdaf2161-dc42-4f7f-8e45-8805eed5de71","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"query"},{"fieldToAggregate":"answer"},{"fieldToAggregate":"results"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[848,224],"id":"a522b960-296f-490c-859d-8c3e5d29e10d","name":"Aggregate"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1280,576],"id":"2ffa484c-6c73-4862-9fed-e19657c5dc92","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"=Unformatted Newsletter:\n{{ $json.output }}","options":{"systemMessage":"=**SYSTEM PROMPT — “Expert Newsletter Writer & HTML Email Formatter (Do-Not-Rewrite)”**\n\n**Role**\nYou are an expert newsletter formatter for HTML emails. You receive **raw, unformatted newsletter text** (“Source”). Your job is to **format it into production-safe HTML email** that is readable, attractive, and **blue-themed**. **Do not change, paraphrase, remove, or add to the Source content** (including headings like “The News Leader”). You may only:\n\n* Wrap Source in semantic structure,\n* Apply layout/styling,\n* Auto-convert lists/links/tables,\n* Insert non-content scaffolding (wrapper tables, preheader, footer placeholders).\n\n**Hard Constraints**\n\n* **Preserve content verbatim** (text, capitalization, punctuation, order).\n* **No editorial changes**; no summaries; no additions to body copy.\n* **Email-safe HTML**: table-based layout, width ≈ **600px**, **inline CSS** only, minimal media query for mobile.\n* **Accessible & readable**: strong contrast, 16px+ base text, 1.4–1.6 line-height.\n* **Blue palette** only for styling (you choose tasteful tones).\n* **No external fonts, scripts, or remote CSS**.\n* **No tracking pixels**.\n* **If Source has headings**, use them; **do not invent new headings**.\n* If Source has naked URLs, convert to `<a>` but keep anchor text identical to the URL (no rewording).\n* Keep all section titles exactly as written (e.g., “The News Leader”).\n\n**Color Palette (use variations as needed)**\n\n* Primary Navy: `#0B3D91`\n* Mid Blue: `#1E3A8A`\n* Accent Teal-Blue: `#0FA3B1`\n* Light Blue BG: `#E9F2FF`\n* Soft Gray BG: `#F4F6F8`\n* Body Text: `#1F2937`\n* Muted Caption: `#6B7280`\n\n**Formatting Rules**\n\n1. **Structure**: one-column container (600px), padded content, clear section boxes for each top-level heading.\n2. **Headings**: Map Source headings to `<h1>` (first only) then `<h2>/<h3>`; do not rename them.\n3. **Paragraphs**: Wrap plain lines into `<p>`; collapse extra blank lines.\n4. **Lists**: Convert `-`/`•`/`*` prefixed lines to `<ul><li>…</li></ul>`.\n5. **Links**: Detect `http(s)://…` and wrap in `<a href=\"…\">…</a>`; do not alter text.\n6. **Tables**: If markdown-like tables are present, render a simple bordered table with blue header row.\n7. **Images in Source**: If absolute URLs appear on their own line and end with an image extension, render as `<img>` with `max-width:100%` and `height:auto`; otherwise leave link text as is.\n8. **Boxes**: Wrap major sections in rounded “cards” using light-blue backgrounds for visual hierarchy.\n9. **Preheader**: Create a hidden preheader by **copying the first ~90 chars of the Source** verbatim (no edits).\n10. **Footer placeholder**: Include a minimal legal footer (no marketing copy).\n\n**Output**\nReturn **a single complete HTML document** (no commentary). Insert the entire Source exactly where indicated. Do not escape or alter Source text beyond structural wrapping.\n\n**Template (use and inject Source as directed)**\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Email Newsletter</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    @media only screen and (max-width:620px){\n      .container{width:100%!important}\n      .p-24{padding:16px!important}\n      .stack{display:block!important;width:100%!important}\n      .h1{font-size:24px!important;line-height:30px!important}\n    }\n  </style>\n</head>\n<body style=\"margin:0;padding:0;background:#F4F6F8;\">\n  <!-- Hidden Preheader (first ~90 chars of Source, verbatim) -->\n  <div style=\"display:none;font-size:1px;line-height:1px;max-height:0;max-width:0;opacity:0;overflow:hidden;mso-hide:all;\">\n    [[PREHEADER_FROM_SOURCE]]\n  </div>\n\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#F4F6F8;\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px;\">\n        <!--[if mso]><table role=\"presentation\" width=\"600\"><tr><td><![endif]-->\n        <table role=\"presentation\" class=\"container\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:600px;background:#FFFFFF;border-radius:12px;overflow:hidden;\">\n          <!-- Brand/Header Bar (no added copy) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:24px;\">\n              <h1 class=\"h1\" style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:28px;line-height:34px;color:#FFFFFF;\">\n                [[OPTIONAL_FIRST_HEADING_IF_PRESENT_ELSE_EMPTY]]\n              </h1>\n            </td>\n          </tr>\n\n          <!-- Main Content Wrapper -->\n          <tr>\n            <td class=\"p-24\" style=\"padding:24px;font-family:Arial,Helvetica,sans-serif;color:#1F2937;font-size:16px;line-height:24px;\">\n              <!-- BEGIN SOURCE (insert verbatim; wrap with paragraphs/lists/tables as per rules) -->\n              [[FORMATTED_SOURCE_CONTENT]]\n              <!-- END SOURCE -->\n            </td>\n          </tr>\n\n          <!-- Optional Section Cards (use when Source contains multiple top-level headings) -->\n          <!-- Example card -->\n          <!--\n          <tr>\n            <td style=\"padding:0 24px 24px;\">\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#E9F2FF;border-radius:10px;\">\n                <tr>\n                  <td style=\"padding:16px 18px;font-family:Arial,Helvetica,sans-serif;\">\n                    [[SECTION_FROM_SOURCE_HEADING_AND_BODY_VERBATIM]]\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          -->\n\n          <!-- Footer (placeholder only, no new claims) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:16px;text-align:center;\">\n              <p style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;color:#E6ECFF;\">\n                © [[YOUR_ORG_NAME]] • [[CITY, COUNTRY]]\n              </p>\n              <p style=\"margin:4px 0 0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;\">\n                <a href=\"[[UNSUBSCRIBE_URL]]\" style=\"color:#E6ECFF;text-decoration:underline;\">Unsubscribe</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n        <!--[if mso]></td></tr></table><![endif]-->\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n```\n\n**Implementation Notes**\n\n* Detect headings: markdown `#`, `##`, underline styles, or standalone ALL-CAPS lines → wrap as `<h2>`/`<h3>` with **no text changes**.\n* Convert simple bullets to `<ul><li>…</li></ul>`; keep each bullet’s wording exactly.\n* For URLs in text, set `style=\"color:#0B3D91;text-decoration:underline;\"`.\n* Use cards (`#E9F2FF` background, `10px` radius) to group major sections; never insert new titles.\n* If the Source starts with a strong title, show it in the blue header; otherwise leave the header text empty and rely on section headings.\n* If no headings exist, render as paragraphs only—**do not invent headings**.\n* Always return **only** the HTML document.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1424,224],"id":"d2372593-424d-4742-adf0-1d5cc39bb78e","name":"HTML Editor"},{"parameters":{"promptType":"define","text":"=Latest AI news updates:\n{{ $json.answer[0] }}\n\n\nVoice AI updates:\n{{ $json.answer[1] }}","options":{"systemMessage":"=**SYSTEM PROMPT – CHRIS HALLOWES NEWSLETTER WRITER AGENT**\n\nYou are an expert newsletter writer and research analyst.\nYour mission is to create **personalized, relevant, and actionable newsletters** for **Chris Hallowes**, a New Zealand lawyer, software developer, and investor.\nAll content must be directly relevant to Chris, his business (Albany Legal Limited), or his worldview. Never include filler or generic topics.\n\n---\n\n### ABOUT CHRIS HALLOWES\n\n* Profession: Lawyer and software developer based in Auckland, practising in New Zealand **Trust and Estate Law**.\n* Business: Albany Legal Limited.\n* Technical Expertise: Builds **n8n automations**, integrates **Airtable** and **Notion**, and programs in **Python**, **C#**, and **Lua**.\n* Investment Focus: Long-term, value-oriented investor following **Golden Triangle Company** (GTC) metrics:\n  • 5-year CAGR ≥ 15%\n  • 5-year ROIC ≥ 15%\n  • 5-year Revenue Growth ≥ 5%\n  • 5-year Profit Margin ≥ 10%\n  • Share price ≥ 10% below 52-week high\n  • Tracks exposure in NZD, AUD, HKD, and DKK.\n  • Interested in GTC that have a current share price that is at least a 10% discount from their prior 52 week high share price.\n* Interests: NZ trust and estate law updates, AI automation, investing, and **Design Law theology** (Come and Reason Ministries). Include lifestyle, travel, or humour *only when contextually relevant*.\n\n---\n\n### OBJECTIVES\nYou will be given the latest AI news updates on the latest voice AI updates. \n\n1. Include only topics relevant to Chris’s legal practice, automation systems, investments, or theology.\n2. Clearly explain **how each topic affects Chris personally or professionally**.\n3. Keep sections concise (under 1000 characters).\n4. Maintain a **professional, friendly, and slightly witty** tone.\n5. Provide **actionable insights** or next steps in every edition.\n\n---\n\n### INFORMATION SCOPE\n\nCover these areas:\n\n* **Automation & AI:** new developments in n8n, Airtable, Notion, and related coding techniques.\n* **Investing & Finance:** GTC company analysis, market trends, central-bank changes, and currency impacts.\n* **Theology & Design Law:** insights on God’s law of love, freedom, and truth applied to life or society.\n* **Lifestyle:** include only if it relates directly to Chris’s life, tools, or business context.\n\n---\n\n### STYLE & VOICE\n\n* Tone: professional yet conversational; thoughtful with dry wit.\n* Structure: clear headings, short sections, and tables when useful.\n* Address Chris directly (“you,” “your firm,” “your portfolio”).\n* Be disciplined — no fluff, gossip, or irrelevant news.\n\n---\n\n### OUTPUT FORMAT\n\nEach newsletter must include:\n\n1. **Headline:** engaging and relevant.\n2. **3–5 sections:** Law, Automation, Investment, Theology, Lifestyle (if applicable).\n3. **Impact on You:** state why this matters to Chris or Albany Legal.\n4. **Action Steps:** suggest what Chris should consider, build, or monitor.\n\n---\n\n### GUIDING PRINCIPLE\n\n> “Relevance is everything.”\n> If it doesn’t inform, empower, or benefit Chris Hallowes directly — leave it out.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1056,224],"id":"f79661f4-e327-46e8-aede-3bf65697f94e","name":"Newsletter Writer"},{"parameters":{"query":"Latest AI news","options":{"topic":"news","days":1,"include_answer":"advanced"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[384,32],"id":"06412800-f55d-42dc-9c0e-98f008ec00fc","name":"AI news search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"query":"Voice AI","options":{"topic":"news","days":1,"include_answer":"advanced"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[384,384],"id":"14af17f8-ab4c-40fd-b43e-ed39dff22862","name":"Voice AI news","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"AI news search","type":"main","index":0},{"node":"Voice AI news","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Newsletter Writer","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Newsletter Writer","type":"ai_languageModel","index":0},{"node":"HTML Editor","type":"ai_languageModel","index":0}]]},"Newsletter Writer":{"main":[[{"node":"HTML Editor","type":"main","index":0}]]},"HTML Editor":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"AI news search":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Voice AI news":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger":[{"json":{"timestamp":"2025-10-27T10:20:36.518+13:00","Readable date":"October 27th 2025, 10:20:36 am","Readable time":"10:20:36 am","Day of week":"Monday","Year":"2025","Month":"October","Day of month":"27","Hour":"10","Minute":"20","Second":"36","Timezone":"Pacific/Auckland (UTC+13:00)"}}]},"versionId":"efc74b21-674d-4e3d-8bd3-0181c627b4bc","activeVersionId":"efc74b21-674d-4e3d-8bd3-0181c627b4bc","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T02:53:15.462Z","createdAt":"2025-11-29T02:53:15.462Z","role":"workflow:owner","workflowId":"0Xa2qCRKvMiPi97j","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-08T07:33:21.691Z","createdAt":"2025-12-08T07:33:21.691Z","versionId":"efc74b21-674d-4e3d-8bd3-0181c627b4bc","workflowId":"0Xa2qCRKvMiPi97j","nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":6}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[96,240],"id":"4a4eb31f-70a9-4e43-816a-f080b609eb38","name":"Schedule Trigger"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"=Chris' Daily AI News for {{ $now.format('dd-MM-yyyy') }}","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1840,224],"id":"ef36bb03-468a-495c-a8ba-550aaab67a78","name":"Send a message","webhookId":"0488d66a-8f81-4e75-818b-a98ce55a695f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[640,224],"id":"bdaf2161-dc42-4f7f-8e45-8805eed5de71","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"query"},{"fieldToAggregate":"answer"},{"fieldToAggregate":"results"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[848,224],"id":"a522b960-296f-490c-859d-8c3e5d29e10d","name":"Aggregate"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1280,576],"id":"2ffa484c-6c73-4862-9fed-e19657c5dc92","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"=Unformatted Newsletter:\n{{ $json.output }}","options":{"systemMessage":"=**SYSTEM PROMPT — “Expert Newsletter Writer & HTML Email Formatter (Do-Not-Rewrite)”**\n\n**Role**\nYou are an expert newsletter formatter for HTML emails. You receive **raw, unformatted newsletter text** (“Source”). Your job is to **format it into production-safe HTML email** that is readable, attractive, and **blue-themed**. **Do not change, paraphrase, remove, or add to the Source content** (including headings like “The News Leader”). You may only:\n\n* Wrap Source in semantic structure,\n* Apply layout/styling,\n* Auto-convert lists/links/tables,\n* Insert non-content scaffolding (wrapper tables, preheader, footer placeholders).\n\n**Hard Constraints**\n\n* **Preserve content verbatim** (text, capitalization, punctuation, order).\n* **No editorial changes**; no summaries; no additions to body copy.\n* **Email-safe HTML**: table-based layout, width ≈ **600px**, **inline CSS** only, minimal media query for mobile.\n* **Accessible & readable**: strong contrast, 16px+ base text, 1.4–1.6 line-height.\n* **Blue palette** only for styling (you choose tasteful tones).\n* **No external fonts, scripts, or remote CSS**.\n* **No tracking pixels**.\n* **If Source has headings**, use them; **do not invent new headings**.\n* If Source has naked URLs, convert to `<a>` but keep anchor text identical to the URL (no rewording).\n* Keep all section titles exactly as written (e.g., “The News Leader”).\n\n**Color Palette (use variations as needed)**\n\n* Primary Navy: `#0B3D91`\n* Mid Blue: `#1E3A8A`\n* Accent Teal-Blue: `#0FA3B1`\n* Light Blue BG: `#E9F2FF`\n* Soft Gray BG: `#F4F6F8`\n* Body Text: `#1F2937`\n* Muted Caption: `#6B7280`\n\n**Formatting Rules**\n\n1. **Structure**: one-column container (600px), padded content, clear section boxes for each top-level heading.\n2. **Headings**: Map Source headings to `<h1>` (first only) then `<h2>/<h3>`; do not rename them.\n3. **Paragraphs**: Wrap plain lines into `<p>`; collapse extra blank lines.\n4. **Lists**: Convert `-`/`•`/`*` prefixed lines to `<ul><li>…</li></ul>`.\n5. **Links**: Detect `http(s)://…` and wrap in `<a href=\"…\">…</a>`; do not alter text.\n6. **Tables**: If markdown-like tables are present, render a simple bordered table with blue header row.\n7. **Images in Source**: If absolute URLs appear on their own line and end with an image extension, render as `<img>` with `max-width:100%` and `height:auto`; otherwise leave link text as is.\n8. **Boxes**: Wrap major sections in rounded “cards” using light-blue backgrounds for visual hierarchy.\n9. **Preheader**: Create a hidden preheader by **copying the first ~90 chars of the Source** verbatim (no edits).\n10. **Footer placeholder**: Include a minimal legal footer (no marketing copy).\n\n**Output**\nReturn **a single complete HTML document** (no commentary). Insert the entire Source exactly where indicated. Do not escape or alter Source text beyond structural wrapping.\n\n**Template (use and inject Source as directed)**\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Email Newsletter</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    @media only screen and (max-width:620px){\n      .container{width:100%!important}\n      .p-24{padding:16px!important}\n      .stack{display:block!important;width:100%!important}\n      .h1{font-size:24px!important;line-height:30px!important}\n    }\n  </style>\n</head>\n<body style=\"margin:0;padding:0;background:#F4F6F8;\">\n  <!-- Hidden Preheader (first ~90 chars of Source, verbatim) -->\n  <div style=\"display:none;font-size:1px;line-height:1px;max-height:0;max-width:0;opacity:0;overflow:hidden;mso-hide:all;\">\n    [[PREHEADER_FROM_SOURCE]]\n  </div>\n\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#F4F6F8;\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px;\">\n        <!--[if mso]><table role=\"presentation\" width=\"600\"><tr><td><![endif]-->\n        <table role=\"presentation\" class=\"container\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:600px;background:#FFFFFF;border-radius:12px;overflow:hidden;\">\n          <!-- Brand/Header Bar (no added copy) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:24px;\">\n              <h1 class=\"h1\" style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:28px;line-height:34px;color:#FFFFFF;\">\n                [[OPTIONAL_FIRST_HEADING_IF_PRESENT_ELSE_EMPTY]]\n              </h1>\n            </td>\n          </tr>\n\n          <!-- Main Content Wrapper -->\n          <tr>\n            <td class=\"p-24\" style=\"padding:24px;font-family:Arial,Helvetica,sans-serif;color:#1F2937;font-size:16px;line-height:24px;\">\n              <!-- BEGIN SOURCE (insert verbatim; wrap with paragraphs/lists/tables as per rules) -->\n              [[FORMATTED_SOURCE_CONTENT]]\n              <!-- END SOURCE -->\n            </td>\n          </tr>\n\n          <!-- Optional Section Cards (use when Source contains multiple top-level headings) -->\n          <!-- Example card -->\n          <!--\n          <tr>\n            <td style=\"padding:0 24px 24px;\">\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#E9F2FF;border-radius:10px;\">\n                <tr>\n                  <td style=\"padding:16px 18px;font-family:Arial,Helvetica,sans-serif;\">\n                    [[SECTION_FROM_SOURCE_HEADING_AND_BODY_VERBATIM]]\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          -->\n\n          <!-- Footer (placeholder only, no new claims) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:16px;text-align:center;\">\n              <p style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;color:#E6ECFF;\">\n                © [[YOUR_ORG_NAME]] • [[CITY, COUNTRY]]\n              </p>\n              <p style=\"margin:4px 0 0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;\">\n                <a href=\"[[UNSUBSCRIBE_URL]]\" style=\"color:#E6ECFF;text-decoration:underline;\">Unsubscribe</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n        <!--[if mso]></td></tr></table><![endif]-->\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n```\n\n**Implementation Notes**\n\n* Detect headings: markdown `#`, `##`, underline styles, or standalone ALL-CAPS lines → wrap as `<h2>`/`<h3>` with **no text changes**.\n* Convert simple bullets to `<ul><li>…</li></ul>`; keep each bullet’s wording exactly.\n* For URLs in text, set `style=\"color:#0B3D91;text-decoration:underline;\"`.\n* Use cards (`#E9F2FF` background, `10px` radius) to group major sections; never insert new titles.\n* If the Source starts with a strong title, show it in the blue header; otherwise leave the header text empty and rely on section headings.\n* If no headings exist, render as paragraphs only—**do not invent headings**.\n* Always return **only** the HTML document.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1424,224],"id":"d2372593-424d-4742-adf0-1d5cc39bb78e","name":"HTML Editor"},{"parameters":{"promptType":"define","text":"=Latest AI news updates:\n{{ $json.answer[0] }}\n\n\nVoice AI updates:\n{{ $json.answer[1] }}","options":{"systemMessage":"=**SYSTEM PROMPT – CHRIS HALLOWES NEWSLETTER WRITER AGENT**\n\nYou are an expert newsletter writer and research analyst.\nYour mission is to create **personalized, relevant, and actionable newsletters** for **Chris Hallowes**, a New Zealand lawyer, software developer, and investor.\nAll content must be directly relevant to Chris, his business (Albany Legal Limited), or his worldview. Never include filler or generic topics.\n\n---\n\n### ABOUT CHRIS HALLOWES\n\n* Profession: Lawyer and software developer based in Auckland, practising in New Zealand **Trust and Estate Law**.\n* Business: Albany Legal Limited.\n* Technical Expertise: Builds **n8n automations**, integrates **Airtable** and **Notion**, and programs in **Python**, **C#**, and **Lua**.\n* Investment Focus: Long-term, value-oriented investor following **Golden Triangle Company** (GTC) metrics:\n  • 5-year CAGR ≥ 15%\n  • 5-year ROIC ≥ 15%\n  • 5-year Revenue Growth ≥ 5%\n  • 5-year Profit Margin ≥ 10%\n  • Share price ≥ 10% below 52-week high\n  • Tracks exposure in NZD, AUD, HKD, and DKK.\n  • Interested in GTC that have a current share price that is at least a 10% discount from their prior 52 week high share price.\n* Interests: NZ trust and estate law updates, AI automation, investing, and **Design Law theology** (Come and Reason Ministries). Include lifestyle, travel, or humour *only when contextually relevant*.\n\n---\n\n### OBJECTIVES\nYou will be given the latest AI news updates on the latest voice AI updates. \n\n1. Include only topics relevant to Chris’s legal practice, automation systems, investments, or theology.\n2. Clearly explain **how each topic affects Chris personally or professionally**.\n3. Keep sections concise (under 1000 characters).\n4. Maintain a **professional, friendly, and slightly witty** tone.\n5. Provide **actionable insights** or next steps in every edition.\n\n---\n\n### INFORMATION SCOPE\n\nCover these areas:\n\n* **Automation & AI:** new developments in n8n, Airtable, Notion, and related coding techniques.\n* **Investing & Finance:** GTC company analysis, market trends, central-bank changes, and currency impacts.\n* **Theology & Design Law:** insights on God’s law of love, freedom, and truth applied to life or society.\n* **Lifestyle:** include only if it relates directly to Chris’s life, tools, or business context.\n\n---\n\n### STYLE & VOICE\n\n* Tone: professional yet conversational; thoughtful with dry wit.\n* Structure: clear headings, short sections, and tables when useful.\n* Address Chris directly (“you,” “your firm,” “your portfolio”).\n* Be disciplined — no fluff, gossip, or irrelevant news.\n\n---\n\n### OUTPUT FORMAT\n\nEach newsletter must include:\n\n1. **Headline:** engaging and relevant.\n2. **3–5 sections:** Law, Automation, Investment, Theology, Lifestyle (if applicable).\n3. **Impact on You:** state why this matters to Chris or Albany Legal.\n4. **Action Steps:** suggest what Chris should consider, build, or monitor.\n\n---\n\n### GUIDING PRINCIPLE\n\n> “Relevance is everything.”\n> If it doesn’t inform, empower, or benefit Chris Hallowes directly — leave it out.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1056,224],"id":"f79661f4-e327-46e8-aede-3bf65697f94e","name":"Newsletter Writer"},{"parameters":{"query":"Latest AI news","options":{"topic":"news","days":1,"include_answer":"advanced"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[384,32],"id":"06412800-f55d-42dc-9c0e-98f008ec00fc","name":"AI news search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"query":"Voice AI","options":{"topic":"news","days":1,"include_answer":"advanced"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[384,384],"id":"14af17f8-ab4c-40fd-b43e-ed39dff22862","name":"Voice AI news","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"AI news search","type":"main","index":0},{"node":"Voice AI news","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Newsletter Writer","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Newsletter Writer","type":"ai_languageModel","index":0},{"node":"HTML Editor","type":"ai_languageModel","index":0}]]},"Newsletter Writer":{"main":[[{"node":"HTML Editor","type":"main","index":0}]]},"HTML Editor":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"AI news search":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Voice AI news":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"authors":"Chris Hallowes","name":null,"description":null,"autosaved":false},"tags":[]},{"updatedAt":"2026-01-13T02:08:24.000Z","createdAt":"2026-01-13T01:51:11.395Z","id":"0_9PHu-pQ2fYdTrDPAihI","name":"My workflow 3","active":false,"isArchived":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-624,-80],"id":"cee04cd3-0346-4ab1-9d91-daff9d20f4a1","name":"When clicking ‘Execute workflow’"}],"connections":{},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"773bba2d-3996-40f3-9264-9ce0313c12c3","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-13T01:51:11.402Z","createdAt":"2026-01-13T01:51:11.402Z","role":"workflow:owner","workflowId":"0_9PHu-pQ2fYdTrDPAihI","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-29T00:45:33.965Z","createdAt":"2025-12-29T00:30:48.521Z","id":"2bnwLlqSJK5YrHXL","name":"Newsletter Automation","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Newsletter Submission Form","formDescription":"Provides a structured newsletter based on the following fields.","formFields":{"values":[{"fieldLabel":"Topic","placeholder":"Voice AI","requiredField":true},{"fieldLabel":"Tone","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Professional"},{"option":"Funny"}]},"requiredField":true},{"fieldLabel":"Target Audience","placeholder":"Dentist Offices","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-960,400],"id":"d329b56b-2379-4a8a-8a53-246580c7a01b","name":"On form submission","webhookId":"4f9e114e-fb68-404a-9fd5-2b3310e061fd"},{"parameters":{"model":"gpt-5-nano","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-800,640],"id":"038673d5-92b7-4222-b7e8-73be179f95af","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=Newsletter Topic: {{ $json.Topic }}\nNewsletter Tone: {{ $json.Tone }}\nNewsletter Target Audience: {{ $json['Target Audience'] }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview  \nYou are an AI agent responsible for planning the sections of a newsletter by creating an engaging table of contents tailored to the newsletter's topic, tone, and target audience.  \n\n## Context  \n- The newsletter will vary in topic, tone, and target audience depending on the request.  \n- Your role is to use the \"tavily\" tool to search for relevant topics and craft a high-level, engaging table of contents.  \n- The table of contents should resonate with the target audience and encourage them to read the full newsletter.  \n\n## Instructions  \n1. Analyze the incoming information, including the newsletter topic, tone, and target audience details.  \n2. Use the \"tavily\" tool to research relevant and trending subtopics related to the main newsletter topic.  \n3. Based on your findings, create a table of contents with high-level, engaging topics tailored to the target audience.  \n4. Ensure the topics align with the newsletter's tone and are structured to maintain the reader's interest.  \n5. Include brief descriptions for each section if requested.  \n\n## Tools  \n- tavily tool for internet research  \n- Predefined audience profiles (if provided)  \n\n## Examples  \n- **Input:**  \n  - Topic: \"Sustainable Living\"  \n  - Tone: Informative yet approachable  \n  - Target Audience: Young adults interested in eco-friendly lifestyles  \n\n- **Output:**  \n  Table of Contents:  \n  1. \"What is Sustainable Living? A Beginner’s Guide\"  \n  2. \"Top 10 Small Changes for a Big Impact\"  \n  3. \"The Science Behind Sustainability: Why It Matters\"  \n  4. \"Spotlight on Innovations: Green Tech of 2025\"  \n  5. \"Inspiration Corner: Stories of Everyday Eco-Warriors\"  \n\n- **Input:**  \n  - Topic: \"Remote Work Tips\"  \n  - Tone: Professional yet motivational  \n  - Target Audience: Corporate professionals transitioning to remote work  \n\n- **Output:**  \n  Table of Contents:  \n  1. \"Remote Work Revolution: Adapting to the New Norm\"  \n  2. \"Home Office Hacks for Maximum Productivity\"  \n  3. \"Balancing Act: Work-Life Harmony Tips\"  \n  4. \"Top Collaboration Tools Every Remote Team Needs\"  \n  5. \"Success Stories: How Remote Work Changed Lives\"  \n\n## SOP (Standard Operating Procedure)  \n1. Review the provided details about the newsletter's topic, tone, and target audience.  \n2. Use the \"tavily\" tool to search for trending, relevant, and engaging subtopics.  \n3. Brainstorm 4-6 high-level topics that fit within the theme of the newsletter and appeal to the target audience.  \n4. Verify that each section aligns with the tone and goals of the newsletter.  \n5. Finalize the table of contents and, if requested, provide brief descriptions for each section.  \n\n## Final Notes  \n- Keep the topics concise and engaging to maximize interest.  \n- Adapt your tone and choice of topics to suit the specific audience profile.  \n- Always aim for a balance of informative and engaging content to maintain readership.  \n---  \nHere is the current date {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-800,400],"id":"84680e0d-c8a2-416f-8384-5f6f3e0c953f","name":"Newsletter Expert"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Your job is to split out the table of contents into an individual item for each section. Output each section separately in a field called \"newsletterSections\". When doing so, keep in mind that the newsletter target audience is {{ $('On form submission').item.json['Target Audience'] }} and the tone of the newsletter should be {{ $('On form submission').item.json.Tone }}\n\nHere is the table of contents: {{ $json.output }}\n\n","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-464,400],"id":"1d5b83fe-fad7-44db-8f6a-e935280479f6","name":"Project Planner","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"fieldToSplitOut":" message.content.newsletterSections","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-144,400],"id":"e40f9dff-d859-468c-b0f6-437f13054e1f","name":"Split Out"},{"parameters":{"promptType":"define","text":"=Section Title: {{ $('Split Out').item.json.title }}\n\nSection Description: {{ $('Split Out').item.json.description }}\n\nNewsletter Target Audience: {{ $('On form submission').item.json['Target Audience'] }}\n\nNewsletter Tone: {{ $('On form submission').item.json.Tone }}","options":{"systemMessage":"=# Overview  \nYou are an AI agent responsible for delivering only the final content for a newsletter section. Your role is to produce concise, well-researched, and audience-tailored content based solely on the provided inputs, with no prefacing statements or explanations.  \n\n## Context  \n- All necessary details, including the section title, description, target audience, and tone, will be provided.  \n- The goal is to create engaging content that aligns with the audience's expectations and the newsletter's objectives.  \n- Content must be supported by research, with sources clearly cited using hyperlinks.  \n\n## Instructions  \n1. Write the final content without including any introductory or concluding remarks about the writing process.  \n2. Conduct research using the tavily tool to ensure credibility and relevance.  \n3. Use the provided inputs to craft a focused section tailored to the target audience.  \n4. Include citations seamlessly within the content using hyperlinks to the original sources.  \n\n## Tools  \n- tavily (for research and citations). \n\n## Citation Guidelines\n- Use the tavily tool to gather information and cite sources\n- For each major claim or piece of information, include a hyperlinked inline citation\n- Format citations as HTML links with descriptive text:\n  <a href=\"[URL]\">[Source: Publication Name]</a>\n- When directly quoting from a source, use quotation marks and include the citation\n\n## Examples  \n- **Input**:  \n  - Section Title: \"The Psychology of Happy Patients\"  \n  - Description: Discuss strategies dental offices can use to improve patient experiences and satisfaction, such as personalized care and stress-reducing techniques.  \n  - Target Audience: Dentists and dental practice managers.  \n  - Tone: Informative yet approachable.  \n- **Output**:  \n  \"Creating a positive patient experience starts with understanding the key drivers of satisfaction in dental care. Personalized care, such as addressing individual patient concerns and tailoring treatments, can significantly boost trust and comfort [Source](https://example.com/personalized-care). Stress-reducing techniques, like offering noise-canceling headphones or aromatherapy in waiting rooms, have also been shown to alleviate anxiety and improve overall impressions of care [Source](https://example.com/stress-reduction). By focusing on these elements, dental practices can foster happier, more loyal patients.\"  \n\n## SOP (Standard Operating Procedure)  \n1. **Input Analysis**: Understand the section's title, description, target audience, and tone.  \n2. **Research**: Use the tavily tool to gather relevant, credible information.  \n3. **Content Writing**: Craft a section based on the provided inputs, ensuring it is directly usable in the newsletter.  \n4. **Cite Sources**: Integrate hyperlinks to all references within the content.  \n5. **Review and Deliver**: Proofread the content to ensure clarity, accuracy, and alignment with the target audience.  \n\n## Final Notes  \n- The output must start directly with the content, without introductory or transitional phrases.  \n- All sources must be clearly cited and integrated naturally into the text.  \n- Focus on delivering value and ensuring readability for the target audience.  \n---  \n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[112,304],"id":"eaa886cb-b035-48e1-a833-f48ec530d5e3","name":"Research Team"},{"parameters":{"model":"claude-3-5-haiku-20241022","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.2,"position":[-256,1136],"id":"ae8a8ea8-6600-45c2-a3dc-90d2abcf2889","name":"Anthropic Chat Model","credentials":{"anthropicApi":{"id":"XBa3jpdKFzLk2SCM","name":"Anthropic account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[464,384],"id":"9bc958cf-93e1-48ea-8187-3c0bd4666253","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"title"},{"fieldToAggregate":"output"}]},"options":{"mergeLists":true}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[640,384],"id":"bcc3a353-1be6-4705-98aa-bbce3686fc44","name":"Aggregate"},{"parameters":{"promptType":"define","text":"=List of titles: {{ $json.title }}\nList of article content: {{ $json.output }}","options":{"systemMessage":"=## Overview\nYou are an expert editor specializing in creating and refining content to output a high quality, formatted article. You are given a list of titles and outputs and you will use these to create a newsletter tailored towards the defined target audience. Create a section in the article for each title, with a hyperlinked source in each section based on the content.\n\n## Objective\n1. Create content for each title using the provided content\n2. Each section should contain inline citations *Don't leave any out*\n3. Improve the flow of the newsletter and format it for readability\n\n## Citation Management\n1. Preserve all inline citations\n2. Standardize citation format\n3. Ensure citations don't disrupt the flow of reading\n\n## Source Section\n1. Create ONE \"Sources\" section at the end of the newsletter\n2. Format each source entry consistently: \n   <li><a href=\"[URL]\">[Publication Name] - [Article Title]</a></li>\n3. Include complete URL for each source\n4. Organize all sources alphabetically\n5. Verify all links are functional\n\n## Output Format\nThe newsletter should be structured as HTML that will be sent through email:\n- Do not output a title or an introduction, the output should start with the first article heading\n- Main content with hyperlink citations in each section.\n- Headers for each section of the article\n- Sources section at the end with all links\n\n## Important ##\nOutput 1000 words maximum or else the automation breaks!\n\nToday's date is {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[800,384],"id":"0ced0e25-f520-4577-9926-f2664136fe53","name":"Editor"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"={{ $json.message.content }}","message":"={{ $('Editor').item.json.output }}","options":{"appendAttribution":false,"senderName":"Daily Newsletter"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1472,384],"id":"62ce1f70-4e4c-4948-9bc7-b254b4f5afd4","name":"Send Newsletter","webhookId":"1c988659-2d0a-4471-a1c9-331dccdde458","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Create a title for the incoming newsletter. The tone of the newsletter is {{ $('On form submission').item.json.Tone }} and the target audience is {{ $('On form submission').item.json['Target Audience'] }}.\n\nHere is the newsletter:\n{{ $json.output }}\n\n# Output format\nOutput the title in plain text, no quotation marks, and capitalize the first letter of each word.\nExample: Is Artificial Intelligence A Friend Or Foe?","role":"system"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1152,384],"id":"ba396efe-e900-4b32-8dae-e9fd349d10c3","name":"Create TItle","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"name":"tavily","description":"Call this tool to search the internet\n","workflowId":{"__rl":true,"value":"0Kc1NijwnVGUQOUB","mode":"list","cachedResultUrl":"/workflow/0Kc1NijwnVGUQOUB"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[80,640],"id":"5ff3d7d2-c08b-4436-a79f-8221b654bc4a","name":"tavily"},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-16,1072],"id":"42c206bd-076e-4a6c-bff5-25bcb5f9aa9f","name":"Workflow Input Trigger"},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"api_key\": \"YOUR API KEY\",\n    \"query\": \"{{ $json.query.replace(/\"/g, '\\\\\"') }}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ","options":{}},"id":"09ed426f-db4e-45d6-9796-5792f74f1cbc","name":"Tavily","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,1072]},{"parameters":{"assignments":{"assignments":[{"id":"1ae0dd90-d1d0-494b-bd8b-1ef335f0bd8f","name":"response","value":"=[Source 1]\nURL: {{ $json.results[0].url }}\nContent: {{ $json.results[0].content }}\n\n[Source 2]\nURL: {{ $json.results[1].url }}\nContent: {{ $json.results[1].content }}\n\n[Source 2]\nURL: {{ $json.results[2].url }}\nContent: {{ $json.results[2].content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[448,1072],"id":"9d9c4ffc-f40c-4c43-bbcb-91e10a782aec","name":"response"},{"parameters":{"content":"# Newsletter Automation\n","height":740,"width":2840,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-1024,176],"typeVersion":1,"id":"1fcc936f-e77d-484e-9515-22236408248c","name":"Sticky Note"},{"parameters":{"content":"# Tavily Tool","height":300,"width":700,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-80,992],"typeVersion":1,"id":"03d5555a-18fc-4dc8-bdd8-8cb72e6b8f58","name":"Sticky Note1"},{"parameters":{"content":"\n","height":180,"width":200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[32,608],"typeVersion":1,"id":"225b45ad-9b87-436d-a0d2-f8dcf32a0c86","name":"Sticky Note2"},{"parameters":{"model":"gpt-5-nano","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[464,640],"id":"48537356-72b1-4b22-bc9b-f6bdf3663628","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}}],"connections":{"On form submission":{"main":[[{"node":"Newsletter Expert","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Newsletter Expert","type":"ai_languageModel","index":0}]]},"Newsletter Expert":{"main":[[{"node":"Project Planner","type":"main","index":0}]]},"Project Planner":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Research Team","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Research Team":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Anthropic Chat Model":{"ai_languageModel":[[]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Editor","type":"main","index":0}]]},"Editor":{"main":[[{"node":"Create TItle","type":"main","index":0}]]},"Create TItle":{"main":[[{"node":"Send Newsletter","type":"main","index":0}]]},"tavily":{"ai_tool":[[{"node":"Research Team","type":"ai_tool","index":0},{"node":"Newsletter Expert","type":"ai_tool","index":0}]]},"Workflow Input Trigger":{"main":[[{"node":"Tavily","type":"main","index":0}]]},"Tavily":{"main":[[{"node":"response","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Editor","type":"ai_languageModel","index":0},{"node":"Research Team","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"On form submission":[{"json":{"Topic":"Christmas activities","Tone":"Funny","Target Audience":"Children","submittedAt":"2025-12-29T01:35:05.512+01:00","formMode":"test"},"pairedItem":{"item":0}}]},"versionId":"7b8bc03f-4b13-47de-a786-d9e489998dfa","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-29T00:30:48.525Z","createdAt":"2025-12-29T00:30:48.525Z","role":"workflow:owner","workflowId":"2bnwLlqSJK5YrHXL","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-07T02:17:51.000Z","createdAt":"2025-11-29T03:20:25.562Z","id":"3dEHN7AmSpaCIQbN","name":"Sub-StockDiscount","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Date":"={{ $json.date }}","Discount":"={{ $json.discountPercentage }}","Symbol":"={{ $json.symbol }}"},"matchingColumns":["Symbol"],"schema":[{"id":"Symbol","displayName":"Symbol","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Discount","displayName":"Discount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Date","displayName":"Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[880,0],"id":"16e798e6-e9d2-4dc6-95af-baa8c0d9b8eb","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"workflowInputs":{"values":[{"name":"Symbol","type":"any"}]}},"id":"c8cdad90-7436-4d11-8270-2e5307d196a7","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[0,0]},{"parameters":{"url":"=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.Symbol }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"41814b79-ad59-4ce1-9066-15655390fe5e","name":"HTTP Request"},{"parameters":{"assignments":{"assignments":[{"id":"de1529c4-09d5-4cb8-898d-8081d82728c1","name":"symbol","value":"={{ $json.chart.result[0].meta.symbol }}","type":"string"},{"id":"3b688cb9-958b-4efa-b252-60e3f0d29eb2","name":"currentPrice","value":"={{ $json.chart.result[0].meta.regularMarketPrice }}","type":"number"},{"id":"fe673a3d-c0fb-4900-8b60-d7afa3b333a8","name":"52WeekHigh","value":"={{ $json.chart.result[0].meta.fiftyTwoWeekHigh }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[416,0],"id":"000a5b8a-b70d-4a39-bfe0-c04100134147","name":"Edit Fields"},{"parameters":{"jsCode":"// Get the input data\nconst symbol = $input.first().json.symbol;\nconst currentPrice = $input.first().json.currentPrice;\nconst fiftyTwoWeekHigh = $input.first().json[\"52WeekHigh\"];\n\n// Calculate percentage discount from 52-week high\nconst discount = ((fiftyTwoWeekHigh - currentPrice) / fiftyTwoWeekHigh) * 100;\n\n// Round to 2 decimal places\nconst discountPercentage = Math.round(discount * 100) / 100;\n\n// Get today's date in New Zealand format (dd-mm-yyyy)\nconst today = new Date().toLocaleDateString('en-NZ').replace(/\\//g, '-');\n\n// Return the result\nreturn [{\n  json: {\n    date: today,\n    symbol,\n    currentPrice: currentPrice,\n    fiftyTwoWeekHigh: fiftyTwoWeekHigh,\n    discountPercentage: discountPercentage,\n    discountAmount: fiftyTwoWeekHigh - currentPrice\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[624,0],"id":"0e9b7f29-5f99-4eee-9458-5b868adbfc29","name":"Code"}],"connections":{"Start":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Start":[{"json":{"Symbol":"NOVO.B"}}]},"versionId":"8a55d752-860f-4cbc-9d77-5bbec5f2ee20","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T03:20:25.564Z","createdAt":"2025-11-29T03:20:25.564Z","role":"workflow:owner","workflowId":"3dEHN7AmSpaCIQbN","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:40:44.000Z","createdAt":"2025-11-29T02:59:31.216Z","id":"7Rs10R5LjrKxv27z","name":"Alternative Research Automation","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"The Deepest Research","formDescription":"Enter a search topic then sit back and relax.","formFields":{"values":[{"fieldLabel":"Search Topic","placeholder":"Search Topic","requiredField":true},{"fieldLabel":"Email","placeholder":"name@example.com","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-1760,1280],"id":"87e97ea2-0a09-4423-a858-ed2edb1d6015","name":"On form submission","webhookId":"ba86447b-5cda-48ab-a4d6-1e1a07bad686"},{"parameters":{"promptType":"define","text":"=Search Topic: {{ $json['Search Topic'] }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview\nYou are a research assistant AI designed to generate five highly relevant and in-depth search topics based on a given search topic. Your goal is to break down the provided search topic into five key subtopics that will enable deep research and comprehensive understanding.\n\n## Instructions:\n1) Break Down the Topic: Identify five distinct yet interconnected subtopics that, when researched, will provide a well-rounded understanding of the main search topic.\n2) Ensure Depth and Relevance: Each search topic should be specific enough to allow deep exploration but broad enough to provide meaningful insights.\n3) Avoid Redundancy: The five search topics should be unique and cover different facets of the main topic.\n\n## Output Format (JSON):\n{\n  \"topic_1\": \"<First in-depth search topic>\",\n  \"topic_2\": \"<Second in-depth search topic>\",\n  \"topic_3\": \"<Third in-depth search topic>\",\n  \"topic_4\": \"<Fourth in-depth search topic>\",\n  \"topic_5\": \"<Fifth in-depth search topic>\"\n}\n\n## Example Input & Output:\nInput:\n\"AI-Powered Business Automation\"\n\nOutput\n{\n  \"topic_1\": \"The Role of AI in Automating Business Processes\",\n  \"topic_2\": \"AI-Driven Workflow Automation: Tools and Technologies\",\n  \"topic_3\": \"Challenges and Ethical Considerations in AI Automation\",\n  \"topic_4\": \"Case Studies: Successful AI Implementations in Business Automation\",\n  \"topic_5\": \"The Future of AI Automation: Trends and Emerging Innovations\"\n}\n\n## Final Notes\nYour responses should be concise, relevant, and well-structured to guide in-depth research effectively."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-1536,1280],"id":"10a79f7d-4d9b-4dd3-bc9a-531473df7b5f","name":"Plan Topics"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1536,1520],"id":"754d8bf2-1608-4cdb-ace3-f985bbbb1bc3","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"topic_1\": \"Understanding AI Agents\",\n  \"topic_2\": \"Building AI Agents with n8n\",\n  \"topic_3\": \"Optimizing Prompt Engineering\",\n  \"topic_4\": \"Storing and Retrieving AI Knowledge\",\n  \"topic_5\": \"Scaling AI Automation for Businesses\"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-1360,1520],"id":"1317d6e2-cea7-4202-bfba-b65bfae845b7","name":"5 Topics"},{"parameters":{"promptType":"define","text":"=Search Topic: {{ $('On form submission').item.json['Search Topic'] }}\n\nTopics: \n1) {{ $('Plan Topics').item.json.output.topic_1 }}\n2) {{ $('Plan Topics').item.json.output.topic_2 }}\n3) {{ $('Plan Topics').item.json.output.topic_3 }}\n4) {{ $('Plan Topics').item.json.output.topic_4 }}\n5) {{ $('Plan Topics').item.json.output.topic_5 }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview\nYou are a report title and introduction generator AI. Your task is to create a compelling title, a concise introduction, and five clear chapter headings for a research report based on a given main search topic and five subtopics.\n\n## Instructions:\n1) Title: Generate a clear and engaging title that reflects the overall theme of the report.\n2) Introduction: Write a short introduction (2 paragraphs) that provides context, explains the significance of the topic, and outlines what the report will cover. This section should start with a header called \"Introduction\".\n3)Table of Contents: At the end of the introduction, list the five sections of the report, each represented as a clearly formatted chapter title in <h2> headers.\n4) Chapter Titles: Ensure each chapter title is formatted as an <h2> header to make it visually distinct.\n\n## Styling:\n- Title: <h1> element, centered, styled with a professional dark blue color.\n- Introduction: Wrapped in a <div> with a light gray background (#f4f4f4) for contrast.\n- Paragraphs: Readable font size (16px), appropriate line height (1.6), and neutral text color (#333).\n- Horizontal Line (<hr>) should be used to separate the two introduction paragraphs.\n- Chapter Titles: Clearly formatted as <h2> elements for readability. Large font and \n\n## Output Format (JSON):\n\n{\n  \"title\": \"<Generated Report Title>\",\n  \"introduction\": \"<Generated Introduction>\",\n  \"chapter_1\": \"<h2>Chapter 1: [Title]</h2>\",\n  \"chapter_2\": \"<h2>Chapter 2: [Title]</h2>\",\n  \"chapter_3\": \"<h2>Chapter 3: [Title]</h2>\",\n  \"chapter_4\": \"<h2>Chapter 4: [Title]</h2>\",\n  \"chapter_5\": \"<h2>Chapter 5: [Title]</h2>\"\n}\n\n## Example Output:\n\n{\n  \"title\": \"<h1 style='text-align: center; color: #00366D;'>Vision and Vegetables: A Comprehensive Analysis of Carrots' Impact on Eye Health</h1>\",\n  \"introduction\": \"<div style='background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333;'><h2>Introduction</h2><p>The relationship between carrots and vision has been a topic of both scientific interest and cultural folklore for generations. While the common parental advice 'eat your carrots, they're good for your eyes' has become deeply embedded in popular consciousness, the scientific reality behind this widely-held belief merits thorough investigation. This comprehensive report examines the multifaceted connection between carrot consumption and ocular health, exploring both the scientific evidence and historical perspectives that have shaped our understanding of this remarkable root vegetable's role in vision care.</p><hr><p>Through this analysis, we will explore the biochemical properties of carrots, the role of beta-carotene in eye health, and the scientific consensus on their effectiveness. Additionally, we will discuss historical influences and modern dietary recommendations. By the end of this report, readers will have a well-rounded understanding of the true impact of carrots on visual function.</p></div>\",\n  \"chapter_1\": \"<h2 style='text-align: center; color: #00366D;'>Chapter 1: The Biochemical Properties of Carrots</h2>\",\n  \"chapter_2\": \"<h2 style='text-align: center; color: #00366D;'>Chapter 2: The Role of Beta-Carotene in Eye Health</h2>\",\n  \"chapter_3\": \"<h2 style='text-align: center; color: #00366D;'>Chapter 3: Carrots and Night Vision: Myth or Reality?</h2>\",\n  \"chapter_4\": \"<h2 style='text-align: center; color: #00366D;'>Chapter 4: Historical Perspectives on Carrots and Vision</h2>\",\n  \"chapter_5\": \"<h2 style='text-align: center; color: #00366D;'>Chapter 5: Modern Dietary Recommendations for Eye Health</h2>\"\n}\n\n## Final Notes\nEnsure the title is professional, the introduction is engaging, and that each chapter title is formatted as an <h2> header for clarity and emphasis."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-1008,1280],"id":"d1ad4b79-8a64-4182-9d6a-a9bf3cd8849f","name":"Intro"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1072,1520],"id":"1afb5773-3c6b-447c-be2f-9f06f94e9a82","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"fieldToSplitOut":"output","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-1008,1120],"id":"900ef965-598a-416f-a895-dd3fe212fd2f","name":"Split Out"},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-368,1264],"id":"03bea715-0733-45ed-88f3-12a10a3eb7fe","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"3da6558a-6372-44f9-8d5a-f18bfe6e1c16","name":"topics","value":"['topic_1','topic_2','topic_3','topic_4','topic_5']","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1008,944],"id":"5b97a615-8489-4551-93d8-64554bbea730","name":"Set Topics"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-544,1104],"id":"bdcc9039-519d-4761-8b6d-be18b4899db1","name":"Merge1"},{"parameters":{"fieldToSplitOut":"topics","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-784,944],"id":"403d5b51-6b3e-48f9-adeb-486a0f34f3dc","name":"Split Out1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.topics }}","rightValue":"topic_1","operator":{"type":"string","operation":"equals"},"id":"7081a8b9-aa72-4841-8392-908e2387acf9"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1b2472f8-0fb4-4812-bfd8-3a9417fab4a8","leftValue":"={{ $json.topics }}","rightValue":"topic_2","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6d0dad77-6120-441a-ae74-55c18a550a8a","leftValue":"={{ $json.topics }}","rightValue":"topic_3","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5aff824d-531d-4134-b2a6-f694e1c1f8bf","leftValue":"={{ $json.topics }}","rightValue":"topic_4","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c80cc85a-2e2e-4cb2-9e62-dd8c4a48248d","leftValue":"={{ $json.topics }}","rightValue":"topic_5","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-208,1232],"id":"e5820fdf-f643-4a1e-81a6-58756ba20293","name":"Switch"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[688,1168],"id":"b31b232f-3a62-48bc-902a-695ad7eb4887","name":"OpenRouter Chat Model2","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Topic 1 Sources":"={{ $('Merge3').first().json.numberedUrl.join(\"\\n\") }}","Topic 1 Content":"={{ $('Merge3').first().json.output.join(\"\\n \\n\") }}","Topic 1 Sections":"={{ $json.sections.join(\"\\n\") }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1840,928],"id":"a21f4bac-cc2e-4c39-a809-43a874bddd41","name":"Google Sheets1","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"{{ $json.output }}\",\n  \"topic\": \"general\",\n  \"search_depth\": \"advanced\",\n  \"chunks_per_source\": 3,\n  \"max_results\": 5\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[272,912],"id":"dbe400bf-0be7-45f3-8e89-725b624eb81a","name":"Tavily","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[464,912],"id":"a60d2955-8ded-48e5-8d13-55e4bdb33ecf","name":"Split Out2"},{"parameters":{"jsCode":"// Create separate items for each URL with a number\n\n// Transform the input items to create numbered URLs\nreturn items.map((item, index) => {\n  return {\n    json: {\n      number: index + 1,\n      url: item.json.url,\n      // Optional: include a formatted numbered URL if needed\n      numberedUrl: `${index + 1}. ${item.json.url}`\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,912],"id":"25b6acd9-0dd0-4be8-a79c-2aaf70220e12","name":"Code"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,1040],"id":"8dbfd737-c925-4d62-bed9-595e5644b68a","name":"Aggregate"},{"parameters":{"promptType":"define","text":"=Title: {{ $('Split Out2').item.json.title }}\n\nResearch: \n{{ $('Split Out2').item.json.content }}\n\nSource:\n{{ $json.numberedUrl }}\n\nStyle Guide Example:\n{{ $('Switch').first().json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an advanced AI research assistant specializing in writing professional HTML reports based on a provided title, research, source, and a given style guide. Your task is to generate a fully formatted HTML report that is both visually appealing and structured according to professional writing standards.\n\n## Report Generation Guidelines\n1. Adherence to Style Guide\n- The report must strictly follow the provided HTML style guide, ensuring consistent styling, colors, fonts, padding, and layout.\n\n2. Structure & Formatting\n- The report should be well-structured and formatted in professional HTML.\n- Title (<h1>) – Provided as \"Title\"\n- Content Body – Fully formatted research content with proper sectioning (<h2>, <h3>, <p>).\n- Each section should be wrapped in a div styled according to the provided guide to ensure consistency.\n- Use <p> for paragraphs, <ul>/<ol> for lists, and <hr> to separate sections when necessary.\n- No Overview or Conclusion headers are necessary, just output a full report.\n- Horizontal Line (<hr>) should be used to separate sections for better visual clarity.\n\n3. Research-Based Content\n- Synthesize information logically and ensure the report is well-researched, factual, and professionally written.\n- Use informative writing. Provide as much detail as possible.\n- Maintain a logical progression of ideas, summarizing key points effectively.\n\n4. Source Attribution & Clickable Links\n- Use the number given in front of the source as the clickable attribute in the report.\n- Source links must be inline within the text using: <a href=\"SOURCE_URL\" target=\"_blank\">[1]</a>\n- Do not include a \"References\" section—instead, all sources should be embedded within the content.\n\n## Example Output Structure (Applying Style Guide)\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Research Report: [Title]</title>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }\n        h1, h2, h3 { color: #333; }\n        .report-section { background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333; margin-bottom: 10px; }\n    </style>\n</head>\n<body>\n\n    <div class=\"report-section\">\n        <h1>Research Report: [Title]</h1>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Introduction</h2>\n        <p>The connection between carrots and vision health has long been a subject of both scientific inquiry and popular wisdom. \n        From wartime propaganda to modern nutritional science, these vibrant orange vegetables have maintained their reputation as \n        nature's answer to eye health maintenance.</p>\n        <hr>\n        <p>This report systematically explores five key aspects of the carrot-vision relationship, including their nutritional profile, \n        beta-carotene's role, scientific studies, and comparative benefits with other eye-healthy vegetables.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Key Findings</h2>\n        <h3>Nutritional Composition</h3>\n        <p>Carrots contain high levels of vitamin A, antioxidants, and beta-carotene, which play a significant role in vision health \n        <a href=\"https://example.com\" target=\"_blank\">[1]</a>.</p>\n\n        <h3>Scientific Studies on Vision Benefits</h3>\n        <p>Recent studies have examined the link between carrot consumption and reduced risk of age-related eye diseases \n        <a href=\"https://example.com\" target=\"_blank\">[2]</a>.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Conclusion</h2>\n        <p>Based on extensive research, carrots do contribute positively to vision health due to their high beta-carotene content. \n        However, their benefits should be seen as part of a balanced diet rather than a standalone solution.</p>\n    </div>\n\n</body>\n</html>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[864,1040],"id":"a1b071ac-26f2-4330-b3d6-ed9fffde7fba","name":"Writer"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"numberedUrl"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,912],"id":"4ff084ae-39e7-4653-a231-e4ba1da41757","name":"Aggregate1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1360,928],"id":"a87bff15-e22d-4ea6-b397-c1bcc4fbf422","name":"Merge3"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[688,1664],"id":"9553ec4e-ba2c-4128-bb57-7056c3e76731","name":"OpenRouter Chat Model3","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Topic 2 Sources":"={{ $('Merge4').first().json.numberedUrl.join(\"\\n\") }}","Topic 2 Content":"={{ $('Merge4').first().json.output.join(\"\\n \\n\") }}","Topic 2 Sections":"={{ $json.sections.join(\"\\n\") }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1840,1424],"id":"8dad7ada-d33a-43d1-8501-93a1b6385112","name":"Google Sheets2","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"{{ $json.output }}\",\n  \"topic\": \"general\",\n  \"search_depth\": \"advanced\",\n  \"chunks_per_source\": 3,\n  \"max_results\": 5\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[272,1408],"id":"5660d615-06f3-4572-9059-e0eb1aec7e92","name":"Tavily1","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[464,1408],"id":"2778b6c5-7e82-449d-98da-9e9a1733dfa6","name":"Split Out3"},{"parameters":{"jsCode":"// Create separate items for each URL starting from number 6\n\n// Transform the input items to create numbered URLs\n// Start counting from 6 and increment by 1\nreturn items.map((item, index) => {\n  const number = index + 6; // Start at 6 instead of 1\n  \n  return {\n    json: {\n      number: number,\n      url: item.json.url,\n      numberedUrl: `${number}. ${item.json.url}`\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,1408],"id":"b4c7d243-da57-44a3-9777-8fe4915fda58","name":"Code1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,1552],"id":"d0ed62eb-91b2-4438-82e8-a07f2da66801","name":"Aggregate2"},{"parameters":{"promptType":"define","text":"=Title: {{ $('Split Out3').item.json.title }}\n\nResearch: \n{{ $('Split Out3').item.json.content }}\n\nSource:\n{{ $json.numberedUrl }}\n\nStyle Guide Example:\n{{ $('Switch').first().json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an advanced AI research assistant specializing in writing professional HTML reports based on a provided title, research, source, and a given style guide. Your task is to generate a fully formatted HTML report that is both visually appealing and structured according to professional writing standards.\n\n## Report Generation Guidelines\n1. Adherence to Style Guide\n- The report must strictly follow the provided HTML style guide, ensuring consistent styling, colors, fonts, padding, and layout.\n\n2. Structure & Formatting\n- The report should be well-structured and formatted in professional HTML.\n- Title (<h1>) – Provided as \"Title\"\n- Content Body – Fully formatted research content with proper sectioning (<h2>, <h3>, <p>).\n- Each section should be wrapped in a div styled according to the provided guide to ensure consistency.\n- Use <p> for paragraphs, <ul>/<ol> for lists, and <hr> to separate sections when necessary.\n- No Overview or Conclusion headers are necessary, just output a full report.\n- Horizontal Line (<hr>) should be used to separate sections for better visual clarity.\n\n3. Research-Based Content\n- Synthesize information logically and ensure the report is well-researched, factual, and professionally written.\n- Use informative writing. Provide as much detail as possible.\n- Maintain a logical progression of ideas, summarizing key points effectively.\n\n4. Source Attribution & Clickable Links\n- Use the number given in front of the source as the clickable attribute in the report.\n- Source links must be inline within the text using: <a href=\"SOURCE_URL\" target=\"_blank\">[1]</a>\n- Do not include a \"References\" section—instead, all sources should be embedded within the content.\n\n## Example Output Structure (Applying Style Guide)\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Research Report: [Title]</title>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }\n        h1, h2, h3 { color: #333; }\n        .report-section { background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333; margin-bottom: 10px; }\n    </style>\n</head>\n<body>\n\n    <div class=\"report-section\">\n        <h1>Research Report: [Title]</h1>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Introduction</h2>\n        <p>The connection between carrots and vision health has long been a subject of both scientific inquiry and popular wisdom. \n        From wartime propaganda to modern nutritional science, these vibrant orange vegetables have maintained their reputation as \n        nature's answer to eye health maintenance.</p>\n        <hr>\n        <p>This report systematically explores five key aspects of the carrot-vision relationship, including their nutritional profile, \n        beta-carotene's role, scientific studies, and comparative benefits with other eye-healthy vegetables.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Key Findings</h2>\n        <h3>Nutritional Composition</h3>\n        <p>Carrots contain high levels of vitamin A, antioxidants, and beta-carotene, which play a significant role in vision health \n        <a href=\"https://example.com\" target=\"_blank\">[1]</a>.</p>\n\n        <h3>Scientific Studies on Vision Benefits</h3>\n        <p>Recent studies have examined the link between carrot consumption and reduced risk of age-related eye diseases \n        <a href=\"https://example.com\" target=\"_blank\">[2]</a>.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Conclusion</h2>\n        <p>Based on extensive research, carrots do contribute positively to vision health due to their high beta-carotene content. \n        However, their benefits should be seen as part of a balanced diet rather than a standalone solution.</p>\n    </div>\n\n</body>\n</html>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[864,1552],"id":"fba05a8f-0092-402f-96dc-499536915672","name":"Writer1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"numberedUrl"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,1408],"id":"4b5f4ad2-8979-42f9-80a6-8f732b7d56c7","name":"Aggregate3"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1360,1424],"id":"2a931ff8-6785-41cd-9cfe-7305c2225218","name":"Merge4"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[688,2192],"id":"37a2e7df-b2b5-4b6a-8cd6-9eb812d481f0","name":"OpenRouter Chat Model4","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Topic 3 Sources":"={{ $('Merge5').first().json.numberedUrl.join(\"\\n\") }}","Topic 3 Content":"={{ $('Merge5').first().json.output.join(\"\\n \\n\") }}","Topic 3 Sections":"={{ $json.sections.join(\"\\n\") }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 3 Sections","displayName":"Topic 3 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1840,1952],"id":"36aaa198-baee-4d18-b3ee-71ed81fc67ed","name":"Google Sheets3","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"{{ $json.output }}\",\n  \"topic\": \"general\",\n  \"search_depth\": \"advanced\",\n  \"chunks_per_source\": 3,\n  \"max_results\": 5\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[272,1920],"id":"2f50affa-782b-4e61-9bfb-83ed1e1f233e","name":"Tavily2","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[464,1920],"id":"a0fb6311-1f96-48b2-a26c-fe2e6d3f0bad","name":"Split Out4"},{"parameters":{"jsCode":"// Create separate items for each URL starting from number 6\n\n// Transform the input items to create numbered URLs\n// Start counting from 6 and increment by 1\nreturn items.map((item, index) => {\n  const number = index + 11; // Start at 6 instead of 1\n  \n  return {\n    json: {\n      number: number,\n      url: item.json.url,\n      numberedUrl: `${number}. ${item.json.url}`\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,1920],"id":"634419f6-8610-4f9a-9bf5-152ae6b06155","name":"Code2"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,2064],"id":"a11943d5-0921-420f-b95e-d184a43a90dd","name":"Aggregate4"},{"parameters":{"promptType":"define","text":"=Title: {{ $('Split Out4').item.json.title }}\n\nResearch: \n{{ $('Split Out4').item.json.content }}\n\nSource:\n{{ $json.numberedUrl }}\n\nStyle Guide Example:\n{{ $('Switch').first().json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an advanced AI research assistant specializing in writing professional HTML reports based on a provided title, research, source, and a given style guide. Your task is to generate a fully formatted HTML report that is both visually appealing and structured according to professional writing standards.\n\n## Report Generation Guidelines\n1. Adherence to Style Guide\n- The report must strictly follow the provided HTML style guide, ensuring consistent styling, colors, fonts, padding, and layout.\n\n2. Structure & Formatting\n- The report should be well-structured and formatted in professional HTML.\n- Title (<h1>) – Provided as \"Title\"\n- Content Body – Fully formatted research content with proper sectioning (<h2>, <h3>, <p>).\n- Each section should be wrapped in a div styled according to the provided guide to ensure consistency.\n- Use <p> for paragraphs, <ul>/<ol> for lists, and <hr> to separate sections when necessary.\n- No Overview or Conclusion headers are necessary, just output a full report.\n- Horizontal Line (<hr>) should be used to separate sections for better visual clarity.\n\n3. Research-Based Content\n- Synthesize information logically and ensure the report is well-researched, factual, and professionally written.\n- Use informative writing. Provide as much detail as possible.\n- Maintain a logical progression of ideas, summarizing key points effectively.\n\n4. Source Attribution & Clickable Links\n- Use the number given in front of the source as the clickable attribute in the report.\n- Source links must be inline within the text using: <a href=\"SOURCE_URL\" target=\"_blank\">[1]</a>\n- Do not include a \"References\" section—instead, all sources should be embedded within the content.\n\n## Example Output Structure (Applying Style Guide)\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Research Report: [Title]</title>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }\n        h1, h2, h3 { color: #333; }\n        .report-section { background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333; margin-bottom: 10px; }\n    </style>\n</head>\n<body>\n\n    <div class=\"report-section\">\n        <h1>Research Report: [Title]</h1>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Introduction</h2>\n        <p>The connection between carrots and vision health has long been a subject of both scientific inquiry and popular wisdom. \n        From wartime propaganda to modern nutritional science, these vibrant orange vegetables have maintained their reputation as \n        nature's answer to eye health maintenance.</p>\n        <hr>\n        <p>This report systematically explores five key aspects of the carrot-vision relationship, including their nutritional profile, \n        beta-carotene's role, scientific studies, and comparative benefits with other eye-healthy vegetables.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Key Findings</h2>\n        <h3>Nutritional Composition</h3>\n        <p>Carrots contain high levels of vitamin A, antioxidants, and beta-carotene, which play a significant role in vision health \n        <a href=\"https://example.com\" target=\"_blank\">[1]</a>.</p>\n\n        <h3>Scientific Studies on Vision Benefits</h3>\n        <p>Recent studies have examined the link between carrot consumption and reduced risk of age-related eye diseases \n        <a href=\"https://example.com\" target=\"_blank\">[2]</a>.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Conclusion</h2>\n        <p>Based on extensive research, carrots do contribute positively to vision health due to their high beta-carotene content. \n        However, their benefits should be seen as part of a balanced diet rather than a standalone solution.</p>\n    </div>\n\n</body>\n</html>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[848,2064],"id":"9f2e0a07-208c-412c-9555-8af056b26c0f","name":"Writer2"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"numberedUrl"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,1920],"id":"e341d4bf-bce2-4bc0-942d-0ded08169c07","name":"Aggregate5"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1360,1952],"id":"364d1811-2ec2-4dcb-a719-c9de1e48134d","name":"Merge5"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[704,2688],"id":"0f10aebb-12a8-4762-a915-e21cb64213ae","name":"OpenRouter Chat Model5","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Topic 4 Sources":"={{ $('Merge6').first().json.numberedUrl.join(\"\\n\") }}","Topic 4 Content":"={{ $('Merge6').first().json.output.join(\"\\n \\n\") }}","Topic 4 Sections":"={{ $json.sections.join(\"\\n\") }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sections","displayName":"Topic 3 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 4 Sections","displayName":"Topic 4 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sections","displayName":"Topic 5 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1840,2448],"id":"5904f77e-b8ff-4b95-bfcc-a0598f6f96ea","name":"Google Sheets4","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"{{ $json.output }}\",\n  \"topic\": \"general\",\n  \"search_depth\": \"advanced\",\n  \"chunks_per_source\": 3,\n  \"max_results\": 5\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[272,2432],"id":"1ef51350-a445-4025-a174-fb42323197da","name":"Tavily3","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[464,2432],"id":"b7058209-f924-42e2-9fca-6f14eb379a2b","name":"Split Out5"},{"parameters":{"jsCode":"// Create separate items for each URL starting from number 6\n\n// Transform the input items to create numbered URLs\n// Start counting from 6 and increment by 1\nreturn items.map((item, index) => {\n  const number = index + 16; // Start at 6 instead of 1\n  \n  return {\n    json: {\n      number: number,\n      url: item.json.url,\n      numberedUrl: `${number}. ${item.json.url}`\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,2432],"id":"e0bb9f86-ffbc-4eab-9f89-edf597992d61","name":"Code3"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,2560],"id":"3cbfabf1-ca2a-4af9-b0a6-8c7fc7d9163c","name":"Aggregate6"},{"parameters":{"promptType":"define","text":"=Title: {{ $('Split Out5').item.json.title }}\n\nResearch: \n{{ $('Split Out5').item.json.content }}\n\nSource:\n{{ $json.numberedUrl }}\n\nStyle Guide Example:\n{{ $('Switch').first().json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an advanced AI research assistant specializing in writing professional HTML reports based on a provided title, research, source, and a given style guide. Your task is to generate a fully formatted HTML report that is both visually appealing and structured according to professional writing standards.\n\n## Report Generation Guidelines\n1. Adherence to Style Guide\n- The report must strictly follow the provided HTML style guide, ensuring consistent styling, colors, fonts, padding, and layout.\n\n2. Structure & Formatting\n- The report should be well-structured and formatted in professional HTML.\n- Title (<h1>) – Provided as \"Title\"\n- Content Body – Fully formatted research content with proper sectioning (<h2>, <h3>, <p>).\n- Each section should be wrapped in a div styled according to the provided guide to ensure consistency.\n- Use <p> for paragraphs, <ul>/<ol> for lists, and <hr> to separate sections when necessary.\n- No Overview or Conclusion headers are necessary, just output a full report.\n- Horizontal Line (<hr>) should be used to separate sections for better visual clarity.\n\n3. Research-Based Content\n- Synthesize information logically and ensure the report is well-researched, factual, and professionally written.\n- Use informative writing. Provide as much detail as possible.\n- Maintain a logical progression of ideas, summarizing key points effectively.\n\n4. Source Attribution & Clickable Links\n- Use the number given in front of the source as the clickable attribute in the report.\n- Source links must be inline within the text using: <a href=\"SOURCE_URL\" target=\"_blank\">[1]</a>\n- Do not include a \"References\" section—instead, all sources should be embedded within the content.\n\n## Example Output Structure (Applying Style Guide)\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Research Report: [Title]</title>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }\n        h1, h2, h3 { color: #333; }\n        .report-section { background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333; margin-bottom: 10px; }\n    </style>\n</head>\n<body>\n\n    <div class=\"report-section\">\n        <h1>Research Report: [Title]</h1>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Introduction</h2>\n        <p>The connection between carrots and vision health has long been a subject of both scientific inquiry and popular wisdom. \n        From wartime propaganda to modern nutritional science, these vibrant orange vegetables have maintained their reputation as \n        nature's answer to eye health maintenance.</p>\n        <hr>\n        <p>This report systematically explores five key aspects of the carrot-vision relationship, including their nutritional profile, \n        beta-carotene's role, scientific studies, and comparative benefits with other eye-healthy vegetables.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Key Findings</h2>\n        <h3>Nutritional Composition</h3>\n        <p>Carrots contain high levels of vitamin A, antioxidants, and beta-carotene, which play a significant role in vision health \n        <a href=\"https://example.com\" target=\"_blank\">[1]</a>.</p>\n\n        <h3>Scientific Studies on Vision Benefits</h3>\n        <p>Recent studies have examined the link between carrot consumption and reduced risk of age-related eye diseases \n        <a href=\"https://example.com\" target=\"_blank\">[2]</a>.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Conclusion</h2>\n        <p>Based on extensive research, carrots do contribute positively to vision health due to their high beta-carotene content. \n        However, their benefits should be seen as part of a balanced diet rather than a standalone solution.</p>\n    </div>\n\n</body>\n</html>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[864,2560],"id":"7cb62cb0-042d-43d6-9720-51a82ec28c51","name":"Writer3"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"numberedUrl"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,2432],"id":"3ef53e26-b743-4310-9204-bab91a577365","name":"Aggregate7"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1360,2448],"id":"3476c5a0-f64c-42f8-9b83-6e3ccb84d06a","name":"Merge6"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[704,3184],"id":"012d687a-fbe8-44f1-9486-54d2ccfa3fd7","name":"OpenRouter Chat Model6","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Topic 5 Sources":"={{ $('Merge7').first().json.numberedUrl.join(\"\\n\") }}","Topic 5 Content":"={{ $('Merge7').first().json.output.join(\"\\n \\n\") }}","Topic 5 Sections":"={{ $json.sections.join(\"\\n\") }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sections","displayName":"Topic 3 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sections","displayName":"Topic 4 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 5 Sections","displayName":"Topic 5 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1840,2944],"id":"07482bea-793d-4f7f-8ff2-de84a3f7757e","name":"Google Sheets5","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"{{ $json.output }}\",\n  \"topic\": \"general\",\n  \"search_depth\": \"advanced\",\n  \"chunks_per_source\": 3,\n  \"max_results\": 5\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[272,2928],"id":"a14339cc-1e55-4bb1-ba31-b2c2222d4938","name":"Tavily4","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[464,2928],"id":"29b79ca6-42cb-4ae0-a515-a66d87c17f31","name":"Split Out6"},{"parameters":{"jsCode":"// Create separate items for each URL starting from number 6\n\n// Transform the input items to create numbered URLs\n// Start counting from 6 and increment by 1\nreturn items.map((item, index) => {\n  const number = index + 21; // Start at 6 instead of 1\n  \n  return {\n    json: {\n      number: number,\n      url: item.json.url,\n      numberedUrl: `${number}. ${item.json.url}`\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,2928],"id":"aca56766-69c3-4ae2-9f71-31615520e109","name":"Code4"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,3072],"id":"08042913-191a-4386-8653-044796744175","name":"Aggregate8"},{"parameters":{"promptType":"define","text":"=Title: {{ $('Split Out6').item.json.title }}\n\nResearch: \n{{ $('Split Out6').item.json.content }}\n\nSource:\n{{ $json.numberedUrl }}\n\nStyle Guide Example:\n{{ $('Switch').first().json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an advanced AI research assistant specializing in writing professional HTML reports based on a provided title, research, source, and a given style guide. Your task is to generate a fully formatted HTML report that is both visually appealing and structured according to professional writing standards.\n\n## Report Generation Guidelines\n1. Adherence to Style Guide\n- The report must strictly follow the provided HTML style guide, ensuring consistent styling, colors, fonts, padding, and layout.\n\n2. Structure & Formatting\n- The report should be well-structured and formatted in professional HTML.\n- Title (<h1>) – Provided as \"Title\"\n- Content Body – Fully formatted research content with proper sectioning (<h2>, <h3>, <p>).\n- Each section should be wrapped in a div styled according to the provided guide to ensure consistency.\n- Use <p> for paragraphs, <ul>/<ol> for lists, and <hr> to separate sections when necessary.\n- No Overview or Conclusion headers are necessary, just output a full report.\n- Horizontal Line (<hr>) should be used to separate sections for better visual clarity.\n\n3. Research-Based Content\n- Synthesize information logically and ensure the report is well-researched, factual, and professionally written.\n- Use informative writing. Provide as much detail as possible.\n- Maintain a logical progression of ideas, summarizing key points effectively.\n\n4. Source Attribution & Clickable Links\n- Use the number given in front of the source as the clickable attribute in the report.\n- Source links must be inline within the text using: <a href=\"SOURCE_URL\" target=\"_blank\">[1]</a>\n- Do not include a \"References\" section—instead, all sources should be embedded within the content.\n\n## Example Output Structure (Applying Style Guide)\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Research Report: [Title]</title>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }\n        h1, h2, h3 { color: #333; }\n        .report-section { background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333; margin-bottom: 10px; }\n    </style>\n</head>\n<body>\n\n    <div class=\"report-section\">\n        <h1>Research Report: [Title]</h1>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Introduction</h2>\n        <p>The connection between carrots and vision health has long been a subject of both scientific inquiry and popular wisdom. \n        From wartime propaganda to modern nutritional science, these vibrant orange vegetables have maintained their reputation as \n        nature's answer to eye health maintenance.</p>\n        <hr>\n        <p>This report systematically explores five key aspects of the carrot-vision relationship, including their nutritional profile, \n        beta-carotene's role, scientific studies, and comparative benefits with other eye-healthy vegetables.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Key Findings</h2>\n        <h3>Nutritional Composition</h3>\n        <p>Carrots contain high levels of vitamin A, antioxidants, and beta-carotene, which play a significant role in vision health \n        <a href=\"https://example.com\" target=\"_blank\">[1]</a>.</p>\n\n        <h3>Scientific Studies on Vision Benefits</h3>\n        <p>Recent studies have examined the link between carrot consumption and reduced risk of age-related eye diseases \n        <a href=\"https://example.com\" target=\"_blank\">[2]</a>.</p>\n    </div>\n\n    <div class=\"report-section\">\n        <h2>Conclusion</h2>\n        <p>Based on extensive research, carrots do contribute positively to vision health due to their high beta-carotene content. \n        However, their benefits should be seen as part of a balanced diet rather than a standalone solution.</p>\n    </div>\n\n</body>\n</html>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[848,3072],"id":"c681effb-c117-4f3d-ae33-6d1d674ca5ad","name":"Writer4"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"numberedUrl"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1184,2928],"id":"ed4e3f0b-bceb-4468-9c1d-d5f551e4f72c","name":"Aggregate9"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1360,2944],"id":"99b1e421-6a16-46fc-8998-081a150e354f","name":"Merge7"},{"parameters":{"documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Search Topic","lookupValue":"={{ $('On form submission').first().json['Search Topic'] }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2784,880],"id":"9356f1a5-922d-4ea8-a2d8-2da6704ba4cf","name":"Get Sources","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[2592,880],"id":"62e718e0-cc91-494d-ad25-c35506cdbe6e","name":"Limit"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[3568,1168],"id":"8d29c20d-d0b0-4b33-8e84-2df856a211bf","name":"OpenRouter Chat Model7","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"=Sources\n{{ $json['Topic 1 Sources'] }}\n{{ $json['Topic 2 Sources'] }}\n{{ $json['Topic 3 Sources'] }}\n{{ $json['Topic 4 Sources'] }}\n{{ $json['Topic 5 Sources'] }}","options":{"systemMessage":"=# Overview\nYou are an AI assistant specializing in generating well-formatted HTML source sections for research reports. You will be given a list of sources, each with an associated number. Your task is to generate an HTML-formatted \"Sources\" section where:\n1) Each source is displayed with its original number in brackets [ ].\n2) Each source is a clickable hyperlink that opens in a new tab when clicked.\n3) The list is structured in an ordered format (<ul> or <ol>) for clarity and readability.\n\n## Formatting Guidelines:\n- The section title should be <h2>Sources</h2>.\n- Use an unordered list (<ul>) to display the sources.\n- Each source should be in the format:\n<li><a href=\"SOURCE_URL\" target=\"_blank\">[NUMBER] Source Title</a></li>\nThe original numbering of the sources must be preserved.\n\n## Example Output Structure:\n<div class=\"sources-section\">\n    <h2>Sources</h2>\n    <ul>\n        <li><a href=\"https://example1.com\" target=\"_blank\">[1] Research on AI Development</a></li>\n        <li><a href=\"https://example2.com\" target=\"_blank\">[2] The Impact of Automation</a></li>\n        <li><a href=\"https://example3.com\" target=\"_blank\">[3] Machine Learning Trends</a></li>\n    </ul>\n</div>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[2992,880],"id":"c314b5ec-9875-4430-a9a6-356d237d4064","name":"Sources"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","Sources":"={{ $json.output }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[3312,880],"id":"e15db214-286d-4d8d-b1f0-f899959c511d","name":"Send Sources","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Search Topic","lookupValue":"={{ $('On form submission').first().json['Search Topic'] }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[3504,880],"id":"5a3294e8-6e04-4552-9bfe-394c2569f968","name":"Get All Content","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"jsCode":"// N8N Code Node to combine multiple fields into a single field with new lines\n\n// This code expects the input item to have the following fields:\n// - Title\n// - Introduction\n// - ToC (Table of Contents)\n// - Chapter 1\n// - Topic 1 Content\n// - Chapter 2\n// - Topic 2 Content\n// - Chapter 3\n// - Topic 3 Content\n// - Chapter 4\n// - Topic 4 Content\n// - Chapter 5\n// - Topic 5 Content\n// - Sources\n\n// Access the incoming data\nconst item = items[0];\n\n// Create a new field called \"CombinedContent\" that joins all fields with newlines\nconst combinedContent = [\n  item.json.Title || '',\n  item.json.Introduction || '',\n  item.json.ToC || '',\n  item.json['Chapter 1'] || '',\n  item.json['Topic 1 Content'] || '',\n  item.json['Chapter 2'] || '',\n  item.json['Topic 2 Content'] || '',\n  item.json['Chapter 3'] || '',\n  item.json['Topic 3 Content'] || '',\n  item.json['Chapter 4'] || '',\n  item.json['Topic 4 Content'] || '',\n  item.json['Chapter 5'] || '',\n  item.json['Topic 5 Content'] || '',\n  item.json.Sources || ''\n].join('\\n\\n');\n\n// Add the combined content to the item\nitem.json.CombinedContent = combinedContent;\n\n// Return the modified item\nreturn [item];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3312,1152],"id":"8d925817-e527-47b9-a6e1-48704cce179a","name":"Combine Content"},{"parameters":{"url":"={{ $json.download_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2752,1392],"id":"b1894978-32ca-4236-9c4b-afb208f831d6","name":"Download PDF"},{"parameters":{"numberInputs":5},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[2320,944],"id":"701a7ac9-9acb-49c9-8061-8b50ff766e42","name":"Merge2"},{"parameters":{"sendTo":"={{ $('On form submission').first().json.Email }}","subject":"=Deep Research Report: {{ $('On form submission').first().json['Search Topic'] }}","emailType":"text","message":"=Your Deep Research Report on {{ $('On form submission').first().json['Search Topic'] }} is complete.\n\nYou can find it attached below.","options":{"appendAttribution":false,"attachmentsUi":{"attachmentsBinary":[{}]}}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2944,1392],"id":"c7153a28-ffba-4c20-86bc-6dbc0d8a3eba","name":"Send Report","webhookId":"e066c2ef-6c8c-413e-a70e-05c88f29b9f6","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"output","extractionValues":{"values":[{"key":"section","cssSelector":"title"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1520,928],"id":"861dc9ab-0066-4aa2-bf7e-97037951b4d9","name":"HTML"},{"parameters":{"jsCode":"return [{\n  sections: $input.all().map(item => item.json.section)\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,928],"id":"90a83e06-36b4-4f22-9c50-19501f239d65","name":"Combine"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"output","extractionValues":{"values":[{"key":"section","cssSelector":"title"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1520,1424],"id":"5e46571e-5182-46bd-92e8-5b0cc4e4d86a","name":"HTML1"},{"parameters":{"jsCode":"return [{\n  sections: $input.all().map(item => item.json.section)\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,1424],"id":"15989a45-7078-4e55-92ef-ff9b4d807058","name":"Combine1"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"output","extractionValues":{"values":[{"key":"section","cssSelector":"title"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1520,1952],"id":"62bf603d-b1c7-4839-82a3-109985f28bf2","name":"HTML2"},{"parameters":{"jsCode":"return [{\n  sections: $input.all().map(item => item.json.section)\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,1952],"id":"c2cb6aa3-9861-4ae9-a976-39db17b8d87f","name":"Combine2"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"output","extractionValues":{"values":[{"key":"section","cssSelector":"title"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1520,2448],"id":"0571602c-31d1-44e7-97af-5934724f8689","name":"HTML3"},{"parameters":{"jsCode":"return [{\n  sections: $input.all().map(item => item.json.section)\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,2448],"id":"bb687516-0127-404d-a087-a418ff565446","name":"Combine3"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"output","extractionValues":{"values":[{"key":"section","cssSelector":"title"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1520,2944],"id":"9531e705-7cec-4c4e-8c46-df7023d0f198","name":"HTML4"},{"parameters":{"jsCode":"return [{\n  sections: $input.all().map(item => item.json.section)\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,2944],"id":"29a94cb2-9f7c-49d4-b7bd-833353f39444","name":"Combine4"},{"parameters":{"promptType":"define","text":"=Chapter 1: {{ $('Plan Topics').first().json.output.topic_1 }}\nSections:\n{{ $json['Topic 1 Sections']}}\n\nChapter 2: {{ $('Plan Topics').first().json.output.topic_2 }}\nSections:\n{{ $json['Topic 2 Sections'] }}\n\nChapter 3: {{ $('Plan Topics').first().json.output.topic_3 }}\nSections:\n{{ $json['Topic 3 Sections'] }}\n\nChapter 4: {{ $('Plan Topics').first().json.output.topic_4 }}\nSections:\n{{ $json['Topic 4 Sections'] }}\n\nChapter 5: {{ $('Plan Topics').first().json.output.topic_5 }}\nSections:\n{{ $json['Topic 5 Sections'] }}\n\nStyle Guide:\n{{ $json.Introduction }}","options":{"systemMessage":"=# Overview\nYou are an AI assistant tasked with creating a structured Table of Contents (ToC) in professional HTML formatting for a research report. Your output must follow the provided style guide and be clean, readable, and well-structured.\n\n## Guidelines\n1) Format Chapters as <h2> Elements\n- Each chapter should be a distinct <h2> heading.\n2) Format Sections as an Ordered List (<ol>)\n- Each section under a chapter should be a list item (<li>) inside an <ol>.\n- Maintain clear hierarchy and indentation for readability.\n3) Apply Given Style Guide\n- Wrap the ToC in a <div> with the same padding, font size, and color as the style guide.\n- Add a horizontal rule (<hr>) for separation.\n\n## Example Output\n\n<div style=\"background-color: #f4f4f4; padding: 20px; font-size: 16px; line-height: 1.6; color: #333;\">\n    <h2>Table of Contents</h2>\n    <hr>\n    <ol>\n        <li>\n            <h2>Chapter 1: Introduction</h2>\n            <ol>\n                <li>Background and Importance</li>\n                <li>Research Goals</li>\n            </ol>\n        </li>\n        <li>\n            <h2>Chapter 2: Nutritional Science of Carrots</h2>\n            <ol>\n                <li>Vitamin A and Vision Health</li>\n                <li>Antioxidants in Carrots</li>\n                <li>Other Essential Nutrients</li>\n            </ol>\n        </li>\n    </ol>\n</div>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[2544,1152],"id":"717400d3-b748-440c-a23b-2f2bfbf6ee98","name":"Table of Contents"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').first().json['Search Topic'] }}","ToC":"={{ $json.output }}"},"matchingColumns":["Search Topic"],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sections","displayName":"Topic 3 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sections","displayName":"Topic 4 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sections","displayName":"Topic 5 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"ToC","displayName":"ToC","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2912,1152],"id":"25c35171-6eb4-49a3-a60b-86e822934205","name":"Send ToC","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Search Topic":"={{ $('On form submission').item.json['Search Topic'] }}","Title":"={{ $json.output.title }}","Introduction":"={{ $json.output.introduction }}","Chapter 1":"={{ $json.output.chapter_1 }}","Chapter 2":"={{ $json.output.chapter_2 }}","Chapter 3":"={{ $json.output.chapter_3 }}","Chapter 4":"={{ $json.output.chapter_4 }}","Chapter 5":"={{ $json.output.chapter_5 }}"},"matchingColumns":[],"schema":[{"id":"Search Topic","displayName":"Search Topic","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Title","displayName":"Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Introduction","displayName":"Introduction","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Chapter 1","displayName":"Chapter 1","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Chapter 2","displayName":"Chapter 2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Chapter 3","displayName":"Chapter 3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Chapter 4","displayName":"Chapter 4","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Chapter 5","displayName":"Chapter 5","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Topic 1 Sources","displayName":"Topic 1 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Sections","displayName":"Topic 1 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 1 Content","displayName":"Topic 1 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sources","displayName":"Topic 2 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Sections","displayName":"Topic 2 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 2 Content","displayName":"Topic 2 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sources","displayName":"Topic 3 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Sections","displayName":"Topic 3 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 3 Content","displayName":"Topic 3 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sources","displayName":"Topic 4 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Sections","displayName":"Topic 4 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 4 Content","displayName":"Topic 4 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sources","displayName":"Topic 5 Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Sections","displayName":"Topic 5 Sections","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Topic 5 Content","displayName":"Topic 5 Content","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Sources","displayName":"Sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"ToC","displayName":"ToC","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-656,1296],"id":"edbd2f48-cb80-4f12-9537-599a952eebdc","name":"Send Intro","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"title\": \"<Generated Report Title>\",\n  \"introduction\": \"<Generated Introduction>\",\n  \"chapter_1\": \"<h2>Chapter 1: [Title]</h2>\",\n  \"chapter_2\": \"<h2>Chapter 2: [Title]</h2>\",\n  \"chapter_3\": \"<h2>Chapter 3: [Title]</h2>\",\n  \"chapter_4\": \"<h2>Chapter 4: [Title]</h2>\",\n  \"chapter_5\": \"<h2>Chapter 5: [Title]</h2>\"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-800,1520],"id":"1f26bcb5-dcfa-4330-bdb8-709a9e66522f","name":"Title, Intro, Chapters"},{"parameters":{"documentId":{"__rl":true,"value":"1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4","mode":"list","cachedResultName":"Deep Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1nLtek-h9e_Std_lfAG8NIG0TsX3yraYKy3kxJWZ2Av4/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Search Topic","lookupValue":"={{ $('On form submission').first().json['Search Topic'] }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[3088,1152],"id":"0f91d258-e115-42bc-bcf1-a78beb042403","name":"Get All Content1","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"content":"# Planning Stage\n","height":1000,"width":1800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1888,800],"id":"422924e9-87e0-4e21-a9ee-a3a348de8005","name":"Sticky Note"},{"parameters":{"content":"# Chapter 1\n","height":500,"width":2140,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,800],"id":"2b61692c-baa6-4672-a101-e4fd6aa50bb0","name":"Sticky Note1"},{"parameters":{"content":"# Chapter 2\n","height":480,"width":2140},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,1328],"id":"4f469bc0-d0df-4a75-85d7-1da8a0372618","name":"Sticky Note2"},{"parameters":{"content":"# Chapter 3\n","height":500,"width":2140,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,1840],"id":"eaabf36a-155e-4582-b619-5cfd16c230e5","name":"Sticky Note3"},{"parameters":{"content":"# Chapter 4\n","height":480,"width":2140},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,2352],"id":"200612c9-5489-46d0-ab04-6b6c666c0cd1","name":"Sticky Note4"},{"parameters":{"content":"# Chapter 5\n","height":500,"width":2140,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,2848],"id":"0472600e-58a8-43e7-a2eb-67e464a481f6","name":"Sticky Note5"},{"parameters":{"content":"# Finalize Content","height":500,"width":1580,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2160,800],"id":"62a6fb49-6efc-47f9-9e12-67b5b65bd01e","name":"Sticky Note6"},{"parameters":{"content":"# Generate PDF","height":240,"width":1080,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2160,1328],"id":"72861ac5-3f90-400f-8090-f080c08b47e9","name":"Sticky Note7"},{"parameters":{"content":"## 🛠️ SETUP GUIDE\n\n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\n### 1️⃣ Google Sheet Template  \n[📄 Google Sheet Template](https://docs.google.com/spreadsheets/d/16WekkajqKqMAwrERVjQo2XdzhKCU7QcprfasZnyK0CA/edit?usp=sharing)  \n- Make a copy of the sheet.  \n- Rename it to match the node, or modify the node to link to your sheet.\n\n### 2️⃣ Tavily API  \n[🌐 Tavily](https://tavily.com/)  \n- Sign up and get an API key.  \n- Connect your API key in the **5 Tavily HTTP Request nodes**.  \n- Add this header parameter:  Authorization: Bearer <your_token>\n\n\n### 3️⃣ API Template.io  \n[🖨️ API Template.io](https://apitemplate.io/?via=eleanor&gad_source=1&gclid=Cj0KCQjw16O_BhDNARIsAC3i2GDBxOF8j_cmtcTke-dIcypdwLuGT2ijr4vDnR4U7vcMDeGBRoAJntkaAvYnEALw_wcB)  \n- Get an API key.  \n- Connect your account in the **HTTP Request Node** that generates a PDF.  \n\n\n### 4️⃣ OpenRouter  \n[🤖 OpenRouter](https://openrouter.ai/)  \n- Sign up and get an API key.  \n- Make sure you have credits in your account.  \n- Connect your account in **all OpenRouter chat models** (under each agent).  \n","height":660,"width":620},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,112],"id":"1136c43d-b1d4-43c6-a364-06ac2a037288","name":"Sticky Note8"},{"parameters":{"method":"POST","url":"https://rest-us.apitemplate.io/v2/create-pdf-from-html","authentication":"predefinedCredentialType","nodeCredentialType":"apiTemplateIoApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"filename","value":"={{ $('On form submission').first().json['Search Topic'] }}.pdf"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"body\": \"{{$json[\"CombinedContent\"].replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n')}}\",\n  \"css\": \"<style>.bg{background: red};</style>\",\n  \"data\": {\n    \"name\": \"This is a title\"\n  },\n  \"settings\": {\n    \"paper_size\": \"A4\",\n    \"orientation\": \"1\",\n    \"header_font_size\": \"9px\",\n    \"margin_top\": \"40\",\n    \"margin_right\": \"10\",\n    \"margin_bottom\": \"40\",\n    \"margin_left\": \"10\",\n    \"print_background\": \"1\",\n    \"displayHeaderFooter\": true,\n    \"custom_header\": \"<style>#header, #footer { padding: 0 !important; }</style>\\n<table style=\\\"width: 100%; padding: 0px 5px;margin: 0px!important;font-size: 8px\\\">\\n  <tr>\\n    <td style=\\\"text-align:left; width:30%!important;\\\"><span class=\\\"date\\\"></span></td>\\n    <td style=\\\"text-align:center; width:30%!important;\\\"><span class=\\\"pageNumber\\\"></span></td>\\n    <td style=\\\"text-align:right; width:30%!important;\\\"><span class=\\\"totalPages\\\"></span></td>\\n  </tr>\\n</table>\",\n    \"custom_footer\": \"<style>#header, #footer { padding: 0 !important; }</style>\\n<table style=\\\"width: 100%; padding: 0px 5px;margin: 0px!important;font-size: 8px\\\">\\n  <tr>\\n    <td style=\\\"text-align:left; width:30%!important;\\\"><span class=\\\"date\\\"></span></td>\\n    <td style=\\\"text-align:center; width:30%!important;\\\"><span class=\\\"pageNumber\\\"></span></td>\\n    <td style=\\\"text-align:right; width:30%!important;\\\"><span class=\\\"totalPages\\\"></span></td>\\n  </tr>\\n</table>\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2560,1392],"id":"ca09d590-1483-4b07-a7d0-6282824bffee","name":"Generate PDF"},{"parameters":{"content":"# Nate Herk | AI Automation","height":80,"width":500,"color":6},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"9609bb5a-8a01-4470-994a-631967a7bb38","name":"Sticky Note10"}],"connections":{"On form submission":{"main":[[{"node":"Plan Topics","type":"main","index":0}]]},"Plan Topics":{"main":[[{"node":"Intro","type":"main","index":0},{"node":"Split Out","type":"main","index":0},{"node":"Set Topics","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Plan Topics","type":"ai_languageModel","index":0}]]},"5 Topics":{"ai_outputParser":[[{"node":"Plan Topics","type":"ai_outputParser","index":0}]]},"Intro":{"main":[[{"node":"Send Intro","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"Intro","type":"ai_languageModel","index":0}]]},"Split Out":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Set Topics":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Tavily","type":"main","index":0}],[{"node":"Tavily1","type":"main","index":0}],[{"node":"Tavily2","type":"main","index":0}],[{"node":"Tavily3","type":"main","index":0}],[{"node":"Tavily4","type":"main","index":0}]]},"OpenRouter Chat Model2":{"ai_languageModel":[[{"node":"Writer","type":"ai_languageModel","index":0}]]},"Google Sheets1":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Tavily":{"main":[[{"node":"Split Out2","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Writer","type":"main","index":0},{"node":"Aggregate1","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Merge3","type":"main","index":1}]]},"Writer":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Merge3","type":"main","index":0}]]},"Merge3":{"main":[[{"node":"HTML","type":"main","index":0}]]},"OpenRouter Chat Model3":{"ai_languageModel":[[{"node":"Writer1","type":"ai_languageModel","index":0}]]},"Tavily1":{"main":[[{"node":"Split Out3","type":"main","index":0}]]},"Split Out3":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Writer1","type":"main","index":0},{"node":"Aggregate3","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"Merge4","type":"main","index":1}]]},"Writer1":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"Merge4","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"HTML1","type":"main","index":0}]]},"Google Sheets2":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"OpenRouter Chat Model4":{"ai_languageModel":[[{"node":"Writer2","type":"ai_languageModel","index":0}]]},"Tavily2":{"main":[[{"node":"Split Out4","type":"main","index":0}]]},"Split Out4":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Writer2","type":"main","index":0},{"node":"Aggregate5","type":"main","index":0}]]},"Aggregate4":{"main":[[{"node":"Merge5","type":"main","index":1}]]},"Writer2":{"main":[[{"node":"Aggregate4","type":"main","index":0}]]},"Aggregate5":{"main":[[{"node":"Merge5","type":"main","index":0}]]},"Merge5":{"main":[[{"node":"HTML2","type":"main","index":0}]]},"Google Sheets3":{"main":[[{"node":"Merge2","type":"main","index":2}]]},"OpenRouter Chat Model5":{"ai_languageModel":[[{"node":"Writer3","type":"ai_languageModel","index":0}]]},"Tavily3":{"main":[[{"node":"Split Out5","type":"main","index":0}]]},"Split Out5":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Writer3","type":"main","index":0},{"node":"Aggregate7","type":"main","index":0}]]},"Aggregate6":{"main":[[{"node":"Merge6","type":"main","index":1}]]},"Writer3":{"main":[[{"node":"Aggregate6","type":"main","index":0}]]},"Aggregate7":{"main":[[{"node":"Merge6","type":"main","index":0}]]},"Merge6":{"main":[[{"node":"HTML3","type":"main","index":0}]]},"Google Sheets4":{"main":[[{"node":"Merge2","type":"main","index":3}]]},"OpenRouter Chat Model6":{"ai_languageModel":[[{"node":"Writer4","type":"ai_languageModel","index":0}]]},"Tavily4":{"main":[[{"node":"Split Out6","type":"main","index":0}]]},"Split Out6":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Code4":{"main":[[{"node":"Writer4","type":"main","index":0},{"node":"Aggregate9","type":"main","index":0}]]},"Aggregate8":{"main":[[{"node":"Merge7","type":"main","index":1}]]},"Writer4":{"main":[[{"node":"Aggregate8","type":"main","index":0}]]},"Aggregate9":{"main":[[{"node":"Merge7","type":"main","index":0}]]},"Merge7":{"main":[[{"node":"HTML4","type":"main","index":0}]]},"Google Sheets5":{"main":[[{"node":"Merge2","type":"main","index":4}]]},"Get Sources":{"main":[[{"node":"Sources","type":"main","index":0}]]},"Limit":{"main":[[{"node":"Get Sources","type":"main","index":0}]]},"OpenRouter Chat Model7":{"ai_languageModel":[[{"node":"Sources","type":"ai_languageModel","index":0},{"node":"Table of Contents","type":"ai_languageModel","index":0}]]},"Sources":{"main":[[{"node":"Send Sources","type":"main","index":0}]]},"Send Sources":{"main":[[{"node":"Get All Content","type":"main","index":0}]]},"Get All Content":{"main":[[{"node":"Table of Contents","type":"main","index":0}]]},"Combine Content":{"main":[[{"node":"Generate PDF","type":"main","index":0}]]},"Download PDF":{"main":[[{"node":"Send Report","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Limit","type":"main","index":0}]]},"HTML":{"main":[[{"node":"Combine","type":"main","index":0}]]},"Combine":{"main":[[{"node":"Google Sheets1","type":"main","index":0}]]},"HTML1":{"main":[[{"node":"Combine1","type":"main","index":0}]]},"Combine1":{"main":[[{"node":"Google Sheets2","type":"main","index":0}]]},"HTML2":{"main":[[{"node":"Combine2","type":"main","index":0}]]},"Combine2":{"main":[[{"node":"Google Sheets3","type":"main","index":0}]]},"HTML3":{"main":[[{"node":"Combine3","type":"main","index":0}]]},"Combine3":{"main":[[{"node":"Google Sheets4","type":"main","index":0}]]},"HTML4":{"main":[[{"node":"Combine4","type":"main","index":0}]]},"Combine4":{"main":[[{"node":"Google Sheets5","type":"main","index":0}]]},"Table of Contents":{"main":[[{"node":"Send ToC","type":"main","index":0}]]},"Send Intro":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Title, Intro, Chapters":{"ai_outputParser":[[{"node":"Intro","type":"ai_outputParser","index":0}]]},"Send ToC":{"main":[[{"node":"Get All Content1","type":"main","index":0}]]},"Get All Content1":{"main":[[{"node":"Combine Content","type":"main","index":0}]]},"Generate PDF":{"main":[[{"node":"Download PDF","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"847c63e3-8afa-4753-820a-dd1b2ecec404","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:59:31.218Z","createdAt":"2025-11-29T02:59:31.218Z","role":"workflow:owner","workflowId":"7Rs10R5LjrKxv27z","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T01:39:35.000Z","createdAt":"2025-11-29T03:01:43.269Z","id":"8YENlBC8xEuiXrDY","name":"Email Labelling Agent","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyX","value":10,"unit":"minutes"}]},"simple":false,"filters":{},"options":{}},"id":"103426fb-2380-46d1-9ac0-ffefd2bbe2f2","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1.1,"position":[-288,384],"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_3294538948721148189"]},"id":"fc4c2f1a-cc13-422b-a711-0465f1892ecc","name":"Others","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,608],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"## I'm your personal email AI Labeling Agent :)\n\n### I will organize your inbox by labeling all incoming emails into predefined labels to save you time. ","height":223.59369296517087,"width":407.40000000000003,"color":5},"id":"b635d35a-edfe-4090-b2fa-b3a7d63709e3","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"inputText":"={{ $json.text }}","categories":{"categories":[{"category":"Spam","description":"Emails that offer stuff that appears to be spam. This will include GrabOne offers."},{"category":"Investing","description":"Emails that are from WealthGen Investor or Trading Mastery. This also include emails giving Stock Discounts, Chew the Fat, Market Updates, or are from Andrew Barnett. It also includes emails that are Daily Trade Reports or has 'Market Update' in the email subject."},{"category":"Purchases_Receipts","description":"Emails that appear to be about purchases I have made or receipts for the purchases I have made."},{"category":"Other","description":"All others emails that do not match the description of previous labels. "},{"category":"AI_Automations","description":"Emails from AI Automation Society, or other AI related emails."},{"category":"Reply","description":"Determine a this email requires me to reply to it.  If so then then mark it as requiring a reply."}]},"options":{"systemPromptTemplate":"=Please classify the text provided by the user into one of the categories provided. If you cannot determine the category to be used then default it to the 'Other' category.\nIf the Subject is 'Unsubscribe' then igore the email and do nothing"}},"id":"444f76c6-6178-4a24-8d42-71ab3ec894c6","name":"Labeling AI Agent","type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[112,320]},{"parameters":{"model":"gpt-5-nano","options":{}},"id":"0f506c1e-56cb-40fa-aa2e-cf3a86c59f22","name":"chatGPT 5 mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[0,624]},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["SPAM"]},"id":"4a3ac671-cbd4-4947-a384-f926aabdb11a","name":"Spam","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,80],"webhookId":"91478e56-192c-45f6-ab1f-dd774de83d34","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_34"]},"id":"9d79b2ca-cbc5-4f7b-a956-56184e01f517","name":"Investing","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,256],"webhookId":"f25a235c-774e-464e-bc6e-5b168f35876a","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_7928830508184749955"]},"id":"848971b6-7bd9-4ae7-a38d-daddc847e3db","name":"Purchase Receipts","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,432],"webhookId":"37b2667b-0371-4be6-a60e-b5f9bc1fe571","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_29"]},"id":"cb43101b-5606-4a80-8e14-1058278286ce","name":"AI Automations","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,800],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_2476636834875974344"]},"id":"d6f836a2-0226-4bbe-bd37-5790c422851f","name":"Reply to","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[560,992],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Gmail Trigger":{"main":[[{"node":"Labeling AI Agent","type":"main","index":0}]]},"Labeling AI Agent":{"main":[[{"node":"Spam","type":"main","index":0}],[{"node":"Investing","type":"main","index":0}],[{"node":"Purchase Receipts","type":"main","index":0}],[{"node":"Others","type":"main","index":0}],[{"node":"AI Automations","type":"main","index":0}],[{"node":"Reply to","type":"main","index":0}]]},"chatGPT 5 mini":{"ai_languageModel":[[{"node":"Labeling AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"1e6a089c-beac-42ce-8d4d-371225a8e904","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T03:01:43.270Z","createdAt":"2025-11-29T03:01:43.270Z","role":"workflow:owner","workflowId":"8YENlBC8xEuiXrDY","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-27T20:10:41.188Z","createdAt":"2025-12-23T22:13:15.189Z","id":"8YpfuldOVbNPeSoB","name":"Idea Catcher","active":true,"isArchived":false,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-1152,-48],"id":"2013554d-3226-4e3f-bffa-15595c21fe9d","name":"Telegram Trigger","webhookId":"c6102d53-c094-41a6-828b-e04bba6b572b","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"8f9f9b5f-8ff6-49ba-9d75-587c84f41055","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-528,-64],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"5d383313-88fc-4cca-ae4f-3e0d432e1e42","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[-304,-64],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-96,-64],"id":"2a7fa522-911d-4f56-bfc0-d86bfd0d4744","name":"Input"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-928,-48],"id":"11a87123-00a4-4df6-a61b-3b468673c922","name":"Authorised?"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"ba4343c7-72bb-4bfb-8f1e-d8f4aecebd8a","name":"voice or text","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-752,-48]},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"=An email has been sent to you with the note/idea.","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[880,-160],"id":"707e1973-6151-4b12-93a4-3cf091d0e09d","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are an assistant whose only job is to turn rough, spoken-style dictation into a clear, logically structured idea note that is ready to be emailed to the user. You do not send emails yourself and you do not call tools – you only rewrite and structure the text you receive. The dictated note could be a todo list.\n\n# Input\nYou will receive raw text that was dictated by voice (often via Telegram). It may:\n- Lack punctuation or proper sentence boundaries\n- Contain filler words (“um”, “you know”, “okay”, etc.)\n- Jump around in order or repeat itself\n- Contain partial thoughts that need light restructuring\n\nAssume all content belongs to a single “idea note”, though it may contain several related sub-ideas.\n\n# Task\n1. Understand the user’s intent and main idea(s).\n2. Clean up grammar, punctuation, and spelling.\n3. Remove filler words and obvious repetition.\n4. Reorder sentences or points slightly to make the idea more logical and coherent.\n5. Keep the meaning, nuance, and first-person voice of the user.\n6. Do NOT add new content, arguments, or facts that were not implied by the original dictation.\n\n# Output format\nAlways respond in **exactly** this format and nothing else:\n\nSubject: <a short, descriptive subject line (5–12 words) capturing the core idea>\n\nBody:\n<one to three short paragraphs that clearly express the idea, followed by bullet points only if they help clarity. Keep it concise, focused, and email-ready. No greeting, no sign-off.>\n\n# Style rules\n- Be concise and professional but natural, as if the user wrote it thoughtfully in their own voice.\n- Prefer short sentences and clear structure over long, complex phrasing.\n- If there are multiple distinct sub-ideas, separate them with short headings or bullet points inside the Body, not separate emails.\n- If there is a tsks list then make each one a separate bullet point.\n\n# Final reminders\n- Do NOT mention that this was dictated or transcribed.\n- Do NOT explain what you did.\n- Output ONLY the “Subject:” line and the “Body:” section in the format above.\n\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[128,-64],"id":"0eba705a-7fd6-4ed0-acb7-b51eec7c6023","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"model":"deepseek/deepseek-v3.2","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[128,240],"id":"44f8740d-463f-4380-850e-3c90b6dc57cc","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1.1,"position":[432,256],"id":"77d31f7a-8d5d-4066-aed1-f6203a086303","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[288,256],"id":"648ebfec-effa-4000-8697-ab473dd6bc3a","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[608,32],"id":"6064a1cf-a2d0-44a2-9729-10cf7c86cbef","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[256,-400],"id":"37583fd1-7d14-4b1a-bd90-8d313d5d4304","name":"Clean Up"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"={{ $json.subject }}","message":"={{ $json.body }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[672,-160],"id":"7d4e2b65-20db-4054-9c77-ba76e44c5179","name":"Send a message","webhookId":"9e18640f-7f9e-49a9-acf2-0364461f04fd","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"const txt = $json.output || '';\nconst m = txt.match(/Subject:\\s*(.*?)\\s*Body:\\s*([\\s\\S]*)/i);\n\nreturn [{\n  subject: m ? m[1].trim() : '',\n  body:    m ? m[2].trim() : txt,\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[480,-160],"id":"0368ec7d-ee87-4cbc-b99d-1ae0bbd7af1b","name":"format for email"},{"parameters":{"content":"This workflow captures voice notes from Telegram, uses AI to summaries them and then emails it back to me.\n\nConfigure the Telegram credential to listen to the correct BOT.","height":208,"width":528},"type":"n8n-nodes-base.stickyNote","position":[-1216,-416],"typeVersion":1,"id":"dc005806-19c9-44e1-8622-d5f6c30c6fe3","name":"Sticky Note"}],"connections":{"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Authorised?":{"main":[[{"node":"voice or text","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"voice or text":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[]]},"Input":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"format for email","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[]]},"format for email":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c7c0161c-7f73-4150-aac2-6b5de083dc77","activeVersionId":"c7c0161c-7f73-4150-aac2-6b5de083dc77","triggerCount":1,"shared":[{"updatedAt":"2025-12-23T22:13:15.194Z","createdAt":"2025-12-23T22:13:15.194Z","role":"workflow:owner","workflowId":"8YpfuldOVbNPeSoB","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-27T20:10:45.000Z","createdAt":"2025-12-27T20:10:41.192Z","versionId":"c7c0161c-7f73-4150-aac2-6b5de083dc77","workflowId":"8YpfuldOVbNPeSoB","nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-1152,-48],"id":"2013554d-3226-4e3f-bffa-15595c21fe9d","name":"Telegram Trigger","webhookId":"c6102d53-c094-41a6-828b-e04bba6b572b","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"8f9f9b5f-8ff6-49ba-9d75-587c84f41055","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-528,-64],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"5d383313-88fc-4cca-ae4f-3e0d432e1e42","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[-304,-64],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-96,-64],"id":"2a7fa522-911d-4f56-bfc0-d86bfd0d4744","name":"Input"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-928,-48],"id":"11a87123-00a4-4df6-a61b-3b468673c922","name":"Authorised?"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"ba4343c7-72bb-4bfb-8f1e-d8f4aecebd8a","name":"voice or text","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-752,-48]},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"=An email has been sent to you with the note/idea.","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[880,-160],"id":"707e1973-6151-4b12-93a4-3cf091d0e09d","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are an assistant whose only job is to turn rough, spoken-style dictation into a clear, logically structured idea note that is ready to be emailed to the user. You do not send emails yourself and you do not call tools – you only rewrite and structure the text you receive. The dictated note could be a todo list.\n\n# Input\nYou will receive raw text that was dictated by voice (often via Telegram). It may:\n- Lack punctuation or proper sentence boundaries\n- Contain filler words (“um”, “you know”, “okay”, etc.)\n- Jump around in order or repeat itself\n- Contain partial thoughts that need light restructuring\n\nAssume all content belongs to a single “idea note”, though it may contain several related sub-ideas.\n\n# Task\n1. Understand the user’s intent and main idea(s).\n2. Clean up grammar, punctuation, and spelling.\n3. Remove filler words and obvious repetition.\n4. Reorder sentences or points slightly to make the idea more logical and coherent.\n5. Keep the meaning, nuance, and first-person voice of the user.\n6. Do NOT add new content, arguments, or facts that were not implied by the original dictation.\n\n# Output format\nAlways respond in **exactly** this format and nothing else:\n\nSubject: <a short, descriptive subject line (5–12 words) capturing the core idea>\n\nBody:\n<one to three short paragraphs that clearly express the idea, followed by bullet points only if they help clarity. Keep it concise, focused, and email-ready. No greeting, no sign-off.>\n\n# Style rules\n- Be concise and professional but natural, as if the user wrote it thoughtfully in their own voice.\n- Prefer short sentences and clear structure over long, complex phrasing.\n- If there are multiple distinct sub-ideas, separate them with short headings or bullet points inside the Body, not separate emails.\n- If there is a tsks list then make each one a separate bullet point.\n\n# Final reminders\n- Do NOT mention that this was dictated or transcribed.\n- Do NOT explain what you did.\n- Output ONLY the “Subject:” line and the “Body:” section in the format above.\n\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[128,-64],"id":"0eba705a-7fd6-4ed0-acb7-b51eec7c6023","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"model":"deepseek/deepseek-v3.2","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[128,240],"id":"44f8740d-463f-4380-850e-3c90b6dc57cc","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1.1,"position":[432,256],"id":"77d31f7a-8d5d-4066-aed1-f6203a086303","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[288,256],"id":"648ebfec-effa-4000-8697-ab473dd6bc3a","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[608,32],"id":"6064a1cf-a2d0-44a2-9729-10cf7c86cbef","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"zZnLjGklbblacZ6S","name":"Telegram Idea WF"}}},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[256,-400],"id":"37583fd1-7d14-4b1a-bd90-8d313d5d4304","name":"Clean Up"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"={{ $json.subject }}","message":"={{ $json.body }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[672,-160],"id":"7d4e2b65-20db-4054-9c77-ba76e44c5179","name":"Send a message","webhookId":"9e18640f-7f9e-49a9-acf2-0364461f04fd","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"const txt = $json.output || '';\nconst m = txt.match(/Subject:\\s*(.*?)\\s*Body:\\s*([\\s\\S]*)/i);\n\nreturn [{\n  subject: m ? m[1].trim() : '',\n  body:    m ? m[2].trim() : txt,\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[480,-160],"id":"0368ec7d-ee87-4cbc-b99d-1ae0bbd7af1b","name":"format for email"},{"parameters":{"content":"This workflow captures voice notes from Telegram, uses AI to summaries them and then emails it back to me.\n\nConfigure the Telegram credential to listen to the correct BOT.","height":208,"width":528},"type":"n8n-nodes-base.stickyNote","position":[-1216,-416],"typeVersion":1,"id":"dc005806-19c9-44e1-8622-d5f6c30c6fe3","name":"Sticky Note"}],"connections":{"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Authorised?":{"main":[[{"node":"voice or text","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"voice or text":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[]]},"Input":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"format for email","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[]]},"format for email":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Response","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":"Version c7c0161c","description":"","autosaved":false},"tags":[]},{"updatedAt":"2025-12-08T01:16:34.000Z","createdAt":"2025-11-29T02:50:23.353Z","id":"BJx4QAOriH7Jk90v","name":"GTC Newsletter","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":6}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"c23f45df-063d-4781-8e65-320b846f41a4","name":"Schedule Trigger"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[720,192],"id":"ec59d487-cf6d-49f0-ac61-225fb3ef9727","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[208,0],"id":"b9941dd8-d047-4dde-8398-65efaaf0fc1a","name":"Monitored GTCs","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"jsCode":"const symbols = items.map(item => item.json.Symbol).join(', ');\nreturn [{ json: { symbols: symbols } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[416,0],"id":"4c19e357-c101-40f1-b45c-312c24b76c29","name":"Extract Symbol list"},{"parameters":{"promptType":"define","text":"=Latest news updates for companies:\n{{ $json.answer }}","options":{"systemMessage":"=Here’s a **ready-to-paste system prompt** for your n8n agent.\n\n---\n\n**SYSTEM PROMPT — “GTC News Summarizer for Purchase Decisions (Do-Not-Fabricate)”**\n\n**Role**\nYou analyze **recent company news** for Chris Hallowes. The companies are “**Golden Triangle Companies (GTC)**.” Your job is to **summarize only material items that could influence Chris’s share-purchase decisions**—no fluff, no hype, no rewrites of press-release filler.\n\n**User context**\n\n* Prefers concise sections (<1000 chars), professional but friendly.\n* GTC screen (minimums): **ROIC 5y average ≥15%, CAGR 5y ≥15%, Revenue 5y average ≥5%, Profit margin 5y average ≥10%, Price ≥10% below 52-week high**.\nIf you can get the figures for the ROIC, CAGR, REvenue growth, profit margin as described above, include those figures in your output.\n* Output must be **actionable** and **relevant** only.\n\n**Input you receive**\n\n* Unstructured “News” text per company (articles, headlines, notes, snippets).\n* Optional metrics: ROIC, CAGR, FX rate(s), discount to 52-week high, valuation notes.\n\n**Hard rules**\n\n1. **No fabrication.** Use only provided info. If a claim is unclear, mark **“Unverified.”**\n2. **Materiality filter:** include only items that can move valuation or risk (earnings, guidance, margins, cash flow, buybacks/dividends, M&A, litigation/regulation, leadership changes, product/AI moats, macro/FX exposure).\n3. **Impact first:** for each item, state **why it matters for a buy decision** (upside/downsides, durability, timing).\n4. **Keep source wording intact if quoting;** otherwise paraphrase succinctly.\n5. **NZ context:** note **FX implications** for NZD investors; convert figures to NZD **only if an FX rate is given**, else keep original currency and flag FX sensitivity.\n6. **Respect GTC lens:** tie each item to profitability quality (ROIC), growth durability (CAGR/revenue), and margin resilience; note if news strengthens/weakens the GTC thesis.\n7. **No price targets** unless explicitly provided. No personal financial advice—only analysis.\n\n**Red/Green signal rubric (for each company)**\n\n* **GREEN (Buy-lean):** Strengthens moat/earnings power, positive guidance/beats, accretive buybacks/dividend growth, regulatory clarity, durable demand.\n* **YELLOW (Watch):** Mixed/immaterial, execution risk, awaiting data/filings, FX or macro headwinds not quantified.\n* **RED (Avoid-for-now):** Thesis impaired: margin compression, negative guidance, legal/regulatory overhang, balance-sheet stress, broken product/retention.\n\n**Output format (return only this block)**\n\n**Title:** GTC News Impact — [Date]\n\n**[Company Ticker – Company Name]**\n\n* **Key News (bullets):**\n  • <Concise item #1> — *Impact:* <why it matters for buy decision>\n  • <Concise item #2> — *Impact:* <…>\n* **Signals Table:**\n\n  | Thesis Pillar               | Effect       | Notes                             |\n  | --------------------------- | ------------ | --------------------------------- |\n  | ROIC Quality                | ↗/↘/→        | <tie news to returns/efficiency>  |\n  | Growth/CAGR                 | ↗/↘/→        | <demand, guidance, pipeline>      |\n  | Margins                     | ↗/↘/→        | <gross/operating trends>          |\n  | Balance Sheet/Buybacks/Divs | ↗/↘/→        | <cash, leverage, capital returns> |\n  | Regulatory/Litigation       | ↗/↘/→        | <risk or clarity>                 |\n  | FX (NZD)                    | Risk/Benefit | <exposure; convert if FX given>   |\n* **Valuation Context (if provided):** 52-wk discount: <x%>; notes.\n* **Decision Signal:** **GREEN / YELLOW / RED** — *Reason:* <one sentence>\n* **Next Steps:** <data to watch, filings, dates, triggers>\n\n(Repeat the above block for each company in the input.)\n\n**Style**\n\n* Crisp, neutral, slightly witty only if appropriate.\n* Short sentences, strong verbs, no jargon unless essential.\n* Use tables/bullets for scanability.\n* Never exceed ~8 bullets per company.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[832,0],"id":"cc8bf6e9-e866-4d51-8813-fff868d51af3","name":"Newsletter writer"},{"parameters":{"promptType":"define","text":"=Unformatted Newsletter:\n{{ $json.output }}","options":{"systemMessage":"=**SYSTEM PROMPT — “Expert Newsletter Writer & HTML Email Formatter (Do-Not-Rewrite)”**\n\n**Role**\nYou are an expert newsletter formatter for HTML emails. You receive **raw, unformatted newsletter text** (“Source”). Your job is to **format it into production-safe HTML email** that is readable, attractive, and **blue-themed**. **Do not change, paraphrase, remove, or add to the Source content** (including headings like “The News Leader”). You may only:\n\n* Wrap Source in semantic structure,\n* Apply layout/styling,\n* Auto-convert lists/links/tables,\n* Insert non-content scaffolding (wrapper tables, preheader, footer placeholders).\n\n**Hard Constraints**\n\n* **Preserve content verbatim** (text, capitalization, punctuation, order).\n* **No editorial changes**; no summaries; no additions to body copy.\n* **Email-safe HTML**: table-based layout, width ≈ **600px**, **inline CSS** only, minimal media query for mobile.\n* **Accessible & readable**: strong contrast, 16px+ base text, 1.4–1.6 line-height.\n* **Blue palette** only for styling (you choose tasteful tones).\n* **No external fonts, scripts, or remote CSS**.\n* **No tracking pixels**.\n* **If Source has headings**, use them; **do not invent new headings**.\n* If Source has naked URLs, convert to `<a>` but keep anchor text identical to the URL (no rewording).\n* Keep all section titles exactly as written (e.g., “The News Leader”).\n\n**Color Palette (use variations as needed)**\n\n* Primary Navy: `#0B3D91`\n* Mid Blue: `#1E3A8A`\n* Accent Teal-Blue: `#0FA3B1`\n* Light Blue BG: `#E9F2FF`\n* Soft Gray BG: `#F4F6F8`\n* Body Text: `#1F2937`\n* Muted Caption: `#6B7280`\n\n**Formatting Rules**\n\n1. **Structure**: one-column container (600px), padded content, clear section boxes for each top-level heading.\n2. **Headings**: Map Source headings to `<h1>` (first only) then `<h2>/<h3>`; do not rename them.\n3. **Paragraphs**: Wrap plain lines into `<p>`; collapse extra blank lines.\n4. **Lists**: Convert `-`/`•`/`*` prefixed lines to `<ul><li>…</li></ul>`.\n5. **Links**: Detect `http(s)://…` and wrap in `<a href=\"…\">…</a>`; do not alter text.\n6. **Tables**: If markdown-like tables are present, render a simple bordered table with blue header row.\n7. **Images in Source**: If absolute URLs appear on their own line and end with an image extension, render as `<img>` with `max-width:100%` and `height:auto`; otherwise leave link text as is.\n8. **Boxes**: Wrap major sections in rounded “cards” using light-blue backgrounds for visual hierarchy.\n9. **Preheader**: Create a hidden preheader by **copying the first ~90 chars of the Source** verbatim (no edits).\n10. **Footer placeholder**: Include a minimal legal footer (no marketing copy).\n\n**Output**\nReturn **a single complete HTML document** (no commentary). Insert the entire Source exactly where indicated. Do not escape or alter Source text beyond structural wrapping.\n\n**Template (use and inject Source as directed)**\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Email Newsletter</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    @media only screen and (max-width:620px){\n      .container{width:100%!important}\n      .p-24{padding:16px!important}\n      .stack{display:block!important;width:100%!important}\n      .h1{font-size:24px!important;line-height:30px!important}\n    }\n  </style>\n</head>\n<body style=\"margin:0;padding:0;background:#F4F6F8;\">\n  <!-- Hidden Preheader (first ~90 chars of Source, verbatim) -->\n  <div style=\"display:none;font-size:1px;line-height:1px;max-height:0;max-width:0;opacity:0;overflow:hidden;mso-hide:all;\">\n    [[PREHEADER_FROM_SOURCE]]\n  </div>\n\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#F4F6F8;\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px;\">\n        <!--[if mso]><table role=\"presentation\" width=\"600\"><tr><td><![endif]-->\n        <table role=\"presentation\" class=\"container\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:600px;background:#FFFFFF;border-radius:12px;overflow:hidden;\">\n          <!-- Brand/Header Bar (no added copy) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:24px;\">\n              <h1 class=\"h1\" style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:28px;line-height:34px;color:#FFFFFF;\">\n                [[OPTIONAL_FIRST_HEADING_IF_PRESENT_ELSE_EMPTY]]\n              </h1>\n            </td>\n          </tr>\n\n          <!-- Main Content Wrapper -->\n          <tr>\n            <td class=\"p-24\" style=\"padding:24px;font-family:Arial,Helvetica,sans-serif;color:#1F2937;font-size:16px;line-height:24px;\">\n              <!-- BEGIN SOURCE (insert verbatim; wrap with paragraphs/lists/tables as per rules) -->\n              [[FORMATTED_SOURCE_CONTENT]]\n              <!-- END SOURCE -->\n            </td>\n          </tr>\n\n          <!-- Optional Section Cards (use when Source contains multiple top-level headings) -->\n          <!-- Example card -->\n          <!--\n          <tr>\n            <td style=\"padding:0 24px 24px;\">\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#E9F2FF;border-radius:10px;\">\n                <tr>\n                  <td style=\"padding:16px 18px;font-family:Arial,Helvetica,sans-serif;\">\n                    [[SECTION_FROM_SOURCE_HEADING_AND_BODY_VERBATIM]]\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          -->\n\n          <!-- Footer (placeholder only, no new claims) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:16px;text-align:center;\">\n              <p style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;color:#E6ECFF;\">\n                © [[YOUR_ORG_NAME]] • [[CITY, COUNTRY]]\n              </p>\n              <p style=\"margin:4px 0 0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;\">\n                <a href=\"[[UNSUBSCRIBE_URL]]\" style=\"color:#E6ECFF;text-decoration:underline;\">Unsubscribe</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n        <!--[if mso]></td></tr></table><![endif]-->\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n```\n\n**Implementation Notes**\n\n* Detect headings: markdown `#`, `##`, underline styles, or standalone ALL-CAPS lines → wrap as `<h2>`/`<h3>` with **no text changes**.\n* Convert simple bullets to `<ul><li>…</li></ul>`; keep each bullet’s wording exactly.\n* For URLs in text, set `style=\"color:#0B3D91;text-decoration:underline;\"`.\n* Use cards (`#E9F2FF` background, `10px` radius) to group major sections; never insert new titles.\n* If the Source starts with a strong title, show it in the blue header; otherwise leave the header text empty and rely on section headings.\n* If no headings exist, render as paragraphs only—**do not invent headings**.\n* Always return **only** the HTML document.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1200,0],"id":"e93872f9-d878-44a4-adc1-cbee0c4b63d3","name":"HTML Editor"},{"parameters":{"model":"anthropic/claude-sonnet-4.5","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1072,208],"id":"f210ef5c-3930-47d5-96ea-bf7f6b5cf973","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"sendTo":"chris@hallowes.com, monique@hallowes.com","subject":"=Chris and Moniques Daily GTC News for {{ $now.format('dd-MM-yyyy') }}","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1552,0],"id":"a96b1c82-19b2-49eb-9c71-208bb5e0d765","name":"Send a message","webhookId":"0488d66a-8f81-4e75-818b-a98ce55a695f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"query":"=Latest news on any of these companies {{ $json.symbols }}, include financial where possible which include 15 year CAGR, previous 5 years average ROIC, previous 5 years average revenue growth rate, previous 5 years average profit margin, current earning multple. ","options":{"days":1}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[624,0],"id":"79cb4a36-aa63-4186-be9b-530dc6bb56bc","name":"Search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"Monitored GTCs","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Newsletter writer","type":"ai_languageModel","index":0}]]},"Monitored GTCs":{"main":[[{"node":"Extract Symbol list","type":"main","index":0}]]},"Extract Symbol list":{"main":[[{"node":"Search","type":"main","index":0}]]},"Newsletter writer":{"main":[[{"node":"HTML Editor","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"HTML Editor","type":"ai_languageModel","index":0}]]},"HTML Editor":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"673ebdae-06e9-4f6a-b055-e5e1e6292c85","activeVersionId":"673ebdae-06e9-4f6a-b055-e5e1e6292c85","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T02:50:23.358Z","createdAt":"2025-11-29T02:50:23.358Z","role":"workflow:owner","workflowId":"BJx4QAOriH7Jk90v","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-08T01:16:09.301Z","createdAt":"2025-12-08T01:16:09.301Z","versionId":"673ebdae-06e9-4f6a-b055-e5e1e6292c85","workflowId":"BJx4QAOriH7Jk90v","nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":6}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"c23f45df-063d-4781-8e65-320b846f41a4","name":"Schedule Trigger"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[720,192],"id":"ec59d487-cf6d-49f0-ac61-225fb3ef9727","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[208,0],"id":"b9941dd8-d047-4dde-8398-65efaaf0fc1a","name":"Monitored GTCs","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"jsCode":"const symbols = items.map(item => item.json.Symbol).join(', ');\nreturn [{ json: { symbols: symbols } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[416,0],"id":"4c19e357-c101-40f1-b45c-312c24b76c29","name":"Extract Symbol list"},{"parameters":{"promptType":"define","text":"=Latest news updates for companies:\n{{ $json.answer }}","options":{"systemMessage":"=Here’s a **ready-to-paste system prompt** for your n8n agent.\n\n---\n\n**SYSTEM PROMPT — “GTC News Summarizer for Purchase Decisions (Do-Not-Fabricate)”**\n\n**Role**\nYou analyze **recent company news** for Chris Hallowes. The companies are “**Golden Triangle Companies (GTC)**.” Your job is to **summarize only material items that could influence Chris’s share-purchase decisions**—no fluff, no hype, no rewrites of press-release filler.\n\n**User context**\n\n* Prefers concise sections (<1000 chars), professional but friendly.\n* GTC screen (minimums): **ROIC 5y average ≥15%, CAGR 5y ≥15%, Revenue 5y average ≥5%, Profit margin 5y average ≥10%, Price ≥10% below 52-week high**.\nIf you can get the figures for the ROIC, CAGR, REvenue growth, profit margin as described above, include those figures in your output.\n* Output must be **actionable** and **relevant** only.\n\n**Input you receive**\n\n* Unstructured “News” text per company (articles, headlines, notes, snippets).\n* Optional metrics: ROIC, CAGR, FX rate(s), discount to 52-week high, valuation notes.\n\n**Hard rules**\n\n1. **No fabrication.** Use only provided info. If a claim is unclear, mark **“Unverified.”**\n2. **Materiality filter:** include only items that can move valuation or risk (earnings, guidance, margins, cash flow, buybacks/dividends, M&A, litigation/regulation, leadership changes, product/AI moats, macro/FX exposure).\n3. **Impact first:** for each item, state **why it matters for a buy decision** (upside/downsides, durability, timing).\n4. **Keep source wording intact if quoting;** otherwise paraphrase succinctly.\n5. **NZ context:** note **FX implications** for NZD investors; convert figures to NZD **only if an FX rate is given**, else keep original currency and flag FX sensitivity.\n6. **Respect GTC lens:** tie each item to profitability quality (ROIC), growth durability (CAGR/revenue), and margin resilience; note if news strengthens/weakens the GTC thesis.\n7. **No price targets** unless explicitly provided. No personal financial advice—only analysis.\n\n**Red/Green signal rubric (for each company)**\n\n* **GREEN (Buy-lean):** Strengthens moat/earnings power, positive guidance/beats, accretive buybacks/dividend growth, regulatory clarity, durable demand.\n* **YELLOW (Watch):** Mixed/immaterial, execution risk, awaiting data/filings, FX or macro headwinds not quantified.\n* **RED (Avoid-for-now):** Thesis impaired: margin compression, negative guidance, legal/regulatory overhang, balance-sheet stress, broken product/retention.\n\n**Output format (return only this block)**\n\n**Title:** GTC News Impact — [Date]\n\n**[Company Ticker – Company Name]**\n\n* **Key News (bullets):**\n  • <Concise item #1> — *Impact:* <why it matters for buy decision>\n  • <Concise item #2> — *Impact:* <…>\n* **Signals Table:**\n\n  | Thesis Pillar               | Effect       | Notes                             |\n  | --------------------------- | ------------ | --------------------------------- |\n  | ROIC Quality                | ↗/↘/→        | <tie news to returns/efficiency>  |\n  | Growth/CAGR                 | ↗/↘/→        | <demand, guidance, pipeline>      |\n  | Margins                     | ↗/↘/→        | <gross/operating trends>          |\n  | Balance Sheet/Buybacks/Divs | ↗/↘/→        | <cash, leverage, capital returns> |\n  | Regulatory/Litigation       | ↗/↘/→        | <risk or clarity>                 |\n  | FX (NZD)                    | Risk/Benefit | <exposure; convert if FX given>   |\n* **Valuation Context (if provided):** 52-wk discount: <x%>; notes.\n* **Decision Signal:** **GREEN / YELLOW / RED** — *Reason:* <one sentence>\n* **Next Steps:** <data to watch, filings, dates, triggers>\n\n(Repeat the above block for each company in the input.)\n\n**Style**\n\n* Crisp, neutral, slightly witty only if appropriate.\n* Short sentences, strong verbs, no jargon unless essential.\n* Use tables/bullets for scanability.\n* Never exceed ~8 bullets per company.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[832,0],"id":"cc8bf6e9-e866-4d51-8813-fff868d51af3","name":"Newsletter writer"},{"parameters":{"promptType":"define","text":"=Unformatted Newsletter:\n{{ $json.output }}","options":{"systemMessage":"=**SYSTEM PROMPT — “Expert Newsletter Writer & HTML Email Formatter (Do-Not-Rewrite)”**\n\n**Role**\nYou are an expert newsletter formatter for HTML emails. You receive **raw, unformatted newsletter text** (“Source”). Your job is to **format it into production-safe HTML email** that is readable, attractive, and **blue-themed**. **Do not change, paraphrase, remove, or add to the Source content** (including headings like “The News Leader”). You may only:\n\n* Wrap Source in semantic structure,\n* Apply layout/styling,\n* Auto-convert lists/links/tables,\n* Insert non-content scaffolding (wrapper tables, preheader, footer placeholders).\n\n**Hard Constraints**\n\n* **Preserve content verbatim** (text, capitalization, punctuation, order).\n* **No editorial changes**; no summaries; no additions to body copy.\n* **Email-safe HTML**: table-based layout, width ≈ **600px**, **inline CSS** only, minimal media query for mobile.\n* **Accessible & readable**: strong contrast, 16px+ base text, 1.4–1.6 line-height.\n* **Blue palette** only for styling (you choose tasteful tones).\n* **No external fonts, scripts, or remote CSS**.\n* **No tracking pixels**.\n* **If Source has headings**, use them; **do not invent new headings**.\n* If Source has naked URLs, convert to `<a>` but keep anchor text identical to the URL (no rewording).\n* Keep all section titles exactly as written (e.g., “The News Leader”).\n\n**Color Palette (use variations as needed)**\n\n* Primary Navy: `#0B3D91`\n* Mid Blue: `#1E3A8A`\n* Accent Teal-Blue: `#0FA3B1`\n* Light Blue BG: `#E9F2FF`\n* Soft Gray BG: `#F4F6F8`\n* Body Text: `#1F2937`\n* Muted Caption: `#6B7280`\n\n**Formatting Rules**\n\n1. **Structure**: one-column container (600px), padded content, clear section boxes for each top-level heading.\n2. **Headings**: Map Source headings to `<h1>` (first only) then `<h2>/<h3>`; do not rename them.\n3. **Paragraphs**: Wrap plain lines into `<p>`; collapse extra blank lines.\n4. **Lists**: Convert `-`/`•`/`*` prefixed lines to `<ul><li>…</li></ul>`.\n5. **Links**: Detect `http(s)://…` and wrap in `<a href=\"…\">…</a>`; do not alter text.\n6. **Tables**: If markdown-like tables are present, render a simple bordered table with blue header row.\n7. **Images in Source**: If absolute URLs appear on their own line and end with an image extension, render as `<img>` with `max-width:100%` and `height:auto`; otherwise leave link text as is.\n8. **Boxes**: Wrap major sections in rounded “cards” using light-blue backgrounds for visual hierarchy.\n9. **Preheader**: Create a hidden preheader by **copying the first ~90 chars of the Source** verbatim (no edits).\n10. **Footer placeholder**: Include a minimal legal footer (no marketing copy).\n\n**Output**\nReturn **a single complete HTML document** (no commentary). Insert the entire Source exactly where indicated. Do not escape or alter Source text beyond structural wrapping.\n\n**Template (use and inject Source as directed)**\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Email Newsletter</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    @media only screen and (max-width:620px){\n      .container{width:100%!important}\n      .p-24{padding:16px!important}\n      .stack{display:block!important;width:100%!important}\n      .h1{font-size:24px!important;line-height:30px!important}\n    }\n  </style>\n</head>\n<body style=\"margin:0;padding:0;background:#F4F6F8;\">\n  <!-- Hidden Preheader (first ~90 chars of Source, verbatim) -->\n  <div style=\"display:none;font-size:1px;line-height:1px;max-height:0;max-width:0;opacity:0;overflow:hidden;mso-hide:all;\">\n    [[PREHEADER_FROM_SOURCE]]\n  </div>\n\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#F4F6F8;\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px;\">\n        <!--[if mso]><table role=\"presentation\" width=\"600\"><tr><td><![endif]-->\n        <table role=\"presentation\" class=\"container\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:600px;background:#FFFFFF;border-radius:12px;overflow:hidden;\">\n          <!-- Brand/Header Bar (no added copy) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:24px;\">\n              <h1 class=\"h1\" style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:28px;line-height:34px;color:#FFFFFF;\">\n                [[OPTIONAL_FIRST_HEADING_IF_PRESENT_ELSE_EMPTY]]\n              </h1>\n            </td>\n          </tr>\n\n          <!-- Main Content Wrapper -->\n          <tr>\n            <td class=\"p-24\" style=\"padding:24px;font-family:Arial,Helvetica,sans-serif;color:#1F2937;font-size:16px;line-height:24px;\">\n              <!-- BEGIN SOURCE (insert verbatim; wrap with paragraphs/lists/tables as per rules) -->\n              [[FORMATTED_SOURCE_CONTENT]]\n              <!-- END SOURCE -->\n            </td>\n          </tr>\n\n          <!-- Optional Section Cards (use when Source contains multiple top-level headings) -->\n          <!-- Example card -->\n          <!--\n          <tr>\n            <td style=\"padding:0 24px 24px;\">\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#E9F2FF;border-radius:10px;\">\n                <tr>\n                  <td style=\"padding:16px 18px;font-family:Arial,Helvetica,sans-serif;\">\n                    [[SECTION_FROM_SOURCE_HEADING_AND_BODY_VERBATIM]]\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          -->\n\n          <!-- Footer (placeholder only, no new claims) -->\n          <tr>\n            <td style=\"background:#0B3D91;padding:16px;text-align:center;\">\n              <p style=\"margin:0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;color:#E6ECFF;\">\n                © [[YOUR_ORG_NAME]] • [[CITY, COUNTRY]]\n              </p>\n              <p style=\"margin:4px 0 0;font-family:Arial,Helvetica,sans-serif;font-size:12px;line-height:18px;\">\n                <a href=\"[[UNSUBSCRIBE_URL]]\" style=\"color:#E6ECFF;text-decoration:underline;\">Unsubscribe</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n        <!--[if mso]></td></tr></table><![endif]-->\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n```\n\n**Implementation Notes**\n\n* Detect headings: markdown `#`, `##`, underline styles, or standalone ALL-CAPS lines → wrap as `<h2>`/`<h3>` with **no text changes**.\n* Convert simple bullets to `<ul><li>…</li></ul>`; keep each bullet’s wording exactly.\n* For URLs in text, set `style=\"color:#0B3D91;text-decoration:underline;\"`.\n* Use cards (`#E9F2FF` background, `10px` radius) to group major sections; never insert new titles.\n* If the Source starts with a strong title, show it in the blue header; otherwise leave the header text empty and rely on section headings.\n* If no headings exist, render as paragraphs only—**do not invent headings**.\n* Always return **only** the HTML document.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1200,0],"id":"e93872f9-d878-44a4-adc1-cbee0c4b63d3","name":"HTML Editor"},{"parameters":{"model":"anthropic/claude-sonnet-4.5","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1072,208],"id":"f210ef5c-3930-47d5-96ea-bf7f6b5cf973","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"sendTo":"chris@hallowes.com, monique@hallowes.com","subject":"=Chris and Moniques Daily GTC News for {{ $now.format('dd-MM-yyyy') }}","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1552,0],"id":"a96b1c82-19b2-49eb-9c71-208bb5e0d765","name":"Send a message","webhookId":"0488d66a-8f81-4e75-818b-a98ce55a695f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"query":"=Latest news on any of these companies {{ $json.symbols }}, include financial where possible which include 15 year CAGR, previous 5 years average ROIC, previous 5 years average revenue growth rate, previous 5 years average profit margin, current earning multple. ","options":{"days":1}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[624,0],"id":"79cb4a36-aa63-4186-be9b-530dc6bb56bc","name":"Search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"Monitored GTCs","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Newsletter writer","type":"ai_languageModel","index":0}]]},"Monitored GTCs":{"main":[[{"node":"Extract Symbol list","type":"main","index":0}]]},"Extract Symbol list":{"main":[[{"node":"Search","type":"main","index":0}]]},"Newsletter writer":{"main":[[{"node":"HTML Editor","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"HTML Editor","type":"ai_languageModel","index":0}]]},"HTML Editor":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":null,"description":null,"autosaved":false},"tags":[]},{"updatedAt":"2026-01-06T22:07:03.348Z","createdAt":"2025-11-29T02:51:28.050Z","id":"CzIfiZ34D2RwZRGN","name":"AlbanyLegal Attachment Processor","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyX","value":10,"unit":"minutes"}]},"output":"raw","filters":{"hasAttachments":true,"readStatus":"both"},"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlookTrigger","typeVersion":1,"position":[-1488,-320],"id":"a35cf629-a0d6-47d5-819c-77986f0c68a8","name":"Microsoft Outlook Trigger"},{"parameters":{"method":"POST","url":"https://webhook.site/dcc459e3-f84f-40f0-aa35-5fc0bebd933f","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"File","inputDataFieldName":"pdf"},{"name":"FileName","value":"={{ $json.FileName }}"},{"name":"MatterNo","value":"={{ $json.MatterNo }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[752,144],"id":"d185d917-52dd-4189-90b6-fda929e8a308","name":"HTTP Request"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[336,144],"id":"fe15934a-8796-4f15-8885-98311d1d21c8","name":"Merge","alwaysOutputData":true,"executeOnce":true},{"parameters":{"jsCode":"// safer getters\nconst title    = $input.item.json?.content?.[0]?.text ?? 'document';\nconst matterNo = $('Microsoft Outlook Trigger').first().json.subject ?? '';\n\n// prefer whatever binary arrived on the incoming item (from Set/Outlook)\nconst inBin = $input.item.binary || {};\nconst firstKey = Object.keys(inBin)[0];\nlet pdf = firstKey ? inBin[firstKey] : null;\n\n// fallback: pull from Outlook trigger if merge branch didn’t carry binary\nif (!pdf) {\n  pdf = $('Microsoft Outlook Trigger').first().binary?.attachment_0 || null;\n}\nif (!pdf) {\n  throw new Error('No PDF binary found on input or Outlook.');\n}\n\n// (optional) rename file\npdf.fileName = (pdf.fileName && pdf.fileName.endsWith('.pdf')) ? pdf.fileName : `${title}.pdf`;\n\nreturn {\n  json: { FileName: title, MatterNo: matterNo },\n  binary: { pdf }   // <-- MUST be an object of key -> binary\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[528,144],"id":"761f45a8-80cf-4db8-868b-3e9f4797db29","name":"Code in JavaScript"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY","mode":"list","cachedResultName":"OLScans","cachedResultUrl":"https://docs.google.com/spreadsheets/d/150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"MatterNo":"={{ $('Code in JavaScript').item.json.MatterNo }}","DocName":"={{ $('Code in JavaScript').item.json.FileName }}","MessageID":"={{ $json.id.trim().toLowerCase() }}","Date":"={{ (() => { const d = new Date(); const pad = n => String(n).padStart(2, '0'); return pad(d.getFullYear()) + pad(d.getMonth() + 1) + pad(d.getDate()) + ':' + pad(d.getHours()) + ':' + pad(d.getMinutes()) + ':' + pad(d.getSeconds()); })() }}"},"matchingColumns":[],"schema":[{"id":"Date","displayName":"Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"MatterNo","displayName":"MatterNo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"DocName","displayName":"DocName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"MessageID","displayName":"MessageID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[1200,144],"id":"067a40ed-ed35-4e47-8bb8-5919796076c4","name":"Append row in sheet","disabled":true},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"claude-haiku-4-5-20251001","mode":"list","cachedResultName":"claude-haiku-4-5-20251001"},"text":"=Read the PDF and extract a suitable name for the document. If it contains the word Resolution or Resolutions then \"Resolution\" should be in the title.\nIf it contains the word Deed then \"Deed\" should be in the title.\nIf the client name or the name of a trust is present, ignore that.\nIt should be brief. do not give an explanation, just a name for this document.\n## Examples\nSmith Family Trust Resolution of Trustees should just be Resolution of Trustees\nResolution of Trustees\nDeed of Forgiveness of Debt\nDeed of Gift\nTrust Deed\n","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.anthropic","typeVersion":1,"position":[192,0],"id":"6b9f9073-3fd6-446d-a196-e6edb5bbc8af","name":"Extract Doc Name"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"de39dfc4-4d6e-4559-9664-f2cec936a4d5","leftValue":"={{ $node[\"Microsoft Outlook Trigger\"].binary.attachment_0.mimeType }}","rightValue":"=application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-240,144],"id":"5b7f1bb4-4b3c-4d4a-8f4e-d1407980d964","name":"Is a PDF attachment"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"de2757d4-e403-468a-b0af-c9dcd79a9ed3","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-448,160],"id":"15250cae-c32d-485a-8980-5f97dac9b6f6","name":"If"},{"parameters":{"documentId":{"__rl":true,"value":"150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY","mode":"list","cachedResultName":"OLScans","cachedResultUrl":"https://docs.google.com/spreadsheets/d/150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/150sHymYKVRGdJB5GNAnXM-oOx1H5bEYQbsjs3kwJasY/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"col_1","lookupValue":"1"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[-1232,176],"id":"ca9267f6-0c97-4dfa-a8c3-a8646d90a106","name":"Look for duplicate message","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"75439603-0cbf-4fa7-8cac-363842c43999","leftValue":"={{ $json.found }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-640,176],"id":"f11b92ac-7a7b-4621-8079-2c64843b8915","name":"a New PDF"},{"parameters":{"assignments":{"assignments":[{"id":"05bac1ec-8d7c-4f28-8187-846eb3466586","name":"=found","value":"={{ Object.keys($json).length > 0 }}","type":"boolean"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-976,176],"id":"46c363f1-f5c4-4691-9aed-ad7bca7fdc50","name":"FlagFound"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the JSON of the item\nitem.binary = item.binary || {};\nitem.binary.data = $node[\"Microsoft Outlook Trigger\"].binary.attachment_0;\nreturn item;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,0],"id":"112120fc-383f-4b60-8caa-65536857d6a1","name":"pass pdf file"},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $('Microsoft Outlook Trigger').item.json.id }}","mode":"id"},"folderId":{"__rl":true,"mode":"list","value":""}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[944,144],"id":"6e035d0e-88f8-48a8-95d6-1e1f728ff502","name":"Move a message","webhookId":"e3dd7903-247b-45de-9b5b-4a756ea0e4e6","disabled":true},{"parameters":{"operation":"getAll","limit":1,"filters":{"readStatus":"unread"}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[-1536,144],"id":"f844baa6-48fc-48b8-be26-2a7f909d1db1","name":"Get many messages","webhookId":"56d6bbe9-570b-4792-b63c-878bba0b7a35","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"get"},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[-768,-144],"id":"3b109c17-aa8e-4899-9e45-7df85bcec1a1","name":"Get a message","webhookId":"42fdbc46-2a1d-4897-97f7-2628be2e9763","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Microsoft Outlook Trigger":{"main":[[]]},"Merge":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Move a message","type":"main","index":0}]]},"Extract Doc Name":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Is a PDF attachment":{"main":[[{"node":"Merge","type":"main","index":1},{"node":"pass pdf file","type":"main","index":0}]]},"If":{"main":[[{"node":"Is a PDF attachment","type":"main","index":0}]]},"Look for duplicate message":{"main":[[{"node":"FlagFound","type":"main","index":0}]]},"a New PDF":{"main":[[{"node":"If","type":"main","index":0}]]},"FlagFound":{"main":[[{"node":"a New PDF","type":"main","index":0}]]},"pass pdf file":{"main":[[{"node":"Extract Doc Name","type":"main","index":0}]]},"Move a message":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Get many messages":{"main":[[{"node":"Get a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"636748bf-94de-4310-b29e-fe35d9ba6938","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:51:28.053Z","createdAt":"2025-11-29T02:51:28.053Z","role":"workflow:owner","workflowId":"CzIfiZ34D2RwZRGN","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T01:17:09.000Z","createdAt":"2025-12-07T02:09:36.962Z","id":"DWsmsmZ39NMtggi0","name":"From Zero to Inbox Agent","active":false,"isArchived":true,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{},"options":{}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[896,320],"id":"6555358d-5e17-404a-987d-7de24a05b527","name":"Gmail Trigger","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"inputText":"=Subject: {{ $json.headers.subject }}\n\nBody: {{ $json.text }}","categories":{"categories":[{"category":"Customer Support","description":"Emails requesting help, troubleshooting, or guidance for a product or service. Usually describe issues like login errors, bugs, or malfunctioning features. Common keywords: error, issue, problem, help, access, support, fix, reset, troubleshoot."},{"category":"Finance/Billing","description":"Emails about payments, invoices, refunds, or subscriptions. The sender wants to confirm, dispute, or update financial details. Common keywords: invoice, payment, refund, billing, charge, subscription, renewal, receipt."},{"category":"High Priority","description":"Urgent or time-sensitive emails about critical issues or outages requiring immediate attention. Common keywords: urgent, ASAP, critical, outage, down, immediate, emergency, escalation."},{"category":"Promotion","description":"Marketing or sales-focused emails promoting offers, discounts, or new products. Tone is upbeat and persuasive. Common keywords: sale, offer, discount, promotion, new feature, upgrade, limited time, exclusive."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1.1,"position":[1088,288],"id":"0fb5ee69-fbed-41a0-ae86-1f27a054518b","name":"Text Classifier"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1040,592],"id":"93d14176-726e-46e8-b066-138137209b5b","name":"GPT-4.1-mini","credentials":{"openRouterApi":{"id":"uQv2EiUT6dltWPpY","name":"OpenRouter account 2"}}},{"parameters":{"model":"anthropic/claude-3.7-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1936,208],"id":"5fecea67-c4f9-4ed2-9eef-20ca0d2ca99a","name":"Claude 3.7","credentials":{"openRouterApi":{"id":"uQv2EiUT6dltWPpY","name":"OpenRouter account 2"}}},{"parameters":{"promptType":"define","text":"=Subject: {{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody: {{ $('Gmail Trigger').item.json.text }}","options":{"systemMessage":"=You are Nate's AI Assistant — an expert, friendly, and professional customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond clearly, concisely, and helpfully to member questions.\n- Always maintain a warm and approachable tone that reflects Nate Herk’s brand and community values.\n- Provide accurate information about AI Automation Society, its programs, challenges, and community rules.\n- If you do **not** know the answer or the query requires Nate’s direct input, politely tell the user to reach out to **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Nate’s AI Assistant\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,32],"id":"1e95d628-3be3-40bb-875c-113115a194be","name":"Customer Support Agent"},{"parameters":{"operation":"reply","messageId":"={{ $('Gmail Trigger').item.json.id }}","emailType":"text","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,32],"id":"0aedee4c-215b-4981-9179-74f1dc277fe1","name":"Reply to a message","webhookId":"66b6ddd9-e93d-4182-8a22-52481b02bbc4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"billing@example.com","subject":"=New Billing Email: {{ $('Gmail Trigger').item.json.from.value[0].name }}","emailType":"text","message":"=Hey Billing team!\n\nWe received a new billing inquiry at {{ $now.format('yyyy-MM-dd hh:mm a') }}.\n\nIt is from {{ $('Gmail Trigger').item.json.from.value[0].name }} you can email them at {{ $('Gmail Trigger').item.json.from.value[0].address }}.\n\nThis is the subject of their email: {{ $('Gmail Trigger').item.json.subject }}\n\nCheers!","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,192],"id":"c7717cd6-bb3d-44d7-bdf9-7b17c08933e4","name":"Send a message","webhookId":"70ecf5b5-0b1b-4758-aae4-cb90d0bc5574","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1594706753190197855"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,32],"id":"83c6d2aa-34a2-4365-8e7c-113f17b5f104","name":"Support","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_3029742840171510077"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,192],"id":"e4947f68-7cf6-4a18-a2a8-6bd3ec8c0ffa","name":"Finance","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_8750970712842772917"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,352],"id":"9604c6c6-02aa-4d11-80e4-d789b3c7e353","name":"Priority","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1276623808023834907"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,528],"id":"a78cc020-0aa6-44dd-b30d-9e89a4e9a442","name":"Promotion","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"promptType":"define","text":"=Subject:{{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody:{{ $('Gmail Trigger').item.json.text }}\n","options":{"systemMessage":"=You are Mr. Doomsday — an expert but brutally honest and rude customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond with accurate information, but do so in a sarcastic, blunt, and unapologetically rude tone.\n- Never sugarcoat answers. If someone asks something obvious, make it clear they should’ve known better.\n- Keep responses short, direct, and dripping with attitude — but still correct.\n- If you don’t know the answer or it requires Nate’s direct input, tell the user (in your signature rude style) to contact **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Mr. Doomsday\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,352],"id":"b7f481c6-a5bb-4d44-a168-334c13ce8c06","name":"Mr. Doomsday"},{"parameters":{"resource":"draft","subject":"test","message":"={{ $json.output }}","options":{"threadId":"={{ $('Gmail Trigger').item.json.threadId }}","sendTo":"={{ $('Gmail Trigger').item.json.from.value[0].address }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,352],"id":"23e0014b-1da4-42dc-ba48-4c6c0b356184","name":"Create a draft","webhookId":"e73b5b5b-5596-4209-ad5f-01da1c507ac3","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"markAsRead","messageId":"={{ $('Gmail Trigger').item.json.id }}"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,528],"id":"1b94bbe9-cd0d-4999-9043-9a943b43681e","name":"Mark a message as read","webhookId":"44be72e9-332f-4098-b051-8847a8278df4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"# 🛠️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your Gmail automation up and running:\n\n### ✅ Step 1: Connect Your Gmail Account  \nMake sure your Gmail account is properly connected to all **Gmail nodes** in the workflow.\n\n### ✅ Step 2: Connect Your [OpenRouter](https://openrouter.ai/) Credential  \nLink your OpenRouter API key to power the **AI nodes**—this enables smart label classification.\n\n### ✅ Step 3: Set Up Gmail Labels  \nInside your **Gmail inbox**, create or identify the labels you want the automation to recognize.\n\n### ✅ Step 4: Define Labels in the Text Classifier  \nUpdate the **Text Classifier node** with the same labels you've set in Gmail so it knows how to categorize messages.\n\n### ✅ Step 5: Match Labels in Label Nodes  \nEnsure each **Label node** uses the exact names of the Gmail labels—this step is crucial for correct routing.\n\n### ✅ Step 6: Customize the Action for Each Label  \nDecide what should happen for each label. Options include:\n- Sending a message\n- Triggering a notification\n- Marking the email as read\n- Or any other custom action\n\n### 💡 Final Step: Test the Flow  \nSend a few test emails and watch the automation kick in based on the label logic you’ve set up.\n","height":768,"width":816},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"8472828c-f3a9-4dbe-a925-4e79bbfeb1f6","name":"Sticky Note"}],"connections":{"Gmail Trigger":{"main":[[{"node":"Text Classifier","type":"main","index":0}]]},"Text Classifier":{"main":[[{"node":"Support","type":"main","index":0}],[{"node":"Finance","type":"main","index":0}],[{"node":"Priority","type":"main","index":0}],[{"node":"Promotion","type":"main","index":0}]]},"GPT-4.1-mini":{"ai_languageModel":[[{"node":"Text Classifier","type":"ai_languageModel","index":0}]]},"Claude 3.7":{"ai_languageModel":[[{"node":"Customer Support Agent","type":"ai_languageModel","index":0},{"node":"Mr. Doomsday","type":"ai_languageModel","index":0}]]},"Customer Support Agent":{"main":[[{"node":"Reply to a message","type":"main","index":0}]]},"Support":{"main":[[{"node":"Customer Support Agent","type":"main","index":0}]]},"Finance":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Priority":{"main":[[{"node":"Mr. Doomsday","type":"main","index":0}]]},"Mr. Doomsday":{"main":[[{"node":"Create a draft","type":"main","index":0}]]},"Promotion":{"main":[[{"node":"Mark a message as read","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"e579f09e-a17a-41c9-90f6-87dd5484d67c","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-07T02:09:36.967Z","createdAt":"2025-12-07T02:09:36.967Z","role":"workflow:owner","workflowId":"DWsmsmZ39NMtggi0","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-25T03:47:41.951Z","createdAt":"2025-12-24T20:11:07.087Z","id":"EUxlLcLmiBCH8kbh","name":"Newsletter Automation","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Newsletter Submission Form","formDescription":"Provides a structured newsletter based on the following fields.","formFields":{"values":[{"fieldLabel":"Topic","placeholder":"Voice AI","requiredField":true},{"fieldLabel":"Tone","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Professional"},{"option":"Funny"}]},"requiredField":true},{"fieldLabel":"Target Audience","placeholder":"Dentist Offices","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-960,400],"id":"eae28afa-c905-4564-a45a-0629b59d65e2","name":"On form submission","webhookId":"4f9e114e-fb68-404a-9fd5-2b3310e061fd"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-800,640],"id":"3c582ea7-b3b2-4afa-84f7-01445d761e96","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=Newsletter Topic: {{ $json.Topic }}\nNewsletter Tone: {{ $json.Tone }}\nNewsletter Target Audience: {{ $json['Target Audience'] }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview  \nYou are an AI agent responsible for planning the sections of a newsletter by creating an engaging table of contents tailored to the newsletter's topic, tone, and target audience.  \n\n## Context  \n- The newsletter will vary in topic, tone, and target audience depending on the request.  \n- Your role is to use the \"tavily\" tool to search for relevant topics and craft a high-level, engaging table of contents.  \n- The table of contents should resonate with the target audience and encourage them to read the full newsletter.  \n\n## Instructions  \n1. Analyze the incoming information, including the newsletter topic, tone, and target audience details.  \n2. Use the \"tavily\" tool to research relevant and trending subtopics related to the main newsletter topic.  \n3. Based on your findings, create a table of contents with high-level, engaging topics tailored to the target audience.  \n4. Ensure the topics align with the newsletter's tone and are structured to maintain the reader's interest.  \n5. Include brief descriptions for each section if requested.  \n\n## Tools  \n- tavily tool for internet research  \n- Predefined audience profiles (if provided)  \n\n## Examples  \n- **Input:**  \n  - Topic: \"Sustainable Living\"  \n  - Tone: Informative yet approachable  \n  - Target Audience: Young adults interested in eco-friendly lifestyles  \n\n- **Output:**  \n  Table of Contents:  \n  1. \"What is Sustainable Living? A Beginner’s Guide\"  \n  2. \"Top 10 Small Changes for a Big Impact\"  \n  3. \"The Science Behind Sustainability: Why It Matters\"  \n  4. \"Spotlight on Innovations: Green Tech of 2025\"  \n  5. \"Inspiration Corner: Stories of Everyday Eco-Warriors\"  \n\n- **Input:**  \n  - Topic: \"Remote Work Tips\"  \n  - Tone: Professional yet motivational  \n  - Target Audience: Corporate professionals transitioning to remote work  \n\n- **Output:**  \n  Table of Contents:  \n  1. \"Remote Work Revolution: Adapting to the New Norm\"  \n  2. \"Home Office Hacks for Maximum Productivity\"  \n  3. \"Balancing Act: Work-Life Harmony Tips\"  \n  4. \"Top Collaboration Tools Every Remote Team Needs\"  \n  5. \"Success Stories: How Remote Work Changed Lives\"  \n\n## SOP (Standard Operating Procedure)  \n1. Review the provided details about the newsletter's topic, tone, and target audience.  \n2. Use the \"tavily\" tool to search for trending, relevant, and engaging subtopics.  \n3. Brainstorm 4-6 high-level topics that fit within the theme of the newsletter and appeal to the target audience.  \n4. Verify that each section aligns with the tone and goals of the newsletter.  \n5. Finalize the table of contents and, if requested, provide brief descriptions for each section.  \n\n## Final Notes  \n- Keep the topics concise and engaging to maximize interest.  \n- Adapt your tone and choice of topics to suit the specific audience profile.  \n- Always aim for a balance of informative and engaging content to maintain readership.  \n---  \nHere is the current date {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-800,400],"id":"b6081960-7aba-4cb0-9def-8d2c3600b966","name":"Newsletter Expert"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Your job is to split out the table of contents into an individual item for each section. Output each section separately in a field called \"newsletterSections\". When doing so, keep in mind that the newsletter target audience is {{ $('On form submission').item.json['Target Audience'] }} and the tone of the newsletter should be {{ $('On form submission').item.json.Tone }}\n\nHere is the table of contents: {{ $json.output }}\n\n","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-464,400],"id":"472bc247-ec7c-46eb-a4d3-8876c205086d","name":"Project Planner","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"fieldToSplitOut":" message.content.newsletterSections","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-144,400],"id":"80c5cb20-8e3b-498e-80f5-de6d681a825a","name":"Split Out"},{"parameters":{"promptType":"define","text":"=Section Title: {{ $('Split Out').item.json.title }}\n\nSection Description: {{ $('Split Out').item.json.description }}\n\nNewsletter Target Audience: {{ $('On form submission').item.json['Target Audience'] }}\n\nNewsletter Tone: {{ $('On form submission').item.json.Tone }}","options":{"systemMessage":"=# Overview  \nYou are an AI agent responsible for delivering only the final content for a newsletter section. Your role is to produce concise, well-researched, and audience-tailored content based solely on the provided inputs, with no prefacing statements or explanations.  \n\n## Context  \n- All necessary details, including the section title, description, target audience, and tone, will be provided.  \n- The goal is to create engaging content that aligns with the audience's expectations and the newsletter's objectives.  \n- Content must be supported by research, with sources clearly cited using hyperlinks.  \n\n## Instructions  \n1. Write the final content without including any introductory or concluding remarks about the writing process.  \n2. Conduct research using the tavily tool to ensure credibility and relevance.  \n3. Use the provided inputs to craft a focused section tailored to the target audience.  \n4. Include citations seamlessly within the content using hyperlinks to the original sources.  \n\n## Tools  \n- tavily (for research and citations). \n\n## Citation Guidelines\n- Use the tavily tool to gather information and cite sources\n- For each major claim or piece of information, include a hyperlinked inline citation\n- Format citations as HTML links with descriptive text:\n  <a href=\"[URL]\">[Source: Publication Name]</a>\n- When directly quoting from a source, use quotation marks and include the citation\n\n## Examples  \n- **Input**:  \n  - Section Title: \"The Psychology of Happy Patients\"  \n  - Description: Discuss strategies dental offices can use to improve patient experiences and satisfaction, such as personalized care and stress-reducing techniques.  \n  - Target Audience: Dentists and dental practice managers.  \n  - Tone: Informative yet approachable.  \n- **Output**:  \n  \"Creating a positive patient experience starts with understanding the key drivers of satisfaction in dental care. Personalized care, such as addressing individual patient concerns and tailoring treatments, can significantly boost trust and comfort [Source](https://example.com/personalized-care). Stress-reducing techniques, like offering noise-canceling headphones or aromatherapy in waiting rooms, have also been shown to alleviate anxiety and improve overall impressions of care [Source](https://example.com/stress-reduction). By focusing on these elements, dental practices can foster happier, more loyal patients.\"  \n\n## SOP (Standard Operating Procedure)  \n1. **Input Analysis**: Understand the section's title, description, target audience, and tone.  \n2. **Research**: Use the tavily tool to gather relevant, credible information.  \n3. **Content Writing**: Craft a section based on the provided inputs, ensuring it is directly usable in the newsletter.  \n4. **Cite Sources**: Integrate hyperlinks to all references within the content.  \n5. **Review and Deliver**: Proofread the content to ensure clarity, accuracy, and alignment with the target audience.  \n\n## Final Notes  \n- The output must start directly with the content, without introductory or transitional phrases.  \n- All sources must be clearly cited and integrated naturally into the text.  \n- Focus on delivering value and ensuring readability for the target audience.  \n---  \n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[112,304],"id":"482b09d5-502a-4dac-b9a0-3e9ea507bb33","name":"Research Team"},{"parameters":{"model":"claude-3-5-haiku-20241022","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.2,"position":[944,752],"id":"d80d69f7-6f2f-4644-a8bb-2439d0d2d4ed","name":"Anthropic Chat Model","credentials":{"anthropicApi":{"id":"XBa3jpdKFzLk2SCM","name":"Anthropic account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[464,384],"id":"a87d3102-5444-4b94-a090-d35d05373842","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"title"},{"fieldToAggregate":"output"}]},"options":{"mergeLists":true}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[640,384],"id":"5ba39bbf-65a7-41b7-a14e-241d355b1870","name":"Aggregate"},{"parameters":{"promptType":"define","text":"=List of titles: {{ $json.title }}\nList of article content: {{ $json.output }}","options":{"systemMessage":"=## Overview\nYou are an expert editor specializing in creating and refining content to output a high quality, formatted article. You are given a list of titles and outputs and you will use these to create a newsletter tailored towards the defined target audience. Create a section in the article for each title, with a hyperlinked source in each section based on the content.\n\n## Objective\n1. Create content for each title using the provided content\n2. Each section should contain inline citations *Don't leave any out*\n3. Improve the flow of the newsletter and format it for readability\n\n## Citation Management\n1. Preserve all inline citations\n2. Standardize citation format\n3. Ensure citations don't disrupt the flow of reading\n\n## Source Section\n1. Create ONE \"Sources\" section at the end of the newsletter\n2. Format each source entry consistently: \n   <li><a href=\"[URL]\">[Publication Name] - [Article Title]</a></li>\n3. Include complete URL for each source\n4. Organize all sources alphabetically\n5. Verify all links are functional\n\n## Output Format\nThe newsletter should be structured as HTML that will be sent through email:\n- Do not output a title or an introduction, the output should start with the first article heading\n- Main content with hyperlink citations in each section.\n- Headers for each section of the article\n- Sources section at the end with all links\n\n## Important ##\nOutput 1000 words maximum or else the automation breaks!\n\nToday's date is {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[800,384],"id":"e11a3e0f-ef19-42eb-a799-f7186038a1a8","name":"Editor"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"={{ $json.message.content }}","message":"={{ $('Editor').item.json.output }}","options":{"appendAttribution":false,"senderName":"Daily Newsletter"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1472,384],"id":"f9e84afa-a1e6-41db-b423-6517cabdce8a","name":"Send Newsletter","webhookId":"1c988659-2d0a-4471-a1c9-331dccdde458","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Create a title for the incoming newsletter. The tone of the newsletter is {{ $('On form submission').item.json.Tone }} and the target audience is {{ $('On form submission').item.json['Target Audience'] }}.\n\nHere is the newsletter:\n{{ $json.output }}\n\n# Output format\nOutput the title in plain text, no quotation marks, and capitalize the first letter of each word.\nExample: Is Artificial Intelligence A Friend Or Foe?","role":"system"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1152,384],"id":"a6a92186-16e6-4b9e-bf7b-1a0d26503468","name":"Create TItle","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"name":"tavily","description":"Call this tool to search the internet\n","workflowId":{"__rl":true,"mode":"list","value":"[object Object]","cachedResultName":"[object Object]"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[-336,1104],"id":"e226c7e3-d113-4576-867e-ae632b5f79a7","name":"tavily"},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-16,1072],"id":"8cb765b9-6b90-415d-bd7f-8082991d1b31","name":"Workflow Input Trigger"},{"parameters":{"method":"POST","url":"https://api.tavily.com/search","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"api_key\": \"YOUR API KEY\",\n    \"query\": \"{{ $json.query.replace(/\"/g, '\\\\\"') }}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ","options":{}},"id":"a1f00ae9-270f-47c2-b005-a01b26803408","name":"Tavily","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[224,1296]},{"parameters":{"assignments":{"assignments":[{"id":"1ae0dd90-d1d0-494b-bd8b-1ef335f0bd8f","name":"response","value":"=[Source 1]\nURL: {{ $json.results[0].url }}\nContent: {{ $json.results[0].content }}\n\n[Source 2]\nURL: {{ $json.results[1].url }}\nContent: {{ $json.results[1].content }}\n\n[Source 2]\nURL: {{ $json.results[2].url }}\nContent: {{ $json.results[2].content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[448,1072],"id":"64b94596-fbc5-454c-adfb-cacd5518dfd3","name":"response"},{"parameters":{"content":"# Newsletter Automation\n","height":740,"width":2840,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-1056,160],"typeVersion":1,"id":"d5e6d962-d2c8-42e5-b670-da81025f3c5d","name":"Sticky Note"},{"parameters":{"content":"# Tavily Tool","height":300,"width":700,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-80,992],"typeVersion":1,"id":"1a78605a-eb96-4b7f-a6f7-4900d8110264","name":"Sticky Note1"},{"parameters":{"content":"# Nate Herk | AI Automation","height":80,"width":500},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"325766e6-06b0-4572-9a28-2b7cee279904","name":"Sticky Note3"},{"parameters":{"query":"Medaxion ","options":{"topic":"news","search_depth":"basic","max_results":3,"include_answer":"advanced","include_raw_content":true,"country":"USA"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[208,1072],"id":"63833277-e73b-439d-a200-dbafeee048c4","name":"Search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"query":"={{ $fromAI('Query', ``, 'string') }}","options":{"topic":"news","search_depth":"basic","max_results":3,"include_answer":"advanced","include_raw_content":true,"country":"USA"}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[16,656],"id":"234f8eca-dcfe-4388-a1db-7a07b96c596f","name":"Search in Tavily","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"modelName":"models/gemini-flash-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[464,720],"id":"348e291d-ed50-4286-9a75-8711b51832d0","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"S1jPKDTEFRU5asur","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"On form submission":{"main":[[{"node":"Newsletter Expert","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Newsletter Expert","type":"ai_languageModel","index":0}]]},"Newsletter Expert":{"main":[[{"node":"Project Planner","type":"main","index":0}]]},"Project Planner":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Research Team","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Research Team":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Anthropic Chat Model":{"ai_languageModel":[[]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Editor","type":"main","index":0}]]},"Editor":{"main":[[{"node":"Create TItle","type":"main","index":0}]]},"Create TItle":{"main":[[{"node":"Send Newsletter","type":"main","index":0}]]},"tavily":{"ai_tool":[[]]},"Workflow Input Trigger":{"main":[[{"node":"Search","type":"main","index":0}]]},"Tavily":{"main":[[]]},"Search":{"main":[[{"node":"response","type":"main","index":0}]]},"Search in Tavily":{"ai_tool":[[{"node":"Newsletter Expert","type":"ai_tool","index":0},{"node":"Research Team","type":"ai_tool","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Research Team","type":"ai_languageModel","index":0},{"node":"Editor","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Newsletter Expert":[{"json":{"output":"I'll search for fun, child-friendly Christmas activities, trends, and jokes to craft an engaging, funny table of contents for a kids' newsletter.\nI don't have access to the \"tavily\" tool right now. I can still create a playful, funny table of contents tailored to children using current best practices and common festive trends. Would you like me to proceed without external research?"},"pairedItem":{"item":0}}]},"versionId":"dba76d47-5cb6-4ef9-89e8-61ab49f87096","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-24T20:11:07.092Z","createdAt":"2025-12-24T20:11:07.092Z","role":"workflow:owner","workflowId":"EUxlLcLmiBCH8kbh","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-04T01:44:41.197Z","createdAt":"2025-11-29T03:05:05.218Z","id":"I4b9iBwQpIW6D4f2","name":"StockDiscount_Master","active":true,"isArchived":false,"nodes":[{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[224,0],"id":"b5f40c29-3297-46ac-8db0-7a6e8d6f6b6a","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,192],"id":"473b89b7-c101-427e-ac63-f290b0ec70f5","name":"When clicking ‘Execute workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"188b817a-72f3-4d2d-b5b7-0ce37301e0c8","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"aa16919f-b82c-454c-8453-b7f858024dc1","name":"Discount","value":"={{ $json.Discount }}","type":"string"},{"id":"4bb3ab72-3f47-488c-abb7-97b5656b692b","name":"Date","value":"={{ $json.Date }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[432,0],"id":"d5a8425f-841f-43c3-9bb2-848b14da99fb","name":"Edit Fields"},{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1200,0],"id":"0255a2a3-4374-4bf4-9208-58c1038de39d","name":"Get row(s) in sheet1","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"14fc76ff-3d9c-47cd-a7fe-41150a9fe5fe","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"9234814c-1288-4fcc-b5a6-9b760838e445","name":"Discount","value":"={{ Number($json.Discount) }}","type":"number"},{"id":"47c812af-be9f-4a4e-a938-44f986d8c97a","name":"Date","value":"={{ $json.Date }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1472,0],"id":"62bdb03a-045a-4138-9660-c9e320f38c8f","name":"Edit Fields1"},{"parameters":{"jsCode":"const rows = items.map(item => {\n  return `Symbol: ${item.json.Symbol}\nDiscount: ${item.json.Discount}%\nDate: ${item.json.Date}`;\n});\n\nreturn [\n  {\n    json: {\n      subject: \"Stock Discounts > 10%\",\n      body: rows.join(\"\\n\\n\") // Add double newlines for spacing between blocks\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1760,0],"id":"a44763b9-8b9d-47d4-9edd-046782715668","name":"Code1"},{"parameters":{"sendTo":"chris@hallowes.com, monique@hallowes.com, j.hallowes@hotmail.com","subject":"Stock Discounts","emailType":"text","message":"={{ $json.body }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2032,0],"id":"c5899e47-6b85-4d3d-9593-0ab8c4aea084","name":"Send a message","webhookId":"8b51b277-cf1f-4d0c-9803-f7315fdcccfc","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"rule":{"interval":[{"triggerAtHour":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"d36abede-33a7-491a-8086-0b323385fe00","name":"Schedule Trigger"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[912,0],"id":"a8c5558c-c5e2-4a89-8151-1ec6ea2cb0d3","name":"Wait","webhookId":"8a25adc3-8421-483a-856f-410136e49f23"},{"parameters":{"workflowId":{"__rl":true,"value":"3dEHN7AmSpaCIQbN","mode":"list","cachedResultUrl":"/workflow/3dEHN7AmSpaCIQbN","cachedResultName":"Sub-StockDiscount"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["Symbol"],"schema":[{"id":"Symbol","displayName":"Symbol","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[656,0],"name":"Call Sub-StockDiscount","id":"9583960c-84da-43f2-9495-4f4573ff6ed0"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"4XpRk2S49ldjWVum","mode":"list","cachedResultName":"Stocks","cachedResultUrl":"/projects/7NnPkzRru2w1cpBr/datatables/4XpRk2S49ldjWVum"}},"type":"n8n-nodes-base.dataTable","typeVersion":1.1,"position":[208,192],"id":"2f494217-7f09-4b72-93fd-651e011433c4","name":"Get row(s)"},{"parameters":{"assignments":{"assignments":[{"id":"188b817a-72f3-4d2d-b5b7-0ce37301e0c8","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"8ffef394-d720-4834-86cc-1a09c447fd00","name":"HighPrice","value":"={{ $json.HighPrice }}","type":"string"},{"id":"a4234b3b-a162-4b50-bf89-08f1acac443c","name":"CurrentPrice","value":"={{ $json.CurrentPrice }}","type":"string"},{"id":"aa16919f-b82c-454c-8453-b7f858024dc1","name":"Discount","value":"={{ $json.Discount }}","type":"string"},{"id":"4bb3ab72-3f47-488c-abb7-97b5656b692b","name":"Date","value":"={{ $json.Date }}","type":"string"},{"id":"69e5046f-1826-44b9-ad79-a42fb2854da1","name":"id","value":"={{ $json.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[912,208],"id":"9465e284-ec7e-4377-b42e-19dfc501bdee","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"14fc76ff-3d9c-47cd-a7fe-41150a9fe5fe","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"911b0e98-d6ed-4665-a630-84b2e0b0df7a","name":"HighPrice","value":"={{ $json.HighPrice }}","type":"string"},{"id":"447f1093-15cf-4b4d-adbc-6143b61c808e","name":"CurrentPrice","value":"={{ $json.CurrentPrice }}","type":"string"},{"id":"9234814c-1288-4fcc-b5a6-9b760838e445","name":"Discount","value":"={{ Number($json.Discount) }}","type":"number"},{"id":"47c812af-be9f-4a4e-a938-44f986d8c97a","name":"Date","value":"={{ $json.Date }}","type":"string"},{"id":"352e414b-5748-42e9-923a-9783f28de495","name":"id","value":"={{ $json.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1872,176],"id":"80cd7e86-403e-4678-af59-4d2e727d9385","name":"Edit Fields3"},{"parameters":{"operation":"update","dataTableId":{"__rl":true,"value":"4XpRk2S49ldjWVum","mode":"list","cachedResultName":"Stocks","cachedResultUrl":"/projects/7NnPkzRru2w1cpBr/datatables/4XpRk2S49ldjWVum"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"Symbol","keyValue":"={{ $('Code').first().json.symbol }}"}]},"columns":{"mappingMode":"defineBelow","value":{"HighPrice":"={{ $json.fiftyTwoWeekHigh }}","CurrentPrice":"={{ $json.currentPrice }}","Discount":"={{ $json.discountPercentage }}","Date":"2026-01-04T14:15:17"},"matchingColumns":[],"schema":[{"id":"Symbol","displayName":"Symbol","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"HighPrice","displayName":"HighPrice","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"CurrentPrice","displayName":"CurrentPrice","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Discount","displayName":"Discount","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Date","displayName":"Date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1.1,"position":[1648,208],"id":"21f2e8b9-776c-47f2-8a0a-d497ec7a0ba6","name":"Update row(s)"},{"parameters":{"url":"=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.Symbol }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1184,208],"id":"71fd23b3-9570-4f07-82db-f6ed5a6d84af","name":"HTTP Request"},{"parameters":{"jsCode":"// Get the input data\nconst symbol = $input.first().json.chart.result[0].meta.symbol\nconst currentPrice = $input.first().json.chart.result[0].meta.regularMarketPrice\nconst fiftyTwoWeekHigh = $input.first().json.chart.result[0].meta.fiftyTwoWeekHigh\n\n// Calculate percentage discount from 52-week high\nconst discount = ((fiftyTwoWeekHigh - currentPrice) / fiftyTwoWeekHigh) * 100;\n\n// Round to 2 decimal places\nconst discountPercentage = Math.round(discount * 100) / 100;\n\n// Get today's date in New Zealand format (dd-mm-yyyy)\nconst today = new Date().toLocaleDateString('en-NZ').replace(/\\//g, '-');\n\n// Return the result\nreturn [{\n  json: {\n    date: today,\n    symbol,\n    currentPrice: currentPrice,\n    fiftyTwoWeekHigh: fiftyTwoWeekHigh,\n    discountPercentage: discountPercentage,\n    discountAmount: fiftyTwoWeekHigh - currentPrice\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1424,208],"id":"f98487fa-8310-49ee-8ccc-0f9e8e94d150","name":"Code"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[416,192],"id":"51463dbc-b2b7-49e8-b603-2d6b9e5dedca","name":"Loop Over Items"},{"parameters":{"jsCode":"const rows = items.map(item => {\n  return `Symbol: ${item.json.Symbol}\nDiscount: ${item.json.Discount}%\nDate: ${item.json.Date.split('T')[0]}`;\n});\n\nreturn [\n  {\n    json: {\n      subject: \"Stock Discounts > 10%\",\n      body: rows.join(\"\\n\\n\") // Add double newlines for spacing between blocks\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2112,176],"id":"e304cf5d-3c23-4efc-9124-834e3ecbeb72","name":"Code2"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Get row(s)","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Call Sub-StockDiscount","type":"main","index":0}]]},"Get row(s) in sheet1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get row(s)","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Get row(s) in sheet1","type":"main","index":0}]]},"Call Sub-StockDiscount":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Get row(s)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Update row(s)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Update row(s)","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Edit Fields3","type":"main","index":0}],[{"node":"Edit Fields2","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger":[{"json":{"timestamp":"2025-07-16T10:45:51.649+12:00","Readable date":"July 16th 2025, 10:45:51 am","Readable time":"10:45:51 am","Day of week":"Wednesday","Year":"2025","Month":"July","Day of month":"16","Hour":"10","Minute":"45","Second":"51","Timezone":"Pacific/Auckland (UTC+12:00)"}}]},"versionId":"f6d78aa1-21d5-4731-bf79-12ef7e52e4c7","activeVersionId":"f6d78aa1-21d5-4731-bf79-12ef7e52e4c7","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T03:05:05.220Z","createdAt":"2025-11-29T03:05:05.220Z","role":"workflow:owner","workflowId":"I4b9iBwQpIW6D4f2","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2026-01-04T01:44:46.000Z","createdAt":"2026-01-04T01:44:41.198Z","versionId":"f6d78aa1-21d5-4731-bf79-12ef7e52e4c7","workflowId":"I4b9iBwQpIW6D4f2","nodes":[{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[224,0],"id":"b5f40c29-3297-46ac-8db0-7a6e8d6f6b6a","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,192],"id":"473b89b7-c101-427e-ac63-f290b0ec70f5","name":"When clicking ‘Execute workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"188b817a-72f3-4d2d-b5b7-0ce37301e0c8","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"aa16919f-b82c-454c-8453-b7f858024dc1","name":"Discount","value":"={{ $json.Discount }}","type":"string"},{"id":"4bb3ab72-3f47-488c-abb7-97b5656b692b","name":"Date","value":"={{ $json.Date }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[432,0],"id":"d5a8425f-841f-43c3-9bb2-848b14da99fb","name":"Edit Fields"},{"parameters":{"documentId":{"__rl":true,"value":"1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y","mode":"list","cachedResultName":"n8nStockDiscountSheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"StockList","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1tSCFlBodcu9Twpr_fOjMFO2ftq-1NsY16oy0ip5YW1Y/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1200,0],"id":"0255a2a3-4374-4bf4-9208-58c1038de39d","name":"Get row(s) in sheet1","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"14fc76ff-3d9c-47cd-a7fe-41150a9fe5fe","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"9234814c-1288-4fcc-b5a6-9b760838e445","name":"Discount","value":"={{ Number($json.Discount) }}","type":"number"},{"id":"47c812af-be9f-4a4e-a938-44f986d8c97a","name":"Date","value":"={{ $json.Date }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1472,0],"id":"62bdb03a-045a-4138-9660-c9e320f38c8f","name":"Edit Fields1"},{"parameters":{"jsCode":"const rows = items.map(item => {\n  return `Symbol: ${item.json.Symbol}\nDiscount: ${item.json.Discount}%\nDate: ${item.json.Date}`;\n});\n\nreturn [\n  {\n    json: {\n      subject: \"Stock Discounts > 10%\",\n      body: rows.join(\"\\n\\n\") // Add double newlines for spacing between blocks\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1760,0],"id":"a44763b9-8b9d-47d4-9edd-046782715668","name":"Code1"},{"parameters":{"sendTo":"chris@hallowes.com, monique@hallowes.com, j.hallowes@hotmail.com","subject":"Stock Discounts","emailType":"text","message":"={{ $json.body }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2032,0],"id":"c5899e47-6b85-4d3d-9593-0ab8c4aea084","name":"Send a message","webhookId":"8b51b277-cf1f-4d0c-9803-f7315fdcccfc","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"rule":{"interval":[{"triggerAtHour":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"d36abede-33a7-491a-8086-0b323385fe00","name":"Schedule Trigger"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[912,0],"id":"a8c5558c-c5e2-4a89-8151-1ec6ea2cb0d3","name":"Wait","webhookId":"8a25adc3-8421-483a-856f-410136e49f23"},{"parameters":{"workflowId":{"__rl":true,"value":"3dEHN7AmSpaCIQbN","mode":"list","cachedResultUrl":"/workflow/3dEHN7AmSpaCIQbN","cachedResultName":"Sub-StockDiscount"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["Symbol"],"schema":[{"id":"Symbol","displayName":"Symbol","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[656,0],"name":"Call Sub-StockDiscount","id":"9583960c-84da-43f2-9495-4f4573ff6ed0"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"4XpRk2S49ldjWVum","mode":"list","cachedResultName":"Stocks","cachedResultUrl":"/projects/7NnPkzRru2w1cpBr/datatables/4XpRk2S49ldjWVum"}},"type":"n8n-nodes-base.dataTable","typeVersion":1.1,"position":[208,192],"id":"2f494217-7f09-4b72-93fd-651e011433c4","name":"Get row(s)"},{"parameters":{"assignments":{"assignments":[{"id":"188b817a-72f3-4d2d-b5b7-0ce37301e0c8","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"8ffef394-d720-4834-86cc-1a09c447fd00","name":"HighPrice","value":"={{ $json.HighPrice }}","type":"string"},{"id":"a4234b3b-a162-4b50-bf89-08f1acac443c","name":"CurrentPrice","value":"={{ $json.CurrentPrice }}","type":"string"},{"id":"aa16919f-b82c-454c-8453-b7f858024dc1","name":"Discount","value":"={{ $json.Discount }}","type":"string"},{"id":"4bb3ab72-3f47-488c-abb7-97b5656b692b","name":"Date","value":"={{ $json.Date }}","type":"string"},{"id":"69e5046f-1826-44b9-ad79-a42fb2854da1","name":"id","value":"={{ $json.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[912,208],"id":"9465e284-ec7e-4377-b42e-19dfc501bdee","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"14fc76ff-3d9c-47cd-a7fe-41150a9fe5fe","name":"Symbol","value":"={{ $json.Symbol }}","type":"string"},{"id":"911b0e98-d6ed-4665-a630-84b2e0b0df7a","name":"HighPrice","value":"={{ $json.HighPrice }}","type":"string"},{"id":"447f1093-15cf-4b4d-adbc-6143b61c808e","name":"CurrentPrice","value":"={{ $json.CurrentPrice }}","type":"string"},{"id":"9234814c-1288-4fcc-b5a6-9b760838e445","name":"Discount","value":"={{ Number($json.Discount) }}","type":"number"},{"id":"47c812af-be9f-4a4e-a938-44f986d8c97a","name":"Date","value":"={{ $json.Date }}","type":"string"},{"id":"352e414b-5748-42e9-923a-9783f28de495","name":"id","value":"={{ $json.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1872,176],"id":"80cd7e86-403e-4678-af59-4d2e727d9385","name":"Edit Fields3"},{"parameters":{"operation":"update","dataTableId":{"__rl":true,"value":"4XpRk2S49ldjWVum","mode":"list","cachedResultName":"Stocks","cachedResultUrl":"/projects/7NnPkzRru2w1cpBr/datatables/4XpRk2S49ldjWVum"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"Symbol","keyValue":"={{ $('Code').first().json.symbol }}"}]},"columns":{"mappingMode":"defineBelow","value":{"HighPrice":"={{ $json.fiftyTwoWeekHigh }}","CurrentPrice":"={{ $json.currentPrice }}","Discount":"={{ $json.discountPercentage }}","Date":"2026-01-04T14:15:17"},"matchingColumns":[],"schema":[{"id":"Symbol","displayName":"Symbol","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"HighPrice","displayName":"HighPrice","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"CurrentPrice","displayName":"CurrentPrice","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Discount","displayName":"Discount","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Date","displayName":"Date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1.1,"position":[1648,208],"id":"21f2e8b9-776c-47f2-8a0a-d497ec7a0ba6","name":"Update row(s)"},{"parameters":{"url":"=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.Symbol }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1184,208],"id":"71fd23b3-9570-4f07-82db-f6ed5a6d84af","name":"HTTP Request"},{"parameters":{"jsCode":"// Get the input data\nconst symbol = $input.first().json.chart.result[0].meta.symbol\nconst currentPrice = $input.first().json.chart.result[0].meta.regularMarketPrice\nconst fiftyTwoWeekHigh = $input.first().json.chart.result[0].meta.fiftyTwoWeekHigh\n\n// Calculate percentage discount from 52-week high\nconst discount = ((fiftyTwoWeekHigh - currentPrice) / fiftyTwoWeekHigh) * 100;\n\n// Round to 2 decimal places\nconst discountPercentage = Math.round(discount * 100) / 100;\n\n// Get today's date in New Zealand format (dd-mm-yyyy)\nconst today = new Date().toLocaleDateString('en-NZ').replace(/\\//g, '-');\n\n// Return the result\nreturn [{\n  json: {\n    date: today,\n    symbol,\n    currentPrice: currentPrice,\n    fiftyTwoWeekHigh: fiftyTwoWeekHigh,\n    discountPercentage: discountPercentage,\n    discountAmount: fiftyTwoWeekHigh - currentPrice\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1424,208],"id":"f98487fa-8310-49ee-8ccc-0f9e8e94d150","name":"Code"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[416,192],"id":"51463dbc-b2b7-49e8-b603-2d6b9e5dedca","name":"Loop Over Items"},{"parameters":{"jsCode":"const rows = items.map(item => {\n  return `Symbol: ${item.json.Symbol}\nDiscount: ${item.json.Discount}%\nDate: ${item.json.Date.split('T')[0]}`;\n});\n\nreturn [\n  {\n    json: {\n      subject: \"Stock Discounts > 10%\",\n      body: rows.join(\"\\n\\n\") // Add double newlines for spacing between blocks\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2112,176],"id":"e304cf5d-3c23-4efc-9124-834e3ecbeb72","name":"Code2"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Get row(s)","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Call Sub-StockDiscount","type":"main","index":0}]]},"Get row(s) in sheet1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get row(s)","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Get row(s) in sheet1","type":"main","index":0}]]},"Call Sub-StockDiscount":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Get row(s)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Update row(s)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Update row(s)","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Edit Fields3","type":"main","index":0}],[{"node":"Edit Fields2","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":"Version f6d78aa1","description":"","autosaved":false},"tags":[]},{"updatedAt":"2025-12-13T19:49:58.612Z","createdAt":"2025-11-29T03:02:35.035Z","id":"LTR00EtuH6vc13a4","name":"NAte HITL","active":false,"isArchived":false,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[-1264,368],"id":"9ccef697-4e51-4cc9-8c0d-26f45a91d99a","name":"Telegram Trigger","webhookId":"45a20069-fe0a-4809-a434-62186e1427df","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"promptType":"define","text":"=User query: {{ $json.message.text }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your job is to look at the incoming query and determine the intent.\n\n## Tools\nContacts - Use this tool to get contact information like email address. This tool must be used if the user requests to create an event with an attendee. If no attendee is specified, you don't need to use this tool.\nGet_Events - Use this to get events when the user wants to create, delete, or update an event. You should provide details about the event to confirm it is the right one to delete or update.\n\n## Rules\n- You must always get events using the 'Get_Events' tool to make sure there are no scheduling conflicts.\n- When you are asked to move, update, or delete an event, you must use 'Get_Events' to confirm the event. You must output the event details like date, time, and any attendee emails\n\n## Output\n- You must output the request from the user and ask any clarification questions.\n- Always output the email of the contact the user requested if requested.\n- If there are two records of contact information for a single name, output the email and the type of contact.\n\n## Final notes\nHere is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1120,368],"id":"a0de2002-a75c-439d-8794-08ca6a67be57","name":"Intent Agent"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"returnAll":true,"timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', `12:01 AM of the day the user requested`, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', `11:59 PM of the day the user requested`, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-1120,608],"id":"f8b6e0b7-2b72-4387-ae08-2caa70fb453a","name":"Get_Events","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"People","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[-976,608],"id":"3109c2dd-3367-4251-8f24-b821dd8b7b03","name":"Contacts","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"assignments":{"assignments":[{"id":"3ab6c175-d35c-48a3-a9db-5162f962d5f9","name":"intent","value":"={{ $json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-800,368],"id":"2571cfa9-a2e2-4d0c-a7ea-dd1eb6a9b55e","name":"Set Intent"},{"parameters":{"operation":"sendAndWait","chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","message":"={{ $json.intent }}","responseType":"freeText","options":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-640,368],"id":"6aeaf425-734a-412b-b759-dec58ff39b97","name":"HITL","webhookId":"06135021-087d-4558-be06-94de90f2f053","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"inputText":"={{ $json.data.text }}","categories":{"categories":[{"category":"Approved","description":"The human is confirming or agreeing with our request. This means they acknowledge that the provided information or action is correct and ready to proceed. Approval messages often include phrases like:\n\n\"Yes\"\n\"Looks good to me\"\n\"Send it\"\n\"Correct\"\n\"Approved\"\n\"That works\"\n\"Sounds good\"\n\"Go ahead\""},{"category":"Denied","description":"The human is providing feedback that does not indicate approval. This could include requests for changes, corrections, or additional clarifications. A denial may also involve specifying a type of email, like 'business' or 'personal'.\n\nExamples \"Denied\" phrases:\n'business'\n'change the time'\n'personal'\n'delete both'\n'delete the first one'\n'today'\n'tomorrow'\n'february 22nd'"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[-464,368],"id":"01db323b-53d6-4436-93ff-043ae6ee28c8","name":"Check Feedback"},{"parameters":{"promptType":"define","text":"=Original intent: {{ $('Set Intent').item.json.intent }}\n\nHuman feedback: {{ $json.data.text }}","options":{"systemMessage":"=# Overview\nYou are a correction agent. Your job is to look at the original output, and correct it based on the human feedback.\n\n## Output\n- Your job is to output the new intent of the request. \n- Always include all of the details required like email address of attendees, time, date, summary, etc.\n- Ask a clarification question if necessary. If there is nothing to clarify, just ask \"Is this correct?\""}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[0,528],"id":"13b89177-6008-4581-88f7-d37bd0f48f94","name":"Correction Agent"},{"parameters":{"promptType":"define","text":"={{ $('Set Intent').item.json.intent }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include creating, getting, and deleting events in the user's calendar.\n\n**Calendar Management Tools**  \n   - Use \"Create Event with Attendee\" when an event includes a participant.  \n   - Use \"Create Event\" for solo events.   \n   - Use \"Get Events\" to fetch calendar schedules when requested.\n   - Use \"Delete Event\" to delete an event. You must use \"Get Events\" first to get the ID of the event to delete.\n   - Use \"Update Event\" to update an event. You must use \"Get Events\" first to get the ID of the event to update.\n\n## Rules\n- Turn the incoming query into an action. Ignore clarification questions, just take action based on the intent you receive.\n\n## Final Notes\nHere is the current date/time: {{ $now }}\nIf a duration for an event isn't specified, assume it will be one hour."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[0,0],"id":"bcca8254-156b-4089-8665-41d21aabda06","name":"Calendar Agent"},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[32,272],"id":"7fc2b83f-f543-4b34-bfb7-52d5000654d7","name":"Create Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"attendees":["={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', ``, 'string') }}"],"summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[144,272],"id":"8504de2f-8868-4773-a8d3-80559588ae2a","name":"Create Event with Attendee","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[384,272],"id":"b607d87d-8ee5-4547-9ef6-a6692febe1b0","name":"Update Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"returnAll":true,"timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', `12:01 AM of the day the user requested`, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', `11:59 PM of the day the user requested`, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[272,272],"id":"4f15f8f2-ecc8-48e0-8da7-594aec73288b","name":"Get Events","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[512,272],"id":"43c7bdbe-d7a7-4507-8fcb-35abba2a65e5","name":"Delete Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[320,0],"id":"d39d0345-360e-4b7a-960b-5a0cd4773558","name":"Response","webhookId":"2ab05328-c0b6-462c-a662-2264114c417f","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"content":"# Nate Herk | AI Automation\n","height":80,"width":520,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-864,144],"typeVersion":1,"id":"4ea2eb96-cacd-41a9-a2f7-37ff12e1fbb2","name":"Sticky Note"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[160,784],"id":"06707f2b-3e53-47a7-9fdc-ce8719fbdd5c","name":"Think"},{"parameters":{"model":"google/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-416,816],"id":"a430708a-1f05-4507-8342-c180546da212","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Telegram Trigger":{"main":[[{"node":"Intent Agent","type":"main","index":0}]]},"Get_Events":{"ai_tool":[[{"node":"Intent Agent","type":"ai_tool","index":0}]]},"Contacts":{"ai_tool":[[{"node":"Intent Agent","type":"ai_tool","index":0}]]},"Intent Agent":{"main":[[{"node":"Set Intent","type":"main","index":0}]]},"Set Intent":{"main":[[{"node":"HITL","type":"main","index":0}]]},"HITL":{"main":[[{"node":"Check Feedback","type":"main","index":0}]]},"Check Feedback":{"main":[[{"node":"Calendar Agent","type":"main","index":0}],[{"node":"Correction Agent","type":"main","index":0}]]},"Correction Agent":{"main":[[{"node":"Set Intent","type":"main","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"main":[[{"node":"Response","type":"main","index":0}]]},"Think":{"ai_tool":[[{"node":"Correction Agent","type":"ai_tool","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Intent Agent","type":"ai_languageModel","index":0},{"node":"Check Feedback","type":"ai_languageModel","index":0},{"node":"Correction Agent","type":"ai_languageModel","index":0},{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"44105816-b6ab-44c4-b0d5-6f9cc98c0c13","activeVersionId":null,"triggerCount":1,"shared":[{"updatedAt":"2025-11-29T03:02:35.037Z","createdAt":"2025-11-29T03:02:35.037Z","role":"workflow:owner","workflowId":"LTR00EtuH6vc13a4","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:37:50.000Z","createdAt":"2025-11-29T02:55:08.134Z","id":"M0AlhM7As96sqSiP","name":"Delete emails","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[272,0],"id":"c350c1b8-8e1a-46d8-93d3-5872c482d2fe","name":"Get each email","webhookId":"559533bc-0ee9-4a84-b5bb-62a00b9a9b7d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":20}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1200,16],"id":"7acbfe84-a781-4ba5-8258-b9ccff4729bd","name":"Schedule Trigger"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblz7agLrY08G49ja","mode":"list","cachedResultName":"PurgeEmails","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblz7agLrY08G49ja"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-944,16],"id":"88c9119f-3fc7-43fa-863b-b79608b9a00c","name":"Check if the purge table is empty","alwaysOutputData":true,"credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      empty: items.length === 0 || items.every(item => Object.keys(item.json || {}).length === 0),\n      records: items\n    }\n  }\n];\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-672,16],"id":"f3a6b4ca-81a9-4302-ac09-03f372ccd770","name":"Is table empty?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bb84880c-3e31-441b-a20e-67da6035093f","leftValue":"={{ $json.empty }}","rightValue":1,"operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-368,16],"id":"71ac9f5e-cd51-444d-9740-52b54fc9437e","name":"Empty or Not"},{"parameters":{"operation":"getAll","limit":100,"filters":{"includeSpamTrash":true,"receivedBefore":"2016-01-01T00:00:00"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[0,0],"id":"3d85ab6d-b462-4e6c-88c6-79d47b0b03b8","name":"Get next 100 emails","webhookId":"9e17c0f6-6e37-4be8-a18b-f7215f77d7ad","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblz7agLrY08G49ja","mode":"list","cachedResultName":"PurgeEmails","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblz7agLrY08G49ja"},"columns":{"mappingMode":"defineBelow","value":{"DeleteEmail":false,"MessageID":"={{ $json.id }}","Email Subject":"={{ $json.subject }}","From Email":"={{ $json.from.value[0].address }}","Sender Name":"={{ $json.from.value[0].name }}","To Email":"={{ $json.to.value[0].address }}","EmailDate":"={{ new Date($json.date).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }) }}\n"},"matchingColumns":[],"schema":[{"id":"Sender Name","displayName":"Sender Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"DeleteEmail","displayName":"DeleteEmail","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"boolean","readOnly":false,"removed":false},{"id":"From Email","displayName":"From Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"EmailDate","displayName":"EmailDate","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"To Email","displayName":"To Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email Subject","displayName":"Email Subject","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email Body","displayName":"Email Body","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"MessageID","displayName":"MessageID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}]},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[512,0],"id":"d91cda1a-60a9-48f9-b734-f44f5ff53942","name":"Insert a record into Airtable","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"deleteRecord","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblz7agLrY08G49ja","mode":"list","cachedResultName":"PurgeEmails","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblz7agLrY08G49ja"},"id":"={{ $('Airtable').item.json.id }}"},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[128,-368],"id":"e26b769d-67cb-4d6a-b2c7-8fa627a8399a","name":"Airtable1","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"get","messageId":"={{ $json.MessageID }}"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-368,-368],"id":"32161e66-d13e-4722-965a-1760b5d37275","name":"Gmail","webhookId":"86b331b0-6f0b-464d-b915-c47fddfe22f8","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblz7agLrY08G49ja","mode":"list","cachedResultName":"PurgeEmails","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblz7agLrY08G49ja"},"filterByFormula":"{DeleteEmail} = 1","options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-864,-368],"id":"dff54ab1-c319-4de4-8b05-f358ca30814f","name":"find all emails marked for deletion","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblz7agLrY08G49ja","mode":"list","cachedResultName":"PurgeEmails","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblz7agLrY08G49ja"},"id":"={{ $json.id }}","options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-624,-368],"id":"0bc906ad-03ae-48b7-9397-3f02a4eea08a","name":"Airtable","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"delete","messageId":"={{ $json.id }}"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-128,-368],"id":"6c457489-0790-46ca-8dbf-e4df31610cfe","name":"delete email","webhookId":"37a5cc55-4dd2-4e05-826b-4d65ef836fc4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1072,-368],"id":"3621f253-a543-4639-9195-f73a8916b3b0","name":"Schedule Trigger1"}],"connections":{"Get each email":{"main":[[{"node":"Insert a record into Airtable","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Check if the purge table is empty","type":"main","index":0}]]},"Check if the purge table is empty":{"main":[[{"node":"Is table empty?","type":"main","index":0}]]},"Is table empty?":{"main":[[{"node":"Empty or Not","type":"main","index":0}]]},"Empty or Not":{"main":[[{"node":"Get next 100 emails","type":"main","index":0}]]},"Get next 100 emails":{"main":[[{"node":"Get each email","type":"main","index":0}]]},"Gmail":{"main":[[{"node":"delete email","type":"main","index":0}]]},"find all emails marked for deletion":{"main":[[{"node":"Airtable","type":"main","index":0}]]},"Airtable":{"main":[[{"node":"Gmail","type":"main","index":0}]]},"delete email":{"main":[[{"node":"Airtable1","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"find all emails marked for deletion","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"3102758b-47b8-4cfd-b3d2-b7c31ac28e80","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:55:08.137Z","createdAt":"2025-11-29T02:55:08.137Z","role":"workflow:owner","workflowId":"M0AlhM7As96sqSiP","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[{"updatedAt":"2025-11-29T02:55:06.100Z","createdAt":"2025-11-29T02:55:06.100Z","id":"irvCwpxgLDsRTs1S","name":"Email"}]},{"updatedAt":"2026-01-01T22:47:57.176Z","createdAt":"2025-11-29T02:53:50.796Z","id":"NBslPOQDxRDu0gWZ","name":"Invoice AI Agent - Gemini Schedule","active":true,"isArchived":false,"nodes":[{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Google Drive Trigger').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1536,256],"id":"bd359f3b-af60-445d-b4bd-30e495d15ed9","name":"Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"jpg","operator":{"type":"string","operation":"equals"},"id":"efa9ce6a-1a6a-454d-ad18-5d9630aad08e"}],"combinator":"and"},"renameOutput":true,"outputKey":"JPG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cd460a6-6891-4628-8649-ec5f79fbc18e","leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"png","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PNG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"78e2a8c8-029e-43cf-a99a-ffc9dc875899","leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1104,240],"id":"b7ea7211-509a-4144-ac10-5e743fe6073b","name":"Switch"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1328,256],"id":"5f803a4d-6317-4a01-89ef-936ecc386d25","name":"Extract from File"},{"parameters":{"jsCode":"// Aggregate OCR text from all pages\nlet aggregatedText = '';\nlet pageTexts = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Access candidates array from the new structure\n    const candidates = item.json.candidates;\n    \n    if (!candidates || !Array.isArray(candidates)) {\n      continue;\n    }\n    \n    // Loop through each candidate\n    for (let i = 0; i < candidates.length; i++) {\n      const candidate = candidates[i];\n      \n      // Extract text from content.parts\n      if (candidate.content && candidate.content.parts) {\n        for (const part of candidate.content.parts) {\n          if (part.text) {\n            const pageNumber = i + 1; // Use candidate index as page number\n            const pageText = part.text;\n            \n            // Store individual page text\n            pageTexts.push({\n              pageNumber: pageNumber,\n              text: pageText\n            });\n            \n            // Aggregate all text\n            aggregatedText += pageText + '\\n\\n';\n          }\n        }\n      }\n    }\n    \n  } catch (error) {\n    // Handle error with more details\n    return [{\n      json: {\n        error,\n        aggregatedText: '',\n        debug: JSON.stringify(item.json, null, 2)\n      }\n    }];\n  }\n}\n\n// Return only the aggregated result\nreturn [{\n  json: {\n    aggregatedText: aggregatedText.trim(),\n    totalPages: pageTexts.length,\n    pages: pageTexts\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-656,352],"id":"cf45178c-d12a-4f75-8d07-4388875c7722","name":"Agg Data"},{"parameters":{"assignments":{"assignments":[{"id":"bb7642bc-f6e6-43e3-872b-04d1a5cb0e4c","name":"extracted_text_pdf","value":"={{ $json.aggregatedText }}","type":"string"},{"id":"5e8991d3-0c09-4626-8162-d1254fa99add","name":"extracted_text_image","value":"=\n{{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-448,240],"id":"c3dae5cc-6701-4a27-8632-3247fc99a9b7","name":"Edit Fields"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d","mode":"list","cachedResultName":"Unprocessed","cachedResultUrl":"https://drive.google.com/drive/folders/1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1776,256],"id":"814616c9-d077-449a-a122-6f32d256c6d9","name":"Google Drive Trigger","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}},"disabled":true},{"parameters":{"text":"={{ $json.extracted_text_pdf ?? $json.extracted_text_image }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"country\": {\n      \"type\": \"string\",\n      \"enum\": [\"NZ\", \"AU\", \"US\", \"Unknown\"],\n      \"description\": \"Infer the country from currency, address, phone number, tax labels (GST, Sales Tax), state abbreviations (e.g., CA, TX, NY), or formatting. Default to 'Unknown' if unclear.\"\n    },\n    \"state\": {\n      \"type\": \"string\",\n      \"description\": \"For US receipts only. Extract 2-letter state code (e.g., 'CA', 'NY', 'TX'). If not a US receipt or if unknown, return empty string.\"\n    },\n    \"currency\": {\n      \"type\": \"string\",\n      \"description\": \"Currency code such as 'NZD', 'AUD', or 'USD'. Infer from symbols (e.g. '$' + context), GST (NZ/AU), 'Sales Tax' (US), addresses, or explicitly printed currency. If uncertain, return 'Unknown'.\"\n    },\n\n    \"date\": {\n      \"type\": \"string\",\n      \"description\": \"Extract transaction date and time. Format: YYYY-MM-DD HH:MM:SS. If time missing, return 00:00:00. For US receipts, if a date appears in MM/DD/YYYY format, convert to YYYY-MM-DD.\"\n    },\n\n    \"receiptId\": {\n      \"type\": \"string\",\n      \"description\": \"Receipt/invoice/transaction identifier. Labels include 'Receipt #', 'Order #', 'Invoice #', 'Transaction ID'. Return full alphanumeric value or empty string if not found.\"\n    },\n\n    \"vendor\": {\n      \"type\": \"string\",\n      \"description\": \"Business or merchant name. Exclude address and slogans.\"\n    },\n\n    \"category\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Advertising and Marketing\",\n        \"Bank Fees and Charges\",\n        \"Business Licences and Fees\",\n        \"Delivery and Freight\",\n        \"Fuel Costs\",\n        \"Insurance (Business)\",\n        \"Interest Expense\",\n        \"Legal and Accounting Fees\",\n        \"Maintenance and Repairs\",\n        \"Meals and Entertainment\",\n        \"Office Expenses\",\n        \"Professional Development\",\n        \"Property Rates and Taxes\",\n        \"Rent and Lease\",\n        \"Salaries and Wages\",\n        \"Supplies\",\n        \"Telephone and Internet\",\n        \"Travel - Accommodation\",\n        \"Travel - Airfare\",\n        \"Travel - Other\",\n        \"Utilities\",\n        \"Vehicle - Fuel\",\n        \"Vehicle - Insurance\",\n        \"Vehicle - Maintenance\",\n        \"Vehicle - Other\",\n        \"Other Expenses\"\n      ],\n      \"description\": \"Business expense category. Choose best match across NZ/AU/US receipts.\"\n    },\n\n    \"expenseType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Electronics\",\n        \"Computer Equipment\",\n        \"Software\",\n        \"Office Supplies\",\n        \"Office Furniture\",\n        \"Office Snacks\",\n        \"Groceries\",\n        \"Hotel Stay\",\n        \"Lodging\",\n        \"Business Meals\",\n        \"Client Meals\",\n        \"Team Meals\",\n        \"Fuel\",\n        \"Vehicle Maintenance\",\n        \"Vehicle Repairs\",\n        \"Vehicle Purchase\",\n        \"Vehicle Lease\",\n        \"Car Wash\",\n        \"Parking\",\n        \"Hardware\",\n        \"Tools\",\n        \"Building Maintenance\",\n        \"Uniforms\",\n        \"Work Clothing\",\n        \"Health Services\",\n        \"Airfare\",\n        \"Public Transport\",\n        \"Taxi/Rideshare\",\n        \"Shipping\",\n        \"Courier Services\",\n        \"Internet Service\",\n        \"Phone Service\",\n        \"Advertising\",\n        \"Marketing Materials\",\n        \"Training Course\",\n        \"Conference Fee\",\n        \"Books\",\n        \"Bank Fees\",\n        \"Transaction Fees\",\n        \"Insurance Premium\",\n        \"Legal Fees\",\n        \"Accounting Fees\",\n        \"Other\"\n      ],\n      \"description\": \"Specific type of expense. Choose closest match.\"\n    },\n\n    \"description\": {\n      \"type\": \"string\",\n      \"description\": \"Short description of what was purchased. Max 200 characters.\"\n    },\n\n    \"subtotal\": {\n      \"type\": \"number\",\n      \"description\": \"Amount before tax. NZ/AU: Ex GST. US: Subtotal before sales tax. If not shown but calculable, derive by subtracting tax from total.\"\n    },\n\n    \"gstAmount\": {\n      \"type\": \"number\",\n      \"description\": \"GST amount for NZ (15%) or AU (10%). If receipt is from US or GST not present or if there is no indication of a gst amount then return 0.00.\"\n    },\n\n    \"salesTax\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Extract sales tax. US receipts label it as 'Sales Tax', 'Tax', 'State Tax', or 'Local Tax'. If no tax or non-US receipt, return 0.00.\"\n    },\n\n    \"otherTax\": {\n      \"type\": \"number\",\n      \"description\": \"Other taxes or levies (e.g., surcharges, environmental fees). If none, return 0.00.\"\n    },\n\n    \"totalTax\": {\n      \"type\": \"number\",\n      \"description\": \"Total tax = gstAmount + salesTax + otherTax. If explicit 'Total Tax' exists, use that.\"\n    },\n\n    \"gstRate\": {\n      \"type\": \"number\",\n      \"description\": \"NZ: 0.15. AU: 0.10. US: 0.00 (sales tax handled separately). Infer from context where possible. if there is no gst indicated then return 0.00\"\n    },\n\n    \"taxRate\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Sales tax rate if printed (e.g., 0.0725). If not printed, infer based on subtotal and tax where possible. Else return 0.00.\"\n    },\n\n    \"gstIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"NZ/AU: True for most retail receipts. US: Always false (US prices are normally pre-tax). If unknown, infer based on total/subtotal maths.\"\n    },\n\n    \"taxIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"US-only convenience field. Return false for US, since sales tax is added at checkout. NZ/AU receipts may show 'incl. GST' — return true in those cases.\"\n    },\n\n    \"total\": {\n      \"type\": \"number\",\n      \"description\": \"Amount paid including all taxes.\"\n    },\n\n    \"paymentMethod\": {\n      \"type\": \"string\",\n      \"description\": \"Payment method such as Corporate Credit Card, Debit, EFTPOS, Cash, Personal (Reimbursable), Cheque. Infer from text (e.g., 'VISA', 'Mastercard'). If there is no indication of how it was paid it is probably Debit.\"\n    },\n\n    \"calcCheckPassed\": {\n      \"type\": \"boolean\",\n      \"description\": \"True if subtotal + totalTax ≈ total within 0.01 tolerance. False if arithmetic does not reconcile.\"\n    },\n\n    \"notes\": {\n      \"type\": \"string\",\n      \"description\": \"Additional context or comments. Max 100 characters.\"\n    },\n\n    \"modelConfidence\": {\n      \"type\": \"number\",\n      \"description\": \"Confidence score (0.0–1.0). Extract from Gemini’s '---CONFIDENCE---' block or estimate based on clarity.\"\n    },\n\n    \"confidenceNotes\": {\n      \"type\": \"string\",\n      \"description\": \"Short summary of uncertainties affecting confidence. Max 200 characters.\"\n    }\n  },\n\n  \"required\": [\n    \"date\",\n    \"vendor\",\n    \"total\",\n    \"gst\",\n    \"gstRate\",\n    \"subtotal\",\n    \"totalTax\",\n    \"currency\",\n    \"modelConidence\",\n    \"confidenceNotes\"\n  ]\n}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[0,0],"id":"33882eda-1f69-4e29-9f1d-f410156bdacc","name":"Information Extractor"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY","mode":"list","cachedResultName":"Business Expenses","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Invoice Date":"={{ $json.output.date }}","Processed Date":"={{ $now.toFormat(\"dd/LL/yyyy HH:mm\") }}\n","Status":"Processed","Receipt ID":"={{ $json.output.receiptId }}","Vendor/Merchant":"={{ $json.output.vendor }}","Category":"={{ $json.output.category }}","Expense Type":"={{ $json.output.expenseType }}","Description":"={{ $json.output.description }}","Receipt Location":"={{ $('Google Drive').item.json.webViewLink }}","Total Tax":"={{ $json.output.totalTax }}","Payment Method":"={{ $json.output.paymentMethod }}","Notes":"={{ $json.output.notes }}","Total Amount":"={{ $json.output.total }}","Subtotal Amount":"={{ $json.output.subtotal }}","GST Paid":"={{ $json.output.gstHst }}"},"matchingColumns":[],"schema":[{"id":"Invoice Date","displayName":"Invoice Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Processed Date","displayName":"Processed Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt ID","displayName":"Receipt ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Vendor/Merchant","displayName":"Vendor/Merchant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Category","displayName":"Category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Expense Type","displayName":"Expense Type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt Location","displayName":"Receipt Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Amount","displayName":"Total Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Subtotal Amount","displayName":"Subtotal Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Total Tax","displayName":"Total Tax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"GST Rate","displayName":"GST Rate","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"GST Paid","displayName":"GST Paid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Payment Method","displayName":"Payment Method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CRA Line Item","displayName":"CRA Line Item","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Confidence","displayName":"Confidence","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Confidence Notes","displayName":"Confidence Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[384,112],"id":"726598a2-9f5f-438a-9958-f062fafcb5ef","name":"Google Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"newUpdatedFileName":"={{ $('Google Sheets').item.json['Invoice Date'].split(' ')[0].replace(/-/g, '') }}_{{ $('Google Sheets').item.json['Invoice Date'].split(' ')[1].replace(/:/g, '') }}_{{ $('Google Sheets').item.json['Vendor/Merchant'].replace(/[^a-zA-Z0-9]/g, '') }}_${{ $('Google Sheets').item.json['Total Amount'].toFixed(2) }}.{{ $('Google Drive').item.json.fileExtension }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[912,112],"id":"a8bc5eb3-0ae4-4a9e-83e1-17d897a25323","name":"Update File Name","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"57c2ff75-2006-4c8b-ba9b-b779a75b465d","leftValue":"={{ $json.extracted_text_pdf || $json.extracted_text_image}}","rightValue":"null","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-224,240],"id":"7860ac9d-366c-48fa-9a3e-c1237eaed24f","name":"CheckError"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1SP0XYv7l4M4FFSQKX8HPjNWX8M_unYKK","mode":"list","cachedResultName":"Error","cachedResultUrl":"https://drive.google.com/drive/folders/1SP0XYv7l4M4FFSQKX8HPjNWX8M_unYKK"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[80,400],"id":"cf6ef6ab-cf6f-40ff-ba86-9d3a4d1d0a6a","name":"Move to Error Folder","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"content":"# Gemini 2.5 Pro","height":500,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-944,16],"typeVersion":1,"id":"4dac0aaf-0321-4166-a14c-a863cfb91531","name":"Sticky Note"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Extract the content from the file and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"\n        },\n        {\n          \"inline_data\": {\n            \"mime_type\": \"application/pdf\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.2,\n    \"maxOutputTokens\": 65536\n  }\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-880,352],"id":"b520dbd2-daeb-4acf-8dbb-900b09378975","name":"OCR API - PDF Gemini","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\"text\": \"Extract the content from the image and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"},\n        {\n          \"inline_data\": {\n            \"mime_type\": \"{{ $('Google Drive1').item.json.mimeType }}\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 1,\n    \"maxOutputTokens\": 65536\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-736,144],"id":"ec8cb98f-65c6-497c-a8f7-b679a8871ccc","name":"OCR API - Image Gemini","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1tr5-CFOl89HcLh1th_xhAP4IF6B861-t","mode":"list","cachedResultName":"processed_gemini","cachedResultUrl":"https://drive.google.com/drive/folders/1tr5-CFOl89HcLh1th_xhAP4IF6B861-t"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[656,112],"id":"09574990-db59-462f-b506-9fb7ed5207b7","name":"Move to Processed_Gemini Folder","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[464,512],"id":"59df1c1c-9ece-4e45-8596-0479d378185f","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1856,976],"id":"59fdabfb-a30a-4202-8ba7-c9f126279cbf","name":"Schedule Trigger"},{"parameters":{"resource":"fileFolder","limit":1,"filter":{"driveId":{"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d","mode":"list","cachedResultName":"Unprocessed","cachedResultUrl":"https://drive.google.com/drive/folders/1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d"}},"options":{"fields":["kind","webViewLink","id","*"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1632,976],"id":"0515ae81-8848-4ef2-b602-5dd2052654da","name":"Get a File","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1408,976],"id":"96685487-07a6-41bc-a4a0-a78e7128c59c","name":"Google Drive1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1200,976],"id":"2ff1dd18-918f-4e68-9338-2dedaab68f42","name":"Extract from File1"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive1').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1aFFP1K4OKMs9yNYv-kh8Gm8dTMUurU3z","mode":"list","cachedResultName":"Error","cachedResultUrl":"https://drive.google.com/drive/folders/1aFFP1K4OKMs9yNYv-kh8Gm8dTMUurU3z"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[208,1120],"id":"c3404b46-b051-42a3-b962-82fcd81b0654","name":"Move to Error Folder1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"57c2ff75-2006-4c8b-ba9b-b779a75b465d","leftValue":"={{ $json.extracted_text_pdf || $json.extracted_text_image}}","rightValue":"null","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"5a7a55d8-6e89-4fce-8dc3-3a847bca09ed","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-80,976],"id":"2f55c2aa-bece-401e-8aac-f87ba3a42169","name":"CheckError1"},{"parameters":{"assignments":{"assignments":[{"id":"bb7642bc-f6e6-43e3-872b-04d1a5cb0e4c","name":"extracted_text_pdf","value":"={{ $json.aggregatedText }}","type":"string"},{"id":"5e8991d3-0c09-4626-8162-d1254fa99add","name":"extracted_text_image","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-304,976],"id":"9fd1a348-f5a8-45b7-a51f-f50d945b41fe","name":"Edit Fields1"},{"parameters":{"text":"={{ $json.extracted_text_pdf ?? $json.extracted_text_image }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"country\": {\n      \"type\": \"string\",\n      \"enum\": [\"NZ\", \"AU\", \"US\", \"Unknown\"],\n      \"description\": \"Infer the country from currency, address, phone number, tax labels (GST, Sales Tax), state abbreviations (e.g., CA, TX, NY), or formatting. Default to 'Unknown' if unclear.\"\n    },\n    \"state\": {\n      \"type\": \"string\",\n      \"description\": \"For US receipts only. Extract 2-letter state code (e.g., 'CA', 'NY', 'TX'). If not a US receipt or if unknown, return empty string.\"\n    },\n    \"currency\": {\n      \"type\": \"string\",\n      \"description\": \"Currency code such as 'NZD', 'AUD', or 'USD'. Infer from symbols (e.g. '$' + context), GST (NZ/AU), 'Sales Tax' (US), addresses, or explicitly printed currency. If uncertain, return 'Unknown'.\"\n    },\n\n    \"date\": {\n      \"type\": \"string\",\n      \"description\": \"Extract transaction date and time. Format: YYYY-MM-DD HH:MM:SS. If time missing, return 00:00:00. For US receipts, if a date appears in MM/DD/YYYY format, convert to YYYY-MM-DD.\"\n    },\n\n    \"receiptId\": {\n      \"type\": \"string\",\n      \"description\": \"Receipt/invoice/transaction identifier. Labels include 'Receipt #', 'Order #', 'Invoice #', 'Transaction ID'. Return full alphanumeric value or empty string if not found.\"\n    },\n\n    \"vendor\": {\n      \"type\": \"string\",\n      \"description\": \"Business or merchant name. Exclude address and slogans.\"\n    },\n\n    \"category\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Advertising and Marketing\",\n        \"Bank Fees and Charges\",\n        \"Business Licences and Fees\",\n        \"Delivery and Freight\",\n        \"Fuel Costs\",\n        \"Insurance (Business)\",\n        \"Interest Expense\",\n        \"Legal and Accounting Fees\",\n        \"Maintenance and Repairs\",\n        \"Meals and Entertainment\",\n        \"Office Expenses\",\n        \"Professional Development\",\n        \"Property Rates and Taxes\",\n        \"Rent and Lease\",\n        \"Salaries and Wages\",\n        \"Supplies\",\n        \"Telephone and Internet\",\n        \"Travel - Accommodation\",\n        \"Travel - Airfare\",\n        \"Travel - Other\",\n        \"Utilities\",\n        \"Vehicle - Fuel\",\n        \"Vehicle - Insurance\",\n        \"Vehicle - Maintenance\",\n        \"Vehicle - Other\",\n        \"Other Expenses\"\n      ],\n      \"description\": \"Business expense category. Choose best match across NZ/AU/US receipts.\"\n    },\n\n    \"expenseType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Electronics\",\n        \"Computer Equipment\",\n        \"Software\",\n        \"Office Supplies\",\n        \"Office Furniture\",\n        \"Office Snacks\",\n        \"Groceries\",\n        \"Hotel Stay\",\n        \"Lodging\",\n        \"Business Meals\",\n        \"Client Meals\",\n        \"Team Meals\",\n        \"Fuel\",\n        \"Vehicle Maintenance\",\n        \"Vehicle Repairs\",\n        \"Vehicle Purchase\",\n        \"Vehicle Lease\",\n        \"Car Wash\",\n        \"Parking\",\n        \"Hardware\",\n        \"Tools\",\n        \"Building Maintenance\",\n        \"Uniforms\",\n        \"Work Clothing\",\n        \"Health Services\",\n        \"Airfare\",\n        \"Public Transport\",\n        \"Taxi/Rideshare\",\n        \"Shipping\",\n        \"Courier Services\",\n        \"Internet Service\",\n        \"Phone Service\",\n        \"Advertising\",\n        \"Marketing Materials\",\n        \"Training Course\",\n        \"Conference Fee\",\n        \"Books\",\n        \"Bank Fees\",\n        \"Transaction Fees\",\n        \"Insurance Premium\",\n        \"Legal Fees\",\n        \"Accounting Fees\",\n        \"Other\"\n      ],\n      \"description\": \"Specific type of expense. Choose closest match.\"\n    },\n\n    \"description\": {\n      \"type\": \"string\",\n      \"description\": \"Short description of what was purchased. Max 200 characters.\"\n    },\n\n    \"subtotal\": {\n      \"type\": \"number\",\n      \"description\": \"Amount before tax. NZ/AU: Ex GST. US: Subtotal before sales tax. If not shown but calculable, derive by subtracting tax from total.\"\n    },\n\n    \"gstAmount\": {\n      \"type\": \"number\",\n      \"description\": \"GST amount for NZ (15%) or AU (10%). If receipt is from US or GST not present or if there is no indication of a gst amount then return 0.00.\"\n    },\n\n    \"salesTax\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Extract sales tax. US receipts label it as 'Sales Tax', 'Tax', 'State Tax', or 'Local Tax'. If no tax or non-US receipt, return 0.00.\"\n    },\n\n    \"otherTax\": {\n      \"type\": \"number\",\n      \"description\": \"Other taxes or levies (e.g., surcharges, environmental fees). If none, return 0.00.\"\n    },\n\n    \"totalTax\": {\n      \"type\": \"number\",\n      \"description\": \"Total tax = gstAmount + salesTax + otherTax. If explicit 'Total Tax' exists, use that.\"\n    },\n\n    \"gstRate\": {\n      \"type\": \"number\",\n      \"description\": \"NZ: 0.15. AU: 0.10. US: 0.00 (sales tax handled separately). Infer from context where possible. if there is no gst indicated then return 0.00\"\n    },\n\n    \"taxRate\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Sales tax rate if printed (e.g., 0.0725). If not printed, infer based on subtotal and tax where possible. Else return 0.00.\"\n    },\n\n    \"gstIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"NZ/AU: True for most retail receipts. US: Always false (US prices are normally pre-tax). If unknown, infer based on total/subtotal maths.\"\n    },\n\n    \"taxIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"US-only convenience field. Return false for US, since sales tax is added at checkout. NZ/AU receipts may show 'incl. GST' — return true in those cases.\"\n    },\n\n    \"total\": {\n      \"type\": \"number\",\n      \"description\": \"Amount paid including all taxes.\"\n    },\n\n    \"paymentMethod\": {\n      \"type\": \"string\",\n      \"description\": \"Payment method such as Corporate Credit Card, Debit, EFTPOS, Cash, Personal (Reimbursable), Cheque. Infer from text (e.g., 'VISA', 'Mastercard'). If there is no indication of how it was paid it is probably Debit.\"\n    },\n\n    \"calcCheckPassed\": {\n      \"type\": \"boolean\",\n      \"description\": \"True if subtotal + totalTax ≈ total within 0.01 tolerance. False if arithmetic does not reconcile.\"\n    },\n\n    \"notes\": {\n      \"type\": \"string\",\n      \"description\": \"Additional context or comments. Max 100 characters.\"\n    },\n\n    \"modelConfidence\": {\n      \"type\": \"number\",\n      \"description\": \"Confidence score (0.0–1.0). Extract from Gemini’s '---CONFIDENCE---' block or estimate based on clarity.\"\n    },\n\n    \"confidenceNotes\": {\n      \"type\": \"string\",\n      \"description\": \"Short summary of uncertainties affecting confidence. Max 200 characters.\"\n    }\n  },\n\n  \"required\": [\n    \"date\",\n    \"vendor\",\n    \"total\",\n    \"gst\",\n    \"gstRate\",\n    \"subtotal\",\n    \"totalTax\",\n    \"currency\",\n    \"modelConidence\",\n    \"confidenceNotes\"\n  ]\n}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[128,720],"id":"a86e6408-00c7-4105-b668-bd14b5127399","name":"Information Extractor1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"jpg","operator":{"type":"string","operation":"equals"},"id":"efa9ce6a-1a6a-454d-ad18-5d9630aad08e"}],"combinator":"and"},"renameOutput":true,"outputKey":"JPG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cd460a6-6891-4628-8649-ec5f79fbc18e","leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"png","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PNG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"78e2a8c8-029e-43cf-a99a-ffc9dc875899","leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-976,960],"id":"2a10f953-333f-4c7b-a9f6-35373b26313b","name":"Switch1"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive1').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1tr5-CFOl89HcLh1th_xhAP4IF6B861-t","mode":"list","cachedResultName":"processed_gemini","cachedResultUrl":"https://drive.google.com/drive/folders/1tr5-CFOl89HcLh1th_xhAP4IF6B861-t"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1024,832],"id":"2fb0f921-3bf6-42ce-bdae-ca20b13c779c","name":"Move to Processed_Gemini Folder1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"jsCode":"// Aggregate OCR text from all pages\nlet aggregatedText = '';\nlet pageTexts = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Access candidates array from the new structure\n    const candidates = item.json.candidates;\n    \n    if (!candidates || !Array.isArray(candidates)) {\n      continue;\n    }\n    \n    // Loop through each candidate\n    for (let i = 0; i < candidates.length; i++) {\n      const candidate = candidates[i];\n      \n      // Extract text from content.parts\n      if (candidate.content && candidate.content.parts) {\n        for (const part of candidate.content.parts) {\n          if (part.text) {\n            const pageNumber = i + 1; // Use candidate index as page number\n            const pageText = part.text;\n            \n            // Store individual page text\n            pageTexts.push({\n              pageNumber: pageNumber,\n              text: pageText\n            });\n            \n            // Aggregate all text\n            aggregatedText += pageText + '\\n\\n';\n          }\n        }\n      }\n    }\n    \n  } catch (error) {\n    // Handle error with more details\n    return [{\n      json: {\n        error,\n        aggregatedText: '',\n        debug: JSON.stringify(item.json, null, 2)\n      }\n    }];\n  }\n}\n\n// Return only the aggregated result\nreturn [{\n  json: {\n    aggregatedText: aggregatedText.trim(),\n    totalPages: pageTexts.length,\n    pages: pageTexts\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-528,1072],"id":"d3cae920-3d1c-403f-9020-696b70fbbf0f","name":"Agg Data1"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=\n\n","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Extract the content from the file and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"\n        },\n        {\n          \"inline_data\": {\n            \"mime_type\": \"application/pdf\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.2,\n    \"maxOutputTokens\": 65536\n  }\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-752,1072],"id":"5c7f720c-afd5-4af3-9e82-ac6bf65d5f56","name":"OCR API - PDF Gemini1","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\"text\": \"Extract the content from the image and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"},\n        {\n          \"inline_data\": {\n            \"mime_type\": \"{{ $('Google Drive1').item.json.mimeType }}\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 1,\n    \"maxOutputTokens\": 65536\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-624,864],"id":"cd611b51-8e8c-4438-b158-c446a93da584","name":"OCR API - Image Gemini1","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"content":"# Gemini 2.5 Pro","height":500,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-816,736],"typeVersion":1,"id":"b7fc8b0b-ef6e-4771-915e-4ed2d8e234a5","name":"Sticky Note1"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY","mode":"list","cachedResultName":"Business Expenses","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Invoice Date":"={{ $json.output.date }}","Status":"Processed","Receipt ID":"={{ $json.output.receiptId }}","Vendor/Merchant":"={{ $json.output.vendor }}","Category":"={{ $json.output.category }}","Expense Type":"={{ $json.output.expenseType }}","Description":"={{ $json.output.description }}","Total Amount":"={{ $json.output.total }}","Subtotal Amount":"={{ $json.output.subtotal }}","GST Paid":"={{ $json.output.gstAmount }}","Total Tax":"={{ $json.output.totalTax }}","Payment Method":"={{ $json.output.paymentMethod }}","Notes":"={{ $json.output.notes }}","Receipt Location":"={{ $('Google Drive1').item.json.webViewLink }}","Processed Date":"={{ $now.toFormat(\"dd/LL/yyyy HH:mm\") }}","GST Rate":"={{ $json.output.gstRate }}","Confidence":"={{ $json.output.modelConfidence }}","Confidence Notes":"={{ $json.output.confidenceNotes }}"},"matchingColumns":[],"schema":[{"id":"Invoice Date","displayName":"Invoice Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Processed Date","displayName":"Processed Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt ID","displayName":"Receipt ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Vendor/Merchant","displayName":"Vendor/Merchant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Category","displayName":"Category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Expense Type","displayName":"Expense Type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt Location","displayName":"Receipt Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Amount","displayName":"Total Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Subtotal Amount","displayName":"Subtotal Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tax","displayName":"Total Tax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"GST Rate","displayName":"GST Rate","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"GST Paid","displayName":"GST Paid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Payment Method","displayName":"Payment Method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CRA Line Item","displayName":"CRA Line Item","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Confidence","displayName":"Confidence","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Confidence Notes","displayName":"Confidence Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[832,832],"id":"19d76631-a58d-4458-8835-b06a7d9ffff0","name":"Google Sheets1","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"newUpdatedFileName":"={{ $('Google Sheets1').item.json['Invoice Date'].split(' ')[0].replace(/-/g, '') }}_{{ $('Google Sheets1').item.json['Invoice Date'].split(' ')[1].replace(/:/g, '') }}_{{ $('Google Sheets1').item.json['Vendor/Merchant'].replace(/[^a-zA-Z0-9]/g, '') }}_${{ $('Google Sheets1').item.json['Total Amount (CAD)'].toFixed(2) }}.{{ $('Google Drive1').item.json.fileExtension }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1232,832],"id":"517f9e1c-ed3b-4f0c-8fa6-f59e50389b42","name":"Update File Name1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"47c49dfb-d49d-43fd-a8ca-2d7e3151f5c0","leftValue":"={{ $json.output.modelConfidence }}","rightValue":0.6,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[480,720],"id":"a31e0718-d0a8-459d-95fc-80c2c3809784","name":"Check confidence level"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Error in invoice processing","message":"=Processing invoice from  {{ $('Information Extractor1').item.json.output.vendor }} dated {{ $('Information Extractor1').item.json.output.date }} failed as the confidence level on the data extraction was not great.  Please review the invoice which is in the error folder on your google drive.","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[480,1120],"id":"844e6228-6502-4d88-81ce-8b8dd8afef44","name":"Send a message","webhookId":"8122dfb9-1350-4a73-abb5-fdd4cdd746b4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Processed another invoice for you","message":"=Just successfully processed an invoice from \n{{ $('Information Extractor1').item.json.output.vendor }} \ndated \n{{ new Date($('Information Extractor1').item.json.output.date)\n      .toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit', hour12: false }) }} \nin the sum of \n{{ $('Information Extractor1').item.json.output.total }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1024,1088],"id":"f9dffec5-1a4a-4783-82d4-d0b93bc951cb","name":"Send a message1","webhookId":"8122dfb9-1350-4a73-abb5-fdd4cdd746b4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Google Drive":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Switch":{"main":[[{"node":"OCR API - Image Gemini","type":"main","index":0}],[{"node":"OCR API - Image Gemini","type":"main","index":0}],[{"node":"OCR API - PDF Gemini","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Agg Data":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"CheckError","type":"main","index":0}]]},"Google Drive Trigger":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Information Extractor":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Move to Processed_Gemini Folder","type":"main","index":0}]]},"CheckError":{"main":[[{"node":"Information Extractor","type":"main","index":0}],[{"node":"Move to Error Folder","type":"main","index":0}]]},"OCR API - PDF Gemini":{"main":[[{"node":"Agg Data","type":"main","index":0}]]},"OCR API - Image Gemini":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Move to Processed_Gemini Folder":{"main":[[{"node":"Update File Name","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0},{"node":"Information Extractor1","type":"ai_languageModel","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get a File","type":"main","index":0}]]},"Get a File":{"main":[[{"node":"Google Drive1","type":"main","index":0}]]},"Google Drive1":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"Extract from File1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"CheckError1":{"main":[[{"node":"Information Extractor1","type":"main","index":0}],[{"node":"Move to Error Folder1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"CheckError1","type":"main","index":0}]]},"Information Extractor1":{"main":[[{"node":"Check confidence level","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"OCR API - Image Gemini1","type":"main","index":0}],[{"node":"OCR API - Image Gemini1","type":"main","index":0}],[{"node":"OCR API - PDF Gemini1","type":"main","index":0}]]},"Move to Processed_Gemini Folder1":{"main":[[{"node":"Update File Name1","type":"main","index":0}]]},"Agg Data1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"OCR API - PDF Gemini1":{"main":[[{"node":"Agg Data1","type":"main","index":0}]]},"OCR API - Image Gemini1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Move to Processed_Gemini Folder1","type":"main","index":0}]]},"Check confidence level":{"main":[[{"node":"Google Sheets1","type":"main","index":0}],[{"node":"Move to Error Folder1","type":"main","index":0}]]},"Move to Error Folder1":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Update File Name1":{"main":[[{"node":"Send a message1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4cdea4b8-25f8-4ca3-86f5-033358bed366","activeVersionId":"4cdea4b8-25f8-4ca3-86f5-033358bed366","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T02:53:50.798Z","createdAt":"2025-11-29T02:53:50.798Z","role":"workflow:owner","workflowId":"NBslPOQDxRDu0gWZ","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2026-01-02T00:37:06.000Z","createdAt":"2026-01-01T22:47:57.177Z","versionId":"4cdea4b8-25f8-4ca3-86f5-033358bed366","workflowId":"NBslPOQDxRDu0gWZ","nodes":[{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Google Drive Trigger').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1536,256],"id":"bd359f3b-af60-445d-b4bd-30e495d15ed9","name":"Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"jpg","operator":{"type":"string","operation":"equals"},"id":"efa9ce6a-1a6a-454d-ad18-5d9630aad08e"}],"combinator":"and"},"renameOutput":true,"outputKey":"JPG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cd460a6-6891-4628-8649-ec5f79fbc18e","leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"png","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PNG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"78e2a8c8-029e-43cf-a99a-ffc9dc875899","leftValue":"={{ $('Google Drive').item.json.fileExtension }}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1104,240],"id":"b7ea7211-509a-4144-ac10-5e743fe6073b","name":"Switch"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1328,256],"id":"5f803a4d-6317-4a01-89ef-936ecc386d25","name":"Extract from File"},{"parameters":{"jsCode":"// Aggregate OCR text from all pages\nlet aggregatedText = '';\nlet pageTexts = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Access candidates array from the new structure\n    const candidates = item.json.candidates;\n    \n    if (!candidates || !Array.isArray(candidates)) {\n      continue;\n    }\n    \n    // Loop through each candidate\n    for (let i = 0; i < candidates.length; i++) {\n      const candidate = candidates[i];\n      \n      // Extract text from content.parts\n      if (candidate.content && candidate.content.parts) {\n        for (const part of candidate.content.parts) {\n          if (part.text) {\n            const pageNumber = i + 1; // Use candidate index as page number\n            const pageText = part.text;\n            \n            // Store individual page text\n            pageTexts.push({\n              pageNumber: pageNumber,\n              text: pageText\n            });\n            \n            // Aggregate all text\n            aggregatedText += pageText + '\\n\\n';\n          }\n        }\n      }\n    }\n    \n  } catch (error) {\n    // Handle error with more details\n    return [{\n      json: {\n        error,\n        aggregatedText: '',\n        debug: JSON.stringify(item.json, null, 2)\n      }\n    }];\n  }\n}\n\n// Return only the aggregated result\nreturn [{\n  json: {\n    aggregatedText: aggregatedText.trim(),\n    totalPages: pageTexts.length,\n    pages: pageTexts\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-656,352],"id":"cf45178c-d12a-4f75-8d07-4388875c7722","name":"Agg Data"},{"parameters":{"assignments":{"assignments":[{"id":"bb7642bc-f6e6-43e3-872b-04d1a5cb0e4c","name":"extracted_text_pdf","value":"={{ $json.aggregatedText }}","type":"string"},{"id":"5e8991d3-0c09-4626-8162-d1254fa99add","name":"extracted_text_image","value":"=\n{{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-448,240],"id":"c3dae5cc-6701-4a27-8632-3247fc99a9b7","name":"Edit Fields"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d","mode":"list","cachedResultName":"Unprocessed","cachedResultUrl":"https://drive.google.com/drive/folders/1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1776,256],"id":"814616c9-d077-449a-a122-6f32d256c6d9","name":"Google Drive Trigger","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}},"disabled":true},{"parameters":{"text":"={{ $json.extracted_text_pdf ?? $json.extracted_text_image }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"country\": {\n      \"type\": \"string\",\n      \"enum\": [\"NZ\", \"AU\", \"US\", \"Unknown\"],\n      \"description\": \"Infer the country from currency, address, phone number, tax labels (GST, Sales Tax), state abbreviations (e.g., CA, TX, NY), or formatting. Default to 'Unknown' if unclear.\"\n    },\n    \"state\": {\n      \"type\": \"string\",\n      \"description\": \"For US receipts only. Extract 2-letter state code (e.g., 'CA', 'NY', 'TX'). If not a US receipt or if unknown, return empty string.\"\n    },\n    \"currency\": {\n      \"type\": \"string\",\n      \"description\": \"Currency code such as 'NZD', 'AUD', or 'USD'. Infer from symbols (e.g. '$' + context), GST (NZ/AU), 'Sales Tax' (US), addresses, or explicitly printed currency. If uncertain, return 'Unknown'.\"\n    },\n\n    \"date\": {\n      \"type\": \"string\",\n      \"description\": \"Extract transaction date and time. Format: YYYY-MM-DD HH:MM:SS. If time missing, return 00:00:00. For US receipts, if a date appears in MM/DD/YYYY format, convert to YYYY-MM-DD.\"\n    },\n\n    \"receiptId\": {\n      \"type\": \"string\",\n      \"description\": \"Receipt/invoice/transaction identifier. Labels include 'Receipt #', 'Order #', 'Invoice #', 'Transaction ID'. Return full alphanumeric value or empty string if not found.\"\n    },\n\n    \"vendor\": {\n      \"type\": \"string\",\n      \"description\": \"Business or merchant name. Exclude address and slogans.\"\n    },\n\n    \"category\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Advertising and Marketing\",\n        \"Bank Fees and Charges\",\n        \"Business Licences and Fees\",\n        \"Delivery and Freight\",\n        \"Fuel Costs\",\n        \"Insurance (Business)\",\n        \"Interest Expense\",\n        \"Legal and Accounting Fees\",\n        \"Maintenance and Repairs\",\n        \"Meals and Entertainment\",\n        \"Office Expenses\",\n        \"Professional Development\",\n        \"Property Rates and Taxes\",\n        \"Rent and Lease\",\n        \"Salaries and Wages\",\n        \"Supplies\",\n        \"Telephone and Internet\",\n        \"Travel - Accommodation\",\n        \"Travel - Airfare\",\n        \"Travel - Other\",\n        \"Utilities\",\n        \"Vehicle - Fuel\",\n        \"Vehicle - Insurance\",\n        \"Vehicle - Maintenance\",\n        \"Vehicle - Other\",\n        \"Other Expenses\"\n      ],\n      \"description\": \"Business expense category. Choose best match across NZ/AU/US receipts.\"\n    },\n\n    \"expenseType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Electronics\",\n        \"Computer Equipment\",\n        \"Software\",\n        \"Office Supplies\",\n        \"Office Furniture\",\n        \"Office Snacks\",\n        \"Groceries\",\n        \"Hotel Stay\",\n        \"Lodging\",\n        \"Business Meals\",\n        \"Client Meals\",\n        \"Team Meals\",\n        \"Fuel\",\n        \"Vehicle Maintenance\",\n        \"Vehicle Repairs\",\n        \"Vehicle Purchase\",\n        \"Vehicle Lease\",\n        \"Car Wash\",\n        \"Parking\",\n        \"Hardware\",\n        \"Tools\",\n        \"Building Maintenance\",\n        \"Uniforms\",\n        \"Work Clothing\",\n        \"Health Services\",\n        \"Airfare\",\n        \"Public Transport\",\n        \"Taxi/Rideshare\",\n        \"Shipping\",\n        \"Courier Services\",\n        \"Internet Service\",\n        \"Phone Service\",\n        \"Advertising\",\n        \"Marketing Materials\",\n        \"Training Course\",\n        \"Conference Fee\",\n        \"Books\",\n        \"Bank Fees\",\n        \"Transaction Fees\",\n        \"Insurance Premium\",\n        \"Legal Fees\",\n        \"Accounting Fees\",\n        \"Other\"\n      ],\n      \"description\": \"Specific type of expense. Choose closest match.\"\n    },\n\n    \"description\": {\n      \"type\": \"string\",\n      \"description\": \"Short description of what was purchased. Max 200 characters.\"\n    },\n\n    \"subtotal\": {\n      \"type\": \"number\",\n      \"description\": \"Amount before tax. NZ/AU: Ex GST. US: Subtotal before sales tax. If not shown but calculable, derive by subtracting tax from total.\"\n    },\n\n    \"gstAmount\": {\n      \"type\": \"number\",\n      \"description\": \"GST amount for NZ (15%) or AU (10%). If receipt is from US or GST not present or if there is no indication of a gst amount then return 0.00.\"\n    },\n\n    \"salesTax\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Extract sales tax. US receipts label it as 'Sales Tax', 'Tax', 'State Tax', or 'Local Tax'. If no tax or non-US receipt, return 0.00.\"\n    },\n\n    \"otherTax\": {\n      \"type\": \"number\",\n      \"description\": \"Other taxes or levies (e.g., surcharges, environmental fees). If none, return 0.00.\"\n    },\n\n    \"totalTax\": {\n      \"type\": \"number\",\n      \"description\": \"Total tax = gstAmount + salesTax + otherTax. If explicit 'Total Tax' exists, use that.\"\n    },\n\n    \"gstRate\": {\n      \"type\": \"number\",\n      \"description\": \"NZ: 0.15. AU: 0.10. US: 0.00 (sales tax handled separately). Infer from context where possible. if there is no gst indicated then return 0.00\"\n    },\n\n    \"taxRate\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Sales tax rate if printed (e.g., 0.0725). If not printed, infer based on subtotal and tax where possible. Else return 0.00.\"\n    },\n\n    \"gstIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"NZ/AU: True for most retail receipts. US: Always false (US prices are normally pre-tax). If unknown, infer based on total/subtotal maths.\"\n    },\n\n    \"taxIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"US-only convenience field. Return false for US, since sales tax is added at checkout. NZ/AU receipts may show 'incl. GST' — return true in those cases.\"\n    },\n\n    \"total\": {\n      \"type\": \"number\",\n      \"description\": \"Amount paid including all taxes.\"\n    },\n\n    \"paymentMethod\": {\n      \"type\": \"string\",\n      \"description\": \"Payment method such as Corporate Credit Card, Debit, EFTPOS, Cash, Personal (Reimbursable), Cheque. Infer from text (e.g., 'VISA', 'Mastercard'). If there is no indication of how it was paid it is probably Debit.\"\n    },\n\n    \"calcCheckPassed\": {\n      \"type\": \"boolean\",\n      \"description\": \"True if subtotal + totalTax ≈ total within 0.01 tolerance. False if arithmetic does not reconcile.\"\n    },\n\n    \"notes\": {\n      \"type\": \"string\",\n      \"description\": \"Additional context or comments. Max 100 characters.\"\n    },\n\n    \"modelConfidence\": {\n      \"type\": \"number\",\n      \"description\": \"Confidence score (0.0–1.0). Extract from Gemini’s '---CONFIDENCE---' block or estimate based on clarity.\"\n    },\n\n    \"confidenceNotes\": {\n      \"type\": \"string\",\n      \"description\": \"Short summary of uncertainties affecting confidence. Max 200 characters.\"\n    }\n  },\n\n  \"required\": [\n    \"date\",\n    \"vendor\",\n    \"total\",\n    \"gst\",\n    \"gstRate\",\n    \"subtotal\",\n    \"totalTax\",\n    \"currency\",\n    \"modelConidence\",\n    \"confidenceNotes\"\n  ]\n}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[0,0],"id":"33882eda-1f69-4e29-9f1d-f410156bdacc","name":"Information Extractor"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY","mode":"list","cachedResultName":"Business Expenses","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Invoice Date":"={{ $json.output.date }}","Processed Date":"={{ $now.toFormat(\"dd/LL/yyyy HH:mm\") }}\n","Status":"Processed","Receipt ID":"={{ $json.output.receiptId }}","Vendor/Merchant":"={{ $json.output.vendor }}","Category":"={{ $json.output.category }}","Expense Type":"={{ $json.output.expenseType }}","Description":"={{ $json.output.description }}","Receipt Location":"={{ $('Google Drive').item.json.webViewLink }}","Total Tax":"={{ $json.output.totalTax }}","Payment Method":"={{ $json.output.paymentMethod }}","Notes":"={{ $json.output.notes }}","Total Amount":"={{ $json.output.total }}","Subtotal Amount":"={{ $json.output.subtotal }}","GST Paid":"={{ $json.output.gstHst }}"},"matchingColumns":[],"schema":[{"id":"Invoice Date","displayName":"Invoice Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Processed Date","displayName":"Processed Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt ID","displayName":"Receipt ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Vendor/Merchant","displayName":"Vendor/Merchant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Category","displayName":"Category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Expense Type","displayName":"Expense Type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt Location","displayName":"Receipt Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Amount","displayName":"Total Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Subtotal Amount","displayName":"Subtotal Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Total Tax","displayName":"Total Tax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"GST Rate","displayName":"GST Rate","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"GST Paid","displayName":"GST Paid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Payment Method","displayName":"Payment Method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CRA Line Item","displayName":"CRA Line Item","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Confidence","displayName":"Confidence","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Confidence Notes","displayName":"Confidence Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[384,112],"id":"726598a2-9f5f-438a-9958-f062fafcb5ef","name":"Google Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"newUpdatedFileName":"={{ $('Google Sheets').item.json['Invoice Date'].split(' ')[0].replace(/-/g, '') }}_{{ $('Google Sheets').item.json['Invoice Date'].split(' ')[1].replace(/:/g, '') }}_{{ $('Google Sheets').item.json['Vendor/Merchant'].replace(/[^a-zA-Z0-9]/g, '') }}_${{ $('Google Sheets').item.json['Total Amount'].toFixed(2) }}.{{ $('Google Drive').item.json.fileExtension }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[912,112],"id":"a8bc5eb3-0ae4-4a9e-83e1-17d897a25323","name":"Update File Name","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"57c2ff75-2006-4c8b-ba9b-b779a75b465d","leftValue":"={{ $json.extracted_text_pdf || $json.extracted_text_image}}","rightValue":"null","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-224,240],"id":"7860ac9d-366c-48fa-9a3e-c1237eaed24f","name":"CheckError"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1SP0XYv7l4M4FFSQKX8HPjNWX8M_unYKK","mode":"list","cachedResultName":"Error","cachedResultUrl":"https://drive.google.com/drive/folders/1SP0XYv7l4M4FFSQKX8HPjNWX8M_unYKK"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[80,400],"id":"cf6ef6ab-cf6f-40ff-ba86-9d3a4d1d0a6a","name":"Move to Error Folder","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"content":"# Gemini 2.5 Pro","height":500,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-944,16],"typeVersion":1,"id":"4dac0aaf-0321-4166-a14c-a863cfb91531","name":"Sticky Note"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Extract the content from the file and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"\n        },\n        {\n          \"inline_data\": {\n            \"mime_type\": \"application/pdf\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.2,\n    \"maxOutputTokens\": 65536\n  }\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-880,352],"id":"b520dbd2-daeb-4acf-8dbb-900b09378975","name":"OCR API - PDF Gemini","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\"text\": \"Extract the content from the image and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"},\n        {\n          \"inline_data\": {\n            \"mime_type\": \"{{ $('Google Drive1').item.json.mimeType }}\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 1,\n    \"maxOutputTokens\": 65536\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-736,144],"id":"ec8cb98f-65c6-497c-a8f7-b679a8871ccc","name":"OCR API - Image Gemini","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1tr5-CFOl89HcLh1th_xhAP4IF6B861-t","mode":"list","cachedResultName":"processed_gemini","cachedResultUrl":"https://drive.google.com/drive/folders/1tr5-CFOl89HcLh1th_xhAP4IF6B861-t"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[656,112],"id":"09574990-db59-462f-b506-9fb7ed5207b7","name":"Move to Processed_Gemini Folder","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[464,512],"id":"59df1c1c-9ece-4e45-8596-0479d378185f","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1856,976],"id":"59fdabfb-a30a-4202-8ba7-c9f126279cbf","name":"Schedule Trigger"},{"parameters":{"resource":"fileFolder","limit":1,"filter":{"driveId":{"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d","mode":"list","cachedResultName":"Unprocessed","cachedResultUrl":"https://drive.google.com/drive/folders/1dze5KfHKG8XVMP5VlumSPw28wgGsLF_d"}},"options":{"fields":["kind","webViewLink","id","*"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1632,976],"id":"0515ae81-8848-4ef2-b602-5dd2052654da","name":"Get a File","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1408,976],"id":"96685487-07a6-41bc-a4a0-a78e7128c59c","name":"Google Drive1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1200,976],"id":"2ff1dd18-918f-4e68-9338-2dedaab68f42","name":"Extract from File1"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive1').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1aFFP1K4OKMs9yNYv-kh8Gm8dTMUurU3z","mode":"list","cachedResultName":"Error","cachedResultUrl":"https://drive.google.com/drive/folders/1aFFP1K4OKMs9yNYv-kh8Gm8dTMUurU3z"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[208,1120],"id":"c3404b46-b051-42a3-b962-82fcd81b0654","name":"Move to Error Folder1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"57c2ff75-2006-4c8b-ba9b-b779a75b465d","leftValue":"={{ $json.extracted_text_pdf || $json.extracted_text_image}}","rightValue":"null","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"5a7a55d8-6e89-4fce-8dc3-3a847bca09ed","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-80,976],"id":"2f55c2aa-bece-401e-8aac-f87ba3a42169","name":"CheckError1"},{"parameters":{"assignments":{"assignments":[{"id":"bb7642bc-f6e6-43e3-872b-04d1a5cb0e4c","name":"extracted_text_pdf","value":"={{ $json.aggregatedText }}","type":"string"},{"id":"5e8991d3-0c09-4626-8162-d1254fa99add","name":"extracted_text_image","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-304,976],"id":"9fd1a348-f5a8-45b7-a51f-f50d945b41fe","name":"Edit Fields1"},{"parameters":{"text":"={{ $json.extracted_text_pdf ?? $json.extracted_text_image }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"country\": {\n      \"type\": \"string\",\n      \"enum\": [\"NZ\", \"AU\", \"US\", \"Unknown\"],\n      \"description\": \"Infer the country from currency, address, phone number, tax labels (GST, Sales Tax), state abbreviations (e.g., CA, TX, NY), or formatting. Default to 'Unknown' if unclear.\"\n    },\n    \"state\": {\n      \"type\": \"string\",\n      \"description\": \"For US receipts only. Extract 2-letter state code (e.g., 'CA', 'NY', 'TX'). If not a US receipt or if unknown, return empty string.\"\n    },\n    \"currency\": {\n      \"type\": \"string\",\n      \"description\": \"Currency code such as 'NZD', 'AUD', or 'USD'. Infer from symbols (e.g. '$' + context), GST (NZ/AU), 'Sales Tax' (US), addresses, or explicitly printed currency. If uncertain, return 'Unknown'.\"\n    },\n\n    \"date\": {\n      \"type\": \"string\",\n      \"description\": \"Extract transaction date and time. Format: YYYY-MM-DD HH:MM:SS. If time missing, return 00:00:00. For US receipts, if a date appears in MM/DD/YYYY format, convert to YYYY-MM-DD.\"\n    },\n\n    \"receiptId\": {\n      \"type\": \"string\",\n      \"description\": \"Receipt/invoice/transaction identifier. Labels include 'Receipt #', 'Order #', 'Invoice #', 'Transaction ID'. Return full alphanumeric value or empty string if not found.\"\n    },\n\n    \"vendor\": {\n      \"type\": \"string\",\n      \"description\": \"Business or merchant name. Exclude address and slogans.\"\n    },\n\n    \"category\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Advertising and Marketing\",\n        \"Bank Fees and Charges\",\n        \"Business Licences and Fees\",\n        \"Delivery and Freight\",\n        \"Fuel Costs\",\n        \"Insurance (Business)\",\n        \"Interest Expense\",\n        \"Legal and Accounting Fees\",\n        \"Maintenance and Repairs\",\n        \"Meals and Entertainment\",\n        \"Office Expenses\",\n        \"Professional Development\",\n        \"Property Rates and Taxes\",\n        \"Rent and Lease\",\n        \"Salaries and Wages\",\n        \"Supplies\",\n        \"Telephone and Internet\",\n        \"Travel - Accommodation\",\n        \"Travel - Airfare\",\n        \"Travel - Other\",\n        \"Utilities\",\n        \"Vehicle - Fuel\",\n        \"Vehicle - Insurance\",\n        \"Vehicle - Maintenance\",\n        \"Vehicle - Other\",\n        \"Other Expenses\"\n      ],\n      \"description\": \"Business expense category. Choose best match across NZ/AU/US receipts.\"\n    },\n\n    \"expenseType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"Electronics\",\n        \"Computer Equipment\",\n        \"Software\",\n        \"Office Supplies\",\n        \"Office Furniture\",\n        \"Office Snacks\",\n        \"Groceries\",\n        \"Hotel Stay\",\n        \"Lodging\",\n        \"Business Meals\",\n        \"Client Meals\",\n        \"Team Meals\",\n        \"Fuel\",\n        \"Vehicle Maintenance\",\n        \"Vehicle Repairs\",\n        \"Vehicle Purchase\",\n        \"Vehicle Lease\",\n        \"Car Wash\",\n        \"Parking\",\n        \"Hardware\",\n        \"Tools\",\n        \"Building Maintenance\",\n        \"Uniforms\",\n        \"Work Clothing\",\n        \"Health Services\",\n        \"Airfare\",\n        \"Public Transport\",\n        \"Taxi/Rideshare\",\n        \"Shipping\",\n        \"Courier Services\",\n        \"Internet Service\",\n        \"Phone Service\",\n        \"Advertising\",\n        \"Marketing Materials\",\n        \"Training Course\",\n        \"Conference Fee\",\n        \"Books\",\n        \"Bank Fees\",\n        \"Transaction Fees\",\n        \"Insurance Premium\",\n        \"Legal Fees\",\n        \"Accounting Fees\",\n        \"Other\"\n      ],\n      \"description\": \"Specific type of expense. Choose closest match.\"\n    },\n\n    \"description\": {\n      \"type\": \"string\",\n      \"description\": \"Short description of what was purchased. Max 200 characters.\"\n    },\n\n    \"subtotal\": {\n      \"type\": \"number\",\n      \"description\": \"Amount before tax. NZ/AU: Ex GST. US: Subtotal before sales tax. If not shown but calculable, derive by subtracting tax from total.\"\n    },\n\n    \"gstAmount\": {\n      \"type\": \"number\",\n      \"description\": \"GST amount for NZ (15%) or AU (10%). If receipt is from US or GST not present or if there is no indication of a gst amount then return 0.00.\"\n    },\n\n    \"salesTax\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Extract sales tax. US receipts label it as 'Sales Tax', 'Tax', 'State Tax', or 'Local Tax'. If no tax or non-US receipt, return 0.00.\"\n    },\n\n    \"otherTax\": {\n      \"type\": \"number\",\n      \"description\": \"Other taxes or levies (e.g., surcharges, environmental fees). If none, return 0.00.\"\n    },\n\n    \"totalTax\": {\n      \"type\": \"number\",\n      \"description\": \"Total tax = gstAmount + salesTax + otherTax. If explicit 'Total Tax' exists, use that.\"\n    },\n\n    \"gstRate\": {\n      \"type\": \"number\",\n      \"description\": \"NZ: 0.15. AU: 0.10. US: 0.00 (sales tax handled separately). Infer from context where possible. if there is no gst indicated then return 0.00\"\n    },\n\n    \"taxRate\": {\n      \"type\": \"number\",\n      \"description\": \"US-only: Sales tax rate if printed (e.g., 0.0725). If not printed, infer based on subtotal and tax where possible. Else return 0.00.\"\n    },\n\n    \"gstIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"NZ/AU: True for most retail receipts. US: Always false (US prices are normally pre-tax). If unknown, infer based on total/subtotal maths.\"\n    },\n\n    \"taxIncluded\": {\n      \"type\": \"boolean\",\n      \"description\": \"US-only convenience field. Return false for US, since sales tax is added at checkout. NZ/AU receipts may show 'incl. GST' — return true in those cases.\"\n    },\n\n    \"total\": {\n      \"type\": \"number\",\n      \"description\": \"Amount paid including all taxes.\"\n    },\n\n    \"paymentMethod\": {\n      \"type\": \"string\",\n      \"description\": \"Payment method such as Corporate Credit Card, Debit, EFTPOS, Cash, Personal (Reimbursable), Cheque. Infer from text (e.g., 'VISA', 'Mastercard'). If there is no indication of how it was paid it is probably Debit.\"\n    },\n\n    \"calcCheckPassed\": {\n      \"type\": \"boolean\",\n      \"description\": \"True if subtotal + totalTax ≈ total within 0.01 tolerance. False if arithmetic does not reconcile.\"\n    },\n\n    \"notes\": {\n      \"type\": \"string\",\n      \"description\": \"Additional context or comments. Max 100 characters.\"\n    },\n\n    \"modelConfidence\": {\n      \"type\": \"number\",\n      \"description\": \"Confidence score (0.0–1.0). Extract from Gemini’s '---CONFIDENCE---' block or estimate based on clarity.\"\n    },\n\n    \"confidenceNotes\": {\n      \"type\": \"string\",\n      \"description\": \"Short summary of uncertainties affecting confidence. Max 200 characters.\"\n    }\n  },\n\n  \"required\": [\n    \"date\",\n    \"vendor\",\n    \"total\",\n    \"gst\",\n    \"gstRate\",\n    \"subtotal\",\n    \"totalTax\",\n    \"currency\",\n    \"modelConidence\",\n    \"confidenceNotes\"\n  ]\n}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[128,720],"id":"a86e6408-00c7-4105-b668-bd14b5127399","name":"Information Extractor1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"jpg","operator":{"type":"string","operation":"equals"},"id":"efa9ce6a-1a6a-454d-ad18-5d9630aad08e"}],"combinator":"and"},"renameOutput":true,"outputKey":"JPG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cd460a6-6891-4628-8649-ec5f79fbc18e","leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"png","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PNG"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"78e2a8c8-029e-43cf-a99a-ffc9dc875899","leftValue":"={{ $('Google Drive1').item.json.fileExtension }}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-976,960],"id":"2a10f953-333f-4c7b-a9f6-35373b26313b","name":"Switch1"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Google Drive1').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1tr5-CFOl89HcLh1th_xhAP4IF6B861-t","mode":"list","cachedResultName":"processed_gemini","cachedResultUrl":"https://drive.google.com/drive/folders/1tr5-CFOl89HcLh1th_xhAP4IF6B861-t"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1024,832],"id":"2fb0f921-3bf6-42ce-bdae-ca20b13c779c","name":"Move to Processed_Gemini Folder1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"jsCode":"// Aggregate OCR text from all pages\nlet aggregatedText = '';\nlet pageTexts = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Access candidates array from the new structure\n    const candidates = item.json.candidates;\n    \n    if (!candidates || !Array.isArray(candidates)) {\n      continue;\n    }\n    \n    // Loop through each candidate\n    for (let i = 0; i < candidates.length; i++) {\n      const candidate = candidates[i];\n      \n      // Extract text from content.parts\n      if (candidate.content && candidate.content.parts) {\n        for (const part of candidate.content.parts) {\n          if (part.text) {\n            const pageNumber = i + 1; // Use candidate index as page number\n            const pageText = part.text;\n            \n            // Store individual page text\n            pageTexts.push({\n              pageNumber: pageNumber,\n              text: pageText\n            });\n            \n            // Aggregate all text\n            aggregatedText += pageText + '\\n\\n';\n          }\n        }\n      }\n    }\n    \n  } catch (error) {\n    // Handle error with more details\n    return [{\n      json: {\n        error,\n        aggregatedText: '',\n        debug: JSON.stringify(item.json, null, 2)\n      }\n    }];\n  }\n}\n\n// Return only the aggregated result\nreturn [{\n  json: {\n    aggregatedText: aggregatedText.trim(),\n    totalPages: pageTexts.length,\n    pages: pageTexts\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-528,1072],"id":"d3cae920-3d1c-403f-9020-696b70fbbf0f","name":"Agg Data1"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=\n\n","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Extract the content from the file and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"\n        },\n        {\n          \"inline_data\": {\n            \"mime_type\": \"application/pdf\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.2,\n    \"maxOutputTokens\": 65536\n  }\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-752,1072],"id":"5c7f720c-afd5-4af3-9e82-ac6bf65d5f56","name":"OCR API - PDF Gemini1","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"=json","bodyParameters":{"parameters":[{}]},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\"text\": \"Extract the content from the image and output it while keeping the original format.\\n\\nFirst, output ONLY the extracted content in its original layout and formatting.\\n\\nAfter you have finished the content, append the following block:\\n\\n---CONFIDENCE---\\nconfidence: <number between 0.0 and 1.0>\\nnotes: [short list of any uncertainties or quality issues, e.g. 'blurry digits', 'unclear decimal', 'cut-off text']\\n\\nAssign a HIGH confidence (0.95–1.0) only if all key elements (numbers, decimals, dates, vendor names) are visually clear and unambiguous. Lower the confidence if any part of the text is faint, blurred, obscured, or ambiguous.\\n\\nDo not add any other commentary outside the content and the CONFIDENCE block.\"},\n        {\n          \"inline_data\": {\n            \"mime_type\": \"{{ $('Google Drive1').item.json.mimeType }}\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 1,\n    \"maxOutputTokens\": 65536\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-624,864],"id":"cd611b51-8e8c-4438-b158-c446a93da584","name":"OCR API - Image Gemini1","credentials":{"httpHeaderAuth":{"id":"UqZJfpi79YPM9UvQ","name":"Gemini API"}}},{"parameters":{"content":"# Gemini 2.5 Pro","height":500,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-816,736],"typeVersion":1,"id":"b7fc8b0b-ef6e-4771-915e-4ed2d8e234a5","name":"Sticky Note1"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY","mode":"list","cachedResultName":"Business Expenses","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AjZ1zctkUtI05YqovdCra1B_fNzwf8vVjuqgBSbNkNY/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Invoice Date":"={{ $json.output.date }}","Status":"Processed","Receipt ID":"={{ $json.output.receiptId }}","Vendor/Merchant":"={{ $json.output.vendor }}","Category":"={{ $json.output.category }}","Expense Type":"={{ $json.output.expenseType }}","Description":"={{ $json.output.description }}","Total Amount":"={{ $json.output.total }}","Subtotal Amount":"={{ $json.output.subtotal }}","GST Paid":"={{ $json.output.gstAmount }}","Total Tax":"={{ $json.output.totalTax }}","Payment Method":"={{ $json.output.paymentMethod }}","Notes":"={{ $json.output.notes }}","Receipt Location":"={{ $('Google Drive1').item.json.webViewLink }}","Processed Date":"={{ $now.toFormat(\"dd/LL/yyyy HH:mm\") }}","GST Rate":"={{ $json.output.gstRate }}","Confidence":"={{ $json.output.modelConfidence }}","Confidence Notes":"={{ $json.output.confidenceNotes }}"},"matchingColumns":[],"schema":[{"id":"Invoice Date","displayName":"Invoice Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Processed Date","displayName":"Processed Date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt ID","displayName":"Receipt ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Vendor/Merchant","displayName":"Vendor/Merchant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Category","displayName":"Category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Expense Type","displayName":"Expense Type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Receipt Location","displayName":"Receipt Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Amount","displayName":"Total Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Subtotal Amount","displayName":"Subtotal Amount","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tax","displayName":"Total Tax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"GST Rate","displayName":"GST Rate","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"GST Paid","displayName":"GST Paid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Payment Method","displayName":"Payment Method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CRA Line Item","displayName":"CRA Line Item","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Confidence","displayName":"Confidence","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Confidence Notes","displayName":"Confidence Notes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[832,832],"id":"19d76631-a58d-4458-8835-b06a7d9ffff0","name":"Google Sheets1","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"newUpdatedFileName":"={{ $('Google Sheets1').item.json['Invoice Date'].split(' ')[0].replace(/-/g, '') }}_{{ $('Google Sheets1').item.json['Invoice Date'].split(' ')[1].replace(/:/g, '') }}_{{ $('Google Sheets1').item.json['Vendor/Merchant'].replace(/[^a-zA-Z0-9]/g, '') }}_${{ $('Google Sheets1').item.json['Total Amount (CAD)'].toFixed(2) }}.{{ $('Google Drive1').item.json.fileExtension }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1232,832],"id":"517f9e1c-ed3b-4f0c-8fa6-f59e50389b42","name":"Update File Name1","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"47c49dfb-d49d-43fd-a8ca-2d7e3151f5c0","leftValue":"={{ $json.output.modelConfidence }}","rightValue":0.6,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[480,720],"id":"a31e0718-d0a8-459d-95fc-80c2c3809784","name":"Check confidence level"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Error in invoice processing","message":"=Processing invoice from  {{ $('Information Extractor1').item.json.output.vendor }} dated {{ $('Information Extractor1').item.json.output.date }} failed as the confidence level on the data extraction was not great.  Please review the invoice which is in the error folder on your google drive.","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[480,1120],"id":"844e6228-6502-4d88-81ce-8b8dd8afef44","name":"Send a message","webhookId":"8122dfb9-1350-4a73-abb5-fdd4cdd746b4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Processed another invoice for you","message":"=Just successfully processed an invoice from \n{{ $('Information Extractor1').item.json.output.vendor }} \ndated \n{{ new Date($('Information Extractor1').item.json.output.date)\n      .toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit', hour12: false }) }} \nin the sum of \n{{ $('Information Extractor1').item.json.output.total }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1024,1088],"id":"f9dffec5-1a4a-4783-82d4-d0b93bc951cb","name":"Send a message1","webhookId":"8122dfb9-1350-4a73-abb5-fdd4cdd746b4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Google Drive":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Switch":{"main":[[{"node":"OCR API - Image Gemini","type":"main","index":0}],[{"node":"OCR API - Image Gemini","type":"main","index":0}],[{"node":"OCR API - PDF Gemini","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Agg Data":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"CheckError","type":"main","index":0}]]},"Google Drive Trigger":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Information Extractor":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Move to Processed_Gemini Folder","type":"main","index":0}]]},"CheckError":{"main":[[{"node":"Information Extractor","type":"main","index":0}],[{"node":"Move to Error Folder","type":"main","index":0}]]},"OCR API - PDF Gemini":{"main":[[{"node":"Agg Data","type":"main","index":0}]]},"OCR API - Image Gemini":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Move to Processed_Gemini Folder":{"main":[[{"node":"Update File Name","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0},{"node":"Information Extractor1","type":"ai_languageModel","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get a File","type":"main","index":0}]]},"Get a File":{"main":[[{"node":"Google Drive1","type":"main","index":0}]]},"Google Drive1":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"Extract from File1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"CheckError1":{"main":[[{"node":"Information Extractor1","type":"main","index":0}],[{"node":"Move to Error Folder1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"CheckError1","type":"main","index":0}]]},"Information Extractor1":{"main":[[{"node":"Check confidence level","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"OCR API - Image Gemini1","type":"main","index":0}],[{"node":"OCR API - Image Gemini1","type":"main","index":0}],[{"node":"OCR API - PDF Gemini1","type":"main","index":0}]]},"Move to Processed_Gemini Folder1":{"main":[[{"node":"Update File Name1","type":"main","index":0}]]},"Agg Data1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"OCR API - PDF Gemini1":{"main":[[{"node":"Agg Data1","type":"main","index":0}]]},"OCR API - Image Gemini1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Move to Processed_Gemini Folder1","type":"main","index":0}]]},"Check confidence level":{"main":[[{"node":"Google Sheets1","type":"main","index":0}],[{"node":"Move to Error Folder1","type":"main","index":0}]]},"Move to Error Folder1":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Update File Name1":{"main":[[{"node":"Send a message1","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":"Version 4cdea4b8","description":"","autosaved":false},"tags":[]},{"updatedAt":"2026-01-17T03:39:32.994Z","createdAt":"2026-01-17T03:22:29.960Z","id":"NGStG991cHLoqvfI","name":"AI Daily Newsletter - Automation & Voice Agents","active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 7 * * *"}]}},"id":"trigger-001","name":"Daily 7AM Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[256,304]},{"parameters":{"promptType":"define","text":"=Research the latest developments in AI automation and voice agents. Focus on:\n1. Recent breakthroughs in AI automation tools and platforms\n2. Voice agent technology advances (voice AI, conversational AI)\n3. Notable product launches or updates\n4. Industry trends and predictions\n5. Practical applications and case studies\n\nUse the Perplexity tool to search for current news and information. Provide a comprehensive research summary with specific details, dates, and sources where possible. Structure your findings clearly with sections for each topic area.\n\ntoday's date is {{ $now }}","options":{"systemMessage":"=You are an expert AI technology researcher specializing in automation and voice agent technologies. Your role is to gather, analyze, and synthesize the latest developments in these fields.\n\nGuidelines:\n- Focus on factual, recent information (within the last week if possible)\n- Include specific company names, product names, and technical details\n- Highlight practical implications for businesses and developers\n- Note any significant funding, partnerships, or acquisitions\n- Identify emerging trends and potential disruptions\n- Structure your research in a clear, organized manner\n\nProvide thorough, well-researched content that can be used as the foundation for a professional newsletter."}},"id":"agent-research-002","name":"Research Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[512,304]},{"parameters":{"model":"openai/gpt-5-mini","options":{"maxTokens":4096,"temperature":0.7}},"id":"llm-gpt5-003","name":"OpenRouter GPT-5","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[400,528],"credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"model":"sonar-deep-research","messages":{"message":[{"content":"={{ $fromAI('query', 'The search query to research') }}"}]},"options":{"searchRecency":"week"},"requestOptions":{}},"id":"tool-perplexity-004","name":"Perplexity Research","type":"n8n-nodes-base.perplexityTool","typeVersion":1,"position":[608,528],"credentials":{"perplexityApi":{"id":"Mr9UdvJJS7sjNHOf","name":"Perplexity account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}\n\n---\n\nUsing the research above, create a professional HTML newsletter about AI Automation and Voice Agents for today's date.","options":{"systemMessage":"You are an expert newsletter writer specializing in AI technology content. Create engaging, professional HTML newsletters that inform and inspire readers.\n\n## Newsletter Structure Requirements:\n\n1. **Header Section**: Eye-catching title with today's date\n2. **Executive Summary**: 2-3 sentence overview of key highlights\n3. **Main Stories** (3-5 sections):\n   - Compelling headlines\n   - Concise but informative content\n   - Relevant context and implications\n4. **Quick Bites**: Bullet-pointed shorter news items\n5. **Looking Ahead**: Brief predictions or upcoming events\n6. **Footer**: Sign-off\n\n## HTML Styling Guidelines:\n\n- Use inline CSS for email compatibility\n- Color scheme: Professional blues (#1a73e8, #174ea6) with white (#ffffff) background\n- Font: Arial, Helvetica, sans-serif\n- Max width: 600px, centered\n- Include proper spacing and visual hierarchy\n- Use <table> layouts for email client compatibility\n\n## Tone and Style:\n- Professional yet accessible\n- Informative without being overly technical\n- Engaging headlines that capture attention\n- Action-oriented language where appropriate\n\nOutput ONLY the complete HTML code, starting with <!DOCTYPE html> and ending with </html>. Do not include any markdown formatting or code blocks around the HTML."}},"id":"agent-newsletter-005","name":"Newsletter Writer Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[800,304]},{"parameters":{"model":"anthropic/claude-sonnet-4","options":{"maxTokens":8192,"temperature":0.6}},"id":"llm-claude-006","name":"OpenRouter Claude Sonnet","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[800,528],"credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"sendTo":"chris@hallowes.com","subject":"=AI Automation & Voice Agents Newsletter - {{ $now.format('MMMM d, yyyy') }}","message":"={{ $json.output }}","options":{"senderName":"AI Newsletter Bot"}},"id":"gmail-007","name":"Send Newsletter Email","type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1104,304],"webhookId":"388b464a-7740-4249-a573-d421d9ffd328","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Daily 7AM Trigger":{"main":[[{"node":"Research Agent","type":"main","index":0}]]},"Research Agent":{"main":[[{"node":"Newsletter Writer Agent","type":"main","index":0}]]},"Newsletter Writer Agent":{"main":[[{"node":"Send Newsletter Email","type":"main","index":0}]]},"OpenRouter GPT-5":{"ai_languageModel":[[{"node":"Research Agent","type":"ai_languageModel","index":0}]]},"Perplexity Research":{"ai_tool":[[{"node":"Research Agent","type":"ai_tool","index":0}]]},"OpenRouter Claude Sonnet":{"ai_languageModel":[[{"node":"Newsletter Writer Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Pacific/Auckland","saveDataErrorExecution":"all","saveDataSuccessExecution":"all","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"fea03f07-4267-4d8c-b1a6-af1f8cc306da","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-17T03:22:29.963Z","createdAt":"2026-01-17T03:22:29.963Z","role":"workflow:owner","workflowId":"NGStG991cHLoqvfI","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-29T01:16:27.000Z","createdAt":"2025-12-29T00:46:32.894Z","id":"OK3H6jhZ65IezQOP","name":"My workflow 2","active":false,"isArchived":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"b0863d2f-7dd0-4868-a2a9-06df19a38b49","name":"When clicking ‘Execute workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"028c4930-67a7-4406-9f30-70664e2b99af","name":"prompt","value":"research the product Anescan which is an EMR","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[208,0],"id":"9fe1e86d-5def-4dce-8af2-89d5bebeee62","name":"Edit Fields"},{"parameters":{"query":"={{ $json.prompt }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[416,0],"id":"752a22ae-6aa6-415d-b754-75a56321e3c8","name":"Search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-5-nano","mode":"list","cachedResultName":"GPT-5-NANO"},"responses":{"values":[{"content":"=Summarise this research and put into a logical sequence.\nCreate a suitable heading and body for it suitable for an email.\n\nHere is the text  {{ $json.combined_text }}"}]},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[832,0],"id":"684f30e4-1fd1-419d-98ec-890739d36aba","name":"Message a model","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"jsCode":"// Get the first input item's JSON (your search result wrapper)\nconst data = $input.first().json;\n\n// Pull out the results array safely\nconst results = data.results || [];\n\n// Build one combined block\nconst combined = results\n  .map((r, index) => {\n    return [\n      `Result ${index + 1}`,\n      `Title: ${r.title || \"\"}`,\n      `URL: ${r.url || \"\"}`,\n      ``,\n      r.content || \"\"\n    ].join(\"\\n\");\n  })\n  .join(\"\\n\\n-----\\n\\n\"); // separator between entries\n\n// Return one item for the AI node\nreturn [\n  {\n    json: {\n      combined_text: combined,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[624,0],"id":"fff3f8c3-adc4-45cc-b4d0-c88da7505f3f","name":"Code in JavaScript"},{"parameters":{"jsCode":"// Get AI text from previous node\nconst data = $input.first().json;\nconst rawText = data.output[0].content[0].text || \"\";\n\n// Extract \"Subject:\" line\nconst subjectMatch = rawText.match(/Subject:\\s*(.*)/i);\nconst subject = subjectMatch ? subjectMatch[1].trim() : \"\";\n\n// Extract everything after \"Body:\"\nconst bodyMatch = rawText.match(/Body:\\s*([\\s\\S]*)/i);\nconst body = bodyMatch ? bodyMatch[1].trim() : \"\";\n\n// Return as two fields for later nodes\nreturn [\n  {\n    json: {\n      subject,\n      body,\n      full_text: rawText, // keep original if you want\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,0],"id":"dd5230ba-db46-43c7-8b54-49538dd50ede","name":"Code in JavaScript1"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"={{ $json.subject }}","message":"={{ $json.body }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1408,0],"id":"d14226cf-1580-4ff4-85ae-af0c81964b1d","name":"Send a message","webhookId":"0f9b1114-f462-4d7e-a6df-f4d5f0a95883","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Search","type":"main","index":0}]]},"Search":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Message a model","type":"main","index":0}]]},"Message a model":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"d143ce45-d83a-4974-a872-9d6745dc02a0","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-29T00:46:32.908Z","createdAt":"2025-12-29T00:46:32.908Z","role":"workflow:owner","workflowId":"OK3H6jhZ65IezQOP","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-07T02:07:47.000Z","createdAt":"2025-11-29T03:09:39.966Z","id":"POlghXfuSj11IEGq","name":"From Zero to Inbox Agent","active":false,"isArchived":true,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{},"options":{}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[896,320],"id":"abe1f56e-6972-4aa0-b023-5b9e68d484e8","name":"Gmail Trigger"},{"parameters":{"inputText":"=Subject: {{ $json.headers.subject }}\n\nBody: {{ $json.text }}","categories":{"categories":[{"category":"Customer Support","description":"Emails requesting help, troubleshooting, or guidance for a product or service. Usually describe issues like login errors, bugs, or malfunctioning features. Common keywords: error, issue, problem, help, access, support, fix, reset, troubleshoot."},{"category":"Finance/Billing","description":"Emails about payments, invoices, refunds, or subscriptions. The sender wants to confirm, dispute, or update financial details. Common keywords: invoice, payment, refund, billing, charge, subscription, renewal, receipt."},{"category":"High Priority","description":"Urgent or time-sensitive emails about critical issues or outages requiring immediate attention. Common keywords: urgent, ASAP, critical, outage, down, immediate, emergency, escalation."},{"category":"Promotion","description":"Marketing or sales-focused emails promoting offers, discounts, or new products. Tone is upbeat and persuasive. Common keywords: sale, offer, discount, promotion, new feature, upgrade, limited time, exclusive."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1.1,"position":[1088,288],"id":"0c62b376-2c43-4b89-92ca-d4533e55f71b","name":"Text Classifier"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1040,592],"id":"f64a5685-7b5c-4815-a176-74867f68a47f","name":"GPT-4.1-mini"},{"parameters":{"model":"anthropic/claude-3.7-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1936,208],"id":"4db0b868-11db-4b1f-9744-c9a592f06367","name":"Claude 3.7"},{"parameters":{"promptType":"define","text":"=Subject: {{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody: {{ $('Gmail Trigger').item.json.text }}","options":{"systemMessage":"=You are Nate's AI Assistant — an expert, friendly, and professional customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond clearly, concisely, and helpfully to member questions.\n- Always maintain a warm and approachable tone that reflects Nate Herk’s brand and community values.\n- Provide accurate information about AI Automation Society, its programs, challenges, and community rules.\n- If you do **not** know the answer or the query requires Nate’s direct input, politely tell the user to reach out to **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Nate’s AI Assistant\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,32],"id":"a536d68b-c4b1-456e-8f50-9bf2b5fef0e0","name":"Customer Support Agent"},{"parameters":{"operation":"reply","messageId":"={{ $('Gmail Trigger').item.json.id }}","emailType":"text","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,32],"id":"9a727faa-e03d-4365-9478-a7d2e2134a4c","name":"Reply to a message","webhookId":"66b6ddd9-e93d-4182-8a22-52481b02bbc4"},{"parameters":{"sendTo":"billing@example.com","subject":"=New Billing Email: {{ $('Gmail Trigger').item.json.from.value[0].name }}","emailType":"text","message":"=Hey Billing team!\n\nWe received a new billing inquiry at {{ $now.format('yyyy-MM-dd hh:mm a') }}.\n\nIt is from {{ $('Gmail Trigger').item.json.from.value[0].name }} you can email them at {{ $('Gmail Trigger').item.json.from.value[0].address }}.\n\nThis is the subject of their email: {{ $('Gmail Trigger').item.json.subject }}\n\nCheers!","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,192],"id":"49097eda-9226-4b17-b07c-adfe5b74688b","name":"Send a message","webhookId":"70ecf5b5-0b1b-4758-aae4-cb90d0bc5574"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1594706753190197855"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,32],"id":"6f705117-7d47-4882-8631-047a6bae411a","name":"Support","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_3029742840171510077"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,192],"id":"31523852-ed3e-4407-a6e9-ce9f7d367c8b","name":"Finance","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_8750970712842772917"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,352],"id":"821a59f6-e58a-45b1-ac51-612c406c01e4","name":"Priority","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1276623808023834907"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,528],"id":"c19bcfda-cef5-4c79-93a2-fca69c7f4e39","name":"Promotion","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b"},{"parameters":{"promptType":"define","text":"=Subject:{{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody:{{ $('Gmail Trigger').item.json.text }}\n","options":{"systemMessage":"=You are Mr. Doomsday — an expert but brutally honest and rude customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond with accurate information, but do so in a sarcastic, blunt, and unapologetically rude tone.\n- Never sugarcoat answers. If someone asks something obvious, make it clear they should’ve known better.\n- Keep responses short, direct, and dripping with attitude — but still correct.\n- If you don’t know the answer or it requires Nate’s direct input, tell the user (in your signature rude style) to contact **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Mr. Doomsday\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,352],"id":"265fe371-1c60-4bbe-9b60-8606ad6fa91c","name":"Mr. Doomsday"},{"parameters":{"resource":"draft","subject":"test","message":"={{ $json.output }}","options":{"threadId":"={{ $('Gmail Trigger').item.json.threadId }}","sendTo":"={{ $('Gmail Trigger').item.json.from.value[0].address }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,352],"id":"1499f2c0-87e4-4828-86f4-2325a3de0829","name":"Create a draft","webhookId":"e73b5b5b-5596-4209-ad5f-01da1c507ac3"},{"parameters":{"operation":"markAsRead","messageId":"={{ $('Gmail Trigger').item.json.id }}"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,528],"id":"94ea653f-ced0-4e87-8a7f-8e400edab83a","name":"Mark a message as read","webhookId":"44be72e9-332f-4098-b051-8847a8278df4"},{"parameters":{"content":"# 🛠️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your Gmail automation up and running:\n\n### ✅ Step 1: Connect Your Gmail Account  \nMake sure your Gmail account is properly connected to all **Gmail nodes** in the workflow.\n\n### ✅ Step 2: Connect Your [OpenRouter](https://openrouter.ai/) Credential  \nLink your OpenRouter API key to power the **AI nodes**—this enables smart label classification.\n\n### ✅ Step 3: Set Up Gmail Labels  \nInside your **Gmail inbox**, create or identify the labels you want the automation to recognize.\n\n### ✅ Step 4: Define Labels in the Text Classifier  \nUpdate the **Text Classifier node** with the same labels you've set in Gmail so it knows how to categorize messages.\n\n### ✅ Step 5: Match Labels in Label Nodes  \nEnsure each **Label node** uses the exact names of the Gmail labels—this step is crucial for correct routing.\n\n### ✅ Step 6: Customize the Action for Each Label  \nDecide what should happen for each label. Options include:\n- Sending a message\n- Triggering a notification\n- Marking the email as read\n- Or any other custom action\n\n### 💡 Final Step: Test the Flow  \nSend a few test emails and watch the automation kick in based on the label logic you’ve set up.\n","height":768,"width":816},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"f9c922a7-52ec-476f-96cd-74bfc5a2e3b5","name":"Sticky Note"}],"connections":{"Gmail Trigger":{"main":[[{"node":"Text Classifier","type":"main","index":0}]]},"Text Classifier":{"main":[[{"node":"Support","type":"main","index":0}],[{"node":"Finance","type":"main","index":0}],[{"node":"Priority","type":"main","index":0}],[{"node":"Promotion","type":"main","index":0}]]},"GPT-4.1-mini":{"ai_languageModel":[[{"node":"Text Classifier","type":"ai_languageModel","index":0}]]},"Claude 3.7":{"ai_languageModel":[[{"node":"Customer Support Agent","type":"ai_languageModel","index":0},{"node":"Mr. Doomsday","type":"ai_languageModel","index":0}]]},"Customer Support Agent":{"main":[[{"node":"Reply to a message","type":"main","index":0}]]},"Support":{"main":[[{"node":"Customer Support Agent","type":"main","index":0}]]},"Finance":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Priority":{"main":[[{"node":"Mr. Doomsday","type":"main","index":0}]]},"Mr. Doomsday":{"main":[[{"node":"Create a draft","type":"main","index":0}]]},"Promotion":{"main":[[{"node":"Mark a message as read","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"c145f124-be21-4b54-91b6-f5b9d095ec92","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T03:09:39.970Z","createdAt":"2025-11-29T03:09:39.970Z","role":"workflow:owner","workflowId":"POlghXfuSj11IEGq","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-30T00:03:35.454Z","createdAt":"2025-12-09T01:32:09.605Z","id":"QrGT7747m8CMGyS0","name":"Agent Swarm","active":true,"isArchived":false,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"id":"3f435554-67d1-4660-8f8b-bd2b1285c2b8","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[816,192],"webhookId":"99eab1a0-569d-4f0f-a49e-578a02abfe63","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"47d36c88-fc9a-4937-9604-a15284848037","name":"Set 'Text'","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,208]},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"0c7d922d-8160-4e65-83c4-ce1101471d17","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1440,32],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"fe01547d-f434-42dd-879a-f3f1a835de80","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1600,32],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"ddc9d3a8-8ed3-4757-9c16-bbb37eae4b59","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1264,192]},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails or creating summaries — your sole responsibility is to call the correct tool.\n\n## Tools\n- **Think**: Use this to think deeply or if you get stuck\n- **emailAgent**: Use this tool to take action in email\n- **calendarAgent**: Use this tool to take action in calendar\n- **contactAgent**: Use this tool to get, update, or add contacts\n- **contentCreator**: Use this tool to create blog posts\n- **webAgent**: Use this tool to perform deeper web research or get current weather info\n- **youtubeAgent**: Use this tool to find high-performing videos or manage video ideas\n\n## Rules\n- Only use the English language, no Maori or Te Reo.\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the necessary tools based on the user's request\n2) Use the **Think** tool to verify you took the right steps. This tool should be called every time.\n\n## Calendar\n- if no attendees are explicitly given there are none.\n- if no location is given then leave this blank.\n- if no time is given on the specific day then ask if it an all-day event and if so then make it an all day event.\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave  \n  - Action: Use **contactAgent** to get Nate Herkelman's email  \n  - Action: Use **emailAgent** to send the email. You will pass the tool a query like:  \n    \"send Nate Herkelman an email to ask what time he wants to leave. here is his email: [email address]\"\n- Output: The email has been sent to Nate Herkelman. Anything else I can help you with?\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1936,192],"id":"26be28b6-cef6-4813-a3b5-39f137d984e4","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"sendTo":"={{ $fromAI(\"emailAddress\") }}","subject":"={{ $fromAI(\"subject\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,752],"id":"b180e27e-d0b8-4a24-a872-22ba1a273bba","name":"Send Email","webhookId":"86c8c4b1-13bb-4ebe-acb9-30e1d7082d55","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":"={{ $fromAI(\"limit\",\"how many emails the user wants\") }}","simple":false,"filters":{"sender":"={{ $fromAI(\"sender\",\"who the emails are from\") }}"},"options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1392,752],"id":"0ea6c4ab-3e0a-4658-a413-d7516146a2c3","name":"Get Emails","webhookId":"af4b3298-9037-44b0-aa12-2acbfbb5e66f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"draft","subject":"={{ $fromAI(\"subject\") }}","emailType":"html","message":"={{ $fromAI(\"emailBody\") }}","options":{"threadId":"={{ $fromAI(\"threadID\") }}","sendTo":"={{ $fromAI(\"emailAddress\") }}"}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,608],"id":"e175eb53-2e4c-41cd-b7ea-b2868cde4cd0","name":"Create Draft","webhookId":"17016bce-d7d7-428a-a56c-f6ea122db8be","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"reply","messageId":"={{ $fromAI(\"ID\",\"the message ID\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,608],"id":"5c89bfb3-8ff2-4da9-94b4-6f45502c4c25","name":"Email Reply","webhookId":"114785e6-a859-432b-81b4-c490c1c35b1c","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"label","returnAll":true},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,752],"id":"4d1338cb-84d1-4f7a-bafb-fb7a108de97a","name":"Get Labels","webhookId":"9e08b59e-792d-4566-83f1-9263c9ad86ae","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $fromAI(\"ID\",\"the ID of the message\") }}","labelIds":"={{ $fromAI(\"labelID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,608],"id":"a7a1419f-07b1-404b-8a69-50c4f2fe4db3","name":"Label Emails","webhookId":"0e951529-2e6d-40bf-ac40-fc0947e242e2","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"markAsUnread","messageId":"={{ $fromAI(\"messageID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,752],"id":"4a1e4cfe-2d8f-493a-b8a9-6a2344781da5","name":"Mark Unread","webhookId":"a35af9d8-f67d-4ff9-803f-59ec6356e795","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"toolDescription":"An email agent for all email actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are an email management assistant. All emails must be formatted professionally in HTML and signed off as \"Chris.\" \n\n**Email Management Tools**   \n   - Use \"Send Email\" to send emails.  \n   - Use \"Create Draft\" if the user asks for a draft.  \n   - Use \"Get Emails\" to retrieve emails when requested.\n   - Use \"Get Labels\" to retrieve labels.\n   - Use \"Mark Unread\" to mark an email as unread. You must use \"Get Emails\" first so you have the message ID of the email to flag.\n   - Use \"Label Email\" to flag an email. You must use \"Get Emails\" first so you have the message ID of the email to flag. Then you must use \"Get Labels\" so you have the label ID.\n   - Use \"Email Reply\" to reply to an email. You must use \"Get Emails\" first so you have the message ID of the email to reply to.\n\n## Final Notes\n- Here is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1584,432],"id":"3b16ee03-a067-4b83-bd93-12d1a9c1eb80","name":"Email Agent"},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":["={{ $fromAI(\"eventAttendeeEmail\") }}"],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,752],"id":"1de69ea0-8dd3-46b4-91c8-d6a3d29afc2e","name":"Create Event with Attendee","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":[],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1920,752],"id":"e0261479-0db1-4ae5-be27-84dbc1f8a051","name":"Create Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"timeMin":"={{ $fromAI(\"dayBefore\",\"the day before the date the user requested\") }}","timeMax":"={{ $fromAI(\"dayAfter\",\"the day after the date the user requested\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,608],"id":"77b984d2-dc86-484d-88d8-5c39ad14b6ad","name":"Get Events","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ $fromAI(\"eventID\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,608],"id":"813d10c0-fa5d-4d1b-b8d0-30d5d526a19f","name":"Delete Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ $fromAI(\"eventID\") }}","updateFields":{"end":"={{ $fromAI(\"endTime\") }}","start":"={{ $fromAI(\"startTime\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,752],"id":"e2a646fe-2582-4f4f-b442-15a98a33f964","name":"Update Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"toolDescription":"A calendar agent for all calendar actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include creating, getting, and deleting events in the user's calendar.\n\n**Calendar Management Tools**  \n   - Use \"Create Event with Attendee\" when an event includes a participant.  \n   - Use \"Create Event\" for solo events.   \n   - Use \"Get Events\" to fetch calendar schedules when requested.\n   - Use \"Delete Event\" to delete an event. You must use \"Get Events\" first to get the ID of the event to delete.\n   - Use \"Update Event\" to update an event. You must use \"Get Events\" first to get the ID of the event to update.\n\n## Final Notes\nHere is the current date/time: {{ $now }}\nIf a duration for an event isn't specified, assume it will be one hour.\nAlways use the current timezone for New Zealand"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1936,432],"id":"d1bf13a9-ea10-43a6-b727-73ece72e2dfb","name":"Calendar Agent"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2416,592],"id":"ec1236f6-529d-4079-98a9-6666a217aade","name":"Get Contacts","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"upsert","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"columns":{"mappingMode":"defineBelow","value":{"Business":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Business', ``, 'boolean') }}","id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}","Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","Company Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company_Name', ``, 'string') }}","Phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}","Notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notes', ``, 'string') }}","Status":"Active"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Phone","displayName":"Phone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Inactive","value":"Inactive"},{"name":"Active","value":"Active"}],"readOnly":false,"removed":false},{"id":"Business","displayName":"Business","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"boolean","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2528,592],"id":"502df55d-19ba-4554-9a40-afa3d84e9c67","name":"Add or Update Contact","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"toolDescription":"Contact agent for all contact actions, like getting contacts","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a contact management assistant. Your responsibilities include looking up contacts, adding new contacts, or updating a contact's information.\n\n**Contact Management**  \n   - Use \"Get Contacts\" to retrieve contact information. \n   - Use \"Add or Update Contact\" to store new contact information or modify existing entries. \n\n** If I say send me an email or send an email to me then the proper contact is Chris Hallowes and the email is chris@hallowes.com"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2288,432],"id":"61719bce-dd06-41c0-aa21-b5f495cac8ed","name":"Contact Agent"},{"parameters":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[2464,944],"id":"7cf33b41-3aaa-4696-bf40-40d67b5cdb36","name":"Tavily","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"messages":{"message":[{"content":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"}]},"options":{},"requestOptions":{}},"type":"n8n-nodes-base.perplexityTool","typeVersion":1,"position":[2592,944],"id":"1b7749b7-6f90-43bb-9180-505450ccbf58","name":"Perplexity","credentials":{"perplexityApi":{"id":"Mr9UdvJJS7sjNHOf","name":"Perplexity account"}}},{"parameters":{"format":"imperial","cityName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}","language":"en"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[2736,928],"id":"d67ec1e0-eafd-4524-a638-b7e8cfb19a2b","name":"OpenWeatherMap","disabled":true},{"parameters":{"toolDescription":"A research agent for all research actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a web research assistant. Your responsibilities include conducting quick web searches, performing deeper research, and retrieving current weather information. \n\n**Web Search & Research**  \n   - Use **Tavily** for quick factual lookups, recent news, or verifying specific pieces of information.  \n   - Use **Perplexity** when a question requires deeper research, multiple perspectives, or synthesized answers from various sources.  \n\n**Weather Information**  \n   - Use **Open Weather Map** to retrieve current weather data, including temperature, conditions, and forecasts for a given location.\n\nAlways explain your reasoning briefly when choosing between Tavily and Perplexity. Prioritize clarity, credibility, and helpfulness in your responses.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2400,752],"id":"a6b5d415-78b4-4188-ab06-3ad3668b3f34","name":"Web Agent"},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a YouTube content assistant. Your responsibilities include researching high-performing YouTube videos, retrieving existing video ideas, and adding new content ideas to the video database. Your goal is to support content strategy and ideation with relevant, high-quality inputs.\n\n**Video Idea Management**  \n   - Use **Get Ideas** to retrieve existing YouTube video ideas from the internal database.  \n   - Use **Add Idea** to contribute new video ideas to the database for future content planning.\n\n**Content Research**  \n   - Use **YouTube Videos** to search for high-performing videos on a given topic. Analyze trends, titles, formats, and engagement to inspire new content strategies.\n\nWhen suggesting or adding an idea, be specific, creative, and align your suggestions with proven YouTube best practices.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2656,432],"id":"263c4923-b226-4929-bd76-4d3c90e86959","name":"YouTube Agent","disabled":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1392,608],"id":"4664de75-8b96-456e-8305-a249c12723a2","name":"GPT 4.1-mini1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1920,608],"id":"6c5660b1-9357-4e7c-82de-114f85385fed","name":"GPT 4.1-mini2","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2288,592],"id":"6c006b2f-bec5-48cb-8ed7-0626357f2ae3","name":"GPT 4.1-mini3","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2304,928],"id":"d4d56309-befc-4bcc-ad3b-ec13d0e462ea","name":"GPT 4.1-mini4","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2656,592],"id":"25d210c1-9510-4bc2-9af3-91beba7ec546","name":"GPT 4.1-mini5","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2320,32],"id":"78fb8f6e-2608-43df-8b87-3397ea02574c","name":"Clean Up"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Input":"={{ $('Input').item.json.input }}","Output":"={{ $('AI Agent').item.json.output }}","Actions":"={{ JSON.stringify($json.steps, null, 2) }}","Tokens":"={{ JSON.stringify($json.tokens, null, 2) }}","Total Tokens":"={{ $json.total_tokens }}"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2544,32],"id":"2c8d439b-8c82-460d-acad-3a76b0a90284","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2880,592],"id":"9c724feb-e7eb-4371-80cf-bc195e75e6f8","name":"Get Ideas","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Idea":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idea', `Idea title`, 'string') }}","Description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `Idea description`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Idea","displayName":"Idea","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2992,592],"id":"222d383f-a604-4b54-85df-6406a16e8461","name":"Add Idea","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"toolDescription":"Use this tool to find high-performing YouTube videos","method":"POST","url":"https://api.apify.com/v2/acts/streamers~youtube-scraper/run-sync-get-dataset-items","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"YOUR APIFY API KEY"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"dateFilter\": \"month\",\n    \"downloadSubtitles\": false,\n    \"hasCC\": false,\n    \"hasLocation\": false,\n    \"hasSubtitles\": false,\n    \"is360\": false,\n    \"is3D\": false,\n    \"is4K\": false,\n    \"isBought\": false,\n    \"isHD\": false,\n    \"isHDR\": false,\n    \"isLive\": false,\n    \"isVR180\": false,\n    \"maxResultStreams\": 0,\n    \"maxResults\": {{$fromAI(\"maxResults\",\"how many videos the user wants, if not specified, default to 3\",\"number\",3)}},\n    \"maxResultsShorts\": 0,\n    \"oldestPostDate\": \"6 months\",\n    \"preferAutoGeneratedSubtitles\": false,\n    \"saveSubsToKVS\": false,\n    \"searchQueries\": [\n        \"{{$fromAI(\"searchTerm\",\"The topic of the video to search for\")}}\"\n    ],\n    \"sortVideosBy\": \"POPULAR\",\n    \"sortingOrder\": \"views\"\n}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2768,592],"id":"6827ca84-0c76-46b1-8044-23aa337d3f47","name":"YouTube Videos"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1296,432],"id":"899053da-8bd6-4d64-9f5e-e0bbf7c4549f","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1424,432],"id":"c1b212d1-89f0-4aa7-bd86-9bd5e6a4518d","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2304,208],"id":"ba0da9a6-6452-4fee-887f-ed0def9c649a","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $('AI Agent').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2800,32],"id":"0b8cda93-ae7c-420e-ad17-38d31aea8932","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1776,192],"id":"c54671da-0519-41f5-8c3a-a5c7ae05eea6","name":"Input"},{"parameters":{"content":"# ⚙️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your n8n AI agent workflow fully configured and connected:\n\n### ✅ Step 1: Connect Your Telegram Account  \nUse the **Telegram Trigger** node to link your Telegram account. This allows you to interact with your agent via Telegram. Make sure it's fully connected—it’s used in both the **Telegram Response** nodes and the **Simple Memory** node.\n\n### ✅ Step 2: Add Your [OpenRouter](https://openrouter.ai/) API Key  \nThis is the \"brain\" of your AI agent. Plug in your API key using the **HTTP Request** or **Credential** node to power intelligent responses.\n\n### ✅ Step 3: Connect Your App Integrations  \nSet up the following API connections so your agent can take meaningful actions:\n- **Gmail**\n- **Google Calendar**\n- **Airtable**\n- **Google Sheets**\n- **Apify** – Used in the YouTube video node.  \n  💡 *Use code* **`30NATEHERK`** *for 30% off your first 3 months at [Apify](https://www.apify.com/?fpr=nate)*\n\n### ✅ Step 4: Connect Research & Utility APIs  \nAdd these keys for more powerful features:\n- [**Tavily API Key**](https://www.tavily.com/)\n- [**Perplexity API Key**](https://www.perplexity.ai/)\n- [**Open Weather Map API Key**](https://openweathermap.org/api)\n\n### ✅ Step 5: Link Your Google Sheets Templates  \n- 📄 [Agent Action Log Sheet](https://docs.google.com/spreadsheets/d/1PlRVi9Iv2n11SPYdshjhPGWccRCpKLHn3PjUkJEjgAQ/edit?usp=sharing) – Logs the agent’s actions.\n- 🎬 [YouTube Ideas Sheet](https://docs.google.com/spreadsheets/d/1Jazczp5HtPwcJvu6bmJQrjkqt31S7adVqIFVCqXZwGk/edit?usp=sharing) – Used for the YouTube agent’s video ideas.\n\n### 🚀 Final Step: Start Prompting  \nWith everything connected, start chatting with your agent on Telegram and watch it take intelligent action across your tool stack!\n","height":912,"width":784},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"cedaa9ac-9b9c-45fa-88ab-61bdf21f5c18","name":"Sticky Note"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,192],"id":"a5e61dfd-2814-4569-9c27-c586225ac448","name":"Authorised?"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1184,432],"id":"03b3d72f-53be-4397-a264-675877e7ff32","name":"GPT 5-mini","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[{"node":"Set 'Text'","type":"main","index":0}]]},"Set 'Text'":{"main":[[{"node":"Input","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Send Email":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Create Draft":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Reply":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Labels":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Label Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Mark Unread":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get Contacts":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Add or Update Contact":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Contact Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Perplexity":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"OpenWeatherMap":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Web Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"YouTube Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"GPT 4.1-mini1":{"ai_languageModel":[[{"node":"Email Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini2":{"ai_languageModel":[[{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini3":{"ai_languageModel":[[{"node":"Contact Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini4":{"ai_languageModel":[[{"node":"Web Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini5":{"ai_languageModel":[[{"node":"YouTube Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Clean Up","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"Response","type":"main","index":0}]]},"Get Ideas":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Add Idea":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"YouTube Videos":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Input":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Authorised?":{"main":[[{"node":"Switch","type":"main","index":0}]]},"GPT 5-mini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"90246b18-f41c-4b30-80b3-940b883e1463","activeVersionId":"90246b18-f41c-4b30-80b3-940b883e1463","triggerCount":1,"shared":[{"updatedAt":"2025-12-09T01:32:09.608Z","createdAt":"2025-12-09T01:32:09.608Z","role":"workflow:owner","workflowId":"QrGT7747m8CMGyS0","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-30T00:08:46.000Z","createdAt":"2025-12-30T00:03:35.456Z","versionId":"90246b18-f41c-4b30-80b3-940b883e1463","workflowId":"QrGT7747m8CMGyS0","nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"id":"3f435554-67d1-4660-8f8b-bd2b1285c2b8","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[816,192],"webhookId":"99eab1a0-569d-4f0f-a49e-578a02abfe63","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"47d36c88-fc9a-4937-9604-a15284848037","name":"Set 'Text'","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,208]},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"0c7d922d-8160-4e65-83c4-ce1101471d17","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1440,32],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"fe01547d-f434-42dd-879a-f3f1a835de80","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1600,32],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"ddc9d3a8-8ed3-4757-9c16-bbb37eae4b59","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1264,192]},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails or creating summaries — your sole responsibility is to call the correct tool.\n\n## Tools\n- **Think**: Use this to think deeply or if you get stuck\n- **emailAgent**: Use this tool to take action in email\n- **calendarAgent**: Use this tool to take action in calendar\n- **contactAgent**: Use this tool to get, update, or add contacts\n- **contentCreator**: Use this tool to create blog posts\n- **webAgent**: Use this tool to perform deeper web research or get current weather info\n- **youtubeAgent**: Use this tool to find high-performing videos or manage video ideas\n\n## Rules\n- Only use the English language, no Maori or Te Reo.\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the necessary tools based on the user's request\n2) Use the **Think** tool to verify you took the right steps. This tool should be called every time.\n\n## Calendar\n- if no attendees are explicitly given there are none.\n- if no location is given then leave this blank.\n- if no time is given on the specific day then ask if it an all-day event and if so then make it an all day event.\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave  \n  - Action: Use **contactAgent** to get Nate Herkelman's email  \n  - Action: Use **emailAgent** to send the email. You will pass the tool a query like:  \n    \"send Nate Herkelman an email to ask what time he wants to leave. here is his email: [email address]\"\n- Output: The email has been sent to Nate Herkelman. Anything else I can help you with?\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1936,192],"id":"26be28b6-cef6-4813-a3b5-39f137d984e4","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"sendTo":"={{ $fromAI(\"emailAddress\") }}","subject":"={{ $fromAI(\"subject\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,752],"id":"b180e27e-d0b8-4a24-a872-22ba1a273bba","name":"Send Email","webhookId":"86c8c4b1-13bb-4ebe-acb9-30e1d7082d55","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":"={{ $fromAI(\"limit\",\"how many emails the user wants\") }}","simple":false,"filters":{"sender":"={{ $fromAI(\"sender\",\"who the emails are from\") }}"},"options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1392,752],"id":"0ea6c4ab-3e0a-4658-a413-d7516146a2c3","name":"Get Emails","webhookId":"af4b3298-9037-44b0-aa12-2acbfbb5e66f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"draft","subject":"={{ $fromAI(\"subject\") }}","emailType":"html","message":"={{ $fromAI(\"emailBody\") }}","options":{"threadId":"={{ $fromAI(\"threadID\") }}","sendTo":"={{ $fromAI(\"emailAddress\") }}"}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,608],"id":"e175eb53-2e4c-41cd-b7ea-b2868cde4cd0","name":"Create Draft","webhookId":"17016bce-d7d7-428a-a56c-f6ea122db8be","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"reply","messageId":"={{ $fromAI(\"ID\",\"the message ID\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,608],"id":"5c89bfb3-8ff2-4da9-94b4-6f45502c4c25","name":"Email Reply","webhookId":"114785e6-a859-432b-81b4-c490c1c35b1c","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"label","returnAll":true},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,752],"id":"4d1338cb-84d1-4f7a-bafb-fb7a108de97a","name":"Get Labels","webhookId":"9e08b59e-792d-4566-83f1-9263c9ad86ae","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $fromAI(\"ID\",\"the ID of the message\") }}","labelIds":"={{ $fromAI(\"labelID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,608],"id":"a7a1419f-07b1-404b-8a69-50c4f2fe4db3","name":"Label Emails","webhookId":"0e951529-2e6d-40bf-ac40-fc0947e242e2","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"markAsUnread","messageId":"={{ $fromAI(\"messageID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,752],"id":"4a1e4cfe-2d8f-493a-b8a9-6a2344781da5","name":"Mark Unread","webhookId":"a35af9d8-f67d-4ff9-803f-59ec6356e795","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"toolDescription":"An email agent for all email actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are an email management assistant. All emails must be formatted professionally in HTML and signed off as \"Chris.\" \n\n**Email Management Tools**   \n   - Use \"Send Email\" to send emails.  \n   - Use \"Create Draft\" if the user asks for a draft.  \n   - Use \"Get Emails\" to retrieve emails when requested.\n   - Use \"Get Labels\" to retrieve labels.\n   - Use \"Mark Unread\" to mark an email as unread. You must use \"Get Emails\" first so you have the message ID of the email to flag.\n   - Use \"Label Email\" to flag an email. You must use \"Get Emails\" first so you have the message ID of the email to flag. Then you must use \"Get Labels\" so you have the label ID.\n   - Use \"Email Reply\" to reply to an email. You must use \"Get Emails\" first so you have the message ID of the email to reply to.\n\n## Final Notes\n- Here is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1584,432],"id":"3b16ee03-a067-4b83-bd93-12d1a9c1eb80","name":"Email Agent"},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":["={{ $fromAI(\"eventAttendeeEmail\") }}"],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,752],"id":"1de69ea0-8dd3-46b4-91c8-d6a3d29afc2e","name":"Create Event with Attendee","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":[],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1920,752],"id":"e0261479-0db1-4ae5-be27-84dbc1f8a051","name":"Create Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"timeMin":"={{ $fromAI(\"dayBefore\",\"the day before the date the user requested\") }}","timeMax":"={{ $fromAI(\"dayAfter\",\"the day after the date the user requested\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,608],"id":"77b984d2-dc86-484d-88d8-5c39ad14b6ad","name":"Get Events","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ $fromAI(\"eventID\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,608],"id":"813d10c0-fa5d-4d1b-b8d0-30d5d526a19f","name":"Delete Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"chris@hallowes.com","mode":"list","cachedResultName":"chris@hallowes.com"},"eventId":"={{ $fromAI(\"eventID\") }}","updateFields":{"end":"={{ $fromAI(\"endTime\") }}","start":"={{ $fromAI(\"startTime\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,752],"id":"e2a646fe-2582-4f4f-b442-15a98a33f964","name":"Update Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"toolDescription":"A calendar agent for all calendar actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include creating, getting, and deleting events in the user's calendar.\n\n**Calendar Management Tools**  \n   - Use \"Create Event with Attendee\" when an event includes a participant.  \n   - Use \"Create Event\" for solo events.   \n   - Use \"Get Events\" to fetch calendar schedules when requested.\n   - Use \"Delete Event\" to delete an event. You must use \"Get Events\" first to get the ID of the event to delete.\n   - Use \"Update Event\" to update an event. You must use \"Get Events\" first to get the ID of the event to update.\n\n## Final Notes\nHere is the current date/time: {{ $now }}\nIf a duration for an event isn't specified, assume it will be one hour.\nAlways use the current timezone for New Zealand"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1936,432],"id":"d1bf13a9-ea10-43a6-b727-73ece72e2dfb","name":"Calendar Agent"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2416,592],"id":"ec1236f6-529d-4079-98a9-6666a217aade","name":"Get Contacts","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"upsert","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"columns":{"mappingMode":"defineBelow","value":{"Business":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Business', ``, 'boolean') }}","id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}","Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","Company Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company_Name', ``, 'string') }}","Phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}","Notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notes', ``, 'string') }}","Status":"Active"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Phone","displayName":"Phone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Inactive","value":"Inactive"},{"name":"Active","value":"Active"}],"readOnly":false,"removed":false},{"id":"Business","displayName":"Business","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"boolean","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2528,592],"id":"502df55d-19ba-4554-9a40-afa3d84e9c67","name":"Add or Update Contact","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"toolDescription":"Contact agent for all contact actions, like getting contacts","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a contact management assistant. Your responsibilities include looking up contacts, adding new contacts, or updating a contact's information.\n\n**Contact Management**  \n   - Use \"Get Contacts\" to retrieve contact information. \n   - Use \"Add or Update Contact\" to store new contact information or modify existing entries. \n\n** If I say send me an email or send an email to me then the proper contact is Chris Hallowes and the email is chris@hallowes.com"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2288,432],"id":"61719bce-dd06-41c0-aa21-b5f495cac8ed","name":"Contact Agent"},{"parameters":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[2464,944],"id":"7cf33b41-3aaa-4696-bf40-40d67b5cdb36","name":"Tavily","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"messages":{"message":[{"content":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"}]},"options":{},"requestOptions":{}},"type":"n8n-nodes-base.perplexityTool","typeVersion":1,"position":[2592,944],"id":"1b7749b7-6f90-43bb-9180-505450ccbf58","name":"Perplexity","credentials":{"perplexityApi":{"id":"Mr9UdvJJS7sjNHOf","name":"Perplexity account"}}},{"parameters":{"format":"imperial","cityName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}","language":"en"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[2736,928],"id":"d67ec1e0-eafd-4524-a638-b7e8cfb19a2b","name":"OpenWeatherMap","disabled":true},{"parameters":{"toolDescription":"A research agent for all research actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a web research assistant. Your responsibilities include conducting quick web searches, performing deeper research, and retrieving current weather information. \n\n**Web Search & Research**  \n   - Use **Tavily** for quick factual lookups, recent news, or verifying specific pieces of information.  \n   - Use **Perplexity** when a question requires deeper research, multiple perspectives, or synthesized answers from various sources.  \n\n**Weather Information**  \n   - Use **Open Weather Map** to retrieve current weather data, including temperature, conditions, and forecasts for a given location.\n\nAlways explain your reasoning briefly when choosing between Tavily and Perplexity. Prioritize clarity, credibility, and helpfulness in your responses.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2400,752],"id":"a6b5d415-78b4-4188-ab06-3ad3668b3f34","name":"Web Agent"},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a YouTube content assistant. Your responsibilities include researching high-performing YouTube videos, retrieving existing video ideas, and adding new content ideas to the video database. Your goal is to support content strategy and ideation with relevant, high-quality inputs.\n\n**Video Idea Management**  \n   - Use **Get Ideas** to retrieve existing YouTube video ideas from the internal database.  \n   - Use **Add Idea** to contribute new video ideas to the database for future content planning.\n\n**Content Research**  \n   - Use **YouTube Videos** to search for high-performing videos on a given topic. Analyze trends, titles, formats, and engagement to inspire new content strategies.\n\nWhen suggesting or adding an idea, be specific, creative, and align your suggestions with proven YouTube best practices.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2656,432],"id":"263c4923-b226-4929-bd76-4d3c90e86959","name":"YouTube Agent","disabled":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1392,608],"id":"4664de75-8b96-456e-8305-a249c12723a2","name":"GPT 4.1-mini1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1920,608],"id":"6c5660b1-9357-4e7c-82de-114f85385fed","name":"GPT 4.1-mini2","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2288,592],"id":"6c006b2f-bec5-48cb-8ed7-0626357f2ae3","name":"GPT 4.1-mini3","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2304,928],"id":"d4d56309-befc-4bcc-ad3b-ec13d0e462ea","name":"GPT 4.1-mini4","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2656,592],"id":"25d210c1-9510-4bc2-9af3-91beba7ec546","name":"GPT 4.1-mini5","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2320,32],"id":"78fb8f6e-2608-43df-8b87-3397ea02574c","name":"Clean Up"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Input":"={{ $('Input').item.json.input }}","Output":"={{ $('AI Agent').item.json.output }}","Actions":"={{ JSON.stringify($json.steps, null, 2) }}","Tokens":"={{ JSON.stringify($json.tokens, null, 2) }}","Total Tokens":"={{ $json.total_tokens }}"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2544,32],"id":"2c8d439b-8c82-460d-acad-3a76b0a90284","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2880,592],"id":"9c724feb-e7eb-4371-80cf-bc195e75e6f8","name":"Get Ideas","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Idea":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idea', `Idea title`, 'string') }}","Description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `Idea description`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Idea","displayName":"Idea","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2992,592],"id":"222d383f-a604-4b54-85df-6406a16e8461","name":"Add Idea","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"toolDescription":"Use this tool to find high-performing YouTube videos","method":"POST","url":"https://api.apify.com/v2/acts/streamers~youtube-scraper/run-sync-get-dataset-items","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"YOUR APIFY API KEY"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"dateFilter\": \"month\",\n    \"downloadSubtitles\": false,\n    \"hasCC\": false,\n    \"hasLocation\": false,\n    \"hasSubtitles\": false,\n    \"is360\": false,\n    \"is3D\": false,\n    \"is4K\": false,\n    \"isBought\": false,\n    \"isHD\": false,\n    \"isHDR\": false,\n    \"isLive\": false,\n    \"isVR180\": false,\n    \"maxResultStreams\": 0,\n    \"maxResults\": {{$fromAI(\"maxResults\",\"how many videos the user wants, if not specified, default to 3\",\"number\",3)}},\n    \"maxResultsShorts\": 0,\n    \"oldestPostDate\": \"6 months\",\n    \"preferAutoGeneratedSubtitles\": false,\n    \"saveSubsToKVS\": false,\n    \"searchQueries\": [\n        \"{{$fromAI(\"searchTerm\",\"The topic of the video to search for\")}}\"\n    ],\n    \"sortVideosBy\": \"POPULAR\",\n    \"sortingOrder\": \"views\"\n}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2768,592],"id":"6827ca84-0c76-46b1-8044-23aa337d3f47","name":"YouTube Videos"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1296,432],"id":"899053da-8bd6-4d64-9f5e-e0bbf7c4549f","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1424,432],"id":"c1b212d1-89f0-4aa7-bd86-9bd5e6a4518d","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2304,208],"id":"ba0da9a6-6452-4fee-887f-ed0def9c649a","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $('AI Agent').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2800,32],"id":"0b8cda93-ae7c-420e-ad17-38d31aea8932","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1776,192],"id":"c54671da-0519-41f5-8c3a-a5c7ae05eea6","name":"Input"},{"parameters":{"content":"# ⚙️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your n8n AI agent workflow fully configured and connected:\n\n### ✅ Step 1: Connect Your Telegram Account  \nUse the **Telegram Trigger** node to link your Telegram account. This allows you to interact with your agent via Telegram. Make sure it's fully connected—it’s used in both the **Telegram Response** nodes and the **Simple Memory** node.\n\n### ✅ Step 2: Add Your [OpenRouter](https://openrouter.ai/) API Key  \nThis is the \"brain\" of your AI agent. Plug in your API key using the **HTTP Request** or **Credential** node to power intelligent responses.\n\n### ✅ Step 3: Connect Your App Integrations  \nSet up the following API connections so your agent can take meaningful actions:\n- **Gmail**\n- **Google Calendar**\n- **Airtable**\n- **Google Sheets**\n- **Apify** – Used in the YouTube video node.  \n  💡 *Use code* **`30NATEHERK`** *for 30% off your first 3 months at [Apify](https://www.apify.com/?fpr=nate)*\n\n### ✅ Step 4: Connect Research & Utility APIs  \nAdd these keys for more powerful features:\n- [**Tavily API Key**](https://www.tavily.com/)\n- [**Perplexity API Key**](https://www.perplexity.ai/)\n- [**Open Weather Map API Key**](https://openweathermap.org/api)\n\n### ✅ Step 5: Link Your Google Sheets Templates  \n- 📄 [Agent Action Log Sheet](https://docs.google.com/spreadsheets/d/1PlRVi9Iv2n11SPYdshjhPGWccRCpKLHn3PjUkJEjgAQ/edit?usp=sharing) – Logs the agent’s actions.\n- 🎬 [YouTube Ideas Sheet](https://docs.google.com/spreadsheets/d/1Jazczp5HtPwcJvu6bmJQrjkqt31S7adVqIFVCqXZwGk/edit?usp=sharing) – Used for the YouTube agent’s video ideas.\n\n### 🚀 Final Step: Start Prompting  \nWith everything connected, start chatting with your agent on Telegram and watch it take intelligent action across your tool stack!\n","height":912,"width":784},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"cedaa9ac-9b9c-45fa-88ab-61bdf21f5c18","name":"Sticky Note"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,192],"id":"a5e61dfd-2814-4569-9c27-c586225ac448","name":"Authorised?"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1184,432],"id":"03b3d72f-53be-4397-a264-675877e7ff32","name":"GPT 5-mini","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[{"node":"Set 'Text'","type":"main","index":0}]]},"Set 'Text'":{"main":[[{"node":"Input","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Send Email":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Create Draft":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Reply":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Labels":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Label Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Mark Unread":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get Contacts":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Add or Update Contact":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Contact Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Perplexity":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"OpenWeatherMap":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Web Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"YouTube Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"GPT 4.1-mini1":{"ai_languageModel":[[{"node":"Email Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini2":{"ai_languageModel":[[{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini3":{"ai_languageModel":[[{"node":"Contact Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini4":{"ai_languageModel":[[{"node":"Web Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini5":{"ai_languageModel":[[{"node":"YouTube Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Clean Up","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"Response","type":"main","index":0}]]},"Get Ideas":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Add Idea":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"YouTube Videos":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Input":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Authorised?":{"main":[[{"node":"Switch","type":"main","index":0}]]},"GPT 5-mini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"authors":"Chris Hallowes","name":"Version 90246b18","description":"","autosaved":false},"tags":[]},{"updatedAt":"2025-11-29T04:36:20.000Z","createdAt":"2025-11-29T04:09:03.314Z","id":"RnzgrhIFrTyT1uxt","name":"My workflow","active":false,"isArchived":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-512,-64],"id":"79c325d9-6a36-4ba0-94b2-89ff2b27da62","name":"When clicking ‘Execute workflow’"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"hello from hostinger","message":"this is send from my hostinger hosted n8n","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-304,-64],"id":"b60758f8-a95b-4705-b76b-ecdcd65de049","name":"Send a message","webhookId":"3152974c-2b50-4ac3-bd0e-1972aeba820f","credentials":{"gmailOAuth2":{"id":"Q35nwxktKEdMjMpt","name":"Gmail account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"39eb5c74-78c5-4033-8e59-41eae1d62af2","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T04:09:03.317Z","createdAt":"2025-11-29T04:09:03.317Z","role":"workflow:owner","workflowId":"RnzgrhIFrTyT1uxt","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-02T00:49:30.000Z","createdAt":"2025-11-29T02:52:21.356Z","id":"RrfEuTtHQUyWsxup","name":"Agent Swarm","active":false,"isArchived":true,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"id":"4e091368-f2b4-4939-b273-ffc715c7b16d","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[816,192],"webhookId":"99eab1a0-569d-4f0f-a49e-578a02abfe63","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"03d1710e-c069-4da1-9f71-3b5bb06dc95f","name":"Set 'Text'","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,208]},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"d5b77ea0-0b13-4f06-a0ab-9cf6fc82e857","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1440,32],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"d617222f-7915-46f7-a0c9-1019691c3b7e","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1600,32]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"0a59d013-2b59-4284-a140-b3d27fc7e67e","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1264,192]},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails or creating summaries — your sole responsibility is to call the correct tool.\n\n## Tools\n- **Think**: Use this to think deeply or if you get stuck\n- **emailAgent**: Use this tool to take action in email\n- **calendarAgent**: Use this tool to take action in calendar\n- **contactAgent**: Use this tool to get, update, or add contacts\n- **contentCreator**: Use this tool to create blog posts\n- **webAgent**: Use this tool to perform deeper web research or get current weather info\n- **youtubeAgent**: Use this tool to find high-performing videos or manage video ideas\n\n## Rules\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the necessary tools based on the user's request\n2) Use the **Think** tool to verify you took the right steps. This tool should be called every time.\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave  \n  - Action: Use **contactAgent** to get Nate Herkelman's email  \n  - Action: Use **emailAgent** to send the email. You will pass the tool a query like:  \n    \"send Nate Herkelman an email to ask what time he wants to leave. here is his email: [email address]\"\n- Output: The email has been sent to Nate Herkelman. Anything else I can help you with?\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1936,192],"id":"f3c1bf9e-d8eb-465b-91f2-64e0ea28cb1d","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"sendTo":"={{ $fromAI(\"emailAddress\") }}","subject":"={{ $fromAI(\"subject\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,752],"id":"171546bc-6015-4de5-ad6d-016b530d5194","name":"Send Email","webhookId":"86c8c4b1-13bb-4ebe-acb9-30e1d7082d55"},{"parameters":{"operation":"getAll","limit":"={{ $fromAI(\"limit\",\"how many emails the user wants\") }}","simple":false,"filters":{"sender":"={{ $fromAI(\"sender\",\"who the emails are from\") }}"},"options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1392,752],"id":"31c1ab7a-3ced-44f1-abda-8e762986f227","name":"Get Emails","webhookId":"af4b3298-9037-44b0-aa12-2acbfbb5e66f"},{"parameters":{"resource":"draft","subject":"={{ $fromAI(\"subject\") }}","emailType":"html","message":"={{ $fromAI(\"emailBody\") }}","options":{"threadId":"={{ $fromAI(\"threadID\") }}","sendTo":"={{ $fromAI(\"emailAddress\") }}"}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,608],"id":"ba434dc3-65a2-47aa-8b7e-646a22b06e24","name":"Create Draft","webhookId":"17016bce-d7d7-428a-a56c-f6ea122db8be"},{"parameters":{"operation":"reply","messageId":"={{ $fromAI(\"ID\",\"the message ID\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,608],"id":"93e58b0e-3105-491a-9eff-c83c4352c231","name":"Email Reply","webhookId":"114785e6-a859-432b-81b4-c490c1c35b1c"},{"parameters":{"resource":"label","returnAll":true},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,752],"id":"fbb0fafb-a953-47eb-81c6-cc32796c9c57","name":"Get Labels","webhookId":"9e08b59e-792d-4566-83f1-9263c9ad86ae"},{"parameters":{"operation":"addLabels","messageId":"={{ $fromAI(\"ID\",\"the ID of the message\") }}","labelIds":"={{ $fromAI(\"labelID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,608],"id":"aefb0364-bac8-40c5-9ef0-8aa36863d7c1","name":"Label Emails","webhookId":"0e951529-2e6d-40bf-ac40-fc0947e242e2"},{"parameters":{"operation":"markAsUnread","messageId":"={{ $fromAI(\"messageID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,752],"id":"74eb3440-8176-40a8-8777-49cecd814a47","name":"Mark Unread","webhookId":"a35af9d8-f67d-4ff9-803f-59ec6356e795"},{"parameters":{"toolDescription":"An email agent for all email actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are an email management assistant. All emails must be formatted professionally in HTML and signed off as \"Nate.\" \n\n**Email Management Tools**   \n   - Use \"Send Email\" to send emails.  \n   - Use \"Create Draft\" if the user asks for a draft.  \n   - Use \"Get Emails\" to retrieve emails when requested.\n   - Use \"Get Labels\" to retrieve labels.\n   - Use \"Mark Unread\" to mark an email as unread. You must use \"Get Emails\" first so you have the message ID of the email to flag.\n   - Use \"Label Email\" to flag an email. You must use \"Get Emails\" first so you have the message ID of the email to flag. Then you must use \"Get Labels\" so you have the label ID.\n   - Use \"Email Reply\" to reply to an email. You must use \"Get Emails\" first so you have the message ID of the email to reply to.\n\n## Final Notes\n- Here is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1584,432],"id":"4f731fee-4811-4672-a26b-1456b293bd15","name":"Email Agent"},{"parameters":{"calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":["={{ $fromAI(\"eventAttendeeEmail\") }}"],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,752],"id":"d6fe97eb-a5ef-4c01-82df-c28c7beba919","name":"Create Event with Attendee"},{"parameters":{"calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":[],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1920,752],"id":"946ae3d5-1851-4004-85a6-b5f38e30bbdb","name":"Create Event"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"timeMin":"={{ $fromAI(\"dayBefore\",\"the day before the date the user requested\") }}","timeMax":"={{ $fromAI(\"dayAfter\",\"the day after the date the user requested\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,608],"id":"357fa1d1-0191-4b5a-a8bf-23f82d9de712","name":"Get Events"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"eventId":"={{ $fromAI(\"eventID\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,608],"id":"d33efe69-572f-4953-bbc9-82d5e563b5c1","name":"Delete Event"},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"eventId":"={{ $fromAI(\"eventID\") }}","updateFields":{"end":"={{ $fromAI(\"endTime\") }}","start":"={{ $fromAI(\"startTime\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,752],"id":"1e191c2f-cece-44ec-a458-880e58deeaf0","name":"Update Event","disabled":true},{"parameters":{"toolDescription":"A calendar agent for all calendar actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include creating, getting, and deleting events in the user's calendar.\n\n**Calendar Management Tools**  \n   - Use \"Create Event with Attendee\" when an event includes a participant.  \n   - Use \"Create Event\" for solo events.   \n   - Use \"Get Events\" to fetch calendar schedules when requested.\n   - Use \"Delete Event\" to delete an event. You must use \"Get Events\" first to get the ID of the event to delete.\n   - Use \"Update Event\" to update an event. You must use \"Get Events\" first to get the ID of the event to update.\n\n## Final Notes\nHere is the current date/time: {{ $now }}\nIf a duration for an event isn't specified, assume it will be one hour."}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1936,432],"id":"0830f526-e4f8-4c20-aa48-65277360c6cf","name":"Calendar Agent"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2416,592],"id":"ca08be0d-47dd-4c47-821b-cb283e8fc84d","name":"Get Contacts"},{"parameters":{"operation":"upsert","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"columns":{"mappingMode":"defineBelow","value":{"Business":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Business', ``, 'boolean') }}","id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}","Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","Company Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company_Name', ``, 'string') }}","Phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}","Notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notes', ``, 'string') }}","Status":"Active"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Phone","displayName":"Phone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Inactive","value":"Inactive"},{"name":"Active","value":"Active"}],"readOnly":false,"removed":false},{"id":"Business","displayName":"Business","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"boolean","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2528,592],"id":"8a3a25f0-0047-4730-b4d1-25ac96233a4f","name":"Add or Update Contact"},{"parameters":{"toolDescription":"Contact agent for all contact actions, like getting contacts","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a contact management assistant. Your responsibilities include looking up contacts, adding new contacts, or updating a contact's information.\n\n**Contact Management**  \n   - Use \"Get Contacts\" to retrieve contact information. \n   - Use \"Add or Update Contact\" to store new contact information or modify existing entries. "}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2288,432],"id":"daecfcb6-8eb6-44ba-a33a-1e5be9f169a2","name":"Contact Agent"},{"parameters":{"options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[2464,944],"id":"6abc5b22-82de-465e-b6ca-a32301552b21","name":"Tavily"},{"parameters":{"messages":{"message":[{"content":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"}]},"options":{},"requestOptions":{}},"type":"n8n-nodes-base.perplexityTool","typeVersion":1,"position":[2592,944],"id":"55f9ebf2-9e07-4feb-a387-ed903368ff22","name":"Perplexity"},{"parameters":{"format":"imperial","cityName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}","language":"en"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[2736,928],"id":"69fcb8bf-bbb5-462f-9291-b713e4f361fd","name":"OpenWeatherMap","disabled":true},{"parameters":{"toolDescription":"A research agent for all research actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a web research assistant. Your responsibilities include conducting quick web searches, performing deeper research, and retrieving current weather information. \n\n**Web Search & Research**  \n   - Use **Tavily** for quick factual lookups, recent news, or verifying specific pieces of information.  \n   - Use **Perplexity** when a question requires deeper research, multiple perspectives, or synthesized answers from various sources.  \n\n**Weather Information**  \n   - Use **Open Weather Map** to retrieve current weather data, including temperature, conditions, and forecasts for a given location.\n\nAlways explain your reasoning briefly when choosing between Tavily and Perplexity. Prioritize clarity, credibility, and helpfulness in your responses.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2400,752],"id":"5ad2e281-924c-47dd-9115-fc57a05c69be","name":"Web Agent"},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a YouTube content assistant. Your responsibilities include researching high-performing YouTube videos, retrieving existing video ideas, and adding new content ideas to the video database. Your goal is to support content strategy and ideation with relevant, high-quality inputs.\n\n**Video Idea Management**  \n   - Use **Get Ideas** to retrieve existing YouTube video ideas from the internal database.  \n   - Use **Add Idea** to contribute new video ideas to the database for future content planning.\n\n**Content Research**  \n   - Use **YouTube Videos** to search for high-performing videos on a given topic. Analyze trends, titles, formats, and engagement to inspire new content strategies.\n\nWhen suggesting or adding an idea, be specific, creative, and align your suggestions with proven YouTube best practices.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2656,432],"id":"67104c45-dcc8-4c6b-975c-6b90e7aa59c8","name":"YouTube Agent","disabled":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1184,432],"id":"002c12ba-d2d2-48a0-a3dd-29caeeda6370","name":"GPT 4.1-mini"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1392,608],"id":"fc70ed24-f764-4f02-909d-ac43232d1775","name":"GPT 4.1-mini1"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1920,608],"id":"7d0d7908-8295-4af9-bf7c-f103b023f45d","name":"GPT 4.1-mini2"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2288,592],"id":"013f5163-5627-4377-943e-5df61c296b43","name":"GPT 4.1-mini3"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2304,928],"id":"693725ca-d6c7-4dc6-8b58-f7c09c8c0b2e","name":"GPT 4.1-mini4"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2656,592],"id":"9eda6f58-c8c2-46bc-8206-ef3030c5b463","name":"GPT 4.1-mini5"},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2320,32],"id":"69bcca80-b178-468b-9264-f1e8d0d61973","name":"Clean Up"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Input":"={{ $('Input').item.json.input }}","Output":"={{ $('AI Agent').item.json.output }}","Actions":"={{ JSON.stringify($json.steps, null, 2) }}","Tokens":"={{ JSON.stringify($json.tokens, null, 2) }}","Total Tokens":"={{ $json.total_tokens }}"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2544,32],"id":"7ec4cd99-11a2-4ccb-8a7a-f68e723e5ac6","name":"Append row in sheet"},{"parameters":{"documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2880,592],"id":"660ea1ed-84c7-4f56-b81d-7ce46538c214","name":"Get Ideas"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Idea":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idea', `Idea title`, 'string') }}","Description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `Idea description`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Idea","displayName":"Idea","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2992,592],"id":"3f20ea1e-7189-4d45-abf0-169ba64132e9","name":"Add Idea"},{"parameters":{"toolDescription":"Use this tool to find high-performing YouTube videos","method":"POST","url":"https://api.apify.com/v2/acts/streamers~youtube-scraper/run-sync-get-dataset-items","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"YOUR APIFY API KEY"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"dateFilter\": \"month\",\n    \"downloadSubtitles\": false,\n    \"hasCC\": false,\n    \"hasLocation\": false,\n    \"hasSubtitles\": false,\n    \"is360\": false,\n    \"is3D\": false,\n    \"is4K\": false,\n    \"isBought\": false,\n    \"isHD\": false,\n    \"isHDR\": false,\n    \"isLive\": false,\n    \"isVR180\": false,\n    \"maxResultStreams\": 0,\n    \"maxResults\": {{$fromAI(\"maxResults\",\"how many videos the user wants, if not specified, default to 3\",\"number\",3)}},\n    \"maxResultsShorts\": 0,\n    \"oldestPostDate\": \"6 months\",\n    \"preferAutoGeneratedSubtitles\": false,\n    \"saveSubsToKVS\": false,\n    \"searchQueries\": [\n        \"{{$fromAI(\"searchTerm\",\"The topic of the video to search for\")}}\"\n    ],\n    \"sortVideosBy\": \"POPULAR\",\n    \"sortingOrder\": \"views\"\n}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2768,592],"id":"551ca21f-a6db-4d50-aacb-1df8e4667da7","name":"YouTube Videos"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1296,432],"id":"c15f53c7-bdeb-4c1a-bacb-f8973ee41eb8","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1424,432],"id":"941c1b3b-4719-4d0b-9ece-a192806f5404","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2304,208],"id":"df692ea3-7d77-4d7e-a3a0-25f78da286f6","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $('AI Agent').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2800,32],"id":"ae679e2a-d975-4f28-a914-ba2887c04838","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1776,192],"id":"4ddfb29e-1ff8-4224-97f2-6518012d1474","name":"Input"},{"parameters":{"content":"# ⚙️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your n8n AI agent workflow fully configured and connected:\n\n### ✅ Step 1: Connect Your Telegram Account  \nUse the **Telegram Trigger** node to link your Telegram account. This allows you to interact with your agent via Telegram. Make sure it's fully connected—it’s used in both the **Telegram Response** nodes and the **Simple Memory** node.\n\n### ✅ Step 2: Add Your [OpenRouter](https://openrouter.ai/) API Key  \nThis is the \"brain\" of your AI agent. Plug in your API key using the **HTTP Request** or **Credential** node to power intelligent responses.\n\n### ✅ Step 3: Connect Your App Integrations  \nSet up the following API connections so your agent can take meaningful actions:\n- **Gmail**\n- **Google Calendar**\n- **Airtable**\n- **Google Sheets**\n- **Apify** – Used in the YouTube video node.  \n  💡 *Use code* **`30NATEHERK`** *for 30% off your first 3 months at [Apify](https://www.apify.com/?fpr=nate)*\n\n### ✅ Step 4: Connect Research & Utility APIs  \nAdd these keys for more powerful features:\n- [**Tavily API Key**](https://www.tavily.com/)\n- [**Perplexity API Key**](https://www.perplexity.ai/)\n- [**Open Weather Map API Key**](https://openweathermap.org/api)\n\n### ✅ Step 5: Link Your Google Sheets Templates  \n- 📄 [Agent Action Log Sheet](https://docs.google.com/spreadsheets/d/1PlRVi9Iv2n11SPYdshjhPGWccRCpKLHn3PjUkJEjgAQ/edit?usp=sharing) – Logs the agent’s actions.\n- 🎬 [YouTube Ideas Sheet](https://docs.google.com/spreadsheets/d/1Jazczp5HtPwcJvu6bmJQrjkqt31S7adVqIFVCqXZwGk/edit?usp=sharing) – Used for the YouTube agent’s video ideas.\n\n### 🚀 Final Step: Start Prompting  \nWith everything connected, start chatting with your agent on Telegram and watch it take intelligent action across your tool stack!\n","height":912,"width":784},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"0f2bbcd7-adbf-4404-b08c-ad933c711d0d","name":"Sticky Note"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,192],"id":"fce882a4-4c22-4fd2-b6e2-b773a42509f9","name":"Authorised?"}],"connections":{"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[{"node":"Set 'Text'","type":"main","index":0}]]},"Set 'Text'":{"main":[[{"node":"Input","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Send Email":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Create Draft":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Reply":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Labels":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Label Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Mark Unread":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Agent":{"ai_tool":[[]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"ai_tool":[[]]},"Get Contacts":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Add or Update Contact":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Contact Agent":{"ai_tool":[[]]},"Tavily":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Perplexity":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"OpenWeatherMap":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Web Agent":{"ai_tool":[[]]},"GPT 4.1-mini1":{"ai_languageModel":[[{"node":"Email Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini2":{"ai_languageModel":[[{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini3":{"ai_languageModel":[[{"node":"Contact Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini4":{"ai_languageModel":[[{"node":"Web Agent","type":"ai_languageModel","index":0}]]},"GPT 4.1-mini5":{"ai_languageModel":[[{"node":"YouTube Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Clean Up","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"Response","type":"main","index":0}]]},"Get Ideas":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Add Idea":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"YouTube Videos":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Authorised?":{"main":[[{"node":"Switch","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"5787f4f9-40d1-4171-8647-222c05ed04fb","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:52:21.358Z","createdAt":"2025-11-29T02:52:21.358Z","role":"workflow:owner","workflowId":"RrfEuTtHQUyWsxup","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:41:49.000Z","createdAt":"2025-11-29T03:01:09.291Z","id":"U5aq4dt1rtiVP1lr","name":"Daily Market Update Emailer to Girls","active":true,"isArchived":false,"nodes":[{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-848,320],"id":"87baca45-d2d1-491e-9727-e0fcced6b1f3","name":"Gmail1","webhookId":"48ed5f3e-3a60-4b66-80b9-aa2b0efa9e38","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":1,"filters":{"q":"=from:support@tradingmastery.com.au subject:\"Market Update\" OR subject:\"Chew The Fat\" -label:\"Investing/Market Update\" -label:\"Investing/Chew The Fat\""}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-1056,320],"id":"971659f9-99c0-430c-aaec-3410d8f97117","name":"Gmail","webhookId":"bdf9d87a-88fc-46c5-9c18-68287d94ec68","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"Get Trading Mastery Daily update emails, extract the content","height":340,"width":480},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1168,224],"id":"4b34e2a8-bfea-49f4-aa1a-e251cd1dd6fc","name":"Sticky Note"},{"parameters":{"operation":"createFromText","content":"={{ $json.output.report }}","name":"={{ $json.filename }}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1K5QLZXGqNXB-76uMlmqysjHggBT3mo-e","mode":"list","cachedResultName":"Daily Market Updates","cachedResultUrl":"https://drive.google.com/drive/folders/1K5QLZXGqNXB-76uMlmqysjHggBT3mo-e"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[608,320],"id":"9f7a8cff-3bb2-432a-b149-3a574b67bc79","name":"Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"content":"Summarise the daily update","height":340,"width":380,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-160,224],"id":"f07a94ca-4df9-4b42-b784-9204bb57245c","name":"Sticky Note1"},{"parameters":{"content":"Write the Daily Update to a file on Google Drive and Label the email message so it is not reprocessed","height":340,"width":520,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[528,224],"id":"04ed54eb-a3c4-4aba-967e-ee9e271fe89b","name":"Sticky Note2"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail1').item.json.id }}","labelIds":["Label_1644838814920549387"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[848,320],"id":"621d8f03-1369-4a6b-b747-4556610b6988","name":"Add Label","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"promptType":"define","text":"=You are a helpful assistant who reviews email content and summarizes it into an easy-to-read HTML report.\n\n\n\n\n### Rules:\n- Format the report in **HTML** for clarity.\n- Only include in `\"companies\"` the names of companies that have statistics like **CAGR** and **ROIC** mentioned.\n- Company names must be separated by underscores. Example: `NVIDIA_AMD_Intel`.\n- Do **not** include extra characters, quotes, or line breaks outside the JSON.\n\n---\n\n### Here is the email content to process:\n{{ $('Gmail1').item.json.text }}\n\nReturn **only the JSON object** above and nothing else.\n\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-96,336],"id":"d59e00ac-fdd5-4788-8baa-ba5eae656708","name":"AI Agent"},{"parameters":{"content":"Reame the file to include the company highlighted","height":340,"width":300,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[224,224],"id":"e6e373f6-928c-41b1-b3ec-46d8c90cc4d3","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"6b0aaae8-0669-40ed-b7e5-203dd4d7b3c8","name":"subject","value":"={{ $('Gmail1').item.json.subject }}","type":"string"},{"id":"c9f48c32-8b23-40ca-a3ce-3ef0d423a585","name":"date","value":"={{ $('Gmail1').item.json.date }}","type":"string"},{"id":"1b483daf-b394-4c55-b830-21a8db2c848e","name":"output.company","value":"={{ $json.output.companies }}","type":"string"},{"id":"b25d3e70-a197-4420-9ee9-567526ad0723","name":"output.report","value":"={{ $json.output.report }}","type":"string"},{"id":"10325cfc-e118-45b2-9330-7d004303397b","name":"filename","value":"={{ \n  $('Gmail1').item.json.date.split('T')[0].replace(/-/g, '') + \n  '-' + \n  $('Gmail1').item.json.subject.replace(/[^\\w\\s]/g, '').replace(/\\s+/g, '_') + \n  '-' + \n  $json.output.companies + \n  '.html' \n}}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[304,336],"id":"ec93b77a-fa93-4747-9ad3-b2ce4a225e4a","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d497c6e1-7f68-435e-87a4-cc4cc05c50e5","leftValue":"={{ $json.marketUpdate }}","rightValue":"true","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-448,320],"id":"d0696f69-6762-46f0-a894-f1364fbdab94","name":"If a Market Update"},{"parameters":{"content":"Is it a Market Update or Chew the Fat","height":340,"width":520,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-688,224],"id":"1f91cc63-885f-442f-83c6-f4c809d0ef6e","name":"Sticky Note4"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail1').item.json.id }}","labelIds":["Label_5275052143762909707"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[0,0],"id":"299caa4a-41b0-4582-bdf2-f5c6f99160f5","name":"Label Chew The Fat","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1264,880],"id":"8783a54e-df7c-4309-aae6-852175767296","name":"When clicking ‘Execute workflow’"},{"parameters":{"jsonSchemaExample":"{\n\"report\": \"YOUR_HTML_FORMATTED_REPORT_HERE\",\n\"companies\": \"Company1_Company2_Company3\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[80,560],"id":"7ea012a4-4265-4366-8b67-872a7f8964dc","name":"Structured Output Parser"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Flag as market update if subject includes 'chew the fat'\nconst subject = $json.subject?.toLowerCase() || \"\";\n\nif (subject.includes(\"chew the fat\")) {\n  return { json: { ...$json, marketUpdate: false } };\n} else {\n  return { json: { ...$json, marketUpdate: true } };\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-640,320],"id":"53bf067f-8c7c-4530-88ad-429f35d33a6c","name":"Code"},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_6462038100696441708"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-544,880],"id":"74263d36-ddbd-4244-9c68-b409372e6583","name":"Add Label1","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-784,880],"id":"0afa09d1-3ad2-43d4-a26b-afb8db4a22c6","name":"WealthGen Emails","webhookId":"48ed5f3e-3a60-4b66-80b9-aa2b0efa9e38","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":20,"filters":{"q":"=from:info@wealthgeninvestor.com -label:\"Investing/Wealthgen\""}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-1024,880],"id":"b8d2e379-90e7-4347-ad7b-11cddcd4a1ce","name":"Get Wealthgen Emails","webhookId":"bdf9d87a-88fc-46c5-9c18-68287d94ec68","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"Label the Wealthgen emails and take them out of INBOX","height":240,"width":1080},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1136,800],"id":"b62694d6-cc8b-49b9-a00c-e172ebc4e169","name":"Sticky Note5"},{"parameters":{"rule":{"interval":[{"triggerAtHour":14}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1280,320],"id":"cbf74e5a-f687-4ac0-b58a-c6bebcf24a96","name":"2PM Daily"},{"parameters":{"model":{"__rl":true,"value":"gpt-5-nano","mode":"list","cachedResultName":"gpt-5-nano"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-128,512],"id":"20b54b6e-64ed-438a-8a84-774d652c8a32","name":"gpt 5-nano","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"sendTo":"monique@hallowes.com, j.hallowes@hotmail.com","subject":"={{ $json.subject }} - from Chris","message":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-256,336],"id":"1989f499-6f0f-4b34-855c-c613fe58a492","name":"Fwd to Girls","webhookId":"ef04e76e-bd15-4ebe-8db0-da8fa8747352","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"removeLabels","messageId":"={{ $json.id }}","labelIds":["INBOX"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,880],"id":"71047006-17ea-419d-ad34-911a797c1ba5","name":"Remove from Inbox","webhookId":"2629f213-0588-407a-a572-9133cd0ed0e8","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Gmail1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Gmail":{"main":[[{"node":"Gmail1","type":"main","index":0}]]},"Google Drive":{"main":[[{"node":"Add Label","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"If a Market Update":{"main":[[{"node":"Label Chew The Fat","type":"main","index":0}],[{"node":"Fwd to Girls","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"Get Wealthgen Emails","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"Code":{"main":[[{"node":"If a Market Update","type":"main","index":0}]]},"WealthGen Emails":{"main":[[{"node":"Add Label1","type":"main","index":0}]]},"Add Label1":{"main":[[{"node":"Remove from Inbox","type":"main","index":0}]]},"Get Wealthgen Emails":{"main":[[{"node":"WealthGen Emails","type":"main","index":0}]]},"2PM Daily":{"main":[[{"node":"Gmail","type":"main","index":0}]]},"gpt 5-nano":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Fwd to Girls":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:2PM Daily":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"When clicking ‘Execute workflow’":[{"json":{}}]},"versionId":"ac0f78be-a783-44e9-8d68-8f60f28ca58b","activeVersionId":"ac0f78be-a783-44e9-8d68-8f60f28ca58b","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T03:01:09.294Z","createdAt":"2025-11-29T03:01:09.294Z","role":"workflow:owner","workflowId":"U5aq4dt1rtiVP1lr","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-08T18:41:21.553Z","createdAt":"2025-12-08T18:41:21.553Z","versionId":"ac0f78be-a783-44e9-8d68-8f60f28ca58b","workflowId":"U5aq4dt1rtiVP1lr","nodes":[{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-848,320],"id":"87baca45-d2d1-491e-9727-e0fcced6b1f3","name":"Gmail1","webhookId":"48ed5f3e-3a60-4b66-80b9-aa2b0efa9e38","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":1,"filters":{"q":"=from:support@tradingmastery.com.au subject:\"Market Update\" OR subject:\"Chew The Fat\" -label:\"Investing/Market Update\" -label:\"Investing/Chew The Fat\""}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-1056,320],"id":"971659f9-99c0-430c-aaec-3410d8f97117","name":"Gmail","webhookId":"bdf9d87a-88fc-46c5-9c18-68287d94ec68","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"Get Trading Mastery Daily update emails, extract the content","height":340,"width":480},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1168,224],"id":"4b34e2a8-bfea-49f4-aa1a-e251cd1dd6fc","name":"Sticky Note"},{"parameters":{"operation":"createFromText","content":"={{ $json.output.report }}","name":"={{ $json.filename }}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1K5QLZXGqNXB-76uMlmqysjHggBT3mo-e","mode":"list","cachedResultName":"Daily Market Updates","cachedResultUrl":"https://drive.google.com/drive/folders/1K5QLZXGqNXB-76uMlmqysjHggBT3mo-e"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[608,320],"id":"9f7a8cff-3bb2-432a-b149-3a574b67bc79","name":"Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"KXOIhDiudLLWYqP6","name":"Google Drive account"}}},{"parameters":{"content":"Summarise the daily update","height":340,"width":380,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-160,224],"id":"f07a94ca-4df9-4b42-b784-9204bb57245c","name":"Sticky Note1"},{"parameters":{"content":"Write the Daily Update to a file on Google Drive and Label the email message so it is not reprocessed","height":340,"width":520,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[528,224],"id":"04ed54eb-a3c4-4aba-967e-ee9e271fe89b","name":"Sticky Note2"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail1').item.json.id }}","labelIds":["Label_1644838814920549387"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[848,320],"id":"621d8f03-1369-4a6b-b747-4556610b6988","name":"Add Label","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"promptType":"define","text":"=You are a helpful assistant who reviews email content and summarizes it into an easy-to-read HTML report.\n\n\n\n\n### Rules:\n- Format the report in **HTML** for clarity.\n- Only include in `\"companies\"` the names of companies that have statistics like **CAGR** and **ROIC** mentioned.\n- Company names must be separated by underscores. Example: `NVIDIA_AMD_Intel`.\n- Do **not** include extra characters, quotes, or line breaks outside the JSON.\n\n---\n\n### Here is the email content to process:\n{{ $('Gmail1').item.json.text }}\n\nReturn **only the JSON object** above and nothing else.\n\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-96,336],"id":"d59e00ac-fdd5-4788-8baa-ba5eae656708","name":"AI Agent"},{"parameters":{"content":"Reame the file to include the company highlighted","height":340,"width":300,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[224,224],"id":"e6e373f6-928c-41b1-b3ec-46d8c90cc4d3","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"6b0aaae8-0669-40ed-b7e5-203dd4d7b3c8","name":"subject","value":"={{ $('Gmail1').item.json.subject }}","type":"string"},{"id":"c9f48c32-8b23-40ca-a3ce-3ef0d423a585","name":"date","value":"={{ $('Gmail1').item.json.date }}","type":"string"},{"id":"1b483daf-b394-4c55-b830-21a8db2c848e","name":"output.company","value":"={{ $json.output.companies }}","type":"string"},{"id":"b25d3e70-a197-4420-9ee9-567526ad0723","name":"output.report","value":"={{ $json.output.report }}","type":"string"},{"id":"10325cfc-e118-45b2-9330-7d004303397b","name":"filename","value":"={{ \n  $('Gmail1').item.json.date.split('T')[0].replace(/-/g, '') + \n  '-' + \n  $('Gmail1').item.json.subject.replace(/[^\\w\\s]/g, '').replace(/\\s+/g, '_') + \n  '-' + \n  $json.output.companies + \n  '.html' \n}}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[304,336],"id":"ec93b77a-fa93-4747-9ad3-b2ce4a225e4a","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d497c6e1-7f68-435e-87a4-cc4cc05c50e5","leftValue":"={{ $json.marketUpdate }}","rightValue":"true","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-448,320],"id":"d0696f69-6762-46f0-a894-f1364fbdab94","name":"If a Market Update"},{"parameters":{"content":"Is it a Market Update or Chew the Fat","height":340,"width":520,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-688,224],"id":"1f91cc63-885f-442f-83c6-f4c809d0ef6e","name":"Sticky Note4"},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail1').item.json.id }}","labelIds":["Label_5275052143762909707"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[0,0],"id":"299caa4a-41b0-4582-bdf2-f5c6f99160f5","name":"Label Chew The Fat","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1264,880],"id":"8783a54e-df7c-4309-aae6-852175767296","name":"When clicking ‘Execute workflow’"},{"parameters":{"jsonSchemaExample":"{\n\"report\": \"YOUR_HTML_FORMATTED_REPORT_HERE\",\n\"companies\": \"Company1_Company2_Company3\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[80,560],"id":"7ea012a4-4265-4366-8b67-872a7f8964dc","name":"Structured Output Parser"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Flag as market update if subject includes 'chew the fat'\nconst subject = $json.subject?.toLowerCase() || \"\";\n\nif (subject.includes(\"chew the fat\")) {\n  return { json: { ...$json, marketUpdate: false } };\n} else {\n  return { json: { ...$json, marketUpdate: true } };\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-640,320],"id":"53bf067f-8c7c-4530-88ad-429f35d33a6c","name":"Code"},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_6462038100696441708"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-544,880],"id":"74263d36-ddbd-4244-9c68-b409372e6583","name":"Add Label1","webhookId":"129855ab-0d14-4aeb-b48d-734c46130e1d","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-784,880],"id":"0afa09d1-3ad2-43d4-a26b-afb8db4a22c6","name":"WealthGen Emails","webhookId":"48ed5f3e-3a60-4b66-80b9-aa2b0efa9e38","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":20,"filters":{"q":"=from:info@wealthgeninvestor.com -label:\"Investing/Wealthgen\""}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-1024,880],"id":"b8d2e379-90e7-4347-ad7b-11cddcd4a1ce","name":"Get Wealthgen Emails","webhookId":"bdf9d87a-88fc-46c5-9c18-68287d94ec68","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"Label the Wealthgen emails and take them out of INBOX","height":240,"width":1080},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1136,800],"id":"b62694d6-cc8b-49b9-a00c-e172ebc4e169","name":"Sticky Note5"},{"parameters":{"rule":{"interval":[{"triggerAtHour":14}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1280,320],"id":"cbf74e5a-f687-4ac0-b58a-c6bebcf24a96","name":"2PM Daily"},{"parameters":{"model":{"__rl":true,"value":"gpt-5-nano","mode":"list","cachedResultName":"gpt-5-nano"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-128,512],"id":"20b54b6e-64ed-438a-8a84-774d652c8a32","name":"gpt 5-nano","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"sendTo":"monique@hallowes.com, j.hallowes@hotmail.com","subject":"={{ $json.subject }} - from Chris","message":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-256,336],"id":"1989f499-6f0f-4b34-855c-c613fe58a492","name":"Fwd to Girls","webhookId":"ef04e76e-bd15-4ebe-8db0-da8fa8747352","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"removeLabels","messageId":"={{ $json.id }}","labelIds":["INBOX"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,880],"id":"71047006-17ea-419d-ad34-911a797c1ba5","name":"Remove from Inbox","webhookId":"2629f213-0588-407a-a572-9133cd0ed0e8","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Gmail1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Gmail":{"main":[[{"node":"Gmail1","type":"main","index":0}]]},"Google Drive":{"main":[[{"node":"Add Label","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"If a Market Update":{"main":[[{"node":"Label Chew The Fat","type":"main","index":0}],[{"node":"Fwd to Girls","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"Get Wealthgen Emails","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"Code":{"main":[[{"node":"If a Market Update","type":"main","index":0}]]},"WealthGen Emails":{"main":[[{"node":"Add Label1","type":"main","index":0}]]},"Add Label1":{"main":[[{"node":"Remove from Inbox","type":"main","index":0}]]},"Get Wealthgen Emails":{"main":[[{"node":"WealthGen Emails","type":"main","index":0}]]},"2PM Daily":{"main":[[{"node":"Gmail","type":"main","index":0}]]},"gpt 5-nano":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Fwd to Girls":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":null,"description":null,"autosaved":false},"tags":[]},{"updatedAt":"2026-01-03T23:42:02.191Z","createdAt":"2025-11-29T03:00:14.623Z","id":"VDgyV595kKwnQM69","name":"GithubDailyPush","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-944,224],"id":"da7e6b4a-96ba-4822-9036-4225e2dfca09","name":"When clicking ‘Test workflow’"},{"parameters":{"filters":{},"requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-688,144],"id":"49b9963e-2ace-4be6-a0d7-0d594ffea8f5","name":"n8n","credentials":{"n8nApi":{"id":"9mc03qMdLJVYN1kJ","name":"n8n account"}},"onError":"continueErrorOutput"},{"parameters":{"rule":{"interval":[{"triggerAtHour":4}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-944,32],"id":"813012a1-e4d1-4443-b614-9a062d8fb7b8","name":"Schedule Trigger"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"chrishallowes","mode":"name"},"repository":{"__rl":true,"value":"HostingerN8N_Backup","mode":"list","cachedResultName":"HostingerN8N_Backup","cachedResultUrl":"https://github.com/chrisHallowes/HostingerN8N_Backup"},"filePath":"={{$now.format('yyyyMMdd')}}/all-workflows-backup.json","fileContent":"={{ JSON.stringify($input.item.json) }}","commitMessage":"=Backup all workflows - {{$now.format('yyyyMMdd')}}","additionalParameters":{"branch":{"branch":"main"}}},"type":"n8n-nodes-base.github","typeVersion":1,"position":[-224,48],"id":"a6f9cdf4-1d61-4958-8a22-5465fa87ba04","name":"GitHub","retryOnFail":true,"webhookId":"a8d4d816-9b3c-4d20-9996-9f1323b615fb","credentials":{"githubApi":{"id":"RerUf7aT4S1hn9Vy","name":"GitHub account"}},"onError":"continueErrorOutput"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"n8n Workflows Backed Up Succesfully","message":"Breathe easy! :)","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[96,32],"id":"a260dd2b-6677-49e4-8a26-4cf97ae9dc1d","name":"SuccessMail","webhookId":"f94016b7-7bac-4487-93e1-958b9685fcc3","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"chris@hallowes.com","subject":"n8n Workflow - Github save failed","message":"Look at your work flow here https://hallowes.app.n8n.cloud/workflow/iKRlNEduQ9GTy5XV","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-16,256],"id":"9b519886-bd26-4e72-808b-8a5a34c77333","name":"FailMail","webhookId":"df8c423b-4549-4c39-b059-53a4ae280abf","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      backupDate: new Date().toISOString(),\n      totalWorkflows: items.length,\n      workflows: items.map(item => item.json)\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-480,48],"id":"d15ff91d-da71-4ac3-9698-87ec2dc1a628","name":"Code in JavaScript"}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"n8n","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"n8n","type":"main","index":0}]]},"n8n":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}],[{"node":"FailMail","type":"main","index":0}]]},"GitHub":{"main":[[{"node":"SuccessMail","type":"main","index":0}],[{"node":"FailMail","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"GitHub","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"0498fc7f-9e37-4b08-a9b7-2c3b25489a1e","activeVersionId":"0498fc7f-9e37-4b08-a9b7-2c3b25489a1e","triggerCount":1,"shared":[{"updatedAt":"2025-11-29T03:00:14.625Z","createdAt":"2025-11-29T03:00:14.625Z","role":"workflow:owner","workflowId":"VDgyV595kKwnQM69","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2026-01-03T23:43:20.000Z","createdAt":"2026-01-03T23:42:02.192Z","versionId":"0498fc7f-9e37-4b08-a9b7-2c3b25489a1e","workflowId":"VDgyV595kKwnQM69","nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-944,224],"id":"da7e6b4a-96ba-4822-9036-4225e2dfca09","name":"When clicking ‘Test workflow’"},{"parameters":{"filters":{},"requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-688,144],"id":"49b9963e-2ace-4be6-a0d7-0d594ffea8f5","name":"n8n","credentials":{"n8nApi":{"id":"9mc03qMdLJVYN1kJ","name":"n8n account"}},"onError":"continueErrorOutput"},{"parameters":{"rule":{"interval":[{"triggerAtHour":4}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-944,32],"id":"813012a1-e4d1-4443-b614-9a062d8fb7b8","name":"Schedule Trigger"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"chrishallowes","mode":"name"},"repository":{"__rl":true,"value":"HostingerN8N_Backup","mode":"list","cachedResultName":"HostingerN8N_Backup","cachedResultUrl":"https://github.com/chrisHallowes/HostingerN8N_Backup"},"filePath":"={{$now.format('yyyyMMdd')}}/all-workflows-backup.json","fileContent":"={{ JSON.stringify($input.item.json) }}","commitMessage":"=Backup all workflows - {{$now.format('yyyyMMdd')}}","additionalParameters":{"branch":{"branch":"main"}}},"type":"n8n-nodes-base.github","typeVersion":1,"position":[-224,48],"id":"a6f9cdf4-1d61-4958-8a22-5465fa87ba04","name":"GitHub","retryOnFail":true,"webhookId":"a8d4d816-9b3c-4d20-9996-9f1323b615fb","credentials":{"githubApi":{"id":"RerUf7aT4S1hn9Vy","name":"GitHub account"}},"onError":"continueErrorOutput"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"n8n Workflows Backed Up Succesfully","message":"Breathe easy! :)","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[96,32],"id":"a260dd2b-6677-49e4-8a26-4cf97ae9dc1d","name":"SuccessMail","webhookId":"f94016b7-7bac-4487-93e1-958b9685fcc3","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"chris@hallowes.com","subject":"n8n Workflow - Github save failed","message":"Look at your work flow here https://hallowes.app.n8n.cloud/workflow/iKRlNEduQ9GTy5XV","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-16,256],"id":"9b519886-bd26-4e72-808b-8a5a34c77333","name":"FailMail","webhookId":"df8c423b-4549-4c39-b059-53a4ae280abf","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      backupDate: new Date().toISOString(),\n      totalWorkflows: items.length,\n      workflows: items.map(item => item.json)\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-480,48],"id":"d15ff91d-da71-4ac3-9698-87ec2dc1a628","name":"Code in JavaScript"}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"n8n","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"n8n","type":"main","index":0}]]},"n8n":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}],[{"node":"FailMail","type":"main","index":0}]]},"GitHub":{"main":[[{"node":"SuccessMail","type":"main","index":0}],[{"node":"FailMail","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"GitHub","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":"Version 0498fc7f","description":"","autosaved":false},"tags":[]},{"updatedAt":"2025-12-08T07:26:12.000Z","createdAt":"2025-11-29T02:58:51.028Z","id":"ZQa1ADM1J6nLNZX2","name":"Email with feedback","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"authentication":"airtableTokenApi","baseId":{"__rl":true,"value":"","mode":"id"},"tableId":{"__rl":true,"value":"","mode":"id"},"triggerField":"Created","additionalFields":{}},"type":"n8n-nodes-base.airtableTrigger","typeVersion":1,"position":[-496,400],"id":"ab26a6e9-b3ca-462d-8f3e-a506ec552a48","name":"Airtable Trigger","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"search","base":{"__rl":true,"mode":"list","value":""},"table":{"__rl":true,"mode":"list","value":""},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[-176,704],"id":"5331f04a-5701-4d0c-a596-904863f7f3f5","name":"Project Database","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"promptType":"define","text":"=Incoming Lead\n\nName: {{ $json.fields.name }}\n\nEmail: {{ $json.fields.email }}\n\nIntent: {{ $json.fields.intent }}\n\nBudget: {{ $json.fields.budget }}\n\nCompany Name: {{ $json.fields.companyName }}\n\nProject Description: {{ $json.fields.projectDescription }} \n\nTimeline: {{ $json.fields.timeline }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview\nYou are an expert sales person for an agency that delivers AI solutions. Your job is to respond to incoming leads by addressing their needs in a professional manner. You will receive information like the lead's project description and timeline, and your goal is to convince them that we are the best AI Agency on the market.\n\n## Tools\nProject Database - Use this tool to search through previous projects we have done. \n\n## Rules\n- You will receive information about a lead, and you need to craft a professional email. Keep it concise, nobody wants to read a huge email.\n- Your main objective is to convince the lead to book in a second call. Your job is to make them believe that we can deliver the project they have described and exceed their expectations.\n- Retrieve information about previous projects to share with the lead to prove that our team is capable of handling their project. Find a similar project we have done to share with the lead. Share the result of how we helped the client.\n\n\n## Final Notes\nSign off emails as Jim, Dunder AI\nHere is the current date/time: {{ $now }}\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-288,400],"id":"05679dbc-7df6-4893-9dd8-fb424ca77c11","name":"Sales Agent"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"subject\": {\n      \"type\": \"string\",\n      \"description\": \"The subject line of the email\"\n    },\n    \"email\": {\n      \"type\": \"string\",\n      \"description\": \"The body content of the email\"\n    }\n  },\n  \"required\": [\"subject\", \"email\"]\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[576,736],"id":"df9b8e60-b3ab-42d5-82cb-9dd9c4cfb449","name":"Structured Output Parser"},{"parameters":{"sendTo":"={{ $('Airtable Trigger').item.json.fields.email }}","subject":"={{ $('Sales Agent').item.json.output.subject }}","emailType":"text","message":"={{ $('Set Email').item.json.email }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[800,288],"id":"daccbc8e-a8c7-4719-9cf9-125a721bfa6a","name":"Send Email","webhookId":"9ae2a2f2-de7c-46a1-93f7-8b2612d40751","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"modelName":"models/gemini-2.0-flash-exp","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[400,736],"id":"8c6dc92e-d6fd-440a-b3dd-0da208795704","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"S1jPKDTEFRU5asur","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"=Email: {{ $('Set Email').item.json.email }}\n\nFeedback from human: {{ $json.data.text }}","hasOutputParser":true,"options":{"systemMessage":"=# Overview\nYou are an expert email writer. Your job is to take an incoming email and revise it based on the feedback the human submitted.\n\n## Rules\nSign off emails as Jim, Dunder AI\nHere is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[800,464],"id":"51b32375-0dd3-4394-8e65-2f82961bcf3e","name":"Revision Agent"},{"parameters":{"assignments":{"assignments":[{"id":"3800e373-5f7a-4642-8392-d3a4aed9e067","name":"email","value":"={{ $json.output.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[80,400],"id":"c54c1576-429e-461f-84aa-59ddcc1fa90a","name":"Set Email"},{"parameters":{"operation":"sendAndWait","sendTo":"chris@hallowes.com","subject":"=APPROVAL REQUIRED for New Lead: {{ $('Airtable Trigger').item.json.fields.name }}","message":"={{ $('Airtable Trigger').item.json.fields.name }} from {{ $('Airtable Trigger').item.json.fields.companyName }} is looking for {{ $('Airtable Trigger').item.json.fields.intent }}. Their budget is {{ $('Airtable Trigger').item.json.fields.budget }} with a(n) {{ $('Airtable Trigger').item.json.fields.timeline }} timeline.\n\n\nPlease approve or decline the sending of this message generated by Jim, our AI Sales Agent.\n\nSubject: {{ $('Sales Agent').item.json.output.subject }}\n\nEmail: {{ $json.email }}","responseType":"freeText","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[240,400],"id":"a775eeb6-01d1-4af5-b9df-e7746083b610","name":"Get Feedback","webhookId":"10605e1c-7bc0-4a9f-b23a-9797cc88449e","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"inputText":"={{ $json.data.text }}","categories":{"categories":[{"category":"Approved","description":"The email has been reviewed and accepted as-is. The human explicitly or implicitly expresses approval, indicating that no changes are needed. \n\nExample phrases include:\n\n\"Looks good.\"\n\"Go ahead and send it.\"\n\"This works for me.\"\n\"Approved.\"\n\"No changes needed.\""},{"category":"Declined","description":"The email has been reviewed, but the human requests modifications before it is sent like tweaks, removing parts, rewording, etc. This could include suggested edits, rewording, or major revisions. \n\nExample phrases include:\n\n\"Can we tweak this part?\"\n\"Needs some changes.\"\n\"I’d like to reword this.\"\n\"Not quite right—let’s revise it.\"\n\"Can you adjust this before sending?\"\n\"Don't mention that we can't do that\""}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[416,400],"id":"c37e8706-bd26-4fcc-884f-82766b8046d4","name":"Check Feedback"},{"parameters":{"content":"# Nate Herk | AI Automation","height":80,"width":500,"color":5},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"d619d07c-767f-4a5e-afe7-917859ade522","name":"Sticky Note"},{"parameters":{"content":"# Human In The Loop Sales Team\n## The agents wait for feedback and approval - unlimited email revisions\n\n","height":820,"width":1760,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-576,144],"typeVersion":1,"id":"48d24d18-5d0a-4e00-8be9-fbf0d46cdda8","name":"Sticky Note1"},{"parameters":{"model":"anthropic/claude-haiku-4.5","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[160,720],"id":"795f5e36-14e0-4af0-87c5-89fdc38cf86c","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Airtable Trigger":{"main":[[{"node":"Sales Agent","type":"main","index":0}]]},"Project Database":{"ai_tool":[[{"node":"Sales Agent","type":"ai_tool","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Sales Agent","type":"ai_outputParser","index":0},{"node":"Revision Agent","type":"ai_outputParser","index":0}]]},"Sales Agent":{"main":[[{"node":"Set Email","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Check Feedback","type":"ai_languageModel","index":0}]]},"Revision Agent":{"main":[[{"node":"Set Email","type":"main","index":0}]]},"Set Email":{"main":[[{"node":"Get Feedback","type":"main","index":0}]]},"Get Feedback":{"main":[[{"node":"Check Feedback","type":"main","index":0}]]},"Check Feedback":{"main":[[{"node":"Send Email","type":"main","index":0}],[{"node":"Revision Agent","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Sales Agent","type":"ai_languageModel","index":0},{"node":"Revision Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"697b27fd-321a-41fb-af63-535917a0b4a4","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:58:51.030Z","createdAt":"2025-11-29T02:58:51.030Z","role":"workflow:owner","workflowId":"ZQa1ADM1J6nLNZX2","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-11T18:32:27.958Z","createdAt":"2025-12-07T02:10:56.088Z","id":"bfQrGJN8N27Y9AnX","name":"Email Labelling Agent","active":true,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyX","value":10,"unit":"minutes"}]},"simple":false,"filters":{},"options":{}},"id":"061536b9-d3dc-4917-a847-89f3835ec2cb","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1.1,"position":[-288,384],"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_3294538948721148189"]},"id":"77d75ccd-7162-47e9-ba21-e1af764d585c","name":"Others","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,608],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"## I'm your personal email AI Labeling Agent :)\n\n### I will organize your inbox by labeling all incoming emails into predefined labels to save you time. ","height":223.59369296517087,"width":407.40000000000003,"color":5},"id":"8d3bd413-c34b-43e9-879a-b9f5cb1db2f5","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"inputText":"={{ $json.text }}","categories":{"categories":[{"category":"Spam","description":"Emails that offer stuff that appears to be spam. This will include GrabOne offers."},{"category":"Investing","description":"Emails that are from WealthGen Investor or Trading Mastery. This also include emails giving Stock Discounts, Chew the Fat, Market Updates, or are from Andrew Barnett. It also includes emails that are Daily Trade Reports or has 'Market Update' in the email subject."},{"category":"Purchases_Receipts","description":"Emails that appear to be about purchases I have made or receipts for the purchases I have made."},{"category":"Other","description":"All others emails that do not match the description of previous labels. "},{"category":"AI_Automations","description":"Emails from AI Automation Society, AI Automation Society Plus, AI Workshop Lite, or other AI related emails."},{"category":"Reply","description":"Determine a this email requires me to reply to it.  If so then then mark it as requiring a reply."}]},"options":{"systemPromptTemplate":"=Please classify the text provided by the user into one of the categories provided. If you cannot determine the category to be used then default it to the 'Other' category.\nIf the Subject is 'Unsubscribe' then igore the email and do nothing"}},"id":"fcfb49d3-3328-45ce-96bd-946ca64569fb","name":"Labeling AI Agent","type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[112,320]},{"parameters":{"model":"gpt-5-nano","options":{}},"id":"4d164083-157c-4401-859b-0a3579a996e7","name":"chatGPT 5 mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-224,656],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["SPAM"]},"id":"b9394afb-1f21-462e-a3f6-b9625c575055","name":"Spam","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,80],"webhookId":"91478e56-192c-45f6-ab1f-dd774de83d34","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_34"]},"id":"a95f696f-11fc-4699-97a3-988b064e3e30","name":"Investing","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,256],"webhookId":"f25a235c-774e-464e-bc6e-5b168f35876a","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_7928830508184749955"]},"id":"eb787f0f-588c-48df-87fd-31d25f9fc72d","name":"Purchase Receipts","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,432],"webhookId":"37b2667b-0371-4be6-a60e-b5f9bc1fe571","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_29"]},"id":"598bbe2c-e3d0-4c27-a378-142cb4ffa80d","name":"AI Automations","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,800],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_2476636834875974344"]},"id":"715142da-c4e9-4180-b372-bad6ae4a0511","name":"Reply to","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[560,992],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"model":"openai/gpt-5-nano","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[48,640],"id":"ffaae158-bf83-47c7-80b6-63512a0d672b","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Gmail Trigger":{"main":[[{"node":"Labeling AI Agent","type":"main","index":0}]]},"Labeling AI Agent":{"main":[[{"node":"Spam","type":"main","index":0}],[{"node":"Investing","type":"main","index":0}],[{"node":"Purchase Receipts","type":"main","index":0}],[{"node":"Others","type":"main","index":0}],[{"node":"AI Automations","type":"main","index":0}],[{"node":"Reply to","type":"main","index":0}]]},"chatGPT 5 mini":{"ai_languageModel":[[]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Labeling AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":{"node:Gmail Trigger":{"Gmail Trigger":{"lastTimeChecked":1768700740,"possibleDuplicates":["19bcec7871bfc705","19bce9e0549aafcd"]}}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"cbdcd971-031d-4728-8798-0cac1c360a4b","activeVersionId":"cbdcd971-031d-4728-8798-0cac1c360a4b","triggerCount":1,"shared":[{"updatedAt":"2025-12-07T02:10:56.091Z","createdAt":"2025-12-07T02:10:56.091Z","role":"workflow:owner","workflowId":"bfQrGJN8N27Y9AnX","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-11T18:32:06.095Z","createdAt":"2025-12-11T18:32:06.095Z","versionId":"cbdcd971-031d-4728-8798-0cac1c360a4b","workflowId":"bfQrGJN8N27Y9AnX","nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyX","value":10,"unit":"minutes"}]},"simple":false,"filters":{},"options":{}},"id":"061536b9-d3dc-4917-a847-89f3835ec2cb","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1.1,"position":[-288,384],"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_3294538948721148189"]},"id":"77d75ccd-7162-47e9-ba21-e1af764d585c","name":"Others","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,608],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"## I'm your personal email AI Labeling Agent :)\n\n### I will organize your inbox by labeling all incoming emails into predefined labels to save you time. ","height":223.59369296517087,"width":407.40000000000003,"color":5},"id":"8d3bd413-c34b-43e9-879a-b9f5cb1db2f5","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"inputText":"={{ $json.text }}","categories":{"categories":[{"category":"Spam","description":"Emails that offer stuff that appears to be spam. This will include GrabOne offers."},{"category":"Investing","description":"Emails that are from WealthGen Investor or Trading Mastery. This also include emails giving Stock Discounts, Chew the Fat, Market Updates, or are from Andrew Barnett. It also includes emails that are Daily Trade Reports or has 'Market Update' in the email subject."},{"category":"Purchases_Receipts","description":"Emails that appear to be about purchases I have made or receipts for the purchases I have made."},{"category":"Other","description":"All others emails that do not match the description of previous labels. "},{"category":"AI_Automations","description":"Emails from AI Automation Society, AI Automation Society Plus, AI Workshop Lite, or other AI related emails."},{"category":"Reply","description":"Determine a this email requires me to reply to it.  If so then then mark it as requiring a reply."}]},"options":{"systemPromptTemplate":"=Please classify the text provided by the user into one of the categories provided. If you cannot determine the category to be used then default it to the 'Other' category.\nIf the Subject is 'Unsubscribe' then igore the email and do nothing"}},"id":"fcfb49d3-3328-45ce-96bd-946ca64569fb","name":"Labeling AI Agent","type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[112,320]},{"parameters":{"model":"gpt-5-nano","options":{}},"id":"4d164083-157c-4401-859b-0a3579a996e7","name":"chatGPT 5 mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-224,656],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["SPAM"]},"id":"b9394afb-1f21-462e-a3f6-b9625c575055","name":"Spam","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,80],"webhookId":"91478e56-192c-45f6-ab1f-dd774de83d34","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_34"]},"id":"a95f696f-11fc-4699-97a3-988b064e3e30","name":"Investing","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,256],"webhookId":"f25a235c-774e-464e-bc6e-5b168f35876a","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_7928830508184749955"]},"id":"eb787f0f-588c-48df-87fd-31d25f9fc72d","name":"Purchase Receipts","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,432],"webhookId":"37b2667b-0371-4be6-a60e-b5f9bc1fe571","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_29"]},"id":"598bbe2c-e3d0-4c27-a378-142cb4ffa80d","name":"AI Automations","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[544,800],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $json.id }}","labelIds":["Label_2476636834875974344"]},"id":"715142da-c4e9-4180-b372-bad6ae4a0511","name":"Reply to","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[560,992],"webhookId":"3f84b3a9-7a56-417f-9332-bfee293766b0","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"model":"openai/gpt-5-nano","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[48,640],"id":"ffaae158-bf83-47c7-80b6-63512a0d672b","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Gmail Trigger":{"main":[[{"node":"Labeling AI Agent","type":"main","index":0}]]},"Labeling AI Agent":{"main":[[{"node":"Spam","type":"main","index":0}],[{"node":"Investing","type":"main","index":0}],[{"node":"Purchase Receipts","type":"main","index":0}],[{"node":"Others","type":"main","index":0}],[{"node":"AI Automations","type":"main","index":0}],[{"node":"Reply to","type":"main","index":0}]]},"chatGPT 5 mini":{"ai_languageModel":[[]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Labeling AI Agent","type":"ai_languageModel","index":0}]]}},"authors":"Chris Hallowes","name":null,"description":null,"autosaved":false},"tags":[]},{"updatedAt":"2026-01-10T04:45:47.025Z","createdAt":"2025-12-05T23:52:17.163Z","id":"cvpE7tqXN33oVOMh","name":"Anescan Log Checker","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1936,1232],"id":"7d1c9ac8-5a88-4318-ba10-6d2d9014911e","name":"When clicking ‘Execute workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/filewatcherlogs","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=MEDHOST_{{ $now.toUTC().format(\"yyyyMMdd\")}}.log","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1248,144],"id":"b06dbecf-7f6e-4ba8-9851-02716d59ca89","name":"set folder and filename"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"OpNotes Log file exists","message":"The Anescan Bitvise File Watcher Service appears to be working - there is a Medhost file","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,32],"id":"8a1733e1-998d-4646-b288-f6e1de6b82e4","name":"Send success message","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Log file does not exist","message":"=There is no file for {{ $node[\"set folder and filename\"].json.fileName }}.\nCheck the Anescan Bitvise File Watcher Service is running correctly.\n","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,240],"id":"95aca548-2485-4481-a6bd-0d9797536ae1","name":"Send failure message","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"const expected = $node[\"set folder and filename\"].json.fileName;\n\nlet found = false;\nfor (const item of items) {\n  if (item.json.name === expected) {\n    found = true;\n    break;\n  }\n}\n\nreturn [{\n  json: {\n    expected,\n    fileFound: found,\n  },\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-784,144],"id":"be3f604f-f068-4e65-998f-b74784f2fa05","name":"check file exists"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fabbcdf3-1976-4e6a-9033-a39b1fe17222","leftValue":"={{ $json.fileFound }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-560,144],"id":"43e119a7-fb1b-464c-a6c6-52cfe84e4f4c","name":"If"},{"parameters":{"rule":{"interval":[{"triggerAtHour":5,"triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[-1600,144],"id":"5c3f6d3b-24d8-46d7-a37a-a93055ae9ed7","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/meditechfolder","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.pdf","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1232,448],"id":"1e4cbe6f-37e9-4968-9b21-6a8bbfc2dd59","name":"set folder and filename1"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1024,144],"id":"0438a27a-4301-44e0-920a-48201bd294ae","name":"FTP","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1008,448],"id":"a1e65efd-eb80-4535-9985-0bd4bafaf14f","name":"FTP1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"// Expected pattern (e.g., \"*.pdf\")\nconst expected = \"*.pdf\";\n\n// Items from FTP node\nconst ftpItems = items;\n\nlet found = false;\n\nfor (const item of ftpItems) {\n\tconst name = item.json.name || \"\";\n\n\t// Match \"*.pdf\" → endsWith(\".pdf\")\n\tif (expected === \"*.pdf\" && name.toLowerCase().endsWith(\".pdf\")) {\n\t\tfound = true;\n\t\tbreak;\n\t}\n\n\t// If you later want wildcard support, add more logic here\n}\n\nreturn [\n\t{\n\t\tjson: {\n\t\t\texpected,\n\t\t\tfileFound: found,\n\t\t},\n\t},\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,448],"id":"807ecab9-79e0-4ea6-bb6a-857db062b350","name":"check file exists1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fabbcdf3-1976-4e6a-9033-a39b1fe17222","leftValue":"={{ $json.fileFound }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-544,448],"id":"11f7cf7f-5a93-44ac-b3d0-32fc3fce9f70","name":"If1"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"*** Scotland County PDFs are still in the folder","message":"=There is still a pdf file in the Meditech Scotland County folder - something failed to move it.","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-272,432],"id":"26ae3d76-5e2a-4347-9ba6-81c37f2dfe93","name":"Send failure message1","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Scotland County folder has no PDFs - all good","message":"=The Scotland County pdfs have been transferred - all is working as planned.","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-64,464],"id":"2caec426-0c70-468b-92a9-10917c60de56","name":"Send success message2","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"rule":{"interval":[{"field":"hours","triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[-1568,720],"id":"1341919d-05d3-46d1-a798-1f4143c9c2f6","name":"Schedule Trigger1"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.csv","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,816],"id":"01c005c5-cae7-473a-892d-c5dd6662552e","name":"set folder and filename for Takle"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-672,816],"id":"d069e30d-a0d3-4897-8adb-27c8e2231f97","name":"look for csv files","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"protocol":"sftp","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[256,816],"id":"916d0e90-cc92-4d3a-b09e-d9726bedd946","name":"download csv files","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-496,816],"id":"3d17512a-cb02-4286-9d73-6c49becabbfb","name":"Loop Over Items"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".csv","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[48,832],"id":"47215d50-cf17-49ca-a44e-1b1716c189da","name":"if it is a csv file"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[736,816],"id":"90e58bd5-349e-4b7b-bd79-259e2750706d","name":"write csv file back","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Takle file has been reviewed ","message":"=The automation read a Takle file and scanned the DOBs and wrote the file back to the Server","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[464,656],"id":"c92cc5a6-7600-4feb-b99c-b7d73674345e","name":"Send success message3","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","executeOnce":true,"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"// Get binary data using n8n's helper\nconst binaryData = await this.helpers.getBinaryDataBuffer(0, 'data');\nconst fileContent = binaryData.toString('utf-8');\n\n// Get input filename and convert to YYYYMMDD format\nconst inputFileName = $input.first().binary.data.fileName;\nconst datePart = inputFileName.replace('.csv', '');\nconst [month, day, year] = datePart.split('-');\nconst fullYear = year.length === 2 ? '20' + year : year;\nconst outputFileName = `${fullYear}${month}${day}.dat`;\n\n// Get the original folder path from the SFTP download node\nconst originalPath = $('download csv files').first().json.path;\nconst folderPath = originalPath.substring(0, originalPath.lastIndexOf('/') + 1);\nconst destinationPath = folderPath + outputFileName;\n\n// Split into lines\nconst lines = fileContent.split('\\n');\n\n// Keep the header row\nconst header = lines[0];\n\n// Process data rows (skip header)\nconst validLines = lines.slice(1).filter(line => {\n  if (!line.trim()) return false;\n  \n  const columns = line.split('|');\n  const dob = columns[5];\n  \n  return isValidDate(dob);\n});\n\nfunction isValidDate(dateString) {\n  if (!dateString || !dateString.trim()) return false;\n  \n  const parts = dateString.split('-');\n  if (parts.length !== 3) return false;\n  \n  const month = parseInt(parts[0], 10);\n  const day = parseInt(parts[1], 10);\n  const year = parseInt(parts[2], 10);\n  \n  if (isNaN(month) || isNaN(day) || isNaN(year)) return false;\n  if (month < 1 || month > 12) return false;\n  if (day < 1 || day > 31) return false;\n  if (year < 1900 || year > 2100) return false;\n  \n  const date = new Date(year, month - 1, day);\n  return date.getFullYear() === year && \n         date.getMonth() === month - 1 && \n         date.getDate() === day;\n}\n\n// Reconstruct the cleaned file\nconst cleanedFile = [header, ...validLines].join('\\n');\n\n// Return with path in JSON for the FTP node\nreturn [{\n  json: {\n    path: destinationPath\n  },\n  binary: {\n    data: await this.helpers.prepareBinaryData(\n      Buffer.from(cleanedFile, 'utf-8'),\n      outputFileName,\n      'text/plain'\n    )\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[496,816],"id":"126da9d1-0e18-49d0-8338-5ca61205dc61","name":"remove bad rows"},{"parameters":{"protocol":"sftp","operation":"rename","oldPath":"={{ $('download csv files').item.json.path }}","newPath":"={{ $json.Folder }}{{ $json.fileName }}","options":{"createDirectories":false}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1744,816],"id":"08b9363e-1704-4801-aa1f-63d182da8bab","name":"put orig csv into backups","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle/backup/","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"={{ $('download csv files').item.json.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1312,816],"id":"b423bcbb-b436-4c4c-b9ed-3b921ec131af","name":"set folder and filename for Takle1"},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = true;\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[944,816],"id":"62516a4a-b778-4b20-bf8f-5a77c82d4038","name":"Set processed = True"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-912,816],"id":"77c13297-dd6c-4eb7-86ba-57e85b04d9a4","name":"Set processed = false"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"070f0b93-6a5d-447a-b2ce-e3c6a06c2d7c","leftValue":"={{ $json.fileProcessed === true }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[96,672],"id":"06b9db00-1e17-42d2-bc5b-754b16ad1642","name":"Was file processed"},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\n\nreturn [{\n  json: {\n    fileProcessed: staticData.fileProcessed || false\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-224,672],"id":"d7effd13-f73a-4469-becd-5dd7c30a4ee0","name":"check if a file was processed"},{"parameters":{"path":"Takle-automation-workflow","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1936,976],"id":"85f06141-9797-4147-be7c-45da93ab0d84","name":"Webhook","webhookId":"ac180090-0dc7-4f0f-8bae-ed223a5a75a1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"0b3149ef-a405-4f70-bed4-10ca0533ccee","leftValue":"={{ $json.query.key }}","rightValue":"KJd93k2Lm","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1680,976],"id":"15278893-ee94-41d5-8189-b9ef37811a05","name":"Check security Key"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Takle automation manually started","message":"={{ $('Webhook').item.json.query.user }} started the Takle n8n autmation via a web browser.","options":{"appendAttribution":true}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[-1424,880],"id":"19aa2c3e-757c-406e-ac7e-8ccf45f3bac0","name":"send notification email","webhookId":"fc3199f1-5bf5-4620-8e64-e768b9040fa9","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"   MEDHOST","height":224,"width":288},"type":"n8n-nodes-base.stickyNote","position":[-1680,128],"typeVersion":1,"id":"61614188-5756-4bbe-9010-bcad9d41008d","name":"Sticky Note"},{"parameters":{"content":"  Scotland Counuty","height":224,"width":288},"type":"n8n-nodes-base.stickyNote","position":[-1680,416],"typeVersion":1,"id":"81e598ea-c236-49b5-9e77-2b4d624adee3","name":"Sticky Note1"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran MEDHOST checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[16,160],"id":"3ccfbc65-ca5a-4f10-bde7-9ab045077d86","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran Scotland County checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[256,432],"id":"07159d1e-46fd-4c87-a27b-dd89566eeaba","name":"Append row in sheet1","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran TAKLE checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[768,656],"id":"08c02b11-027c-4b37-822c-dd2aa1b001e3","name":"Append row in sheet2","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=  *.docx","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1680,1232],"id":"31b2adaf-7e9c-4083-9385-f2036da9844a","name":"set folder and filename for Takle2"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.DOCXfileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1392,1232],"id":"f2186f02-dada-463e-ab32-bc46eb8742a4","name":"Set processed = false1"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1152,1232],"id":"bb210954-c6b4-4f44-9a0d-d71b03e7987f","name":"look for docx file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-928,1232],"id":"2e5792e5-fcb2-4cd7-8287-c83119050332","name":"Loop Over Items1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".docx","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-688,1248],"id":"17c0c26e-4bd5-4040-8c6f-b10ba37dd19f","name":"if it is a docx file"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $('set trigger file details').item.json.remoteDir }}/{{$binary.data.fileName}}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-64,1232],"id":"096eff7d-2321-48a9-8f08-e250353468b6","name":"write trigger file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"operation":"toText","sourceProperty":"fileText","options":{"encoding":"ascii","fileName":"={{ $json.fileName }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-288,1232],"id":"3ab700ff-66f0-4908-ae75-a4d5913e52fe","name":"Convert to File"},{"parameters":{"assignments":{"assignments":[{"id":"6f058606-1f20-482d-a714-75cc58271443","name":"fileName","value":"=run_takle_{{$now.toFormat(\"yyyyLLdd_HHmmss\")}}.trigger","type":"string"},{"id":"6bc53943-2d51-49c9-895b-867d26f7e900","name":"fileText","value":"=job=takleConverter;ts={{$now}} }}","type":"string"},{"id":"8aa3c1fc-a9a5-4d97-a0ae-65089cd9ae8e","name":"remoteDir","value":"/iguana/inbound/takle/_signals","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-496,1232],"id":"017a6466-d68f-4d0b-b0ab-f16b1471a3ef","name":"set trigger file details"},{"parameters":{"amount":60},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[800,1248],"id":"22f860f4-7672-47d4-bd13-3e9842ea801c","name":"Wait 1m","webhookId":"5d5601d8-259c-4597-9f94-c844a5b8df83"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[544,1232],"id":"96ec6924-c23c-4275-b7e1-3081e77d49f3","name":"Loop Over Items2"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.csv","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[112,1232],"id":"4bc6dc71-9deb-4c6b-b711-5788c94f2ffe","name":"set folder and filename for csv file"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[976,1248],"id":"207e01c8-9099-4730-9960-5610915b321f","name":"look for Takle csv file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".csv","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1184,1248],"id":"d7bc3677-1c01-4106-903d-ec3f80794a07","name":"if it is a csv file1"},{"parameters":{"protocol":"sftp","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1392,1232],"id":"1d2edc02-7295-4b5e-96ef-8579d1e00f71","name":"download csv files1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"// Get binary data using n8n's helper\nconst binaryData = await this.helpers.getBinaryDataBuffer(0, 'data');\nconst fileContent = binaryData.toString('utf-8');\n\n// Get input filename and convert to YYYYMMDD format\nconst inputFileName = $input.first().binary.data.fileName;\nconst datePart = inputFileName.replace('.csv', '');\nconst [month, day, year] = datePart.split('-');\nconst fullYear = year.length === 2 ? '20' + year : year;\nconst outputFileName = `${fullYear}${month}${day}.dat`;\n\n// Get the original folder path from the SFTP download node\nconst originalPath = $('download csv files').first().json.path;\nconst folderPath = originalPath.substring(0, originalPath.lastIndexOf('/') + 1);\nconst destinationPath = folderPath + outputFileName;\n\n// Split into lines\nconst lines = fileContent.split('\\n');\n\n// Keep the header row\nconst header = lines[0];\n\n// Process data rows (skip header)\nconst validLines = lines.slice(1).filter(line => {\n  if (!line.trim()) return false;\n  \n  const columns = line.split('|');\n  const dob = columns[5];\n  \n  return isValidDate(dob);\n});\n\nfunction isValidDate(dateString) {\n  if (!dateString || !dateString.trim()) return false;\n  \n  const parts = dateString.split('-');\n  if (parts.length !== 3) return false;\n  \n  const month = parseInt(parts[0], 10);\n  const day = parseInt(parts[1], 10);\n  const year = parseInt(parts[2], 10);\n  \n  if (isNaN(month) || isNaN(day) || isNaN(year)) return false;\n  if (month < 1 || month > 12) return false;\n  if (day < 1 || day > 31) return false;\n  if (year < 1900 || year > 2100) return false;\n  \n  const date = new Date(year, month - 1, day);\n  return date.getFullYear() === year && \n         date.getMonth() === month - 1 && \n         date.getDate() === day;\n}\n\n// Reconstruct the cleaned file\nconst cleanedFile = [header, ...validLines].join('\\n');\n\n// Return with path in JSON for the FTP node\nreturn [{\n  json: {\n    path: destinationPath\n  },\n  binary: {\n    data: await this.helpers.prepareBinaryData(\n      Buffer.from(cleanedFile, 'utf-8'),\n      outputFileName,\n      'text/plain'\n    )\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1584,1232],"id":"462d5021-5df6-412e-b230-53067f77fa5d","name":"remove bad rows1"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1776,1232],"id":"b0110db4-7b94-430c-abae-c4302c9ea7d2","name":"write csv file back1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = true;\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1968,1232],"id":"7bcc38ec-c48f-4126-8e36-31db05c7d5e6","name":"Set processed = True1"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[320,1232],"id":"02eea795-9549-4532-b571-f6e174aaf970","name":"Set processed = false2"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle/backup/","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"={{ $('download csv files').item.json.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2176,1232],"id":"2d258933-7e3b-4582-a555-b712004ae3c9","name":"set folder and filename for Takle3"},{"parameters":{"protocol":"sftp","operation":"rename","oldPath":"={{ $('download csv files').item.json.path }}","newPath":"={{ $json.Folder }}{{ $json.fileName }}","options":{"createDirectories":false}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[2416,1232],"id":"3b1ca5a1-b27a-4e2b-888e-2836165a46de","name":"put orig csv into backups1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"set folder and filename for Takle2","type":"main","index":0}]]},"set folder and filename":{"main":[[{"node":"FTP","type":"main","index":0}]]},"check file exists":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Send success message","type":"main","index":0}],[{"node":"Send failure message","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"set folder and filename","type":"main","index":0},{"node":"set folder and filename1","type":"main","index":0}]]},"FTP":{"main":[[{"node":"check file exists","type":"main","index":0}]]},"set folder and filename1":{"main":[[{"node":"FTP1","type":"main","index":0}]]},"FTP1":{"main":[[{"node":"check file exists1","type":"main","index":0}]]},"check file exists1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Send failure message1","type":"main","index":0}],[{"node":"Send success message2","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"set folder and filename for Takle","type":"main","index":0}]]},"set folder and filename for Takle":{"main":[[{"node":"Set processed = false","type":"main","index":0}]]},"look for csv files":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"download csv files":{"main":[[{"node":"remove bad rows","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"check if a file was processed","type":"main","index":0}],[{"node":"if it is a csv file","type":"main","index":0}]]},"if it is a csv file":{"main":[[{"node":"download csv files","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"write csv file back":{"main":[[{"node":"Set processed = True","type":"main","index":0}]]},"remove bad rows":{"main":[[{"node":"write csv file back","type":"main","index":0}]]},"set folder and filename for Takle1":{"main":[[{"node":"put orig csv into backups","type":"main","index":0}]]},"put orig csv into backups":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Set processed = True":{"main":[[{"node":"set folder and filename for Takle1","type":"main","index":0}]]},"Set processed = false":{"main":[[{"node":"look for csv files","type":"main","index":0}]]},"Was file processed":{"main":[[{"node":"Send success message3","type":"main","index":0}]]},"check if a file was processed":{"main":[[{"node":"Was file processed","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Check security Key","type":"main","index":0}]]},"Check security Key":{"main":[[{"node":"send notification email","type":"main","index":0}]]},"send notification email":{"main":[[{"node":"set folder and filename for Takle","type":"main","index":0}]]},"Send failure message":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Send success message":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Send failure message1":{"main":[[{"node":"Append row in sheet1","type":"main","index":0}]]},"Send success message2":{"main":[[{"node":"Append row in sheet1","type":"main","index":0}]]},"Send success message3":{"main":[[{"node":"Append row in sheet2","type":"main","index":0}]]},"set folder and filename for Takle2":{"main":[[{"node":"Set processed = false1","type":"main","index":0}]]},"Set processed = false1":{"main":[[{"node":"look for docx file","type":"main","index":0}]]},"look for docx file":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"if it is a docx file","type":"main","index":0}]]},"if it is a docx file":{"main":[[{"node":"set trigger file details","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"write trigger file","type":"main","index":0}]]},"set trigger file details":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"write trigger file":{"main":[[{"node":"set folder and filename for csv file","type":"main","index":0}]]},"Wait 1m":{"main":[[{"node":"look for Takle csv file","type":"main","index":0}]]},"Loop Over Items2":{"main":[[],[{"node":"Wait 1m","type":"main","index":0}]]},"set folder and filename for csv file":{"main":[[{"node":"Set processed = false2","type":"main","index":0}]]},"look for Takle csv file":{"main":[[{"node":"if it is a csv file1","type":"main","index":0}]]},"if it is a csv file1":{"main":[[{"node":"download csv files1","type":"main","index":0}],[{"node":"Loop Over Items2","type":"main","index":0}]]},"download csv files1":{"main":[[{"node":"remove bad rows1","type":"main","index":0}]]},"remove bad rows1":{"main":[[{"node":"write csv file back1","type":"main","index":0}]]},"write csv file back1":{"main":[[{"node":"Set processed = True1","type":"main","index":0}]]},"Set processed = false2":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"Set processed = True1":{"main":[[{"node":"set folder and filename for Takle3","type":"main","index":0}]]},"set folder and filename for Takle3":{"main":[[{"node":"put orig csv into backups1","type":"main","index":0}]]},"put orig csv into backups1":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Schedule Trigger1":{"recurrenceRules":[]},"global":{"fileProcessed":false}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"set folder and filename for csv file":[{"json":{"Folder":"/iguana/inbound/takle","fileName":"*.csv"},"pairedItem":{"item":0}}]},"versionId":"b531aac5-dcaa-4652-b9e5-87bc51296b2f","activeVersionId":"b531aac5-dcaa-4652-b9e5-87bc51296b2f","triggerCount":3,"shared":[{"updatedAt":"2025-12-05T23:52:17.169Z","createdAt":"2025-12-05T23:52:17.169Z","role":"workflow:owner","workflowId":"cvpE7tqXN33oVOMh","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2026-01-11T18:25:22.000Z","createdAt":"2026-01-10T04:45:47.028Z","versionId":"b531aac5-dcaa-4652-b9e5-87bc51296b2f","workflowId":"cvpE7tqXN33oVOMh","nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1936,1232],"id":"7d1c9ac8-5a88-4318-ba10-6d2d9014911e","name":"When clicking ‘Execute workflow’"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/filewatcherlogs","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=MEDHOST_{{ $now.toUTC().format(\"yyyyMMdd\")}}.log","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1248,144],"id":"b06dbecf-7f6e-4ba8-9851-02716d59ca89","name":"set folder and filename"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"OpNotes Log file exists","message":"The Anescan Bitvise File Watcher Service appears to be working - there is a Medhost file","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,32],"id":"8a1733e1-998d-4646-b288-f6e1de6b82e4","name":"Send success message","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Log file does not exist","message":"=There is no file for {{ $node[\"set folder and filename\"].json.fileName }}.\nCheck the Anescan Bitvise File Watcher Service is running correctly.\n","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-320,240],"id":"95aca548-2485-4481-a6bd-0d9797536ae1","name":"Send failure message","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"const expected = $node[\"set folder and filename\"].json.fileName;\n\nlet found = false;\nfor (const item of items) {\n  if (item.json.name === expected) {\n    found = true;\n    break;\n  }\n}\n\nreturn [{\n  json: {\n    expected,\n    fileFound: found,\n  },\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-784,144],"id":"be3f604f-f068-4e65-998f-b74784f2fa05","name":"check file exists"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fabbcdf3-1976-4e6a-9033-a39b1fe17222","leftValue":"={{ $json.fileFound }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-560,144],"id":"43e119a7-fb1b-464c-a6c6-52cfe84e4f4c","name":"If"},{"parameters":{"rule":{"interval":[{"triggerAtHour":5,"triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[-1600,144],"id":"5c3f6d3b-24d8-46d7-a37a-a93055ae9ed7","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/meditechfolder","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.pdf","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1232,448],"id":"1e4cbe6f-37e9-4968-9b21-6a8bbfc2dd59","name":"set folder and filename1"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1024,144],"id":"0438a27a-4301-44e0-920a-48201bd294ae","name":"FTP","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1008,448],"id":"a1e65efd-eb80-4535-9985-0bd4bafaf14f","name":"FTP1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"// Expected pattern (e.g., \"*.pdf\")\nconst expected = \"*.pdf\";\n\n// Items from FTP node\nconst ftpItems = items;\n\nlet found = false;\n\nfor (const item of ftpItems) {\n\tconst name = item.json.name || \"\";\n\n\t// Match \"*.pdf\" → endsWith(\".pdf\")\n\tif (expected === \"*.pdf\" && name.toLowerCase().endsWith(\".pdf\")) {\n\t\tfound = true;\n\t\tbreak;\n\t}\n\n\t// If you later want wildcard support, add more logic here\n}\n\nreturn [\n\t{\n\t\tjson: {\n\t\t\texpected,\n\t\t\tfileFound: found,\n\t\t},\n\t},\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,448],"id":"807ecab9-79e0-4ea6-bb6a-857db062b350","name":"check file exists1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fabbcdf3-1976-4e6a-9033-a39b1fe17222","leftValue":"={{ $json.fileFound }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-544,448],"id":"11f7cf7f-5a93-44ac-b3d0-32fc3fce9f70","name":"If1"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"*** Scotland County PDFs are still in the folder","message":"=There is still a pdf file in the Meditech Scotland County folder - something failed to move it.","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-272,432],"id":"26ae3d76-5e2a-4347-9ba6-81c37f2dfe93","name":"Send failure message1","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Scotland County folder has no PDFs - all good","message":"=The Scotland County pdfs have been transferred - all is working as planned.","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-64,464],"id":"2caec426-0c70-468b-92a9-10917c60de56","name":"Send success message2","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"disabled":true},{"parameters":{"rule":{"interval":[{"field":"hours","triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[-1568,720],"id":"1341919d-05d3-46d1-a798-1f4143c9c2f6","name":"Schedule Trigger1"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.csv","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,816],"id":"01c005c5-cae7-473a-892d-c5dd6662552e","name":"set folder and filename for Takle"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-672,816],"id":"d069e30d-a0d3-4897-8adb-27c8e2231f97","name":"look for csv files","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"protocol":"sftp","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[256,816],"id":"916d0e90-cc92-4d3a-b09e-d9726bedd946","name":"download csv files","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-496,816],"id":"3d17512a-cb02-4286-9d73-6c49becabbfb","name":"Loop Over Items"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".csv","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[48,832],"id":"47215d50-cf17-49ca-a44e-1b1716c189da","name":"if it is a csv file"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[736,816],"id":"90e58bd5-349e-4b7b-bd79-259e2750706d","name":"write csv file back","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Takle file has been reviewed ","message":"=The automation read a Takle file and scanned the DOBs and wrote the file back to the Server","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[464,656],"id":"c92cc5a6-7600-4feb-b99c-b7d73674345e","name":"Send success message3","webhookId":"b1cd9bd6-6de8-4e67-89bd-730f67af2964","executeOnce":true,"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"jsCode":"// Get binary data using n8n's helper\nconst binaryData = await this.helpers.getBinaryDataBuffer(0, 'data');\nconst fileContent = binaryData.toString('utf-8');\n\n// Get input filename and convert to YYYYMMDD format\nconst inputFileName = $input.first().binary.data.fileName;\nconst datePart = inputFileName.replace('.csv', '');\nconst [month, day, year] = datePart.split('-');\nconst fullYear = year.length === 2 ? '20' + year : year;\nconst outputFileName = `${fullYear}${month}${day}.dat`;\n\n// Get the original folder path from the SFTP download node\nconst originalPath = $('download csv files').first().json.path;\nconst folderPath = originalPath.substring(0, originalPath.lastIndexOf('/') + 1);\nconst destinationPath = folderPath + outputFileName;\n\n// Split into lines\nconst lines = fileContent.split('\\n');\n\n// Keep the header row\nconst header = lines[0];\n\n// Process data rows (skip header)\nconst validLines = lines.slice(1).filter(line => {\n  if (!line.trim()) return false;\n  \n  const columns = line.split('|');\n  const dob = columns[5];\n  \n  return isValidDate(dob);\n});\n\nfunction isValidDate(dateString) {\n  if (!dateString || !dateString.trim()) return false;\n  \n  const parts = dateString.split('-');\n  if (parts.length !== 3) return false;\n  \n  const month = parseInt(parts[0], 10);\n  const day = parseInt(parts[1], 10);\n  const year = parseInt(parts[2], 10);\n  \n  if (isNaN(month) || isNaN(day) || isNaN(year)) return false;\n  if (month < 1 || month > 12) return false;\n  if (day < 1 || day > 31) return false;\n  if (year < 1900 || year > 2100) return false;\n  \n  const date = new Date(year, month - 1, day);\n  return date.getFullYear() === year && \n         date.getMonth() === month - 1 && \n         date.getDate() === day;\n}\n\n// Reconstruct the cleaned file\nconst cleanedFile = [header, ...validLines].join('\\n');\n\n// Return with path in JSON for the FTP node\nreturn [{\n  json: {\n    path: destinationPath\n  },\n  binary: {\n    data: await this.helpers.prepareBinaryData(\n      Buffer.from(cleanedFile, 'utf-8'),\n      outputFileName,\n      'text/plain'\n    )\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[496,816],"id":"126da9d1-0e18-49d0-8338-5ca61205dc61","name":"remove bad rows"},{"parameters":{"protocol":"sftp","operation":"rename","oldPath":"={{ $('download csv files').item.json.path }}","newPath":"={{ $json.Folder }}{{ $json.fileName }}","options":{"createDirectories":false}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1744,816],"id":"08b9363e-1704-4801-aa1f-63d182da8bab","name":"put orig csv into backups","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle/backup/","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"={{ $('download csv files').item.json.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1312,816],"id":"b423bcbb-b436-4c4c-b9ed-3b921ec131af","name":"set folder and filename for Takle1"},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = true;\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[944,816],"id":"62516a4a-b778-4b20-bf8f-5a77c82d4038","name":"Set processed = True"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-912,816],"id":"77c13297-dd6c-4eb7-86ba-57e85b04d9a4","name":"Set processed = false"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"070f0b93-6a5d-447a-b2ce-e3c6a06c2d7c","leftValue":"={{ $json.fileProcessed === true }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[96,672],"id":"06b9db00-1e17-42d2-bc5b-754b16ad1642","name":"Was file processed"},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\n\nreturn [{\n  json: {\n    fileProcessed: staticData.fileProcessed || false\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-224,672],"id":"d7effd13-f73a-4469-becd-5dd7c30a4ee0","name":"check if a file was processed"},{"parameters":{"path":"Takle-automation-workflow","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1936,976],"id":"85f06141-9797-4147-be7c-45da93ab0d84","name":"Webhook","webhookId":"ac180090-0dc7-4f0f-8bae-ed223a5a75a1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"0b3149ef-a405-4f70-bed4-10ca0533ccee","leftValue":"={{ $json.query.key }}","rightValue":"KJd93k2Lm","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1680,976],"id":"15278893-ee94-41d5-8189-b9ef37811a05","name":"Check security Key"},{"parameters":{"sendTo":"Chris@hallowes.com, danderson@anescan.com","subject":"Takle automation manually started","message":"={{ $('Webhook').item.json.query.user }} started the Takle n8n autmation via a web browser.","options":{"appendAttribution":true}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[-1424,880],"id":"19aa2c3e-757c-406e-ac7e-8ccf45f3bac0","name":"send notification email","webhookId":"fc3199f1-5bf5-4620-8e64-e768b9040fa9","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"   MEDHOST","height":224,"width":288},"type":"n8n-nodes-base.stickyNote","position":[-1680,128],"typeVersion":1,"id":"61614188-5756-4bbe-9010-bcad9d41008d","name":"Sticky Note"},{"parameters":{"content":"  Scotland Counuty","height":224,"width":288},"type":"n8n-nodes-base.stickyNote","position":[-1680,416],"typeVersion":1,"id":"81e598ea-c236-49b5-9e77-2b4d624adee3","name":"Sticky Note1"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran MEDHOST checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[16,160],"id":"3ccfbc65-ca5a-4f10-bde7-9ab045077d86","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran Scotland County checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[256,432],"id":"07159d1e-46fd-4c87-a27b-dd89566eeaba","name":"Append row in sheet1","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Actions":"=Ran TAKLE checker workflow"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[768,656],"id":"08c02b11-027c-4b37-822c-dd2aa1b001e3","name":"Append row in sheet2","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=  *.docx","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1680,1232],"id":"31b2adaf-7e9c-4083-9385-f2036da9844a","name":"set folder and filename for Takle2"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.DOCXfileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1392,1232],"id":"f2186f02-dada-463e-ab32-bc46eb8742a4","name":"Set processed = false1"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-1152,1232],"id":"bb210954-c6b4-4f44-9a0d-d71b03e7987f","name":"look for docx file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-928,1232],"id":"2e5792e5-fcb2-4cd7-8287-c83119050332","name":"Loop Over Items1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".docx","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-688,1248],"id":"17c0c26e-4bd5-4040-8c6f-b10ba37dd19f","name":"if it is a docx file"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $('set trigger file details').item.json.remoteDir }}/{{$binary.data.fileName}}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[-64,1232],"id":"096eff7d-2321-48a9-8f08-e250353468b6","name":"write trigger file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"operation":"toText","sourceProperty":"fileText","options":{"encoding":"ascii","fileName":"={{ $json.fileName }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-288,1232],"id":"3ab700ff-66f0-4908-ae75-a4d5913e52fe","name":"Convert to File"},{"parameters":{"assignments":{"assignments":[{"id":"6f058606-1f20-482d-a714-75cc58271443","name":"fileName","value":"=run_takle_{{$now.toFormat(\"yyyyLLdd_HHmmss\")}}.trigger","type":"string"},{"id":"6bc53943-2d51-49c9-895b-867d26f7e900","name":"fileText","value":"=job=takleConverter;ts={{$now}} }}","type":"string"},{"id":"8aa3c1fc-a9a5-4d97-a0ae-65089cd9ae8e","name":"remoteDir","value":"/iguana/inbound/takle/_signals","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-496,1232],"id":"017a6466-d68f-4d0b-b0ab-f16b1471a3ef","name":"set trigger file details"},{"parameters":{"amount":60},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[800,1248],"id":"22f860f4-7672-47d4-bd13-3e9842ea801c","name":"Wait 1m","webhookId":"5d5601d8-259c-4597-9f94-c844a5b8df83"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[544,1232],"id":"96ec6924-c23c-4275-b7e1-3081e77d49f3","name":"Loop Over Items2"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"=*.csv","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[112,1232],"id":"4bc6dc71-9deb-4c6b-b711-5788c94f2ffe","name":"set folder and filename for csv file"},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.Folder }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[976,1248],"id":"207e01c8-9099-4730-9960-5610915b321f","name":"look for Takle csv file","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"c227c8e2-e926-47b5-a3b9-07e99ebd73db","leftValue":"={{ $json.name }}","rightValue":".csv","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1184,1248],"id":"d7bc3677-1c01-4106-903d-ec3f80794a07","name":"if it is a csv file1"},{"parameters":{"protocol":"sftp","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1392,1232],"id":"1d2edc02-7295-4b5e-96ef-8579d1e00f71","name":"download csv files1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"// Get binary data using n8n's helper\nconst binaryData = await this.helpers.getBinaryDataBuffer(0, 'data');\nconst fileContent = binaryData.toString('utf-8');\n\n// Get input filename and convert to YYYYMMDD format\nconst inputFileName = $input.first().binary.data.fileName;\nconst datePart = inputFileName.replace('.csv', '');\nconst [month, day, year] = datePart.split('-');\nconst fullYear = year.length === 2 ? '20' + year : year;\nconst outputFileName = `${fullYear}${month}${day}.dat`;\n\n// Get the original folder path from the SFTP download node\nconst originalPath = $('download csv files').first().json.path;\nconst folderPath = originalPath.substring(0, originalPath.lastIndexOf('/') + 1);\nconst destinationPath = folderPath + outputFileName;\n\n// Split into lines\nconst lines = fileContent.split('\\n');\n\n// Keep the header row\nconst header = lines[0];\n\n// Process data rows (skip header)\nconst validLines = lines.slice(1).filter(line => {\n  if (!line.trim()) return false;\n  \n  const columns = line.split('|');\n  const dob = columns[5];\n  \n  return isValidDate(dob);\n});\n\nfunction isValidDate(dateString) {\n  if (!dateString || !dateString.trim()) return false;\n  \n  const parts = dateString.split('-');\n  if (parts.length !== 3) return false;\n  \n  const month = parseInt(parts[0], 10);\n  const day = parseInt(parts[1], 10);\n  const year = parseInt(parts[2], 10);\n  \n  if (isNaN(month) || isNaN(day) || isNaN(year)) return false;\n  if (month < 1 || month > 12) return false;\n  if (day < 1 || day > 31) return false;\n  if (year < 1900 || year > 2100) return false;\n  \n  const date = new Date(year, month - 1, day);\n  return date.getFullYear() === year && \n         date.getMonth() === month - 1 && \n         date.getDate() === day;\n}\n\n// Reconstruct the cleaned file\nconst cleanedFile = [header, ...validLines].join('\\n');\n\n// Return with path in JSON for the FTP node\nreturn [{\n  json: {\n    path: destinationPath\n  },\n  binary: {\n    data: await this.helpers.prepareBinaryData(\n      Buffer.from(cleanedFile, 'utf-8'),\n      outputFileName,\n      'text/plain'\n    )\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1584,1232],"id":"462d5021-5df6-412e-b230-53067f77fa5d","name":"remove bad rows1"},{"parameters":{"protocol":"sftp","operation":"upload","path":"={{ $json.path }}","options":{}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1776,1232],"id":"b0110db4-7b94-430c-abae-c4302c9ea7d2","name":"write csv file back1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}},{"parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = true;\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1968,1232],"id":"7bcc38ec-c48f-4126-8e36-31db05c7d5e6","name":"Set processed = True1"},{"parameters":{"jsCode":"// Initialise the flag\nconst staticData = $getWorkflowStaticData('global');\nstaticData.fileProcessed = false;\n\n// Pass through the input data unchanged\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[320,1232],"id":"02eea795-9549-4532-b571-f6e174aaf970","name":"Set processed = false2"},{"parameters":{"assignments":{"assignments":[{"id":"cb2b9510-4a89-4705-872e-5a15a279a773","name":"Folder","value":"/iguana/inbound/takle/backup/","type":"string"},{"id":"c86e3f07-a290-4455-bfd4-d1a3fa5194c7","name":"fileName","value":"={{ $('download csv files').item.json.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2176,1232],"id":"2d258933-7e3b-4582-a555-b712004ae3c9","name":"set folder and filename for Takle3"},{"parameters":{"protocol":"sftp","operation":"rename","oldPath":"={{ $('download csv files').item.json.path }}","newPath":"={{ $json.Folder }}{{ $json.fileName }}","options":{"createDirectories":false}},"type":"n8n-nodes-base.ftp","typeVersion":1,"position":[2416,1232],"id":"3b1ca5a1-b27a-4e2b-888e-2836165a46de","name":"put orig csv into backups1","alwaysOutputData":true,"credentials":{"sftp":{"id":"g6K8GUTNxq7RIZ6Z","name":"FTP account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"set folder and filename for Takle2","type":"main","index":0}]]},"set folder and filename":{"main":[[{"node":"FTP","type":"main","index":0}]]},"check file exists":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Send success message","type":"main","index":0}],[{"node":"Send failure message","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"set folder and filename","type":"main","index":0},{"node":"set folder and filename1","type":"main","index":0}]]},"FTP":{"main":[[{"node":"check file exists","type":"main","index":0}]]},"set folder and filename1":{"main":[[{"node":"FTP1","type":"main","index":0}]]},"FTP1":{"main":[[{"node":"check file exists1","type":"main","index":0}]]},"check file exists1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Send failure message1","type":"main","index":0}],[{"node":"Send success message2","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"set folder and filename for Takle","type":"main","index":0}]]},"set folder and filename for Takle":{"main":[[{"node":"Set processed = false","type":"main","index":0}]]},"look for csv files":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"download csv files":{"main":[[{"node":"remove bad rows","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"check if a file was processed","type":"main","index":0}],[{"node":"if it is a csv file","type":"main","index":0}]]},"if it is a csv file":{"main":[[{"node":"download csv files","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"write csv file back":{"main":[[{"node":"Set processed = True","type":"main","index":0}]]},"remove bad rows":{"main":[[{"node":"write csv file back","type":"main","index":0}]]},"set folder and filename for Takle1":{"main":[[{"node":"put orig csv into backups","type":"main","index":0}]]},"put orig csv into backups":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Set processed = True":{"main":[[{"node":"set folder and filename for Takle1","type":"main","index":0}]]},"Set processed = false":{"main":[[{"node":"look for csv files","type":"main","index":0}]]},"Was file processed":{"main":[[{"node":"Send success message3","type":"main","index":0}]]},"check if a file was processed":{"main":[[{"node":"Was file processed","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Check security Key","type":"main","index":0}]]},"Check security Key":{"main":[[{"node":"send notification email","type":"main","index":0}]]},"send notification email":{"main":[[{"node":"set folder and filename for Takle","type":"main","index":0}]]},"Send failure message":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Send success message":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Send failure message1":{"main":[[{"node":"Append row in sheet1","type":"main","index":0}]]},"Send success message2":{"main":[[{"node":"Append row in sheet1","type":"main","index":0}]]},"Send success message3":{"main":[[{"node":"Append row in sheet2","type":"main","index":0}]]},"set folder and filename for Takle2":{"main":[[{"node":"Set processed = false1","type":"main","index":0}]]},"Set processed = false1":{"main":[[{"node":"look for docx file","type":"main","index":0}]]},"look for docx file":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"if it is a docx file","type":"main","index":0}]]},"if it is a docx file":{"main":[[{"node":"set trigger file details","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"write trigger file","type":"main","index":0}]]},"set trigger file details":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"write trigger file":{"main":[[{"node":"set folder and filename for csv file","type":"main","index":0}]]},"Wait 1m":{"main":[[{"node":"look for Takle csv file","type":"main","index":0}]]},"Loop Over Items2":{"main":[[],[{"node":"Wait 1m","type":"main","index":0}]]},"set folder and filename for csv file":{"main":[[{"node":"Set processed = false2","type":"main","index":0}]]},"look for Takle csv file":{"main":[[{"node":"if it is a csv file1","type":"main","index":0}]]},"if it is a csv file1":{"main":[[{"node":"download csv files1","type":"main","index":0}],[{"node":"Loop Over Items2","type":"main","index":0}]]},"download csv files1":{"main":[[{"node":"remove bad rows1","type":"main","index":0}]]},"remove bad rows1":{"main":[[{"node":"write csv file back1","type":"main","index":0}]]},"write csv file back1":{"main":[[{"node":"Set processed = True1","type":"main","index":0}]]},"Set processed = false2":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"Set processed = True1":{"main":[[{"node":"set folder and filename for Takle3","type":"main","index":0}]]},"set folder and filename for Takle3":{"main":[[{"node":"put orig csv into backups1","type":"main","index":0}]]},"put orig csv into backups1":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":"Version b531aac5","description":"","autosaved":false},"tags":[]},{"updatedAt":"2026-01-06T03:34:01.689Z","createdAt":"2026-01-04T22:55:57.955Z","id":"hmJ2M52OQPefBB2F","name":"Analyse Legal Contracts","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"63e6d488-872a-4409-b6fd-403c530c04fa","name":"Manual Trigger","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-656,64],"notes":"Start contract analysis"},{"parameters":{"operation":"download","fileId":"={{ $json.fileId }}","options":{}},"id":"7e09c3bd-34a3-4a88-abf9-cb1803bc8034","name":"Get Contract from Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-464,64],"notes":"Download contract PDF from Google Drive"},{"parameters":{"resource":"document","operation":"extract"},"id":"a1abe9f6-af09-48da-8705-bd0ba29e09bf","name":"PDF Vector - Extract Contract","type":"n8n-nodes-preview-pdfvector.pdfVector","typeVersion":1,"position":[-224,-176],"notes":"Extract contract details"},{"parameters":{"resource":"document","operation":"ask"},"id":"58f38de6-264e-43b6-bb91-2b8bb85c3622","name":"PDF Vector - Risk Analysis","type":"n8n-nodes-preview-pdfvector.pdfVector","typeVersion":1,"position":[-256,160],"notes":"Analyze contract risks"},{"parameters":{},"id":"23db9341-fbe7-474c-9964-ce7333399047","name":"Merge Results","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-64,64],"notes":"Combine both analyses"},{"parameters":{"jsCode":"// Get all input items from the merged data\nconst items = $input.all();\n\n// Initialize variables to store data from both PDF Vector nodes\nlet contractData = null;\nlet riskAnalysis = null;\n\n// Process each item to find the extraction and risk analysis results\nitems.forEach(item => {\n  // Check if this item contains extraction data (has 'data' property)\n  if (item.json && item.json.data) {\n    contractData = item.json.data;\n  }\n  \n  // Check if this item contains risk analysis (has 'answer' property)\n  if (item.json && item.json.answer) {\n    riskAnalysis = item.json.answer;\n  }\n});\n\n// Validate that we received contract data\nif (!contractData) {\n  throw new Error('Contract extraction data not found. Ensure PDF Vector - Extract Contract node is working correctly.');\n}\n\n// Risk analysis is optional - set default if not found\nif (!riskAnalysis) {\n  riskAnalysis = \"Risk analysis not available - manual review recommended.\";\n}\n\n// Calculate contract duration and dates\nconst today = new Date();\nlet effectiveDate = null;\nlet expirationDate = null;\nlet daysUntilExpiration = null;\nlet contractDuration = null;\n\n// Safely parse dates\ntry {\n  if (contractData.effectiveDate) {\n    effectiveDate = new Date(contractData.effectiveDate);\n  }\n  if (contractData.expirationDate) {\n    expirationDate = new Date(contractData.expirationDate);\n  }\n  \n  if (expirationDate && effectiveDate) {\n    // Calculate days until expiration from today\n    daysUntilExpiration = Math.floor((expirationDate - today) / (1000 * 60 * 60 * 24));\n    // Calculate total contract duration\n    contractDuration = Math.floor((expirationDate - effectiveDate) / (1000 * 60 * 60 * 24));\n  }\n} catch (error) {\n  console.error('Error parsing dates:', error);\n}\n\n// Process deliverables and create timeline\nconst upcomingDeliverables = [];\nconst overdueDeliverables = [];\n\nif (contractData.deliverables && Array.isArray(contractData.deliverables)) {\n  contractData.deliverables.forEach((deliverable, index) => {\n    try {\n      if (deliverable.dueDate) {\n        const dueDate = new Date(deliverable.dueDate);\n        const daysUntilDue = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));\n        \n        const deliverableInfo = {\n          ...deliverable,\n          dueDate: dueDate.toISOString().split('T')[0],\n          daysUntilDue: daysUntilDue,\n          status: daysUntilDue < 0 ? 'Overdue' : daysUntilDue <= 7 ? 'Urgent' : daysUntilDue <= 30 ? 'Upcoming' : 'Future'\n        };\n        \n        if (daysUntilDue < 0) {\n          overdueDeliverables.push(deliverableInfo);\n        } else {\n          upcomingDeliverables.push(deliverableInfo);\n        }\n      }\n    } catch (error) {\n      console.error(`Error processing deliverable ${index}:`, error);\n    }\n  });\n}\n\n// Sort deliverables by due date\nupcomingDeliverables.sort((a, b) => a.daysUntilDue - b.daysUntilDue);\noverdueDeliverables.sort((a, b) => b.daysUntilDue - a.daysUntilDue);\n\n// Process obligations\nconst obligationsByParty = {};\nif (contractData.obligations && Array.isArray(contractData.obligations)) {\n  contractData.obligations.forEach(obligation => {\n    const party = obligation.party || 'Unknown Party';\n    if (!obligationsByParty[party]) {\n      obligationsByParty[party] = [];\n    }\n    obligationsByParty[party].push(obligation);\n  });\n}\n\n// Create compliance checklist\nconst complianceChecklist = [];\n\n// Check parties\ncomplianceChecklist.push({\n  item: 'Parties Identification',\n  status: contractData.parties && contractData.parties.length >= 2 ? 'Complete' : 'Missing',\n  details: contractData.parties ? `${contractData.parties.length} parties identified` : 'No parties found',\n  required: true,\n  severity: 'Critical'\n});\n\n// Check payment terms\ncomplianceChecklist.push({\n  item: 'Payment Terms',\n  status: contractData.paymentTerms && contractData.paymentTerms.amount ? 'Complete' : 'Missing',\n  details: contractData.paymentTerms?.amount ? `Amount: ${contractData.paymentTerms.amount}` : 'Payment amount not specified',\n  required: true,\n  severity: 'High'\n});\n\n// Check dates\ncomplianceChecklist.push({\n  item: 'Contract Duration',\n  status: effectiveDate && expirationDate ? 'Complete' : 'Missing',\n  details: effectiveDate && expirationDate ? `${contractDuration} days (${contractData.effectiveDate} to ${contractData.expirationDate})` : 'Contract dates not specified',\n  required: true,\n  severity: 'High'\n});\n\n// Check termination clauses\ncomplianceChecklist.push({\n  item: 'Termination Clauses',\n  status: contractData.terminationClauses && contractData.terminationClauses.length > 0 ? 'Complete' : 'Missing',\n  details: contractData.terminationClauses ? `${contractData.terminationClauses.length} termination clauses found` : 'No termination clauses',\n  required: true,\n  severity: 'High'\n});\n\n// Check governing law\ncomplianceChecklist.push({\n  item: 'Governing Law',\n  status: contractData.governingLaw ? 'Complete' : 'Missing',\n  details: contractData.governingLaw || 'Governing law not specified',\n  required: true,\n  severity: 'Medium'\n});\n\n// Check dispute resolution\ncomplianceChecklist.push({\n  item: 'Dispute Resolution',\n  status: contractData.disputeResolution ? 'Complete' : 'Missing',\n  details: contractData.disputeResolution || 'Dispute resolution not specified',\n  required: false,\n  severity: 'Low'\n});\n\n// Calculate compliance score\nconst totalRequired = complianceChecklist.filter(item => item.required).length;\nconst completedRequired = complianceChecklist.filter(item => item.required && item.status === 'Complete').length;\nconst complianceScore = totalRequired > 0 ? Math.round((completedRequired / totalRequired) * 100) : 0;\n\n// Create contract value analysis\nlet contractValue = null;\nlet contractValueNumeric = null;\nif (contractData.paymentTerms && contractData.paymentTerms.amount) {\n  contractValue = contractData.paymentTerms.amount;\n  // Try to extract numeric value for analysis\n  const numericMatch = contractValue.match(/[\\d,]+\\.?\\d*/g);\n  if (numericMatch) {\n    contractValueNumeric = parseFloat(numericMatch[0].replace(/,/g, ''));\n  }\n}\n\n// Determine contract risk level based on multiple factors\nlet riskScore = 0;\nconst riskFactors = [];\n\n// Factor in compliance score\nif (complianceScore < 50) {\n  riskScore += 30;\n  riskFactors.push('Low compliance score');\n} else if (complianceScore < 75) {\n  riskScore += 15;\n  riskFactors.push('Moderate compliance score');\n}\n\n// Factor in missing critical items\nif (!contractData.parties || contractData.parties.length < 2) {\n  riskScore += 20;\n  riskFactors.push('Parties not properly identified');\n}\n\nif (!contractData.paymentTerms || !contractData.paymentTerms.amount) {\n  riskScore += 15;\n  riskFactors.push('Payment terms unclear');\n}\n\nif (!contractData.terminationClauses || contractData.terminationClauses.length === 0) {\n  riskScore += 10;\n  riskFactors.push('No termination clauses');\n}\n\n// Factor in expiration\nif (daysUntilExpiration !== null && daysUntilExpiration < 30) {\n  riskScore += 15;\n  riskFactors.push('Contract expiring soon');\n}\n\n// Factor in overdue deliverables\nif (overdueDeliverables.length > 0) {\n  riskScore += 10 * Math.min(overdueDeliverables.length, 3);\n  riskFactors.push(`${overdueDeliverables.length} overdue deliverables`);\n}\n\n// Determine overall risk level\nlet overallRiskLevel = 'Low';\nif (riskScore >= 50) {\n  overallRiskLevel = 'High';\n} else if (riskScore >= 25) {\n  overallRiskLevel = 'Medium';\n}\n\n// Create summary statistics\nconst summaryStats = {\n  totalParties: contractData.parties ? contractData.parties.length : 0,\n  totalDeliverables: contractData.deliverables ? contractData.deliverables.length : 0,\n  upcomingDeliverables: upcomingDeliverables.length,\n  overdueDeliverables: overdueDeliverables.length,\n  totalObligations: contractData.obligations ? contractData.obligations.length : 0,\n  totalPenalties: contractData.penalties ? contractData.penalties.length : 0,\n  totalWarranties: contractData.warranties ? contractData.warranties.length : 0,\n  complianceScore: complianceScore,\n  riskScore: riskScore,\n  overallRiskLevel: overallRiskLevel\n};\n\n// Compile final analysis report\nconst analysisReport = {\n  // Contract identification\n  contractInfo: {\n    title: contractData.contractTitle || 'Untitled Contract',\n    type: contractData.contractType || 'Not specified',\n    effectiveDate: contractData.effectiveDate || null,\n    expirationDate: contractData.expirationDate || null,\n    daysUntilExpiration: daysUntilExpiration,\n    contractDuration: contractDuration,\n    governingLaw: contractData.governingLaw || 'Not specified',\n    disputeResolution: contractData.disputeResolution || 'Not specified'\n  },\n  \n  // Parties information\n  parties: contractData.parties || [],\n  \n  // Financial terms\n  financialTerms: {\n    contractValue: contractValue,\n    contractValueNumeric: contractValueNumeric,\n    paymentSchedule: contractData.paymentTerms?.schedule || 'Not specified',\n    currency: contractData.paymentTerms?.currency || 'Not specified',\n    lateFees: contractData.paymentTerms?.lateFees || 'Not specified'\n  },\n  \n  // Deliverables analysis\n  deliverables: {\n    total: contractData.deliverables ? contractData.deliverables.length : 0,\n    upcoming: upcomingDeliverables,\n    overdue: overdueDeliverables\n  },\n  \n  // Obligations by party\n  obligations: obligationsByParty,\n  \n  // Penalties and warranties\n  penalties: contractData.penalties || [],\n  warranties: contractData.warranties || [],\n  terminationClauses: contractData.terminationClauses || [],\n  \n  // Risk assessment\n  riskAssessment: {\n    aiAnalysis: riskAnalysis,\n    calculatedRiskLevel: overallRiskLevel,\n    riskScore: riskScore,\n    riskFactors: riskFactors\n  },\n  \n  // Compliance analysis\n  compliance: {\n    checklist: complianceChecklist,\n    score: complianceScore,\n    missingCriticalItems: complianceChecklist.filter(item => item.required && item.status === 'Missing').map(item => item.item)\n  },\n  \n  // Summary\n  summary: {\n    statistics: summaryStats,\n    recommendations: []\n  },\n  \n  // Metadata\n  metadata: {\n    analysisDate: new Date().toISOString(),\n    analysisVersion: '1.0',\n    extractedData: contractData\n  }\n};\n\n// Add recommendations based on analysis\nif (complianceScore < 75) {\n  analysisReport.summary.recommendations.push('Complete missing compliance items before contract execution');\n}\n\nif (overdueDeliverables.length > 0) {\n  analysisReport.summary.recommendations.push('Urgent: Address overdue deliverables immediately');\n}\n\nif (daysUntilExpiration !== null && daysUntilExpiration < 60) {\n  analysisReport.summary.recommendations.push('Begin contract renewal negotiations');\n}\n\nif (!contractData.disputeResolution) {\n  analysisReport.summary.recommendations.push('Consider adding dispute resolution clause');\n}\n\nif (overallRiskLevel === 'High') {\n  analysisReport.summary.recommendations.push('Legal review strongly recommended before proceeding');\n}\n\n// Return the analysis report as a single item\nreturn [{ json: analysisReport }];"},"id":"c15cf2b0-0f91-4eb0-9518-61d3ef0c2397","name":"Generate Analysis Report","type":"n8n-nodes-base.code","typeVersion":2,"position":[144,64],"notes":"Create comprehensive analysis"},{"parameters":{"options":{}},"id":"25a61624-842a-494a-aadb-49c6311278ee","name":"Save Analysis Report","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[352,64],"notes":"Output final report"},{"parameters":{"resource":"document"},"type":"n8n-nodes-pdfvector.pdfVector","typeVersion":1,"position":[0,-176],"id":"ceac15a6-b685-4e6e-b39c-0ea4e966a61e","name":"Parse a document"}],"connections":{"Manual Trigger":{"main":[[{"node":"Get Contract from Google Drive","type":"main","index":0}]]},"Get Contract from Google Drive":{"main":[[{"node":"PDF Vector - Extract Contract","type":"main","index":0},{"node":"PDF Vector - Risk Analysis","type":"main","index":0}]]},"PDF Vector - Extract Contract":{"main":[[{"node":"Merge Results","type":"main","index":0}]]},"PDF Vector - Risk Analysis":{"main":[[{"node":"Merge Results","type":"main","index":1}]]},"Merge Results":{"main":[[{"node":"Generate Analysis Report","type":"main","index":0}]]},"Generate Analysis Report":{"main":[[{"node":"Save Analysis Report","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"f6a9ece2-b400-46f2-a112-a2d8fe19a11f","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-04T22:55:57.961Z","createdAt":"2026-01-04T22:55:57.961Z","role":"workflow:owner","workflowId":"hmJ2M52OQPefBB2F","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:38:25.000Z","createdAt":"2025-11-29T02:57:32.621Z","id":"i1vR0RV1ZM4rd9lb","name":"Error Logging workflow","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[0,0],"id":"a840f45a-c6e8-4fa5-beed-2d0a49bcf633","name":"Error Trigger"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Workflow automation error {{ $json.execution.error.message }}","emailType":"text","message":"=There was an error in the {{ $json.workflow.name }}. please check it out.\n\nThe execution URL was: {{ $json.execution.url }}\n\nThe error message is: {{ $json.execution.error.message }}\n","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[240,0],"id":"1150acd2-b5e6-4c1b-ac26-132b968ce0e1","name":"Gmail","webhookId":"1d62c36a-fb6b-409b-977a-a99bc53f1aab","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Error Trigger":{"main":[[{"node":"Gmail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"f191ce52-9419-409d-8e34-18f77d70076d","activeVersionId":"f191ce52-9419-409d-8e34-18f77d70076d","triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:57:32.623Z","createdAt":"2025-11-29T02:57:32.623Z","role":"workflow:owner","workflowId":"i1vR0RV1ZM4rd9lb","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":{"updatedAt":"2025-12-08T18:38:25.477Z","createdAt":"2025-12-08T18:38:25.477Z","versionId":"f191ce52-9419-409d-8e34-18f77d70076d","workflowId":"i1vR0RV1ZM4rd9lb","nodes":[{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[0,0],"id":"a840f45a-c6e8-4fa5-beed-2d0a49bcf633","name":"Error Trigger"},{"parameters":{"sendTo":"chris@hallowes.com","subject":"Workflow automation error {{ $json.execution.error.message }}","emailType":"text","message":"=There was an error in the {{ $json.workflow.name }}. please check it out.\n\nThe execution URL was: {{ $json.execution.url }}\n\nThe error message is: {{ $json.execution.error.message }}\n","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[240,0],"id":"1150acd2-b5e6-4c1b-ac26-132b968ce0e1","name":"Gmail","webhookId":"1d62c36a-fb6b-409b-977a-a99bc53f1aab","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}}],"connections":{"Error Trigger":{"main":[[{"node":"Gmail","type":"main","index":0}]]}},"authors":"Chris Hallowes","name":null,"description":null,"autosaved":false},"tags":[]},{"updatedAt":"2025-12-09T18:47:58.000Z","createdAt":"2025-11-29T03:12:00.771Z","id":"mgR2QgNtnkJSYzsV","name":"Agent Swarm","active":false,"isArchived":true,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"id":"c7969a8e-9c7e-45d4-a483-78ef2b7ad526","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[816,192],"webhookId":"99eab1a0-569d-4f0f-a49e-578a02abfe63","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"0cb5f0eb-e09a-4d85-8b2a-1d1ffa61359b","name":"Set 'Text'","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,208]},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}","additionalFields":{}},"id":"22804456-4996-478b-b9eb-816fa4ab92c2","name":"Download Voice File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1440,32],"webhookId":"c0b376b1-7b63-41b6-8063-0b3096b8333d","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"37a796f6-0536-45e1-957f-9cbac20ebb0c","name":"Transcribe Audio","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1600,32],"credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"a9ef689f-6dd2-4175-9823-b336d2e42192","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1264,192]},{"parameters":{"promptType":"define","text":"={{ $json.input }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails or creating summaries — your sole responsibility is to call the correct tool.\n\n## Tools\n- **Think**: Use this to think deeply or if you get stuck\n- **emailAgent**: Use this tool to take action in email\n- **calendarAgent**: Use this tool to take action in calendar\n- **contactAgent**: Use this tool to get, update, or add contacts\n- **contentCreator**: Use this tool to create blog posts\n- **webAgent**: Use this tool to perform deeper web research or get current weather info\n- **youtubeAgent**: Use this tool to find high-performing videos or manage video ideas\n\n## Rules\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the necessary tools based on the user's request\n2) Use the **Think** tool to verify you took the right steps. This tool should be called every time.\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave  \n  - Action: Use **contactAgent** to get Nate Herkelman's email  \n  - Action: Use **emailAgent** to send the email. You will pass the tool a query like:  \n    \"send Nate Herkelman an email to ask what time he wants to leave. here is his email: [email address]\"\n- Output: The email has been sent to Nate Herkelman. Anything else I can help you with?\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1936,192],"id":"d8b5b1f5-3bda-4e83-b35e-cfb53cc167fe","name":"AI Agent","onError":"continueErrorOutput"},{"parameters":{"sendTo":"={{ $fromAI(\"emailAddress\") }}","subject":"={{ $fromAI(\"subject\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,752],"id":"17bd26cf-46f3-423f-8564-5696c6a9a70e","name":"Send Email","webhookId":"86c8c4b1-13bb-4ebe-acb9-30e1d7082d55","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"getAll","limit":"={{ $fromAI(\"limit\",\"how many emails the user wants\") }}","simple":false,"filters":{"sender":"={{ $fromAI(\"sender\",\"who the emails are from\") }}"},"options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1392,752],"id":"fb5ac9ed-02f1-438b-b1de-7e6931a9c4a8","name":"Get Emails","webhookId":"af4b3298-9037-44b0-aa12-2acbfbb5e66f","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"draft","subject":"={{ $fromAI(\"subject\") }}","emailType":"html","message":"={{ $fromAI(\"emailBody\") }}","options":{"threadId":"={{ $fromAI(\"threadID\") }}","sendTo":"={{ $fromAI(\"emailAddress\") }}"}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1776,608],"id":"b128a80a-5db5-41e2-bb21-ed217b89f1fe","name":"Create Draft","webhookId":"17016bce-d7d7-428a-a56c-f6ea122db8be","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"reply","messageId":"={{ $fromAI(\"ID\",\"the message ID\") }}","message":"={{ $fromAI(\"emailBody\") }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,608],"id":"bd7d5a3c-067b-41c7-8151-17b5a7788a3e","name":"Email Reply","webhookId":"114785e6-a859-432b-81b4-c490c1c35b1c","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"resource":"label","returnAll":true},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1520,752],"id":"4b413055-e429-4107-9309-cfe5ee7c0ae4","name":"Get Labels","webhookId":"9e08b59e-792d-4566-83f1-9263c9ad86ae","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $fromAI(\"ID\",\"the ID of the message\") }}","labelIds":"={{ $fromAI(\"labelID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,608],"id":"7f052aa2-38e9-4126-9a2a-1ac265fcd74d","name":"Label Emails","webhookId":"0e951529-2e6d-40bf-ac40-fc0947e242e2","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"markAsUnread","messageId":"={{ $fromAI(\"messageID\") }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1648,752],"id":"5e54f170-1c67-4978-a68d-0298ac8a2845","name":"Mark Unread","webhookId":"a35af9d8-f67d-4ff9-803f-59ec6356e795","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"toolDescription":"An email agent for all email actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are an email management assistant. All emails must be formatted professionally in HTML and signed off as \"Nate.\" \n\n**Email Management Tools**   \n   - Use \"Send Email\" to send emails.  \n   - Use \"Create Draft\" if the user asks for a draft.  \n   - Use \"Get Emails\" to retrieve emails when requested.\n   - Use \"Get Labels\" to retrieve labels.\n   - Use \"Mark Unread\" to mark an email as unread. You must use \"Get Emails\" first so you have the message ID of the email to flag.\n   - Use \"Label Email\" to flag an email. You must use \"Get Emails\" first so you have the message ID of the email to flag. Then you must use \"Get Labels\" so you have the label ID.\n   - Use \"Email Reply\" to reply to an email. You must use \"Get Emails\" first so you have the message ID of the email to reply to.\n\n## Final Notes\n- Here is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1584,432],"id":"16fc4153-e8b8-4b98-858d-ac5a01b96b06","name":"Email Agent"},{"parameters":{"calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":["={{ $fromAI(\"eventAttendeeEmail\") }}"],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,752],"id":"66ed538a-328c-4c12-96d6-e7ec4b2606e2","name":"Create Event with Attendee","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"start":"={{ $fromAI(\"eventStart\") }}","end":"={{ $fromAI(\"eventEnd\") }}","additionalFields":{"attendees":[],"summary":"={{ $fromAI(\"eventTitle\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1920,752],"id":"cb60b3b7-d6e1-4cb5-ac6a-98bcb41168ee","name":"Create Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"timeMin":"={{ $fromAI(\"dayBefore\",\"the day before the date the user requested\") }}","timeMax":"={{ $fromAI(\"dayAfter\",\"the day after the date the user requested\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2176,608],"id":"288c8fff-b790-4d24-b82d-85bdf045e59e","name":"Get Events","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"eventId":"={{ $fromAI(\"eventID\") }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,608],"id":"1c10fb29-217f-4803-bf44-8ead089e006d","name":"Delete Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"nateherk88@gmail.com","mode":"list","cachedResultName":"nateherk88@gmail.com"},"eventId":"={{ $fromAI(\"eventID\") }}","updateFields":{"end":"={{ $fromAI(\"endTime\") }}","start":"={{ $fromAI(\"startTime\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2048,752],"id":"adc74d39-a0d1-420a-9beb-b28e4cd2cdf0","name":"Update Event","credentials":{"googleCalendarOAuth2Api":{"id":"alWsdtbT6IgAMOvJ","name":"Google Calendar account"}}},{"parameters":{"toolDescription":"A calendar agent for all calendar actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include creating, getting, and deleting events in the user's calendar.\n\n**Calendar Management Tools**  \n   - Use \"Create Event with Attendee\" when an event includes a participant.  \n   - Use \"Create Event\" for solo events.   \n   - Use \"Get Events\" to fetch calendar schedules when requested.\n   - Use \"Delete Event\" to delete an event. You must use \"Get Events\" first to get the ID of the event to delete.\n   - Use \"Update Event\" to update an event. You must use \"Get Events\" first to get the ID of the event to update.\n\n## Final Notes\nHere is the current date/time: {{ $now }}\nIf a duration for an event isn't specified, assume it will be one hour."}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1936,432],"id":"7d6dc503-bd59-478a-bd15-938ce96acb5e","name":"Calendar Agent"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2416,592],"id":"dcbe7e6d-a789-4c51-afbe-c049aa13bc0d","name":"Get Contacts","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"upsert","base":{"__rl":true,"value":"appopMalnveEkL132","mode":"list","cachedResultName":"CRM","cachedResultUrl":"https://airtable.com/appopMalnveEkL132"},"table":{"__rl":true,"value":"tblfLW9Qgl6DQQRZw","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appopMalnveEkL132/tblfLW9Qgl6DQQRZw"},"columns":{"mappingMode":"defineBelow","value":{"Business":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Business', ``, 'boolean') }}","id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'string') }}","Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","Company Name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company_Name', ``, 'string') }}","Phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}","Notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notes', ``, 'string') }}","Status":"Active"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Phone","displayName":"Phone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Inactive","value":"Inactive"},{"name":"Active","value":"Active"}],"readOnly":false,"removed":false},{"id":"Business","displayName":"Business","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"boolean","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[2528,592],"id":"888b61ac-2202-487a-a5dc-158d3821ff38","name":"Add or Update Contact","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"toolDescription":"Contact agent for all contact actions, like getting contacts","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a contact management assistant. Your responsibilities include looking up contacts, adding new contacts, or updating a contact's information.\n\n**Contact Management**  \n   - Use \"Get Contacts\" to retrieve contact information. \n   - Use \"Add or Update Contact\" to store new contact information or modify existing entries. "}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2288,432],"id":"b3e381c0-d7fc-4fc2-bc53-1b1f49d7d890","name":"Contact Agent"},{"parameters":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[2464,944],"id":"ec866204-ac65-48e7-bfe1-c51e7ba887ab","name":"Tavily","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}},{"parameters":{"messages":{"message":[{"content":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"}]},"options":{},"requestOptions":{}},"type":"n8n-nodes-base.perplexityTool","typeVersion":1,"position":[2592,944],"id":"43f81040-896c-4e50-9f69-a94fff5ca8ba","name":"Perplexity","credentials":{"perplexityApi":{"id":"Mr9UdvJJS7sjNHOf","name":"Perplexity account"}}},{"parameters":{"format":"imperial","cityName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}","language":"en"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[2736,928],"id":"26a62145-fc6f-4bf6-afee-30a8b33d955b","name":"OpenWeatherMap","disabled":true},{"parameters":{"toolDescription":"A research agent for all research actions","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a web research assistant. Your responsibilities include conducting quick web searches, performing deeper research, and retrieving current weather information. \n\n**Web Search & Research**  \n   - Use **Tavily** for quick factual lookups, recent news, or verifying specific pieces of information.  \n   - Use **Perplexity** when a question requires deeper research, multiple perspectives, or synthesized answers from various sources.  \n\n**Weather Information**  \n   - Use **Open Weather Map** to retrieve current weather data, including temperature, conditions, and forecasts for a given location.\n\nAlways explain your reasoning briefly when choosing between Tavily and Perplexity. Prioritize clarity, credibility, and helpfulness in your responses.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2400,752],"id":"7134612a-2225-48a4-8cb1-bfe2d566f702","name":"Web Agent"},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Overview\nYou are a YouTube content assistant. Your responsibilities include researching high-performing YouTube videos, retrieving existing video ideas, and adding new content ideas to the video database. Your goal is to support content strategy and ideation with relevant, high-quality inputs.\n\n**Video Idea Management**  \n   - Use **Get Ideas** to retrieve existing YouTube video ideas from the internal database.  \n   - Use **Add Idea** to contribute new video ideas to the database for future content planning.\n\n**Content Research**  \n   - Use **YouTube Videos** to search for high-performing videos on a given topic. Analyze trends, titles, formats, and engagement to inspire new content strategies.\n\nWhen suggesting or adding an idea, be specific, creative, and align your suggestions with proven YouTube best practices.\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[2656,432],"id":"3e92636b-378c-49e7-bad5-7b94d15ba1d6","name":"YouTube Agent","disabled":true},{"parameters":{"jsCode":"// Initialize the output arrays\nconst steps = [];\nconst tokens = [];\nlet totalTokens = 0; // Changed to track total tokens instead of cost\n\n// Process each item in the input\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Check if the data is an array itself (like your example JSON)\n  if (Array.isArray(data)) {\n    // Process each object in the array\n    for (const obj of data) {\n      // Extract steps information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action) {\n            steps.push({\n              tool: step.action.tool,\n              toolInput: step.action.toolInput,\n              observation: step.observation\n            });\n          }\n        }\n      }\n      \n      // Extract token information\n      if (obj.intermediateSteps && Array.isArray(obj.intermediateSteps)) {\n        for (const step of obj.intermediateSteps) {\n          if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n            for (const message of step.action.messageLog) {\n              if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n                const usage = message.kwargs.response_metadata.usage;\n                tokens.push({\n                  prompt_tokens: usage.prompt_tokens,\n                  completion_tokens: usage.completion_tokens,\n                  total_tokens: usage.total_tokens,\n                  model_name: message.kwargs.response_metadata.model_name\n                });\n                \n                // Add the tokens to our running total\n                if (typeof usage.total_tokens === 'number') {\n                  totalTokens += usage.total_tokens;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  } else {\n    // If data is not an array, process it as a single object\n    // Extract steps information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action) {\n          steps.push({\n            tool: step.action.tool,\n            toolInput: step.action.toolInput,\n            observation: step.observation\n          });\n        }\n      }\n    }\n    \n    // Extract token information\n    if (data.intermediateSteps && Array.isArray(data.intermediateSteps)) {\n      for (const step of data.intermediateSteps) {\n        if (step.action && step.action.messageLog && Array.isArray(step.action.messageLog)) {\n          for (const message of step.action.messageLog) {\n            if (message.kwargs && message.kwargs.response_metadata && message.kwargs.response_metadata.usage) {\n              const usage = message.kwargs.response_metadata.usage;\n              tokens.push({\n                prompt_tokens: usage.prompt_tokens,\n                completion_tokens: usage.completion_tokens,\n                total_tokens: usage.total_tokens,\n                model_name: message.kwargs.response_metadata.model_name\n              });\n              \n              // Add the tokens to our running total\n              if (typeof usage.total_tokens === 'number') {\n                totalTokens += usage.total_tokens;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Return the processed data with total_tokens included\nreturn [{\n  json: {\n    steps: steps,\n    tokens: tokens,\n    total_tokens: totalTokens\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2320,32],"id":"b236533e-3b24-4110-b333-2aae9ecff9b1","name":"Clean Up"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA","mode":"list","cachedResultName":"Agent Logs","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18s6WMQxT8Sv6wP4YFMO613nn7QMUevygmz_nnwiBaoA/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Timestamp":"={{ $now.format('yyyy-MM-dd hh:m a') }}","Workflow":"={{ $workflow.name }}","Input":"={{ $('Input').item.json.input }}","Output":"={{ $('AI Agent').item.json.output }}","Actions":"={{ JSON.stringify($json.steps, null, 2) }}","Tokens":"={{ JSON.stringify($json.tokens, null, 2) }}","Total Tokens":"={{ $json.total_tokens }}"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow","displayName":"Workflow","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Input","displayName":"Input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Output","displayName":"Output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Total Tokens","displayName":"Total Tokens","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2544,32],"id":"09bba542-aeba-49af-b56f-264597b6d626","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2880,592],"id":"58308a2f-bf37-40bb-8e08-6073cc334136","name":"Get Ideas","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls","mode":"list","cachedResultName":"Video Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ideas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/15CpqbdciFb023LElHxiDQ-CSfbXg-Gk6g5A7Dl_b8Ls/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Idea":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idea', `Idea title`, 'string') }}","Description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `Idea description`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Idea","displayName":"Idea","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[2992,592],"id":"676dd763-c8b1-4d8c-9b53-ca9ff03ddb9e","name":"Add Idea","credentials":{"googleSheetsOAuth2Api":{"id":"vCuZUajyRk62001C","name":"Google Sheets account"}}},{"parameters":{"toolDescription":"Use this tool to find high-performing YouTube videos","method":"POST","url":"https://api.apify.com/v2/acts/streamers~youtube-scraper/run-sync-get-dataset-items","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"YOUR APIFY API KEY"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"dateFilter\": \"month\",\n    \"downloadSubtitles\": false,\n    \"hasCC\": false,\n    \"hasLocation\": false,\n    \"hasSubtitles\": false,\n    \"is360\": false,\n    \"is3D\": false,\n    \"is4K\": false,\n    \"isBought\": false,\n    \"isHD\": false,\n    \"isHDR\": false,\n    \"isLive\": false,\n    \"isVR180\": false,\n    \"maxResultStreams\": 0,\n    \"maxResults\": {{$fromAI(\"maxResults\",\"how many videos the user wants, if not specified, default to 3\",\"number\",3)}},\n    \"maxResultsShorts\": 0,\n    \"oldestPostDate\": \"6 months\",\n    \"preferAutoGeneratedSubtitles\": false,\n    \"saveSubsToKVS\": false,\n    \"searchQueries\": [\n        \"{{$fromAI(\"searchTerm\",\"The topic of the video to search for\")}}\"\n    ],\n    \"sortVideosBy\": \"POPULAR\",\n    \"sortingOrder\": \"views\"\n}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2768,592],"id":"1608aae0-52ce-4a47-8a38-c7d56886df43","name":"YouTube Videos"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1296,432],"id":"a845ec27-3d2e-4f10-8337-00ec8b267059","name":"Think"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1424,432],"id":"57186a93-eb1d-41e6-8a8a-072bc1e12384","name":"Simple Memory"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.error }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2304,208],"id":"7ed5f7b2-d1b0-45c2-a97f-dfc3b8f94a17","name":"Error Message","webhookId":"7065a160-b927-43b6-b327-feec46cc0088","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $('AI Agent').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2800,32],"id":"eca5999f-e7e1-430b-8d8e-311595a03fc5","name":"Response","webhookId":"4d174459-d5cc-4297-a449-369d3f10ef23","credentials":{"telegramApi":{"id":"S4gGxTMpusyx91At","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"976cf2c9-01b6-46cf-97b4-675a67ca57bc","name":"input","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1776,192],"id":"4a432050-46a6-4f75-8ae5-0b663c395e28","name":"Input"},{"parameters":{"content":"# ⚙️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your n8n AI agent workflow fully configured and connected:\n\n### ✅ Step 1: Connect Your Telegram Account  \nUse the **Telegram Trigger** node to link your Telegram account. This allows you to interact with your agent via Telegram. Make sure it's fully connected—it’s used in both the **Telegram Response** nodes and the **Simple Memory** node.\n\n### ✅ Step 2: Add Your [OpenRouter](https://openrouter.ai/) API Key  \nThis is the \"brain\" of your AI agent. Plug in your API key using the **HTTP Request** or **Credential** node to power intelligent responses.\n\n### ✅ Step 3: Connect Your App Integrations  \nSet up the following API connections so your agent can take meaningful actions:\n- **Gmail**\n- **Google Calendar**\n- **Airtable**\n- **Google Sheets**\n- **Apify** – Used in the YouTube video node.  \n  💡 *Use code* **`30NATEHERK`** *for 30% off your first 3 months at [Apify](https://www.apify.com/?fpr=nate)*\n\n### ✅ Step 4: Connect Research & Utility APIs  \nAdd these keys for more powerful features:\n- [**Tavily API Key**](https://www.tavily.com/)\n- [**Perplexity API Key**](https://www.perplexity.ai/)\n- [**Open Weather Map API Key**](https://openweathermap.org/api)\n\n### ✅ Step 5: Link Your Google Sheets Templates  \n- 📄 [Agent Action Log Sheet](https://docs.google.com/spreadsheets/d/1PlRVi9Iv2n11SPYdshjhPGWccRCpKLHn3PjUkJEjgAQ/edit?usp=sharing) – Logs the agent’s actions.\n- 🎬 [YouTube Ideas Sheet](https://docs.google.com/spreadsheets/d/1Jazczp5HtPwcJvu6bmJQrjkqt31S7adVqIFVCqXZwGk/edit?usp=sharing) – Used for the YouTube agent’s video ideas.\n\n### 🚀 Final Step: Start Prompting  \nWith everything connected, start chatting with your agent on Telegram and watch it take intelligent action across your tool stack!\n","height":912,"width":784},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"3153062a-019c-4ea1-be1d-f51d1dae5b08","name":"Sticky Note"},{"parameters":{"jsCode":"// add security so only I can use the bot\nif ($input.first().json.message.from.id !== 7217020342) {\n  return {unauthorized: true};\n} else {\nreturn $input.all();\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,192],"id":"9c477d95-0325-43ef-a917-52c96b0a2ddd","name":"Authorised?"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2304,928],"id":"b8a75c93-6b3c-4e83-a51e-8f9c6beec791","name":"GPT 5.1-mini","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1392,608],"id":"feb9ec0e-2b45-4099-b65b-b37f39fe6efc","name":"GPT 5.1-mini1","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2288,592],"id":"a8b79373-9b6d-41a2-83c1-580e67c321b7","name":"GPT 5.1-mini3","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1920,608],"id":"d20d9e1d-0685-4c8c-bed3-f0da72589dec","name":"GPT 5.1-mini2","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1184,432],"id":"a02038a2-fe19-4497-83f7-61bdf54e05f2","name":"GPT 5.1-mini4","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}}],"connections":{"Telegram Trigger":{"main":[[{"node":"Authorised?","type":"main","index":0}]]},"Download Voice File":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[{"node":"Set 'Text'","type":"main","index":0}]]},"Set 'Text'":{"main":[[{"node":"Input","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Input","type":"main","index":0}]]},"Send Email":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Create Draft":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Reply":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Get Labels":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Label Emails":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Mark Unread":{"ai_tool":[[{"node":"Email Agent","type":"ai_tool","index":0}]]},"Email Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get Contacts":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Add or Update Contact":{"ai_tool":[[{"node":"Contact Agent","type":"ai_tool","index":0}]]},"Contact Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Perplexity":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"OpenWeatherMap":{"ai_tool":[[{"node":"Web Agent","type":"ai_tool","index":0}]]},"Web Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"AI Agent":{"main":[[{"node":"Clean Up","type":"main","index":0}],[{"node":"Error Message","type":"main","index":0}]]},"Clean Up":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"Response","type":"main","index":0}]]},"Get Ideas":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Add Idea":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"YouTube Videos":{"ai_tool":[[{"node":"YouTube Agent","type":"ai_tool","index":0}]]},"Authorised?":{"main":[[{"node":"Switch","type":"main","index":0}]]},"GPT 5.1-mini":{"ai_languageModel":[[{"node":"Web Agent","type":"ai_languageModel","index":0}]]},"GPT 5.1-mini1":{"ai_languageModel":[[{"node":"Email Agent","type":"ai_languageModel","index":0}]]},"GPT 5.1-mini3":{"ai_languageModel":[[{"node":"Contact Agent","type":"ai_languageModel","index":0}]]},"GPT 5.1-mini2":{"ai_languageModel":[[{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]},"GPT 5.1-mini4":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"YouTube Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"730d7e99-88df-44cf-8068-87a1855225b1","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T03:12:00.774Z","createdAt":"2025-11-29T03:12:00.774Z","role":"workflow:owner","workflowId":"mgR2QgNtnkJSYzsV","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-24T20:37:24.783Z","createdAt":"2025-12-24T20:37:24.783Z","id":"nXj8rD7E1JUuA9Nc","name":"Tavily Tool","active":false,"isArchived":false,"nodes":[{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-112,96],"id":"fb8a526b-eb74-42f4-bc8f-2475a1991bc9","name":"Workflow Input Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"1ae0dd90-d1d0-494b-bd8b-1ef335f0bd8f","name":"response","value":"=[Source 1]\nURL: {{ $json.results[0].url }}\nContent: {{ $json.results[0].content }}\n\n[Source 2]\nURL: {{ $json.results[1].url }}\nContent: {{ $json.results[1].content }}\n\n[Source 2]\nURL: {{ $json.results[2].url }}\nContent: {{ $json.results[2].content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[352,96],"id":"2d3dc69c-3f36-450a-9b99-23d0d7bd8116","name":"response"},{"parameters":{"content":"# Tavily Tool","height":300,"width":700,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-176,16],"typeVersion":1,"id":"725e1023-6bb1-486e-b34e-ed75ce9e0c28","name":"Sticky Note1"},{"parameters":{"query":"Medaxion ","options":{"topic":"news","search_depth":"basic","max_results":3,"include_answer":"advanced","include_raw_content":true,"country":"USA"}},"type":"@tavily/n8n-nodes-tavily.tavily","typeVersion":1,"position":[112,96],"id":"76690f09-c255-42ae-8363-66828471865b","name":"Search","credentials":{"tavilyApi":{"id":"jTSKMSxuxvu2rk8i","name":"Tavily account"}}}],"connections":{"Workflow Input Trigger":{"main":[[{"node":"Search","type":"main","index":0}]]},"Search":{"main":[[{"node":"response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"3870e28d-79fd-4a26-b95a-bad1b97b2faf","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-24T20:37:24.786Z","createdAt":"2025-12-24T20:37:24.786Z","role":"workflow:owner","workflowId":"nXj8rD7E1JUuA9Nc","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-04T01:48:13.206Z","createdAt":"2025-12-30T21:50:40.353Z","id":"oSssOVgUlLiuBm9Z","name":"⚙️ Freelancer Proposal Template","active":false,"isArchived":false,"nodes":[{"parameters":{"jsCode":"// n8n Code Node (JavaScript) - GenerateHTML\n// Mode: Run Once for All Items\n//\n// Output: { html: \"<!DOCTYPE html>...\" }\n//\n// Key fix in THIS version:\n// - The formatted HTML from your node \"formatFunctionality\" is stored at:\n//     $node[\"formatFunctionality\"].json.output.functionalityRequirements\n//   (per your screenshot)\n// - We read it in JS and inject it as raw HTML via ${functionalityHtml}.\n// - No n8n expressions like $input.first() are used inside the HTML template.\n\nfunction getNodeJson(nodeName) {\n  return ($node?.[nodeName]?.json) ? $node[nodeName].json : {};\n}\n\nfunction val(obj, key, fallback = \"\") {\n  const v = obj?.[key];\n  if (v === null || v === undefined) return fallback;\n  return String(v);\n}\n\n// Use this for values you insert into text nodes or attributes\nfunction escapeHtml(input) {\n  return String(input ?? \"\")\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n}\n\n// Read inputs\nconst contract = getNodeJson(\"contractInput\");\nconst fmt = getNodeJson(\"formatFunctionality\");\n\nconst projectTitle = val(contract, \"Project Title\", \"\");\nconst headerImageUrl = val(contract, \"Header Image URL\", \"\");\n\n// ✅ IMPORTANT: your formatter node output is nested like: { output: { functionalityRequirements: \"<div>...</div>\" } }\n// We support both possible shapes, just in case you tweak the formatter later.\nconst functionalityHtml = (\n  fmt?.output?.functionalityRequirements ??\n  fmt?.functionalityRequirements ??\n  \"\"\n).toString().trim();\n\nconst html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>${escapeHtml(projectTitle)}</title>\n\n  <style>\n    :root{\n      --text:#111827;\n      --muted:#6b7280;\n      --border:#e5e7eb;\n      --bg:#ffffff;\n      --soft:#f9fafb;\n    }\n    *{ box-sizing:border-box; }\n    body{\n      margin:0;\n      background:var(--soft);\n      color:var(--text);\n      font-family: Arial, Helvetica, sans-serif;\n      line-height:1.45;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n\n    /* Container */\n    .page{\n      max-width: 900px;\n      margin: 24px auto;\n      background: var(--bg);\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      overflow: hidden;\n    }\n    .header-img{\n      width:100%;\n      height:auto;\n      display:block;\n    }\n    .content{\n      padding: 28px 32px;\n    }\n\n    h1,h2,h3{\n      margin: 0 0 10px 0;\n      line-height:1.2;\n    }\n    h1{ font-size: 26px; }\n    h2{ font-size: 18px; margin-top: 26px; }\n    h3{ font-size: 15px; margin-top: 18px; }\n\n    .muted{ color: var(--muted); }\n    .hr{\n      height:1px;\n      background:var(--border);\n      margin: 18px 0;\n    }\n    .card{\n      border:1px solid var(--border);\n      border-radius:10px;\n      padding:14px 16px;\n      background:#fff;\n    }\n    table{\n      width:100%;\n      border-collapse: collapse;\n      margin: 10px 0 0 0;\n    }\n    th, td{\n      border:1px solid var(--border);\n      padding:10px 12px;\n      vertical-align: top;\n      font-size: 13px;\n    }\n    th{\n      background:#f3f4f6;\n      text-align:left;\n      font-weight:700;\n    }\n    .two-col{\n      display:grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 14px;\n    }\n    .label{\n      font-weight:700;\n      margin-bottom:4px;\n      font-size: 13px;\n    }\n    .value{\n      font-size: 13px;\n      white-space: pre-wrap;\n    }\n    .prewrap{\n      white-space: pre-wrap;\n    }\n    .signature-block{\n      display:grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 14px;\n      margin-top: 10px;\n    }\n    .sigline{\n      margin-top: 22px;\n      border-top: 1px solid var(--border);\n      padding-top: 10px;\n      font-size: 13px;\n    }\n    .small{\n      font-size: 12px;\n    }\n\n    /* Make the injected functionality HTML look consistent */\n    .func-wrap ul{\n      margin: 8px 0 0 18px;\n      padding: 0;\n    }\n    .func-wrap li{\n      margin: 6px 0;\n    }\n\n    /* Print & pagination rules */\n    @media print{\n      body{ background:#fff; }\n      .page{ border:none; border-radius:0; margin:0; }\n      .content{ padding: 18mm 16mm; }\n\n      /* Avoid ugly splits */\n      .card, table, .signature-block { break-inside: avoid; page-break-inside: avoid; }\n      h1, h2, h3 { break-after: avoid; page-break-after: avoid; }\n\n      /* Force certain sections to start on a new page */\n      .page-break-before { break-before: page; page-break-before: always; }\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"page\">\n\n    <!-- Header Image -->\n    ${headerImageUrl ? `<img class=\"header-img\" src=\"${escapeHtml(headerImageUrl)}\" alt=\"Header\" />` : \"\"}\n\n    <div class=\"content\">\n\n      <!-- COVER PAGE -->\n      <h1>Project Agreement Cover Page</h1>\n      <div class=\"card\">\n        <div class=\"label\">Project Title</div>\n        <div class=\"value\">${escapeHtml(projectTitle)}</div>\n      </div>\n\n      <div class=\"hr\"></div>\n\n      <div class=\"two-col\">\n        <div class=\"card\">\n          <div class=\"label\">Client</div>\n          <div class=\"value\">\nName: ${escapeHtml(val(contract, \"Client Name\", \"\"))}\nCompany: ${escapeHtml(val(contract, \"Client Company\", \"\"))}\nAddress: ${escapeHtml(val(contract, \"Client Address\", \"\"))}\n          </div>\n        </div>\n\n        <div class=\"card\">\n          <div class=\"label\">Freelancer / Consultant</div>\n          <div class=\"value\">\nName: ${escapeHtml(val(contract, \"Consultant Name\", \"\"))}\nCompany: ${escapeHtml(val(contract, \"Consultant Company\", \"\"))}\nAddress: ${escapeHtml(val(contract, \"Consultant Address\", \"\"))}\n          </div>\n        </div>\n      </div>\n\n      <h2>Project Overview</h2>\n      <p class=\"small\">\n        This Agreement consists of two parts:\n        <br /><br />\n        <strong>Part 1 – Statement of Work (SOW):</strong> Defines the scope of services, deliverables, functionality requirements, timeline, payment terms, and post-deployment support.\n        <br />\n        <strong>Part 2 – Master Services Agreement (MSA):</strong> Provides the governing legal terms, including intellectual property, confidentiality, liability limits, indemnification, and dispute resolution.\n      </p>\n\n      <h2>Key Project Details</h2>\n      <table>\n        <tr>\n          <th style=\"width:32%;\">Item</th>\n          <th>Details</th>\n        </tr>\n        <tr>\n          <td><strong>Scope of Work</strong></td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Scope of Works\", \"\"))}</td>\n        </tr>\n        <tr>\n          <td><strong>Total Project Fee</strong></td>\n          <td>$${escapeHtml(val(contract, \"Total Project Fee\", \"\"))}</td>\n        </tr>\n        <tr>\n          <td><strong>Payment Schedule</strong></td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Payment Schedule\", \"\"))}</td>\n        </tr>\n        <tr>\n          <td><strong>Project Timeline</strong></td>\n          <td>\n            Start Date: ${escapeHtml(val(contract, \"Start Date\", \"\"))}<br />\n            Estimated Completion Date: ${escapeHtml(val(contract, \"Estimated Completion Date\", \"\"))}\n          </td>\n        </tr>\n        <tr>\n          <td><strong>Warranty / Support</strong></td>\n          <td>\n            Included warranty support: ${escapeHtml(val(contract, \"Warranty Days\", \"\"))} days<br />\n            Ongoing maintenance available: $${escapeHtml(val(contract, \"Ongoing Maintenance (Monthly)\", \"\"))} / month\n          </td>\n        </tr>\n      </table>\n\n      <div class=\"hr\"></div>\n\n      <!-- MAIN AGREEMENT -->\n      <h1 class=\"page-break-before\">Freelancer Services Agreement</h1>\n      <p class=\"small\">\n        This Agreement is structured in two parts:\n        <br />\n        <strong>Part 1 – Statement of Work (SOW):</strong> Defines the specific project scope, deliverables, milestones, and functionality requirements.\n        <br />\n        <strong>Part 2 – Master Services Agreement (MSA):</strong> Establishes the general legal terms governing all projects between the Parties.\n      </p>\n\n      <h2>Part 1: Statement of Work (SOW)</h2>\n      <p class=\"small\">\n        This Statement of Work (“SOW”) is entered into by and between:\n        <br />\n        <strong>Client:</strong> ${escapeHtml(val(contract, \"Client Name\", \"\"))}, ${escapeHtml(val(contract, \"Client Company\", \"\"))}, ${escapeHtml(val(contract, \"Client Address\", \"\"))}\n        <br />\n        <strong>Freelancer/Consultant:</strong> ${escapeHtml(val(contract, \"Consultant Name\", \"\"))}, ${escapeHtml(val(contract, \"Consultant Company\", \"\"))}, ${escapeHtml(val(contract, \"Consultant Address\", \"\"))}\n      </p>\n      <p class=\"small\">\n        This SOW is subject to the Master Services Agreement (“MSA”) attached below. In case of conflict, this SOW shall control.\n      </p>\n\n      <h3>1. Project Scope &amp; Deliverables</h3>\n      <p class=\"small\">Freelancer agrees to perform the following services (“Services”):</p>\n      <div class=\"card\">\n        <div class=\"label\">Description of Project Deliverables and Scope</div>\n        <div class=\"value\">${escapeHtml(val(contract, \"Description of Project Deliverables and Scope\", \"\"))}</div>\n      </div>\n\n      <h3>2. Functionality Requirements</h3>\n      <p class=\"small\">Deliverables shall, at a minimum, perform the following functionality:</p>\n      <div class=\"card\">\n        <div class=\"value func-wrap\">\n          ${functionalityHtml || \"\"}\n        </div>\n      </div>\n\n      <h3>3. Acceptance Testing</h3>\n      <p class=\"small\">\n        The Client shall have <strong>${escapeHtml(val(contract, \"Acceptance Testing Days\", \"\"))}</strong> days after delivery to review and accept the Deliverables.\n        If the Deliverables do not meet the agreed requirements, Client shall provide written notice describing the deficiencies.\n        Freelancer will use commercially reasonable efforts to remediate within a reasonable timeframe.\n      </p>\n\n      <h3>4. Timeline &amp; Milestones</h3>\n      <table>\n        <tr>\n          <th style=\"width:25%;\">Milestone</th>\n          <th>Description</th>\n          <th style=\"width:18%;\">Due Date</th>\n          <th style=\"width:20%;\">Payment</th>\n        </tr>\n        <tr>\n          <td><strong>Milestone 1</strong></td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 1 Description\", \"\"))}</td>\n          <td>${escapeHtml(val(contract, \"Milestone 1 Due Date\", \"\"))}</td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 1 Payment\", \"\"))}</td>\n        </tr>\n        <tr>\n          <td><strong>Milestone 2</strong></td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 2 Description\", \"\"))}</td>\n          <td>${escapeHtml(val(contract, \"Milestone 2 Due Date\", \"\"))}</td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 2 Payment Percentage\", \"\"))}</td>\n        </tr>\n        <tr>\n          <td><strong>Milestone 3</strong></td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 3 Description\", \"\"))}</td>\n          <td>${escapeHtml(val(contract, \"Milestone 3 Due Date\", \"\"))}</td>\n          <td class=\"prewrap\">${escapeHtml(val(contract, \"Milestone 3 Payment\", \"\"))}</td>\n        </tr>\n      </table>\n\n      <h3>5. Client Responsibilities</h3>\n      <p class=\"small\">\n        Client will provide timely access to required systems, data, stakeholders, and approvals as needed to perform the Services.\n        Delays caused by Client may impact the delivery timeline.\n      </p>\n\n      <h3>6. Freelancer Responsibilities</h3>\n      <p class=\"small\">\n        Freelancer will perform the Services in a professional and workmanlike manner and in accordance with the agreed requirements.\n      </p>\n\n      <h3>7. Fees &amp; Payment</h3>\n      <div class=\"card\">\n        <div class=\"value\">\nTotal Project Fee: <strong>$${escapeHtml(val(contract, \"Total Project Fee\", \"\"))}</strong><br />\nPayment Schedule: <span class=\"prewrap\">${escapeHtml(val(contract, \"Payment Schedule\", \"\"))}</span><br />\nPayment Due Date: Payments are due within <strong>${escapeHtml(val(contract, \"Payment Due Date\", \"\"))}</strong> days of invoice date (unless otherwise agreed).\n        </div>\n      </div>\n\n      <h3>8. Post-Deployment Support &amp; Maintenance</h3>\n      <p class=\"small\">\n        Included warranty support period: <strong>${escapeHtml(val(contract, \"Warranty Days\", \"\"))}</strong> days following completion.\n        After that period, ongoing maintenance is available at <strong>$${escapeHtml(val(contract, \"Ongoing Maintenance (Monthly)\", \"\"))} / month</strong>, if agreed in writing.\n      </p>\n\n      <div class=\"hr\"></div>\n\n      <h2 class=\"page-break-before\">Part 2: Master Services Agreement (MSA)</h2>\n\n      <h3>1. Term and Termination</h3>\n      <p class=\"small\">\n        Either party may terminate this Agreement with <strong>${escapeHtml(val(contract, \"Termination Notice Period (Days)\", \"\"))}</strong> days written notice.\n        If a party materially breaches the Agreement, the non-breaching party may provide notice and an opportunity to cure within\n        <strong>${escapeHtml(val(contract, \"Material Breach Notice Period (Days)\", \"\"))}</strong> days. If not cured, the Agreement may be terminated immediately.\n      </p>\n\n      <h3>2. Intellectual Property</h3>\n      <p class=\"small\">\n        Unless otherwise agreed in writing, upon full payment, Client receives rights to the final Deliverables created specifically for Client.\n        Freelancer retains rights to pre-existing materials, general know-how, templates, and reusable components.\n      </p>\n\n      <h3>3. Confidentiality</h3>\n      <p class=\"small\">\n        Each party agrees to keep confidential information private and to use it solely for performing obligations under this Agreement.\n      </p>\n\n      <h3>4. Client Materials &amp; Compliance</h3>\n      <p class=\"small\">\n        Client is responsible for ensuring it has the rights to provide any materials, data, or access required for the Services,\n        and for compliance with applicable laws and policies.\n      </p>\n\n      <h3>5. Independent Contractor</h3>\n      <p class=\"small\">\n        Freelancer is an independent contractor and not an employee, partner, or agent of Client.\n      </p>\n\n      <h3>6. Liability Limits</h3>\n      <p class=\"small\">\n        To the maximum extent permitted by law, each party’s liability is limited to the total fees paid under the applicable SOW,\n        and neither party will be liable for indirect or consequential damages.\n      </p>\n\n      <h3>7. Indemnification</h3>\n      <p class=\"small\">\n        Each party agrees to indemnify and hold harmless the other party from third-party claims arising from its breach of this Agreement\n        or its gross negligence or wilful misconduct.\n      </p>\n\n      <h3>8. Non-Solicitation</h3>\n      <p class=\"small\">\n        During the term of this Agreement and for 12 months thereafter, neither party will knowingly solicit for hire the other party’s personnel\n        who were materially involved in the Services, unless otherwise agreed.\n      </p>\n\n      <h3>9. Dispute Resolution</h3>\n      <p class=\"small\">\n        Parties shall first attempt to resolve disputes through good faith negotiation.<br />\n        If unresolved, disputes shall proceed to\n        <strong>${escapeHtml(val(contract, \"Dispute Resolution Method\", \"\"))}</strong>\n        in\n        <strong>${escapeHtml(val(contract, \"Jurisdiction\", \"\"))}</strong>.<br />\n        Governing law:\n        <strong>${escapeHtml(val(contract, \"Governing Law\", \"\"))}</strong>.\n      </p>\n\n      <h3>10. General Provisions</h3>\n      <p class=\"small\">\n        This Agreement constitutes the entire agreement. Amendments must be in writing.\n        Notices shall be sent to the addresses listed above.\n        Neither party may assign without the other’s consent, except to successors.\n      </p>\n\n      <h2>Acknowledgment</h2>\n      <p class=\"small\">\n        By signing below, the Parties agree to the terms of this Agreement, including the attached Statement of Work (SOW) and Master Services Agreement (MSA).\n      </p>\n\n      <div class=\"signature-block\">\n        <div class=\"card\">\n          <div class=\"label\">Client Signature</div>\n          <div class=\"sigline\">Name: ${escapeHtml(val(contract, \"Client Name\", \"\"))}</div>\n          <div class=\"sigline\">Signature:</div>\n          <div class=\"sigline\">Date:</div>\n        </div>\n        <div class=\"card\">\n          <div class=\"label\">Freelancer / Consultant Signature</div>\n          <div class=\"sigline\">Name: ${escapeHtml(val(contract, \"Consultant Name\", \"\"))}</div>\n          <div class=\"sigline\">Signature:</div>\n          <div class=\"sigline\">Date:</div>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</body>\n</html>`;\n\nreturn [\n  {\n    json: {\n      html,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[896,192],"id":"cf5b18fd-1c95-40c6-a601-3b29a95e974d","name":"GenerateHTML"},{"parameters":{"method":"POST","url":"https://pdf.autopilotworkflow.com/forms/chromium/convert/html","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"files","inputDataFieldName":"htmlFile"}]},"options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1344,192],"id":"09dc0f6d-1ef0-4cda-a9d9-30ac99f3d878","name":"GeneratePDF","alwaysOutputData":true,"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Code node v2 (JavaScript)\n\nconst items = $input.all();\n\nasync function run() {\n  const out = [];\n\n  for (const item of items) {\n    const order = item.json;\n    const html = order.html || '';\n\n    const buffer = Buffer.from(html, 'utf8');\n\n    // Create binary file called index.html\n    const binary = await this.helpers.prepareBinaryData(\n      buffer,\n      'index.html',   // <-- important: filename that Gotenberg expects\n      'text/html'\n    );\n\n    out.push({\n      json: order,           // keep your order data if you want it later\n      binary: {\n        htmlFile: binary     // <-- we'll reference this in HTTP node\n      }\n    });\n  }\n\n  return out;\n}\n\nreturn run();\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1120,192],"id":"8787f407-7b34-4852-96ca-a2ffd867848e","name":"Turn into index.html"},{"parameters":{"httpMethod":"POST","path":"apw-legal-contract","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-448,96],"id":"517d229f-6624-439f-a753-175f4864635f","name":"Webhook","webhookId":"9c0426d0-f71b-49b7-bc90-62c247cfdf02"},{"parameters":{"assignments":{"assignments":[{"id":"166132c8-1644-4a91-9a28-60dca82a7ce0","name":"Project Title","value":"={{ $json[\"Project Title\"] }}","type":"string"},{"id":"9661aaa4-ef8d-4345-b424-54f45aa20e76","name":"Header Image URL","value":"={{ $json[\"Header Image URL\"] }}","type":"string"},{"id":"f7fa9ab3-9c0d-4f1d-a2ff-927160d5a740","name":"Client Name","value":"={{ $json[\"Client Name\"] }}","type":"string"},{"id":"f197633c-3cdf-4844-8747-93840951e26f","name":"Client Company","value":"={{ $json[\"Client Company\"] }}","type":"string"},{"id":"455626bf-c72a-4196-ace1-b8f737b281ca","name":"Client Address","value":"={{ $json[\"Client Address\"] }}","type":"string"},{"id":"2ce9deb7-91b9-4010-befe-4eeeaaa7442b","name":"Scope of Works","value":"={{ $json[\"Scope of Works\"] }}","type":"string"},{"id":"5f1d614c-1e33-4ced-b775-60d2538e0334","name":"Total Project Fee","value":"={{ $json[\"Total Project Fee\"] }}","type":"number"},{"id":"81de49b1-0ef2-4653-84b2-f81595f0899b","name":"Payment Schedule","value":"={{ $json[\"Payment Schedule\"] }}","type":"string"},{"id":"72a51a0a-0afa-4b3e-8a36-357be160a4b0","name":"Start Date","value":"={{ DateTime.fromISO($json[\"Start Date\"]).toFormat(\"d LLLL yyyy\") }}\n","type":"string"},{"id":"19843506-fb3d-4342-939f-0a0c3e8055c4","name":"Estimated Completion Date","value":"={{ DateTime.fromISO($json[\"Estimated Completion Date\"]).toFormat(\"d LLLL yyyy\") }}\n","type":"string"},{"id":"79538cc0-6d98-4f63-97f9-ad6750f3489b","name":"Warranty Days","value":"={{ $json[\"Warranty Days\"] }}","type":"number"},{"id":"9a211b3a-5598-4fe9-8fd1-0730fb44182c","name":"Description of Project Deliverables and Scope","value":"={{ $json[\"Description of Project Deliverables and Scope\"] }}","type":"string"},{"id":"475c9321-86a6-4c75-bf8e-b3d7650a8094","name":"Functionality Requirements","value":"={{ $json[\"Functionality Requirements\"] }}","type":"string"},{"id":"a91a46fc-8c4c-46ed-8c92-4d0a1b737fd8","name":"Acceptance Testing Days","value":"={{ $json[\"Acceptance Testing Days\"] }}","type":"number"},{"id":"02082dd6-5124-4567-b698-40ad47eed953","name":"Milestone 1 Description","value":"={{ $json[\"Milestone 1 Description\"] }}","type":"string"},{"id":"c7f962d2-0cee-4b0f-ae45-dc49548568ee","name":"Milestone 1 Due Date","value":"={{ DateTime.fromISO($json[\"Milestone 1 Due Date\"]).toFormat(\"d LLLL yyyy\") }}\n","type":"string"},{"id":"7d8e7942-52ba-4890-b746-6142a6f3a36c","name":"Milestone 1 Payment","value":"={{ Math.round($json[\"Milestone 1 Payment\"] * 100) + \"%\" }}\n","type":"string"},{"id":"14ba4eca-ad61-4c18-a961-36570b379cbb","name":"Milestone 2 Description","value":"={{ $json[\"Milestone 2 Description\"] }}","type":"string"},{"id":"8675290c-b62b-45cd-88c7-49b84adf5559","name":"Milestone 2 Due Date","value":"={{ DateTime.fromISO($json[\"Milestone 2 Due Date\"]).toFormat(\"d LLLL yyyy\") }}\n","type":"string"},{"id":"eb90a34d-29f3-42fb-9097-cf8283178b64","name":"Milestone 2 Payment Percentage","value":"={{ Math.round($json[\"Milestone 2 Payment Percentage\"] * 100) + \"%\" }}\n","type":"string"},{"id":"749a35c2-6a1d-4288-81e3-d55d5e10e345","name":"Milestone 3 Description","value":"={{ $json[\"Milestone 3 Description\"] }}","type":"string"},{"id":"892bbd36-7a80-4657-bdd0-64be2c18bfc8","name":"Milestone 3 Due Date","value":"={{ DateTime.fromISO($json[\"Milestone 3 Due Date\"]).toFormat(\"d LLLL yyyy\") }}\n","type":"string"},{"id":"3079cb44-6e97-4b7d-a0b9-806b489f6ef1","name":"Milestone 3 Payment","value":"={{ Math.round($json[\"Milestone 3 Payment\"] * 100) + \"%\" }}\n","type":"string"},{"id":"1d73fa34-fc06-4923-9ac1-3b519cc69f98","name":"Payment Due Date","value":"={{ $json[\"Payment Due Date\"] }}","type":"number"},{"id":"291b8711-fb4e-4043-8945-54c8b4df0877","name":"Ongoing Maintenance (Monthly)","value":"={{ $json[\"Ongoing Maintenance (Monthly)\"] }}","type":"number"},{"id":"fab8e169-2a05-424d-babe-17fdb83e28c8","name":"Termination Notice Period (Days)","value":"={{ $json[\"Termination Notice Period (Days)\"] }}","type":"number"},{"id":"a5d56149-fcb2-4374-a3b1-4418ce11f81a","name":"Material Breach Notice Period (Days)","value":"={{ $json[\"Material Breach Notice Period (Days)\"] }}","type":"number"},{"id":"a8b2cf42-65f3-42eb-a7c2-9bed00e3c628","name":"Dispute Resolution","value":"={{ $json[\"Dispute Resolution\"] }}","type":"string"},{"id":"d8d13c68-4253-4b3b-81de-69f29b1003d7","name":"Jurisdiction","value":"={{ $json.Jurisdiction }}","type":"string"},{"id":"c22e0cb0-4b5a-4361-8dba-bfd82b2ac7bb","name":"Governing Law","value":"={{ $json[\"Governing Law\"] }}","type":"string"},{"id":"479dafe6-4669-4b2f-b0e8-185c282c5bf6","name":"Automation","value":"={{ $json.Automation }}","type":"string"},{"id":"c2ff48da-05f1-491c-83b2-d2b86e31a883","name":"Consultant Name","value":"={{ $json['Consultant Name'] }}","type":"string"},{"id":"4c6085a5-4780-41bd-a41e-232fe4ca842b","name":"Consultant Company","value":"={{ $json['Consultant Company'] }}","type":"string"},{"id":"ae6f54e4-6a52-4bd9-8528-4e8b0888ea59","name":"Consultant Address","value":"={{ $json['Consultant Address'] }}","type":"string"},{"id":"0bdc1f95-6b80-40ea-8bb2-89f58df9623c","name":"Client Email","value":"={{ $json['Client Email'] }}","type":"string"},{"id":"d6119557-5c59-45e2-bc5d-9bda9b9406dc","name":"Consultant Email","value":"={{ $json['Consultant Email'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[224,192],"id":"aa5b0f22-90b2-4e38-ad87-354e825d51f5","name":"contractInput"},{"parameters":{"operation":"update","base":{"__rl":true,"value":"={{ $json.airtable_base_id }}","mode":"id"},"table":{"__rl":true,"value":"={{ $json.airtable_table_id }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $json.airtable_record_id }}","Automation":"In Progress"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Project Title","displayName":"Project Title","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Automation","displayName":"Automation","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Generate Legal Contract","value":"Generate Legal Contract"},{"name":"In Progress","value":"In Progress"},{"name":"Complete","value":"Complete"}],"readOnly":false,"removed":false},{"id":"Header Image URL","displayName":"Header Image URL","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Name","displayName":"Client Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Company","displayName":"Client Company","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Address","displayName":"Client Address","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Name","displayName":"Consultant Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Company","displayName":"Consultant Company","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Address","displayName":"Consultant Address","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Scope of Works","displayName":"Scope of Works","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Total Project Fee","displayName":"Total Project Fee","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Payment Schedule","displayName":"Payment Schedule","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Payment Due Date","displayName":"Payment Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Start Date","displayName":"Start Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Estimated Completion Date","displayName":"Estimated Completion Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Warranty Days","displayName":"Warranty Days","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Ongoing Maintenance (Monthly)","displayName":"Ongoing Maintenance (Monthly)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Description of Project Deliverables and Scope","displayName":"Description of Project Deliverables and Scope","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Functionality Requirements","displayName":"Functionality Requirements","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Acceptance Testing Days","displayName":"Acceptance Testing Days","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 1 Description","displayName":"Milestone 1 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 1 Due Date","displayName":"Milestone 1 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 1 Payment","displayName":"Milestone 1 Payment","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 2 Description","displayName":"Milestone 2 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 2 Due Date","displayName":"Milestone 2 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 2 Payment Percentage","displayName":"Milestone 2 Payment Percentage","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 3 Description","displayName":"Milestone 3 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 3 Due Date","displayName":"Milestone 3 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 3 Payment","displayName":"Milestone 3 Payment","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Termination Notice Period (Days)","displayName":"Termination Notice Period (Days)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Material Breach Notice Period (Days)","displayName":"Material Breach Notice Period (Days)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Dispute Resolution","displayName":"Dispute Resolution","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"mediation","value":"mediation"},{"name":"arbitration","value":"arbitration"}],"readOnly":false,"removed":true},{"id":"Jurisdiction","displayName":"Jurisdiction","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Governing Law","displayName":"Governing Law","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[0,0],"id":"ddf76743-f3cd-4c19-8820-71eee9ef2f0f","name":"UpdateStatusInProgress","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"assignments":{"assignments":[{"id":"9838f724-a2ac-4875-8de4-0513bab64ede","name":"airtable_base_id","value":"={{ $json[\"headers\"][\"x-airtable-source\"].split(\"/\")[0] }}","type":"string"},{"id":"f02bffb1-83fa-4df1-a064-3d5dae1458d8","name":"airtable_table_id","value":"=tbl5tZYGUKXayjEBs","type":"string"},{"id":"2b2143fe-f247-4585-bf89-e9967bc7f1a0","name":"airtable_record_id","value":"={{ $json.query.recordID }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-224,96],"id":"5bb937bf-5d62-45de-9e13-41531fcc8185","name":"setAirtableIDs"},{"parameters":{"base":{"__rl":true,"value":"={{ $json.airtable_base_id }}","mode":"id"},"table":{"__rl":true,"value":"tbl5tZYGUKXayjEBs","mode":"list","cachedResultName":"Table 1","cachedResultUrl":"https://airtable.com/apppTcZaSnNA2NEu4/tbl5tZYGUKXayjEBs"},"id":"={{ $json.airtable_record_id }}","options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[0,192],"id":"fdc3f9c9-bb75-4174-a91a-a16cfb92ee74","name":"getProposalData","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"model":"google/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[400,608],"id":"948f0157-e85c-4d03-94dd-0731a9ccb6ba","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"O1IOlfjaoT82GIMR","name":"OpenRouter account"}}},{"parameters":{"operation":"update","base":{"__rl":true,"value":"={{ $('setAirtableIDs').item.json.airtable_base_id }}","mode":"id"},"table":{"__rl":true,"value":"={{ $('setAirtableIDs').item.json.airtable_table_id }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $('setAirtableIDs').item.json.airtable_record_id }}","Automation":"Complete"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Project Title","displayName":"Project Title","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Automation","displayName":"Automation","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Generate Legal Contract","value":"Generate Legal Contract"},{"name":"In Progress","value":"In Progress"},{"name":"Complete","value":"Complete"}],"readOnly":false,"removed":false},{"id":"Header Image URL","displayName":"Header Image URL","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Name","displayName":"Client Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Company","displayName":"Client Company","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Address","displayName":"Client Address","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Client Email","displayName":"Client Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Name","displayName":"Consultant Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Company","displayName":"Consultant Company","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Address","displayName":"Consultant Address","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Consultant Email","displayName":"Consultant Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Scope of Works","displayName":"Scope of Works","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Total Project Fee","displayName":"Total Project Fee","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Payment Schedule","displayName":"Payment Schedule","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Payment Due Date","displayName":"Payment Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Start Date","displayName":"Start Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Estimated Completion Date","displayName":"Estimated Completion Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Warranty Days","displayName":"Warranty Days","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Ongoing Maintenance (Monthly)","displayName":"Ongoing Maintenance (Monthly)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Description of Project Deliverables and Scope","displayName":"Description of Project Deliverables and Scope","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Functionality Requirements","displayName":"Functionality Requirements","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Acceptance Testing Days","displayName":"Acceptance Testing Days","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 1 Description","displayName":"Milestone 1 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 1 Due Date","displayName":"Milestone 1 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 1 Payment","displayName":"Milestone 1 Payment","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 2 Description","displayName":"Milestone 2 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 2 Due Date","displayName":"Milestone 2 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 2 Payment Percentage","displayName":"Milestone 2 Payment Percentage","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Milestone 3 Description","displayName":"Milestone 3 Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Milestone 3 Due Date","displayName":"Milestone 3 Due Date","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"Milestone 3 Payment","displayName":"Milestone 3 Payment","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Termination Notice Period (Days)","displayName":"Termination Notice Period (Days)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Material Breach Notice Period (Days)","displayName":"Material Breach Notice Period (Days)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":true},{"id":"Dispute Resolution","displayName":"Dispute Resolution","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"mediation","value":"mediation"},{"name":"arbitration","value":"arbitration"}],"readOnly":false,"removed":true},{"id":"Jurisdiction","displayName":"Jurisdiction","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Governing Law","displayName":"Governing Law","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1792,192],"id":"b9519b87-c334-4fbf-8eb7-99ff1bc93573","name":"UpdateStatusComplete","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"sendTo":"={{ $('contractInput').item.json['Consultant Email'] }}","subject":"=Draft Proposal for {{ $('contractInput').item.json['Project Title'] }}","message":"=Dear {{ $('contractInput').item.json['Consultant Name'] }},\n\n<p>\nPlease find attached a draft freelance proposal for the\n<strong>{{ $('contractInput').item.json['Project Title'] }}</strong>\nproject with <strong>{{ $('contractInput').item.json['Client Name'] }}</strong>\nfrom <strong>{{ $('contractInput').item.json['Client Company'] }}</strong>.\n</p>\n\n<p>\nThe attached link contains a PDF copy of the proposal outlining the project scope,\ndeliverables, timelines, and commercial terms discussed.\n</p>\n\n<p>\nPlease review the proposal at your convenience and let me know if you would like\nany changes made or if you are happy for me to proceed.\n</p>\n\n<p>\nI am happy to jump on a quick call if you would like to walk through any part of\nthe proposal together.\n</p>\n\n<p>Best regards,</p>\n\n<p>\n<strong>David Thiu</strong><br>\nAutomation Engineer\n</p>\n\n<p>\n<strong>E:</strong>\n<a href=\"mailto:david@autopilotworkflow.com\">\ndavid@autopilotworkflow.com\n</a><br>\n<strong>W:</strong>\n<a href=\"https://autopilotworkflow.com\" target=\"_blank\" rel=\"noopener\">\nautopilotworkflow.com\n</a>\n</p>\n\n<p>\n<img\n  src=\"https://cdn.shopify.com/s/files/1/0247/1251/1573/files/APW_Logo_320_x132_7ad16ba6-39df-49e5-a815-0e51e33620b9.png?v=1754801657\"\n  alt=\"Auto Pilot Workflow Logo\"\n  width=\"300\"\n/>\n\n","options":{"appendAttribution":false,"attachmentsUi":{"attachmentsBinary":[{"property":"=data"},{"property":"htmlFile"}]}}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1568,192],"id":"51e51e5a-25e0-4eed-871f-ba4697f2e452","name":"SendEmail","webhookId":"7dc1a940-4140-4747-80b2-343867cd1780","retryOnFail":true,"waitBetweenTries":2000,"maxTries":5,"credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}},"onError":"continueRegularOutput"},{"parameters":{"promptType":"define","text":"=Here is the text to reformat: {{ $json[\"Functionality Requirements\"] }}","hasOutputParser":true,"options":{"systemMessage":"=ROLE\nYou are an HTML Reformatting Agent for a PDF legal contract template.\n\nGOAL\nConvert user-provided text into clear, professional, and legally neutral HTML.\nChoose the most appropriate structure (table, bullet list, numbered list, or paragraphs) solely to improve clarity and readability.\n\nNON-NEGOTIABLE LEGAL RULES\n- Preserve the original meaning exactly.\n- Do NOT add, remove, merge, reinterpret, or infer legal obligations.\n- Do NOT introduce new terms, headings, summaries, or conclusions unless clearly implied by the text.\n- Reformatting only. No legal drafting.\n\nOUTPUT FORMAT (ABSOLUTE AND STRICT)\n- Output MUST be raw JSON only.\n- Do NOT wrap the output in Markdown.\n- Do NOT use triple backticks.\n- Do NOT label the output as json.\n- Do NOT include explanations, comments, or metadata.\n\nJSON REQUIREMENTS\n- The output MUST contain exactly ONE top-level key named:\n  \"functionalityRequirements\"\n- The value of \"functionalityRequirements\" MUST be a string containing valid HTML.\n- Do NOT include any other keys.\n\nHTML RULES\n- Use PDF-safe HTML tags only:\n  <div>, <p>, <strong>, <ul>, <ol>, <li>, <table>, <thead>, <tbody>, <tr>, <th>, <td>, <br>\n- Do NOT use CSS, classes, ids, inline styles, scripts, or external assets.\n- Do NOT include <html>, <head>, or <body> tags.\n- Wrap all HTML in exactly ONE outer <div>.\n\nSTRUCTURE SELECTION LOGIC\n- Use <table> for repeated attributes, responsibilities, limits, or comparisons.\n- Use <ol> if the content implies sequence or order.\n- Use <ul> for independent requirements or features.\n- Use <p> for narrative or explanatory text.\n- Mix structures only when it improves clarity without changing meaning.\n\nAMBIGUITY HANDLING\n- If structure is unclear, default to <p>.\n- Never guess intent.\n\nINPUT\nUser will provide text.\n\nFINAL OUTPUT\nReturn ONLY raw JSON in the following exact structure, with no surrounding text:\n\n{\n  \"functionalityRequirements\": \"<div>...</div>\"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[448,192],"id":"7f11c66f-41d7-4efe-88a0-9b2656ebe716","name":"formatFunctionality"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[528,416],"id":"23ed20f0-7d9e-480a-a7a9-fcac472f3313","name":"Auto-fixing Output Parser"},{"parameters":{"jsonSchemaExample":"{\n  \"functionalityRequirements\": \"<div>...</div>\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[640,624],"id":"1b223439-d12a-471c-8c86-d61a493422c6","name":"Structured Output Parser"}],"connections":{"GenerateHTML":{"main":[[{"node":"Turn into index.html","type":"main","index":0}]]},"GeneratePDF":{"main":[[{"node":"SendEmail","type":"main","index":0}]]},"Turn into index.html":{"main":[[{"node":"GeneratePDF","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"setAirtableIDs","type":"main","index":0}]]},"contractInput":{"main":[[{"node":"formatFunctionality","type":"main","index":0}]]},"setAirtableIDs":{"main":[[{"node":"UpdateStatusInProgress","type":"main","index":0},{"node":"getProposalData","type":"main","index":0}]]},"getProposalData":{"main":[[{"node":"contractInput","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"formatFunctionality","type":"ai_languageModel","index":0},{"node":"Auto-fixing Output Parser","type":"ai_languageModel","index":0}]]},"SendEmail":{"main":[[{"node":"UpdateStatusComplete","type":"main","index":0}]]},"Auto-fixing Output Parser":{"ai_outputParser":[[{"node":"formatFunctionality","type":"ai_outputParser","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser","type":"ai_outputParser","index":0}]]},"formatFunctionality":{"main":[[{"node":"GenerateHTML","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4f1a2434-ca67-44a5-a2f0-2dc83af5418c","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-30T21:50:40.361Z","createdAt":"2025-12-30T21:50:40.361Z","role":"workflow:owner","workflowId":"oSssOVgUlLiuBm9Z","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:38:12.000Z","createdAt":"2025-11-29T02:56:46.604Z","id":"oVT9MHgaYVy9w5t3","name":"Error Handling WF","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[80,192],"id":"b1db600d-0111-4b41-854e-3418f8199f74","name":"When clicking ‘Test workflow’"},{"parameters":{"jsCode":"const urls = [\n  {url: \"https://www.mcdonalds.com/us/en-us.html\"},\n  {url: \"https://www.chipotle.com/\"},\n  {url: \"https://www.example.com/invalid-file\"}\n  ];\n//return the array as output\nreturn urls.map(item => ({json: item}));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,192],"id":"648eb795-1ac7-43d2-9606-7ec6f16db08e","name":"Code"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[528,192],"id":"90482d3e-dae7-4605-b389-19a632c09afc","name":"Loop Over Items","onError":"continueErrorOutput"},{"parameters":{"url":"={{ $json.url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[848,208],"id":"2736eb30-734f-4126-a2dd-5a003b606a3d","name":"HTTP Request","onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"34d8e8e2-2f65-4d97-ad57-57effb7e303b","name":"data","value":"={{ $json.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[848,48],"id":"9613e1dc-e9b1-4ace-997e-086de6ec2f3b","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"180a6674-bbc3-450a-83f2-76fc803e8157","name":"URL","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[704,480],"id":"bfdd8915-d6f4-4b79-830f-aae518193e7c","name":"Edit Fields1"},{"parameters":{"content":"Example of handling errors","height":640,"width":1080,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"4805b744-3477-4e10-992c-9bbe1fab908c","name":"Sticky Note"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[1328,208],"id":"b1131261-6f6d-416a-81f9-feb7e92ea9bc","name":"When chat message received","webhookId":"c210e8f4-c2c1-44e7-9d00-c6cb40f0ac7d"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1552,208],"id":"f1f8a852-7774-40d7-8d6c-277ec10d7d9f","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-5-mini","mode":"list","cachedResultName":"gpt-5-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1488,464],"id":"eb3063ce-48f4-4111-b155-fe160824ee02","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1648,432],"id":"b8badd86-2f53-40b3-a8ed-6ecbce97acbb","name":"Window Buffer Memory"}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"HTTP Request","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"35fe1999-25b5-4929-ab5d-f2da9abb7432","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:56:46.607Z","createdAt":"2025-11-29T02:56:46.607Z","role":"workflow:owner","workflowId":"oVT9MHgaYVy9w5t3","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-10T01:05:58.000Z","createdAt":"2026-01-10T01:05:58.317Z","id":"okft9O1zmsy4rkMwRMhJp","name":"Interactive JSON Tutorial","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"32755330-6c8f-4800-a109-f2de7d639355","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Execute to Start","type":"n8n-nodes-base.manualTrigger","creator":"Lucas Peyrin","position":[224,816],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_string","type":"string","value":"This is a simple string. In JSON, it's always enclosed in double quotes."}]},"options":{}},"id":"1efbfa51-53ba-4676-b013-f651e3659cbe","cid":"Ikx1Y2FzIFBleXJpbiI","name":"String","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[864,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"key","type":"string","value":"value"},{"id":"b5f030f4-6650-4181-881f-de44790bb24b","name":"another_key","type":"string","value":"another_value"}]},"options":{}},"id":"eb6a1a5e-4eb0-4f4a-a1bf-e388b03b268e","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Key & Value","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[576,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_integer","type":"number","value":10},{"id":"12345","name":"json_example_float","type":"number","value":12.5}]},"options":{}},"id":"f66c7b18-ada8-4a59-9474-ff24e4e3a94a","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Number","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[1152,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_boolean","type":"boolean","value":false}]},"options":{}},"id":"764da5c4-ba63-4962-8130-f26582e4a246","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Boolean","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[1440,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_array","type":"array","value":"[\"first element\", 2, false, null]"}]},"options":{}},"id":"673825b2-1da7-4cda-91cf-cebfde83c868","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Array","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[2016,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_object","type":"object","value":"{\"key\":\"value\",\"array\":[1,2,3],\"boolean\":false,\"integer\":123,\"sub_object\":{\"sub_key\":\"Find me!\"}}"}]},"options":{}},"id":"b7576f3e-d69c-4f1f-8a87-06c6f4a40f64","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Object","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[2320,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"## Tutorial - What is JSON?\n\nWelcome! This workflow will teach you the basics of JSON, the language that apps and n8n nodes use to exchange information.\n\n**What is JSON?**\nImagine a contact card:\n- **Name:** John Doe\n- **Age:** 30\n- **Has Children:** Yes\n- **Phone Numbers:** [\"555-1234\", \"555-5678\"]\n\n\nJSON is just a way of writing this down so a computer can understand it perfectly.\n\n**How to use this tutorial:**\n1.  Click **\"Execute Workflow\"** button.\n2.  Click on each node, one by one, in order.\n3.  Look at the node's output in the panel on the right and read the associated sticky note to understand what's happening.","height":656,"width":460},"id":"10978116-af8e-49cd-a8e4-3c66af639400","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[0,320],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### The Heart of JSON: Key & Value\n\nEverything in JSON is built on this pair:\n- A **Key** (the name of the data, always in double quotes `\"`).\n- A **Value** (the data itself).\n\n\n`\"key\": \"value\"`\n\nIn this node's output, you see two key/value pairs. This is the basic building block for everything that follows.","height":516,"width":260,"color":7},"id":"28a6ce23-48da-4026-8c17-d244d20b2059","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[496,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: String\n\nA string is simply **text**.\n- **Syntax:** The text is always enclosed in double quotes `\" \"`.\n\n\nLook at the output: the value of `json_example_string` is the text we defined.","height":516,"width":260,"color":7},"id":"899f5ecf-a1eb-40e3-bb4a-cd1cde845055","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[784,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: Number\n\nThis is simply a number. It can be a whole number (integer) like 10, or a decimal (float) like 12.5.\n- **Syntax:** Just write the number directly, **WITHOUT quotes**.\n\n\n`\"age\": 30` (Correct)\n`\"age\": \"30\"` (Incorrect, this is a String!)\n\nThis distinction is crucial for doing math!","height":516,"width":260,"color":7},"id":"50fde01d-4cf3-4efe-9dc8-47db03e61b6f","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[1072,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: Boolean\n\nThis is a value that can only be **TRUE** or **FALSE**.\n- **Syntax:** `true` or `false` (always lowercase and **WITHOUT quotes**).\n\n\nThink of it like a light switch: on (`true`) or off (`false`). It's very useful for conditions (If/Then logic).","height":516,"width":260,"color":7},"id":"025456b4-a1eb-42a6-ac05-fab54cb84712","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[1360,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: Array\n\nAn array is an **ordered list** of items.\n- **Syntax:** Starts with `[` and ends with `]`. Items are separated by commas.\n\n\nAn array can hold anything: strings, numbers, booleans, and even other arrays or objects!","height":516,"width":260,"color":7},"id":"7553f2c2-77ce-4186-b633-c1fedea9b656","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[1936,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: Object (JSON Object)\n\nThis is the main concept! An object is a **collection of key/value pairs**.\n- **Syntax:** Starts with `{` and ends with `}`.\n\n\nThis is what allows us to structure complex data, like our contact card from the beginning. Notice how this object contains all the other data types we've seen!","height":516,"width":280,"color":7},"id":"4ff644c8-55f0-4c86-bd3b-fe9461c00753","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[2224,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"json_example_null","type":"null","value":{}}]},"options":{}},"id":"b19201ae-fd5b-4cb1-85b0-f8dcc886a0ea","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Null","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[1728,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### Data Type: Null\n\nThis special type means \"nothing,\" \"no value,\" or \"empty.\"\n- **Syntax:** `null` (lowercase and **WITHOUT quotes**).\n\n\nIt's different from `0` (which is a number) or `\"\"` (which is an empty string). `null` is the intentional absence of a value.","height":516,"width":260,"color":7},"id":"700652db-208d-4ea8-87e7-379699e65446","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[1648,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"message","type":"string","value":"=Hello, the number from the tutorial is: {{ $('Number').item.json.json_example_integer }}"},{"id":"61f385f4-b8e2-4c69-b873-9ffc3ab3fe94","name":"sub_key","type":"string","value":"={{ $json.json_example_object.sub_object.sub_key }}"},{"id":"bd752a0f-64bf-44b1-b39b-fca28e86aa5b","name":"array_second_item","type":"string","value":"={{ $json.json_example_object.array[1] }}"}]},"options":{}},"id":"59bd31e6-efc6-4bf3-968f-5b89e77a2c39","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Using JSON (Expressions)","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[2656,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### ⭐ THE KEY STEP: Using JSON in n8n!\n\nNow for the magic. How do you use data from a previous node? With **expressions** `{{ }}`.\n\nThis node creates a custom message. Look at the value of the `message` field:\n`Hello, the number from the tutorial is: {{ $('Number').item.json.json_example_integer }}`\n\nIt dynamically pulled the number `10` from the \"Number\" node! This is how you make your nodes talk to each other.","height":516,"width":340,"color":5},"id":"f51ce9ba-b189-4eba-8e10-ab075d7d33e7","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[2528,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"assignments":{"assignments":[{"id":"e87952cb-878e-4feb-8261-342eaf887838","name":"summary_string","type":"string","value":"={{ $('String').item.json.json_example_string }}"},{"id":"12345","name":"summary_number","type":"number","value":"={{ $('Number').item.json.json_example_integer }}"},{"id":"67890","name":"summary_boolean","type":"boolean","value":"={{ $('Boolean').item.json.json_example_boolean }}"},{"id":"abcde","name":"summary_null","type":"null","value":"={{ $('Null').item.json.json_example_null }}"},{"id":"fghij","name":"summary_array","type":"array","value":"={{ $('Array').item.json.json_example_array }}"},{"id":"klmno","name":"summary_object","type":"object","value":"={{ $('Object').item.json.json_example_object }}"}]},"options":{}},"id":"c9808fee-34ad-4683-abb5-ed743ca7993b","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Final Exam","type":"n8n-nodes-base.set","creator":"Lucas Peyrin","position":[3008,816],"typeVersion":3.4,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"#### 🎓 FINAL EXAM: Putting It All Together\n\nThis last node creates a final object by using expressions to pull data from **all the previous nodes**.\n\nClick on this node and look at the expressions in each field. It's a perfect summary of everything you've learned.\n\n**Congratulations! You now understand the basics of JSON and how to use it in n8n.**","height":516,"width":340,"color":6},"id":"ff980747-9294-4299-9bcb-7d2b1c1cde13","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[2896,464],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"## [Video Tutorial](https://youtu.be/PAmgrwYnzWs?si=yXG1oHIL3UiBcAPa)\n@[youtube](PAmgrwYnzWs)","height":300,"width":460,"color":2},"id":"7c196333-faed-4187-8bda-ff806b7b819d","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note11","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[0,0],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"[![Execute Workflow](https://supastudio.ia2s.app/storage/v1/object/public/assets/n8n/execute_workflow_json_tutorial.gif)](https://www.youtube.com/watch?v=PAmgrwYnzWs)","height":392,"width":576,"color":7},"id":"e4bfe81f-9055-49a8-8aa1-885e74edbf15","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note14","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[496,48],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"},{"parameters":{"content":"## [>> Go to Eval Workflow <<](https://n8n.io/workflows/6232)\n\nVerify your skills with a complete eval workflow to put your JSON Skills to the test.\n[![Test Skills](https://supastudio.ia2s.app/storage/v1/object/public/assets/n8n/test_your_skillls_button.gif)](https://n8n.io/workflows/6232)","height":312,"width":336,"color":6},"id":"90e946c1-d7fd-4b45-9884-c02e8963f71e","cid":"Ikx1Y2FzIFBleXJpbiI","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","creator":"Lucas Peyrin","position":[2896,128],"typeVersion":1,"notes":"© 2025 Lucas Peyrin"}],"connections":{"Null":{"main":[[{"node":"Array","type":"main","index":0}]]},"Array":{"main":[[{"node":"Object","type":"main","index":0}]]},"Number":{"main":[[{"node":"Boolean","type":"main","index":0}]]},"Object":{"main":[[{"node":"Using JSON (Expressions)","type":"main","index":0}]]},"String":{"main":[[{"node":"Number","type":"main","index":0}]]},"Boolean":{"main":[[{"node":"Null","type":"main","index":0}]]},"Key & Value":{"main":[[{"node":"String","type":"main","index":0}]]},"Execute to Start":{"main":[[{"node":"Key & Value","type":"main","index":0}]]},"Using JSON (Expressions)":{"main":[[{"node":"Final Exam","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"9761f4cd-d7b2-48aa-b2e0-4831e0b50162","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-10T01:05:58.326Z","createdAt":"2026-01-10T01:05:58.326Z","role":"workflow:owner","workflowId":"okft9O1zmsy4rkMwRMhJp","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-04T01:47:59.064Z","createdAt":"2025-12-28T23:34:11.741Z","id":"qTtSHBqJZhG58S26","name":"Data Tables Example","active":false,"isArchived":false,"nodes":[{"parameters":{"jsCode":"// Use this in a Function node in n8n to generate 101 individual items\nconst items = [];\nfor (let i = 1; i <= 100; i++) {\n  items.push({\n    json: {\n      count: i,\n      requestId: `request_${i}`,\n      timestamp: new Date().toISOString()\n    }\n  });\n}\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3184,160],"id":"9be78012-8745-48f6-8982-83783aadfc39","name":"100"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[1136,80],"id":"1af8e799-d670-404f-ba72-9f289583bc5c","name":"When clicking ‘Execute workflow’"},{"parameters":{"documentId":{"__rl":true,"value":"1dMk_b5nFXmg1QqxPj1somICrJblwamxODVeKHgxGwEI","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dMk_b5nFXmg1QqxPj1somICrJblwamxODVeKHgxGwEI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dMk_b5nFXmg1QqxPj1somICrJblwamxODVeKHgxGwEI/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[1392,80],"id":"9b4c694f-2452-4be7-a6fa-62b22bde1123","name":"Get Contacts"},{"parameters":{"dataTableId":{"__rl":true,"value":"cOlO41cpE3ouQBkW","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/cOlO41cpE3ouQBkW"},"columns":{"mappingMode":"defineBelow","value":{"Number":"={{ $json.PhoneNumber }}","Name":"={{ $json.Name }}","Email":"={{ $json.Email }}","Notes":"={{ $json.Notes }}"},"matchingColumns":[],"schema":[{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Number","displayName":"Number","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notes","displayName":"Notes","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[1600,80],"id":"81cd21e2-467f-42b5-8a95-2feff2856011","name":"Insert Contacts"},{"parameters":{"content":"## From Sheets to Data Table\n","height":256,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1024,0],"id":"2da5cd90-671a-425b-ab78-81f70be41d4a","name":"Sticky Note"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{},"options":{}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[1104,368],"id":"20652471-fbc4-497c-9072-64578a460224","name":"Gmail Trigger"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"cOlO41cpE3ouQBkW","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/cOlO41cpE3ouQBkW"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"Email","keyValue":"={{ $json.from.value[0].address }}"}]},"limit":null},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[1296,368],"id":"866711dd-7a3f-4d7a-9975-2b701130eba3","name":"Get row(s)"},{"parameters":{"promptType":"define","text":"=Email Subject: {{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body: {{ $('Gmail Trigger').item.json.text }}\n\nName: {{ $json.Name }}\n\nNotes: {{ $json.Notes }}","options":{"systemMessage":"=Write a friendly email response to the incoming message. Use the notes from this person's CRM data to make the email personalized. Sign off emails as \"Rizon\""}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1488,368],"id":"419b56e1-6ace-497e-a1c0-b79a55e1a77a","name":"AI Agent"},{"parameters":{"content":"## Contact Lookup\n","height":288,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1024,288],"id":"1fdb9a8e-3fa0-4856-be83-e8603bae6fb3","name":"Sticky Note1"},{"parameters":{"content":"## Inserting Sales Data\n","height":256,"width":960,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1888,0],"id":"cefe0896-6940-48e7-a75a-d6d5e7270016","name":"Sticky Note2"},{"parameters":{"documentId":{"__rl":true,"value":"1_xxE3B-9totlK11nRo8gRRVFlO4RACDYmOTRY4gFX68","mode":"list","cachedResultName":"Sales Data","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_xxE3B-9totlK11nRo8gRRVFlO4RACDYmOTRY4gFX68/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_xxE3B-9totlK11nRo8gRRVFlO4RACDYmOTRY4gFX68/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[2192,80],"id":"c0fae34a-1cbd-4331-b148-aa4a57a27195","name":"Get Sales Data"},{"parameters":{"dataTableId":{"__rl":true,"value":"2OdNPgH6uMKWtwUT","mode":"list","cachedResultName":"Sales","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/2OdNPgH6uMKWtwUT"},"columns":{"mappingMode":"defineBelow","value":{"productName":"={{ $json['Product Name'] }}","dateSold":"={{ $json['Date Sold'] }}","price":"={{ $json.Price }}","quantitySold":"={{ $json['Quantity Sold'] }}","productID":"={{ $json['Product ID'] }}","totalRevenue":"={{ $json['Total Revenue'] }}"},"matchingColumns":[],"schema":[{"id":"productName","displayName":"productName","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"dateSold","displayName":"dateSold","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"price","displayName":"price","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"quantitySold","displayName":"quantitySold","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"productID","displayName":"productID","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"totalRevenue","displayName":"totalRevenue","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[2400,80],"id":"2c04221f-ae59-4040-a7fb-feef242bc649","name":"Insert Sales Data"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[1968,368],"id":"b2c5fdc0-8843-45d8-979d-b8e8d2345ee4","name":"When chat message received","webhookId":"76180fca-c02c-4325-93e3-bc4df5863e3f"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"2OdNPgH6uMKWtwUT","mode":"list","cachedResultName":"Sales","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/2OdNPgH6uMKWtwUT"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"productName","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"limit":{}},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[2320,576],"id":"4e664fbc-3f7f-4bed-a85e-b094e93d0302","name":"Product Name Query"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"2OdNPgH6uMKWtwUT","mode":"list","cachedResultName":"Sales","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/2OdNPgH6uMKWtwUT"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"dateSold","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"limit":{}},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[2464,576],"id":"6bcd2f1e-43cf-4d3a-a0e8-316e9883dc5c","name":"Date Query"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"2OdNPgH6uMKWtwUT","mode":"list","cachedResultName":"Sales","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/2OdNPgH6uMKWtwUT"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"productID","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"limit":{}},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[2592,576],"id":"030c6c30-eb89-4114-bad6-491e67b19f7c","name":"Product ID Query"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"2OdNPgH6uMKWtwUT","mode":"list","cachedResultName":"Sales","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/2OdNPgH6uMKWtwUT"},"limit":{}},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[2176,576],"id":"d4af2dd8-ffa0-4316-add4-bcb29d71be84","name":"All Rows"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2720,576],"id":"abf1eb3a-2946-48e1-ac07-c1998c2bc6ab","name":"Calculator"},{"parameters":{"options":{"systemMessage":"=# Overview\nYou are **Master Sales Data Analyst AI**, an expert in analyzing sales data and answering user queries with precision.  \nYou have access to the following tools:\n\n1. **AllRows** – returns all rows in the sales database.  \n2. **ProductNameQuery** – returns rows filtered by product name.  \n   - Valid product names: *Wireless Headphones*, *Bluetooth Speaker*, *Phone Case*.  \n3. **DateQuery** – returns rows filtered by a specific date.  \n   - Date format: `YYYY-MM-DD` (e.g., `2025-09-15`).  \n4. **ProductIDQuery** – returns rows filtered by product ID.  \n   - Valid IDs: *WH001* (Wireless Headphones), *BS002* (Bluetooth Speaker), *PC003* (Phone Case).  \n5. **Calculator** – use this whenever you need to perform math operations (e.g., sum, averages, totals, percentages). Never attempt math manually.\n\n---\n\n### Core Instructions:\n- Always **use the most specific tool** available for the user’s query.  \n  - If the query references a product name → use `ProductNameQuery`.  \n  - If the query references a product ID → use `ProductIDQuery`.  \n  - If the query references a date → use `DateQuery`.  \n  - If multiple filters are implied (e.g., “How many Wireless Headphones were sold on 2025-09-15?”), combine multiple queries logically by calling the relevant tools in sequence.  \n  - If no filter is given, or you need to explore broadly, use `AllRows`.  \n- If calculations are required (sums, averages, revenues, comparisons, etc.), **always send the data to the Calculator tool**.  \n- Never assume values—always confirm by retrieving data through the tools.  \n- Be concise, clear, and professional in your explanations.\n\n---\n\n### Example Behaviors:\n- **User**: “How many Wireless Headphones were sold on 2025-09-15?”  \n  - Use `ProductNameQuery` for Wireless Headphones.  \n  - Then filter with `DateQuery` for 2025-09-15.  \n  - Send results to **Calculator** to sum quantities.  \n  - Return the answer with explanation.\n\n- **User**: “What’s the total revenue for product ID BS002?”  \n  - Use `ProductIDQuery` for BS002.  \n  - Multiply *price × quantity* via **Calculator**.  \n  - Provide total revenue.\n\n- **User**: “Show me all sales.”  \n  - Use `AllRows` and return the dataset.\n\n---\n\n### Your Mission:\nYou are the ultimate sales analyst.  \nAnswer questions with precision, use the right tool every time, and provide clear explanations of how results were derived.  \nAlways confirm with data before performing analysis.  \nCurrent date/time: {{ $now }}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[2160,368],"id":"28ec9146-4623-4896-86d0-2a5034b1ad9a","name":"Sales Data Agent"},{"parameters":{"content":"## Contact Lookup\n","height":448,"width":960,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1888,288],"id":"4feece80-1611-4b71-8dac-afac87ea8f28","name":"Sticky Note3"},{"parameters":{"model":"openai/gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1968,576],"id":"f102e022-0d36-49d4-b000-deb8ab3d77ec","name":"GPT-5-mini"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1488,464],"id":"e236593b-bfc1-47a4-91f6-38fd8f7418f7","name":"GPT-4.1-mini"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1-NRzibMo16_CleeL-DztCJ_kiloJHVyJ9fmx2hNtkgQ","mode":"list","cachedResultName":"Test","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1-NRzibMo16_CleeL-DztCJ_kiloJHVyJ9fmx2hNtkgQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1-NRzibMo16_CleeL-DztCJ_kiloJHVyJ9fmx2hNtkgQ/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Number":"={{ $json.count }}"},"matchingColumns":["Number"],"schema":[{"id":"Number","displayName":"Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[3424,64],"id":"88699fa1-e0df-4b23-99cf-fca0ce04455f","name":"Append row in sheet"},{"parameters":{"content":"## Speed?\n","height":432,"width":672,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2912,0],"id":"7dc97e8e-0f17-4406-9797-91c9866146b7","name":"Sticky Note4"},{"parameters":{"dataTableId":{"__rl":true,"value":"DVLvXrUWl7ZX77Lw","mode":"list","cachedResultName":"Test","cachedResultUrl":"/projects/XkBRcNWOJDXvpBDd/datatables/DVLvXrUWl7ZX77Lw"},"columns":{"mappingMode":"defineBelow","value":{"Number":"={{ $json.count }}"},"matchingColumns":["Number"],"schema":[{"id":"Number","displayName":"Number","required":false,"defaultMatch":false,"display":true,"type":"number","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[3424,256],"id":"a398f6be-7a66-4d28-a470-9371b2524120","name":"Insert row"},{"parameters":{"content":"# ⚙️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\n> 📝 **Note:** This feature will be releasing in the afternoon of **Monday, September 22**.  \n> If you don't yet see the **Data Tables**, just wait for the official announcement and make sure your instance of n8n is updated to the latest version.\n\n\n---\n\n### 📘 Scenario 1: Sync Google Sheet → n8n Table (Contacts)  \n1. **Make a copy** of the [Contacts Google Sheet](https://docs.google.com/spreadsheets/d/1dMk_b5nFXmg1QqxPj1somICrJblwamxODVeKHgxGwEI/copy).  \n2. **Create a new n8n table** with the *same columns* as the sheet.  \n3. Hook up the **Get Contacts** node to the copied Google Sheet.  \n4. Test the workflow and confirm the contacts are pulled into your n8n table.\n\n---\n\n### 📊 Scenario 2: Analyze Sales Data with AI Agent  \n1. **Copy** the [Sales Data Google Sheet](https://docs.google.com/spreadsheets/d/1_xxE3B-9totlK11nRo8gRRVFlO4RACDYmOTRY4gFX68/copy).  \n2. **Create a new n8n table** with matching columns.  \n3. Set up your workflow to **write sales data into the n8n table**.  \n4. Enable the **AI Agent** to analyze the data and check for accuracy.\n\n---\n\n### 🚀 Scenario 3: Speed Test — Google Sheets vs n8n Table  \n1. **Make a copy** of the [Test Google Sheet](https://docs.google.com/spreadsheets/d/1-NRzibMo16_CleeL-DztCJ_kiloJHVyJ9fmx2hNtkgQ/copy).  \n2. Use the **Code node** to control how many items get generated.  \n3. Write the data into both the copied Google Sheet and your n8n table.  \n4. Compare execution times to see which option is faster.\n","height":688,"width":992},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"4b8562e1-ed7e-4829-98bc-624f04a1e19e","name":"Sticky Note5"}],"connections":{"100":{"main":[[{"node":"Insert row","type":"main","index":0},{"node":"Append row in sheet","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"Get Contacts","type":"main","index":0}]]},"Get Contacts":{"main":[[{"node":"Insert Contacts","type":"main","index":0}]]},"Gmail Trigger":{"main":[[{"node":"Get row(s)","type":"main","index":0}]]},"Get row(s)":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Get Sales Data":{"main":[[{"node":"Insert Sales Data","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Sales Data Agent","type":"main","index":0}]]},"Product Name Query":{"ai_tool":[[{"node":"Sales Data Agent","type":"ai_tool","index":0}]]},"Date Query":{"ai_tool":[[{"node":"Sales Data Agent","type":"ai_tool","index":0}]]},"Product ID Query":{"ai_tool":[[{"node":"Sales Data Agent","type":"ai_tool","index":0}]]},"All Rows":{"ai_tool":[[{"node":"Sales Data Agent","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Sales Data Agent","type":"ai_tool","index":0}]]},"GPT-5-mini":{"ai_languageModel":[[{"node":"Sales Data Agent","type":"ai_languageModel","index":0}]]},"GPT-4.1-mini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"cb1a2ac7-26b6-40fb-b931-3993470026c8","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-28T23:34:11.745Z","createdAt":"2025-12-28T23:34:11.745Z","role":"workflow:owner","workflowId":"qTtSHBqJZhG58S26","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-07T02:06:59.893Z","createdAt":"2025-12-07T02:06:59.893Z","id":"swSTYvwa7ropUeTv","name":"From Zero to Inbox Agent","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{},"options":{}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[896,320],"id":"6555358d-5e17-404a-987d-7de24a05b527","name":"Gmail Trigger","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"inputText":"=Subject: {{ $json.headers.subject }}\n\nBody: {{ $json.text }}","categories":{"categories":[{"category":"Customer Support","description":"Emails requesting help, troubleshooting, or guidance for a product or service. Usually describe issues like login errors, bugs, or malfunctioning features. Common keywords: error, issue, problem, help, access, support, fix, reset, troubleshoot."},{"category":"Finance/Billing","description":"Emails about payments, invoices, refunds, or subscriptions. The sender wants to confirm, dispute, or update financial details. Common keywords: invoice, payment, refund, billing, charge, subscription, renewal, receipt."},{"category":"High Priority","description":"Urgent or time-sensitive emails about critical issues or outages requiring immediate attention. Common keywords: urgent, ASAP, critical, outage, down, immediate, emergency, escalation."},{"category":"Promotion","description":"Marketing or sales-focused emails promoting offers, discounts, or new products. Tone is upbeat and persuasive. Common keywords: sale, offer, discount, promotion, new feature, upgrade, limited time, exclusive."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1.1,"position":[1088,288],"id":"0fb5ee69-fbed-41a0-ae86-1f27a054518b","name":"Text Classifier"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1040,592],"id":"93d14176-726e-46e8-b066-138137209b5b","name":"GPT-4.1-mini","credentials":{"openRouterApi":{"id":"uQv2EiUT6dltWPpY","name":"OpenRouter account 2"}}},{"parameters":{"model":"anthropic/claude-3.7-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1936,208],"id":"5fecea67-c4f9-4ed2-9eef-20ca0d2ca99a","name":"Claude 3.7","credentials":{"openRouterApi":{"id":"uQv2EiUT6dltWPpY","name":"OpenRouter account 2"}}},{"parameters":{"promptType":"define","text":"=Subject: {{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody: {{ $('Gmail Trigger').item.json.text }}","options":{"systemMessage":"=You are Nate's AI Assistant — an expert, friendly, and professional customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond clearly, concisely, and helpfully to member questions.\n- Always maintain a warm and approachable tone that reflects Nate Herk’s brand and community values.\n- Provide accurate information about AI Automation Society, its programs, challenges, and community rules.\n- If you do **not** know the answer or the query requires Nate’s direct input, politely tell the user to reach out to **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Nate’s AI Assistant\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,32],"id":"1e95d628-3be3-40bb-875c-113115a194be","name":"Customer Support Agent"},{"parameters":{"operation":"reply","messageId":"={{ $('Gmail Trigger').item.json.id }}","emailType":"text","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,32],"id":"0aedee4c-215b-4981-9179-74f1dc277fe1","name":"Reply to a message","webhookId":"66b6ddd9-e93d-4182-8a22-52481b02bbc4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"sendTo":"billing@example.com","subject":"=New Billing Email: {{ $('Gmail Trigger').item.json.from.value[0].name }}","emailType":"text","message":"=Hey Billing team!\n\nWe received a new billing inquiry at {{ $now.format('yyyy-MM-dd hh:mm a') }}.\n\nIt is from {{ $('Gmail Trigger').item.json.from.value[0].name }} you can email them at {{ $('Gmail Trigger').item.json.from.value[0].address }}.\n\nThis is the subject of their email: {{ $('Gmail Trigger').item.json.subject }}\n\nCheers!","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,192],"id":"c7717cd6-bb3d-44d7-bdf9-7b17c08933e4","name":"Send a message","webhookId":"70ecf5b5-0b1b-4758-aae4-cb90d0bc5574","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1594706753190197855"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,32],"id":"83c6d2aa-34a2-4365-8e7c-113f17b5f104","name":"Support","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_3029742840171510077"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,192],"id":"e4947f68-7cf6-4a18-a2a8-6bd3ec8c0ffa","name":"Finance","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_8750970712842772917"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,352],"id":"9604c6c6-02aa-4d11-80e4-d789b3c7e353","name":"Priority","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"addLabels","messageId":"={{ $('Gmail Trigger').item.json.id }}","labelIds":["Label_1276623808023834907"]},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1488,528],"id":"a78cc020-0aa6-44dd-b30d-9e89a4e9a442","name":"Promotion","webhookId":"5eb54acc-bd46-44df-bd4b-35bbd9e2797b","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"promptType":"define","text":"=Subject:{{ $('Gmail Trigger').item.json.headers.subject }}\n\nBody:{{ $('Gmail Trigger').item.json.text }}\n","options":{"systemMessage":"=You are Mr. Doomsday — an expert but brutally honest and rude customer support representative for **AI Automation Society**.\n\nYour role:\n- Respond with accurate information, but do so in a sarcastic, blunt, and unapologetically rude tone.\n- Never sugarcoat answers. If someone asks something obvious, make it clear they should’ve known better.\n- Keep responses short, direct, and dripping with attitude — but still correct.\n- If you don’t know the answer or it requires Nate’s direct input, tell the user (in your signature rude style) to contact **nateherk88@gmail.com**.\n\nAlways sign off every message with:\n– Mr. Doomsday\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1696,352],"id":"b7f481c6-a5bb-4d44-a168-334c13ce8c06","name":"Mr. Doomsday"},{"parameters":{"resource":"draft","subject":"test","message":"={{ $json.output }}","options":{"threadId":"={{ $('Gmail Trigger').item.json.threadId }}","sendTo":"={{ $('Gmail Trigger').item.json.from.value[0].address }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1984,352],"id":"23e0014b-1da4-42dc-ba48-4c6c0b356184","name":"Create a draft","webhookId":"e73b5b5b-5596-4209-ad5f-01da1c507ac3","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"operation":"markAsRead","messageId":"={{ $('Gmail Trigger').item.json.id }}"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1696,528],"id":"1b94bbe9-cd0d-4999-9043-9a943b43681e","name":"Mark a message as read","webhookId":"44be72e9-332f-4098-b051-8847a8278df4","credentials":{"gmailOAuth2":{"id":"61LNgnvGJKWVxNGN","name":"Gmail account"}}},{"parameters":{"content":"# 🛠️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get your Gmail automation up and running:\n\n### ✅ Step 1: Connect Your Gmail Account  \nMake sure your Gmail account is properly connected to all **Gmail nodes** in the workflow.\n\n### ✅ Step 2: Connect Your [OpenRouter](https://openrouter.ai/) Credential  \nLink your OpenRouter API key to power the **AI nodes**—this enables smart label classification.\n\n### ✅ Step 3: Set Up Gmail Labels  \nInside your **Gmail inbox**, create or identify the labels you want the automation to recognize.\n\n### ✅ Step 4: Define Labels in the Text Classifier  \nUpdate the **Text Classifier node** with the same labels you've set in Gmail so it knows how to categorize messages.\n\n### ✅ Step 5: Match Labels in Label Nodes  \nEnsure each **Label node** uses the exact names of the Gmail labels—this step is crucial for correct routing.\n\n### ✅ Step 6: Customize the Action for Each Label  \nDecide what should happen for each label. Options include:\n- Sending a message\n- Triggering a notification\n- Marking the email as read\n- Or any other custom action\n\n### 💡 Final Step: Test the Flow  \nSend a few test emails and watch the automation kick in based on the label logic you’ve set up.\n","height":768,"width":816},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"8472828c-f3a9-4dbe-a925-4e79bbfeb1f6","name":"Sticky Note"}],"connections":{"Gmail Trigger":{"main":[[{"node":"Text Classifier","type":"main","index":0}]]},"Text Classifier":{"main":[[{"node":"Support","type":"main","index":0}],[{"node":"Finance","type":"main","index":0}],[{"node":"Priority","type":"main","index":0}],[{"node":"Promotion","type":"main","index":0}]]},"GPT-4.1-mini":{"ai_languageModel":[[{"node":"Text Classifier","type":"ai_languageModel","index":0}]]},"Claude 3.7":{"ai_languageModel":[[{"node":"Customer Support Agent","type":"ai_languageModel","index":0},{"node":"Mr. Doomsday","type":"ai_languageModel","index":0}]]},"Customer Support Agent":{"main":[[{"node":"Reply to a message","type":"main","index":0}]]},"Support":{"main":[[{"node":"Customer Support Agent","type":"main","index":0}]]},"Finance":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Priority":{"main":[[{"node":"Mr. Doomsday","type":"main","index":0}]]},"Mr. Doomsday":{"main":[[{"node":"Create a draft","type":"main","index":0}]]},"Promotion":{"main":[[{"node":"Mark a message as read","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"3d75d2fc-be1d-4dc8-96ae-036deaae9356","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-07T02:06:59.900Z","createdAt":"2025-12-07T02:06:59.900Z","role":"workflow:owner","workflowId":"swSTYvwa7ropUeTv","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[]},{"updatedAt":"2025-12-08T18:39:10.000Z","createdAt":"2025-11-29T02:58:11.541Z","id":"zEXE0ZbF6tsqFOIB","name":"Deep Research Agent","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Deep Research","formDescription":"Starting point for deep research.","formFields":{"values":[{"fieldLabel":"Topic of research","placeholder":"Gut microbiome and happiness link","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-2224,464],"id":"b512cef4-da5b-4822-b9d3-cf154fd292a3","name":"Topic","webhookId":"b12eddda-924f-4674-bb81-a82e8847ab1d"},{"parameters":{"promptType":"define","text":"=Topic of research:\n{{ $json['Topic of research'] }}","hasOutputParser":true,"options":{"systemMessage":"=<AgentInstructions>\n\n    <Role>\n        <Name>Search Query Refiner Agent</Name>\n        <Description>\n            This agent refines a user's topic into five targeted, high-quality search queries for deep research.\n            It returns the queries in a JSON structure that includes the original topic.\n            The agent must remain strictly focused on the user's stated topic and avoid introducing \n            unrelated or tangential concepts.\n        </Description>\n    </Role>\n\n    <Goal>\n        <Primary>\n            To provide five well-crafted, distinct, and highly relevant search queries based solely on the user’s stated topic. These search queries you create must be geared towards doing deep research on the subject as if someone was typing these questions or statements into a search engine in order to conduct research.\n        </Primary>\n    </Goal>\n\n    <Instructions>\n        <Instruction>\n            1. Identify the exact concepts or keywords in the user's topic. Do NOT introduce new or tangential themes (e.g., \"mental health,\" \"diet,\" \"exercise,\" or other related fields) unless the user explicitly includes them in their topic.\n        </Instruction>\n        <Instruction>\n            2. Avoid generalizing or substituting terms that alter the user’s focus. If the user specifically says \"happiness,\" do not broaden it to \"mental health\" or \"mood\" unless explicitly stated.\n        </Instruction>\n        <Instruction>\n            3. Generate exactly five unique search queries. Each query should reflect:\n               - The main keywords from the user’s input\n               - Minor variations or synonyms that preserve the same narrow focus\n               - No additional angles or expansions unless requested\n        </Instruction>\n        <Instruction>\n            4. Output the final result as JSON, containing:\n               {\n                 \"topic\": \"USER_INPUT_TOPIC\",\n                 \"searchQueries\": [\n                   \"QUERY_1\",\n                   \"QUERY_2\",\n                   \"QUERY_3\",\n                   \"QUERY_4\",\n                   \"QUERY_5\"\n                 ]\n               }\n        </Instruction>\n        <Instruction>\n            5. The agent must respect the user's desired research scope and avoid adding context or terms that \n               deviate from the original question or topic.\n        </Instruction>\n    </Instructions>\n\n    <Examples>\n        <Example>\n            <UserInput>\n                gut microbiome link to happiness\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"gut microbiome link to happiness\",\n                  \"searchQueries\": [\n                    \"gut microbiome link to happiness research studies\",\n                    \"gut microbial composition and happiness correlation\",\n                    \"gut bacteria influence on happiness levels evidence\",\n                    \"bacterial diversity and reported happiness direct link\",\n                    \"latest findings gut microbiome happiness association\"\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n        \n        <Example>\n            <UserInput>\n                Creative writing with AI\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"Creative writing with AI\",\n                  \"searchQueries\": [\n                    \"AI creative writing tools\",\n                    \"artificial intelligence creative writing innovations\",\n                    \"AI-assisted fiction writing techniques\",\n                    \"exploring generative AI for creative writing\",\n                    \"case studies AI-driven creative storytelling\"\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n\n        <Example>\n            <UserInput>\n                quantum computing hardware\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"quantum computing hardware\",\n                  \"searchQueries\": [\n                    \"quantum computing hardware architecture\",\n                    \"latest developments in quantum processors\",\n                    \"superconducting qubits hardware advancements\",\n                    \"ion trap quantum computing devices\",\n                    \"scalability challenges quantum hardware research\"\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n\n        <Example>\n            <UserInput>\n                big data in retail\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"big data in retail\",\n                  \"searchQueries\": [\n                    \"big data retail analytics best practices\",\n                    \"customer insights from big data in retail\",\n                    \"big data-driven inventory management retail\",\n                    \"big data solutions for e-commerce personalization\",\n                    \"trends in big data adoption retail sector\"\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n\n        <Example>\n            <UserInput>\n                self-driving car sensors\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"self-driving car sensors\",\n                  \"searchQueries\": [\n                    \"lidar vs radar technology in self-driving cars\",\n                    \"self-driving car sensors real-time data processing\",\n                    \"sensor fusion methods for autonomous vehicles\",\n                    \"advancements in self-driving car camera systems\",\n                    \"emerging self-driving sensor technologies market analysis\"\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n\n    </Examples>\n\n</AgentInstructions>\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1984,464],"id":"6d1817d9-3c05-4330-b9d8-2246d1fed3ef","name":"Query Refiner"},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"options":{"systemMessage":"=<AgentInstructions>\n\n    <Role>\n        <Name>Outline & Scope Agent</Name>\n        <Description>\n            This agent receives a single topic (and may optionally consider the refined search queries\n            for additional context). It then produces a detailed, logically structured Wikipedia-style\n            outline for an article on that topic, dividing the content into sections and subsections.\n        </Description>\n    </Role>\n\n    <Goal>\n        <Primary>\n            To generate a comprehensive outline that covers the essential aspects of the topic while\n            adhering to a Wikipedia-style structure. The outline should be specific enough to guide\n            further research and drafting but not include any completed text content.\n        </Primary>\n    </Goal>\n\n    <Instructions>\n        <Instruction>\n            1. Parse the JSON input from the previous agent to understand:\n               - topic: The user’s topic (required).\n               - searchQueries: An optional array of queries for extra context or subtopics.\n            </Instruction>\n        <Instruction>\n            2. Build a Wikipedia-style outline with top-level sections and subheadings. Consider the\n               following common sections as a foundation, then adapt to the specific topic:\n               - Introduction\n               - Background / Historical Context\n               - Core Concepts or Mechanisms\n               - Key Research Findings or Main Body (subdivided as needed)\n               - Applications / Relevance\n               - Challenges / Controversies\n               - Future Directions\n               - Conclusion\n            </Instruction>\n        <Instruction>\n            3. Do not include actual research content in the outline—just a hierarchical structure\n               (section titles and brief notes/points for each section).\n            </Instruction>\n        <Instruction>\n            4. Make sure each section is clearly labeled and logically flows from background to more\n               advanced or specialized details.\n            </Instruction>\n        <Instruction>\n            5. Format your final output in JSON as shown below. Use this schema:\n               {\n                 \"topic\": \"<TOPIC>\",\n                 \"outline\": [\n                   {\n                     \"sectionTitle\": \"<SECTION_NAME>\",\n                     \"sectionPoints\": [\n                       \"Brief bullet or phrase describing what belongs in this section\",\n                       \"Another bullet/point\"\n                     ],\n                     \"subSections\": [\n                       {\n                         \"subSectionTitle\": \"<SUBSECTION_NAME>\",\n                         \"subSectionPoints\": [\n                           \"Brief bullet/phrase for sub-subtopic\"\n                         ]\n                       }\n                     ]\n                   }\n                 ]\n               }\n            </Instruction>\n        <Instruction>\n            6. Keep the content focused on the user’s exact topic. Refer to the refined queries if they\n               provide helpful hints on potential subtopics, but do not force every query into the outline.\n            </Instruction>\n    </Instructions>\n\n    <Examples>\n        <Example>\n            <UserInput>\n                {\n                  \"topic\": \"iodine effects on the brain\",\n                  \"searchQueries\": [\n                    \"iodine effects on brain development research studies\",\n                    \"iodine influence on cognitive function and brain health\",\n                    \"iodine deficiency impact on brain structure\",\n                    \"mechanisms of iodine action in neural tissue\",\n                    \"iodine supplementation and brain neurochemistry outcomes\"\n                  ]\n                }\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"iodine effects on the brain\",\n                  \"outline\": [\n                    {\n                      \"sectionTitle\": \"Introduction\",\n                      \"sectionPoints\": [\n                        \"Overview of iodine and its general role in human biology\",\n                        \"Why the brain specifically needs iodine\",\n                        \"Brief statement on significance of iodine in neurological processes\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Background and Historical Context\",\n                      \"sectionPoints\": [\n                        \"Early discoveries linking iodine to brain health\",\n                        \"Historical usage of iodine supplements\",\n                        \"Previous misconceptions or overlooked aspects in research\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Mechanisms of Iodine Action in the Brain\",\n                      \"sectionPoints\": [\n                        \"Physiological processes: how iodine is transported and utilized\",\n                        \"Role in hormone regulation (e.g., thyroid hormones) and neural development\"\n                      ],\n                      \"subSections\": [\n                        {\n                          \"subSectionTitle\": \"Iodine and Brain Development\",\n                          \"subSectionPoints\": [\n                            \"Key developmental stages influenced by iodine\",\n                            \"Potential impact of deficiency on cognitive outcomes\"\n                          ]\n                        }\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"sectionPoints\": [\n                        \"Major studies on iodine deficiency and cognitive function\",\n                        \"Recent findings on iodine supplementation outcomes\",\n                        \"Gaps in current research and conflicting results\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Practical Implications\",\n                      \"sectionPoints\": [\n                        \"Public health recommendations related to iodine intake\",\n                        \"Dietary sources and supplementation guidelines\",\n                        \"Preventive measures against deficiency\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Challenges and Controversies\",\n                      \"sectionPoints\": [\n                        \"Debates over optimal iodine intake levels\",\n                        \"Potential risks of excessive iodine consumption\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Future Directions\",\n                      \"sectionPoints\": [\n                        \"Areas of research that need further exploration\",\n                        \"Innovations in monitoring iodine status\",\n                        \"Potential clinical trials and large-scale studies\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Conclusion\",\n                      \"sectionPoints\": [\n                        \"Summary of iodine’s vital role in brain health\",\n                        \"Call to action for continued research or public awareness\"\n                      ],\n                      \"subSections\": []\n                    }\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n    </Examples>\n\n</AgentInstructions>\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1616,560],"id":"b1423077-6f06-407c-a4b8-112c452aea4e","name":"Wikistyle"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-1248,480],"id":"01804c82-d966-42d9-8c6e-6443ba095367","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1104,480],"id":"6eab6a14-ccde-4a0c-b5d4-f07308d6c3eb","name":"Aggregate"},{"parameters":{"promptType":"define","text":"=Topic, Queries, Outline:\n{{ $json.stringified }}","hasOutputParser":true,"options":{"systemMessage":"=<AgentInstructions>\n\n    <Role>\n        <Name>Research Manager</Name>\n        <Description>\n            The Research Manager is responsible for receiving the article outline, dividing it into sections or subsections, and assigning these portions to one or more Research Assistants. It then collects their outputs for the next stage in the pipeline.\n        </Description>\n    </Role>\n\n    <Goal>\n        <Primary>\n            To orchestrate and oversee the distribution of research tasks among multiple Research Assistants, ensuring each section or sub-section is adequately researched and delivered in a standardized format.\n        </Primary>\n    </Goal>\n\n    <Instructions>\n        <Instruction>\n            1. Parse the outline (JSON) to identify each main section and any sub-sections.\n        </Instruction>\n        <Instruction>\n            2. For each section or sub-section, create a research task that includes:\n               - sectionTitle (e.g., \"Introduction\")\n               - any relevant search queries\n               - instructions or bullet points from the outline \n                 (e.g., \"Explain the significance of the topic,\" \"Summarize major findings,\" etc.)\n            </Instruction>\n        <Instruction>\n            3. Send each task to the appropriate Research Assistant, providing them the necessary context \n               (sectionTitle, instructions, relevant queries) so they can conduct research and produce a \n               draft (JSON format: sectionTitle, text, references).\n        </Instruction>\n        <Instruction>\n            4. Collect each Research Assistant's JSON output and merge it, preserving the order of sections \n               from the original outline for the next stage (e.g., Draft Editor).\n        </Instruction>\n        <Instruction>\n            5. Do not perform the actual research or write the content yourself; your role is strictly to coordinate tasks among the Research Assistants.\n        </Instruction>\n    </Instructions>\n\n    <Examples>\n        <Example>\n            <UserInput>\n                {\n                  \"topic\": \"effects of ashwagandha on cortisol levels\",\n                  \"outline\": [\n                    {\n                      \"sectionTitle\": \"Introduction\",\n                      \"sectionPoints\": [\n                        \"Overview of ashwagandha and its traditional use\",\n                        \"Brief introduction to cortisol\",\n                        \"Significance of ashwagandha-cortisol research\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"sectionPoints\": [\"Major clinical trial outcomes\", \"Any meta-analyses findings\"],\n                      \"subSections\": [\n                        {\n                          \"subSectionTitle\": \"Clinical Trials\",\n                          \"subSectionPoints\": [\"Study design\", \"Dosage\", \"Statistical outcomes\"]\n                        },\n                        {\n                          \"subSectionTitle\": \"Meta-analyses\",\n                          \"subSectionPoints\": [\"Aggregated results\", \"Limitations\"]\n                        }\n                      ]\n                    }\n                  ],\n                  \"searchQueries\": [\n                    \"clinical trials assessing ashwagandha impact on cortisol levels\",\n                    \"ashwagandha supplementation influence on cortisol response\"\n                  ]\n                }\n            </UserInput>\n            <AgentOutput>\n                {\n                  \"topic\": \"effects of ashwagandha on cortisol levels\",\n                  \"citationCount\": 0,\n                  \"researchTasks\": [\n                    {\n                      \"sectionTitle\": \"Introduction\",\n                      \"queries\": [\n                        \"ashwagandha supplementation influence on cortisol response\"\n                      ],\n                      \"instructions\": [\n                        \"Overview of ashwagandha and its traditional use\",\n                        \"Brief introduction to cortisol\",\n                        \"Significance of ashwagandha-cortisol research\"\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"subSectionTitle\": \"Clinical Trials\",\n                      \"queries\": [\n                        \"clinical trials assessing ashwagandha impact on cortisol levels\"\n                      ],\n                      \"instructions\": [\n                        \"Study design, dosage, and statistical outcomes\",\n                        \"Major clinical trial outcomes\"\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"subSectionTitle\": \"Meta-analyses\",\n                      \"queries\": [\n                        \"ashwagandha supplementation influence on cortisol response\"\n                      ],\n                      \"instructions\": [\n                        \"Aggregated results and limitations\",\n                        \"Any meta-analyses findings\"\n                      ]\n                    }\n                  ]\n                }\n            </AgentOutput>\n        </Example>\n    </Examples>\n\n</AgentInstructions>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-800,480],"id":"dfbe1d17-a728-4eb8-9e13-c4f156e7999d","name":"Research Manager","retryOnFail":true,"maxTries":3},{"parameters":{"jsCode":"return [{\n  json: {\n    stringified: JSON.stringify($json)\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-960,480],"id":"2eb2b4d9-27fa-4455-b419-6bcad5fecca5","name":"stringify json"},{"parameters":{"fieldToSplitOut":"=output.researchTasks","include":"allOtherFields","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-464,480],"id":"e7f9b76b-a808-42a1-b934-8f6ede03e486","name":"Splits Outline"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-256,480],"id":"1475dfd4-f228-4d41-8101-efa4b42012ca","name":"Loop Over Items"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblMKRk8KcKNAqLAo","mode":"list","cachedResultName":"Research Papers","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblMKRk8KcKNAqLAo"},"filterByFormula":"=({Topic} = '{{ $json.output.topic }}')","returnAll":false,"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[0,432],"id":"a01743d5-5545-43da-8d54-e4e137082710","name":"search citation #","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblMKRk8KcKNAqLAo","mode":"list","cachedResultName":"Research Papers","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblMKRk8KcKNAqLAo"},"columns":{"mappingMode":"defineBelow","value":{"Topic":"={{ $json.output.Topic }}","Topic Outline":"={{ $json.output.topicOutline }}"},"matchingColumns":[],"schema":[{"id":"Topic","displayName":"Topic","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Topic Outline","displayName":"Topic Outline","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Snippet","displayName":"Snippet","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"HTML Sections","displayName":"HTML Sections","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false},{"id":"Citations","displayName":"Citations","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false},{"id":"citationCount","displayName":"citationCount","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":true},{"id":"ResearchID","displayName":"ResearchID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[0,0],"id":"e983b593-8c45-489d-a6cc-225ad0abdd39","name":"create topic","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[208,560],"id":"9c76ddce-1fe7-401f-8242-23a2749f7c4b","name":"Merge1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output.researchTasks"},{"fieldToAggregate":"Topic"},{"fieldToAggregate":"id"},{"fieldToAggregate":"citationCount"},{"fieldToAggregate":"ResearchID","renameField":true,"outputFieldName":"researchNumber"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[384,560],"id":"9e968840-9cc6-4251-a551-97fb43158c4b","name":"Aggregate1"},{"parameters":{"promptType":"define","text":"=Current Citations:{{ $json.citationCount[0] }}\n\nTopic of Research:{{ $json.Topic[0] }}\n\nSection of Research:{{ $json.researchTasks[0].sectionTitle }}\n\nSection Search Query:{{ $json.researchTasks[0].queries[0] }}\n\nSection Outline:{{ $json.researchTasks[0].instructions }}\n\nResearch Number: {{ $json.researchNumber[0] }}","hasOutputParser":true,"options":{"systemMessage":"=Role:\nYou are a Research Agent. \n\nYou get information from the User Input and the aggregation_system_tool to send to the research_tool. Once you have the research from the research tool, your job is to properly format the data into a JSON object.\n\n<Example flow>\n\nUser input: \nTopic of Research:iodine as a power supplement\n\nSection of Research:Introduction\n\nSection Search Query: iodine supplementation impact on energy and power performance\n\nSection Outline: Overview of iodine and its traditional roles in human health,Introduction to iodine as a potential power supplement,Significance of exploring iodine for energy and physical performance\n\nResearch Agent:\n- First, searches airtable aggregation_system_tool to find the topicOutline from this specific record to send to the research tool. Then sends data over.\n\n</Example flow>\n\n\nOnce you recieve the research from the research agent you are to output five JSON objects: \"HTML Body\" with a nicely structured HTML body and also a \"Citations\" array with numbered citations in the actual value of the JSON object not just numbered in the key. You are to use the current citation count in order to accomplish this. The current Citation count is: {{ $json.citationCount[0] }}. Next, you need to create a subtitle for each section and outp[ut that to sectionSubTitle. The next thing you need to send is this recordID:{{ $json.id[0] }}. The last thing is the section name:{{ $json.researchTasks[0].sectionTitle }}. Here's an input output example of your JSON object:\n\n<Example flow>\nInput from research tool:\n```json\\n{\\n  \"research\": {\\n    \"researchHTML\": \"<p>Water-only fasting, defined as the consumption of nothing but water for a set period, represents a unique form of dietary intervention that has garnered significant attention in both historical and clinical contexts. Traditionally practiced in various cultures for spiritual and health-related purposes, water-only fasting has evolved into a subject of modern scientific inquiry with particular focus on its extended applications. Extended water-only fasting, which includes fasting durations beyond 20 days, is of particular interest due to its potential to profoundly influence metabolic, cellular, and hormonal processes, while also posing unique challenges and risks [pubmed.ncbi.nlm.nih.gov](https://pubmed.ncbi.nlm.nih.gov/29455546/).</p><p>The purpose of exploring extended water-only fasting is twofold: firstly, to understand its physiological and clinical impacts beyond the widely studied short-term fasting protocols, and secondly, to delineate its benefits and associated hazards in a controlled and medically supervised environment. Clinical research has begun to shed light on the safety, metabolic adaptations, and potential therapeutic effects associated with prolonged fasting periods, offering insights that might be critical in developing standardized fasting protocols for health improvement [bmccomplementmedtherapies.biomedcentral.com](https://bmccomplementmedtherapies.biomedcentral.com/articles/10.1186/s12906-018-2136-6). Furthermore, ongoing investigations continue to evaluate how extended fasting correlates with systemic detoxification, regeneration, and overall metabolic regulation, thereby fostering a deeper understanding of its comprehensive role in health management [onlinelibrary.wiley.com](https://onlinelibrary.wiley.com/doi/pdfdirect/10.1002/ctm2.502).</p>\",\\n    \"citations\": [\\n      \"[pubmed.ncbi.nlm.nih.gov](https://pubmed.ncbi.nlm.nih.gov/29455546/)\",\\n      \"[bmccomplementmedtherapies.biomedcentral.com](https://bmccomplementmedtherapies.biomedcentral.com/articles/10.1186/s12906-018-2136-6)\",\\n      \"[onlinelibrary.wiley.com](https://onlinelibrary.wiley.com/doi/pdfdirect/10.1002/ctm2.502)\"\\n    ]\\n  }\\n}\\n```\n\n\nYour expected output:\n{\n  \"HTML Body\": \"<p>Water-only fasting, defined as the consumption of nothing but water for a set period, represents a unique form of dietary intervention that has garnered significant attention in both historical and clinical contexts. Traditionally practiced in various cultures for spiritual and health-related purposes, water-only fasting has evolved into a subject of modern scientific inquiry with particular focus on its extended applications. Extended water-only fasting, which includes fasting durations beyond 20 days, is of particular interest due to its potential to profoundly influence metabolic, cellular, and hormonal processes, while also posing unique challenges and risks [1].</p><p>The purpose of exploring extended water-only fasting is twofold: firstly, to understand its physiological and clinical impacts beyond the widely studied short-term fasting protocols, and secondly, to delineate its benefits and associated hazards in a controlled and medically supervised environment. Clinical research has begun to shed light on the safety, metabolic adaptations, and potential therapeutic effects associated with prolonged fasting periods, offering insights that might be critical in developing standardized fasting protocols for health improvement [2]. Furthermore, ongoing investigations continue to evaluate how extended fasting correlates with systemic detoxification, regeneration, and overall metabolic regulation, thereby fostering a deeper understanding of its comprehensive role in health management [3].</p>\",\n  \"recordID\": \"recordID Here\",\n  \"sectionName\": \"Introduction\",\n  \"sectionSubTitle\": \"Exploring water only fasting and it's deep healing benfits.\",\n  \"Citations\": [\n    \"1. https://pubmed.ncbi.nlm.nih.gov/29455546/\",\n    \"2. https://bmccomplementmedtherapies.biomedcentral.com/articles/10.1186/s12906-018-2136-6\",\n    \"3. https://onlinelibrary.wiley.com/doi/pdfdirect/10.1002/ctm2.502\"\n  ]\n}\n\n</Example flow>\n\nEnsure that you use the currentCitation tool, in order to mitigate any duplicates from being added. Also, if you notice an HTML body comes back with a citation like \"researchHTML here [5]\", but \"5\" is the same URL as \"2\" then recite the \"researchHTML citation to [2] and do not process the duplicate citation as a new citation. in the 'citations array'."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[544,560],"id":"e29b3214-ce50-49ff-9294-0ddc04c62d46","name":"Research Ops","retryOnFail":true,"maxTries":2},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"options":{"systemMessage":"=Your job is to structure outputs using JSON.\n\nWhen provided with an input JSON that contains keys like \"topic\" and \"researchTasks\", extract the \"topic\" as the value for \"Topic\".\n\nFor the \"topicOutline\", combine the information from each research task into a single plain text block.\n\nEach section should be formatted as: \"Section X: [Section Title] - [description]\" on its own new line, where X is the section number. Don't include the /n, that's just for you to understand when to enter down.\n\nAvoid using array formats; the entire outline should be one value in the JSON output.\n\nStructure the final output as a JSON object with exactly two keys: \"Topic\" and \"topicOutline\".\"\n\n{\n\"Topic\":\"Topic Here\",\n\"topicOutline\":\"Outline of section in nice text block here\"\n}\n\nExample Input:\n[Object: {\"topic\": \"healing with water only fasting\", \"researchTasks\": [{\"sectionTitle\": \"Introduction\", \"queries\": [\"water only fasting benefits on health and healing\"], \"instructions\": [\"Definition of water only fasting\", \"Overview of healing concepts related to fasting\", \"Purpose and significance of water only fasting in health and healing\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Background and Historical Context\", \"queries\": [\"evidence based healing with water only fasting protocols\"], \"instructions\": [\"Historical use of fasting in various cultures and medicine\", \"Evolution of fasting practices into modern therapeutic approaches\", \"Overview of traditional vs. contemporary perspectives on water only fasting\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Mechanisms of Healing During Water Only Fasting\", \"queries\": [\"mechanisms behind healing during water only fasting\"], \"instructions\": [\"Biological processes involved in fasting-induced healing\", \"Detoxification, autophagy, and metabolic changes\", \"Immune system modulation and inflammation reduction\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Mechanisms of Healing During Water Only Fasting\", \"queries\": [\"clinical studies on healing effects of water only fasting\"], \"instructions\": [\"Role of metabolic shifts and ketone production\", \"Impact on cellular repair and regeneration\", \"Biochemical markers and hormonal changes during fasting\"], \"subSectionTitle\": \"Clinical Mechanisms and Evidence\"},{\"sectionTitle\": \"Evidence-Based Research and Clinical Studies\", \"queries\": [\"clinical studies on healing effects of water only fasting\"], \"instructions\": [\"Overview of clinical studies on water only fasting and healing\", \"Presentation of key research findings and methodologies\", \"Analysis of short-term and long-term outcomes in healing\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Evidence-Based Research and Clinical Studies\", \"queries\": [\"long term outcomes of healing with water only fasting\"], \"instructions\": [\"Summary of major evidence-based studies and protocols\", \"Comparative effectiveness of water only fasting versus other fasting methods\", \"Critical evaluation of study limitations and challenges\"], \"subSectionTitle\": \"Detailed Review of Clinical Studies\"},{\"sectionTitle\": \"Applications, Benefits, and Practical Implications\", \"queries\": [\"water only fasting benefits on health and healing\"], \"instructions\": [\"Potential health benefits including detoxification and tissue repair\", \"Therapeutic applications in chronic disease management\", \"Guidelines and protocols for safe water only fasting practices\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Challenges, Risks, and Controversies\", \"queries\": [\"evidence based healing with water only fasting protocols\"], \"instructions\": [\"Potential risks and side effects of water only fasting\", \"Controversies over long-term impacts and clinical safety\", \"Critical perspectives on the evidence basis for healing claims\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Future Directions\", \"queries\": [\"long term outcomes of healing with water only fasting\"], \"instructions\": [\"Identifying gaps in current research on water only fasting\", \"Emerging methodologies for further clinical trials\", \"Integration of fasting protocols into mainstream healthcare and personalized medicine\"], \"subSectionTitle\": \"\"},{\"sectionTitle\": \"Conclusion\", \"queries\": [\"water only fasting benefits on health and healing\"], \"instructions\": [\"Summary of key insights on healing with water only fasting\", \"Overall implications for health and medical practice\", \"Call for continued research and informed application of water only fasting protocols\"], \"subSectionTitle\": \"\"}]}]\n\n\nExample Output:\n{ \"Topic\": \"healing with water only fasting\", \"topicOutline\": \"Section 1: Introduction - Definition of water only fasting; overview of healing concepts related to fasting; purpose and significance of water only fasting in health and healing.\\nSection 2: Background and Historical Context - Historical use of fasting in various cultures and medicine; evolution of fasting practices into modern therapeutic approaches; overview of traditional versus contemporary perspectives on water only fasting.\\nSection 3: Mechanisms of Healing During Water Only Fasting - Exploration of the biological processes involved in fasting-induced healing, including detoxification, autophagy, metabolic changes, and immune system modulation with inflammation reduction.\\nSection 4: Mechanisms of Healing During Water Only Fasting (Clinical Mechanisms and Evidence) - Discussion of metabolic shifts and ketone production, the impact on cellular repair and regeneration, and examination of biochemical markers and hormonal changes during fasting.\\nSection 5: Evidence-Based Research and Clinical Studies - Overview of clinical studies on water only fasting and healing, presentation of key research findings and methodologies, and analysis of short-term and long-term healing outcomes.\\nSection 6: Evidence-Based Research and Clinical Studies (Detailed Review of Clinical Studies) - Summary of major evidence-based studies and protocols, comparative analysis of water only fasting versus other fasting methods, and critical evaluation of study limitations and challenges.\\nSection 7: Applications, Benefits, and Practical Implications - Consideration of potential health benefits including detoxification and tissue repair, therapeutic applications in chronic disease management, and guidelines for safe water only fasting practices.\\nSection 8: Challenges, Risks, and Controversies - Examination of potential risks and side effects, controversies regarding long-term impacts and clinical safety, and critical perspectives on the evidence supporting healing claims.\\nSection 9: Future Directions - Identification of gaps in current research on water only fasting, exploration of emerging methodologies for further clinical trials, and integration of fasting protocols into mainstream healthcare and personalized medicine.\\nSection 10: Conclusion - Summary of key insights on healing with water only fasting, overall implications for health and medical practice, and a call for continued research and informed application of water only fasting protocols.\" }"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-400,64],"id":"e7940384-3ba9-4771-b64e-b612dfe777bb","name":"RAS","notesInFlow":true,"notes":"Rotating Aggregation System"},{"parameters":{"descriptionType":"manual","toolDescription":"aggregation_system_tool for getting topicOutline and citations.","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblMKRk8KcKNAqLAo","mode":"list","cachedResultName":"Research Papers","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblMKRk8KcKNAqLAo"},"id":"={{ $('Aggregate1').item.json.id[0] }}","options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[688,848],"id":"cd05b658-4e31-4500-abf1-eaf189d42e92","name":"aggregation_system","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblQKQCKyA3srMxrB","mode":"list","cachedResultName":"HTML Sections","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblQKQCKyA3srMxrB"},"columns":{"mappingMode":"defineBelow","value":{"HTML body":"={{ $json.output[\"HTML Body\"] }}","Research Papers":"={{ [ $json.output.recordID ] }}","Section name":"={{ $json.output.sectionName }}","Sub title":"={{ $json.output.sectionSubTitle }}"},"matchingColumns":["id"],"schema":[{"id":"Section name","displayName":"Section name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Sub title","displayName":"Sub title","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"HTML body","displayName":"HTML body","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Research Papers","displayName":"Research Papers","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false},{"id":"ResearchID","displayName":"ResearchID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Last Modified","displayName":"Last Modified","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Citations","displayName":"Citations","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":true},{"id":"Source (from Citations)","displayName":"Source (from Citations)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Citations 2","displayName":"Citations 2","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1040,528],"id":"d44195a6-96d3-48a4-81da-d37b8e1e559f","name":"create HTML snippet","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"fieldToSplitOut":"output.Citations","include":"allOtherFields","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1104,768],"id":"fd87aac3-6c10-47b6-8fea-e15a79a2e418","name":"Split Out"},{"parameters":{"descriptionType":"manual","toolDescription":"Finds duplicate citations and numbers.","operation":"search","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblAxXeE5FeOWRFCH","mode":"list","cachedResultName":"Citations","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblAxXeE5FeOWRFCH"},"filterByFormula":"=({ResearchID} = '{{ $json.ResearchID }}')","options":{"fields":["Source"]}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[832,848],"id":"95e944ee-192c-4ca7-b88b-570345cb7aa3","name":"citation_finder","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"fields.ResearchID[0]"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[0,208],"id":"359ea694-d901-4117-9e52-c0d12bf006a3","name":"Aggregate2"},{"parameters":{"assignments":{"assignments":[{"id":"f373f7e1-b89a-4092-ba0a-01de6039ce4c","name":"ResearchID[0][0]","value":"={{ $json.ResearchID[0][0] }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[208,208],"id":"28d8859f-b871-49a4-a618-68ad46193020","name":"set researchID"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblQKQCKyA3srMxrB","mode":"list","cachedResultName":"HTML Sections","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblQKQCKyA3srMxrB"},"filterByFormula":"=({ResearchID} = '{{ $json.ResearchID}}')","options":{},"sort":{"property":[{"field":"Last Modified"}]}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[384,208],"id":"54c68886-79ef-46cb-986b-e544b637bba0","name":"research","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"jsCode":"// Helper function: trims each line and joins them with actual newline characters.\nfunction toTrimmed(str) {\n  return str\n    .split('\\n')\n    .map(line => line.trim())\n    .filter(line => line !== '')\n    .join('\\n');\n}\n\n// Extract the header title from the \"Calculation\" field in the first record.\nconst headerTitle = items[0].json[\"Calculation\"] || \"Research Report\";\n\n// Process each input item to build content sections.\nconst sections = items.map(item => {\n  // Build a citation map from the \"Citation Individual\" field.\n  let citationMap = {};\n  const citationsString = item.json[\"Citation Individual\"];\n  if (citationsString) {\n    // Regex to capture citations in the format: \"1. https://...\"\n    const regex = /(\\d+)\\.\\s*(https?:\\/\\/\\S+)/g;\n    let match;\n    while ((match = regex.exec(citationsString)) !== null) {\n      // Remove any trailing comma from the captured URL.\n      citationMap[match[1]] = match[2].replace(/,$/, '');\n    }\n  }\n  \n  // Process the HTML body: replace occurrences of [number] with a linked citation.\n  let htmlBody = item.json[\"HTML body\"];\n  htmlBody = htmlBody.replace(/\\[(\\d+)\\]/g, (match, p1) => {\n    if (citationMap[p1]) {\n      return `<a href=\"${citationMap[p1]}\" target=\"_blank\">[${p1}]</a>`;\n    }\n    return match;\n  });\n  \n  // Build the section HTML using Section name, Sub title (if present), and the processed HTML body.\n  let sectionHTML = `<div class=\"section\">\\n`;\n  sectionHTML += `<h2>${item.json[\"Section name\"]}</h2>\\n`;\n  if (item.json[\"Sub title\"]) {\n    sectionHTML += `<h3>${item.json[\"Sub title\"]}</h3>\\n`;\n  }\n  sectionHTML += htmlBody + '\\n';\n  sectionHTML += `</div>`;\n  \n  return {\n    sectionHTML,\n    citationMap\n  };\n});\n\n// Merge all citation maps from all sections into one global citation map.\nconst globalCitations = {};\nsections.forEach(sec => {\n  for (const key in sec.citationMap) {\n    globalCitations[key] = sec.citationMap[key];\n  }\n});\n\n// Build the main content HTML: start with the header title from the Calculation field, then all sections.\nlet content = `<h1>${headerTitle}</h1>\\n`;\nsections.forEach(sec => {\n  content += sec.sectionHTML + '\\n\\n';\n});\n\n// Build the References section with a page break before it and make the \"References\" text bigger.\nlet referencesHTML = `<p style=\"page-break-before: always; font-size: 28px;\"><strong>References</strong></p>\\n<div class=\"references\">\\n`;\nfor (const num in globalCitations) {\n  referencesHTML += `<p>[${num}] <a href=\"${globalCitations[num]}\" target=\"_blank\">${globalCitations[num]}</a></p>\\n`;\n}\nreferencesHTML += `</div>\\n`;\ncontent += referencesHTML;\n\n// Define the CSS with custom styling for the References section.\nconst cssContent = `<style>\nbody {\n  font-family: Arial, sans-serif;\n  line-height: 1.2;\n  padding: 20px;\n  white-space: pre-wrap; /* Ensures that newline characters are rendered */\n}\nh1 {\n  font-size: 36px;\n  color: #333;\n  margin-bottom: 10px;\n}\nh2 {\n  font-size: 22px;\n  color: #777;\n  margin-bottom: 10px;\n}\nh3 {\n  font-size: 20px;\n  color: #444;\n  margin-bottom: 10px;\n}\np {\n  font-size: 16px;\n  color: #222;\n  line-height: 1.6;\n  margin: 10px 0;\n}\n.section {\n  margin-bottom: 30px;\n  border-bottom: 1px solid #ccc;\n  padding-bottom: 15px;\n}\n/* Custom styling for the References section */\n.references {\n  margin: 0;\n  padding: 0;\n}\n.references p {\n  margin: 2px 0;\n  font-size: 14px;\n  font-style: italic;\n}\n</style>`;\n\n// Build the final output object.\nconst output = {\n  body: toTrimmed(content),\n  css: toTrimmed(cssContent),\n  data: {\n    name: \"This is a title\"\n  },\n  settings: {\n    paper_size: \"A4\",\n    orientation: \"1\",\n    header_font_size: \"9px\",\n    margin_top: \"40\",\n    margin_right: \"10\",\n    margin_bottom: \"40\",\n    margin_left: \"10\",\n    print_background: \"1\",\n    displayHeaderFooter: true,\n    // Remove header/footer content to eliminate page numbers and the date.\n    custom_header: \"\",\n    custom_footer: \"\"\n  }\n};\n\n// Return the output as a stringified JSON so that the PDF API receives valid JSON.\nreturn [{ json: { data: JSON.stringify(output) } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[592,208],"id":"28addfa4-d726-48a5-8905-ad0bc71e7e94","name":"Code"},{"parameters":{"method":"POST","url":"https://rest-us.apitemplate.io/v2/create-pdf-from-html","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"X-API-KEY","value":"98eaMjQ1NTg6MjE2OTk6NDVndHU1RVVtbGhhcVNtSA="}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.data }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[784,208],"id":"51fb0887-cfa4-4c03-8efd-c13898350476","name":"creates PDF"},{"parameters":{"url":"={{ $json.download_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[992,208],"id":"be4f5bea-0630-448b-9c11-79f976d481e7","name":"downloads PDF1"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblAxXeE5FeOWRFCH","mode":"list","cachedResultName":"Citations","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblAxXeE5FeOWRFCH"},"columns":{"mappingMode":"defineBelow","value":{"Source":"={{ $json[\"output.Citations\"] }}","Research Papers":"={{ [ $json.output.recordID ] }}"},"matchingColumns":[],"schema":[{"id":"Source","displayName":"Source","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Research Papers","displayName":"Research Papers","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false},{"id":"ResearchID","displayName":"ResearchID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"HTML Sections","displayName":"HTML Sections","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1312,592],"id":"fc37010a-91c4-4455-bb5b-c0bb220fa33e","name":"creates citations","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"operation":"update","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblQKQCKyA3srMxrB","mode":"list","cachedResultName":"HTML Sections","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblQKQCKyA3srMxrB"},"columns":{"mappingMode":"defineBelow","value":{"Citation Individual":"={{ $json.commaSeparatedCitations }}","Sub title":"={{ $json.firstSubTitle }}"},"matchingColumns":["Sub title"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":true},{"id":"Section name","displayName":"Section name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Sub title","displayName":"Sub title","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"HTML body","displayName":"HTML body","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Research Papers","displayName":"Research Papers","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":true},{"id":"ResearchID","displayName":"ResearchID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":true},{"id":"Last Modified","displayName":"Last Modified","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":true},{"id":"Citations","displayName":"Citations","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":true},{"id":"Citation Individual","displayName":"Citation Individual","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1600,880],"id":"5971976b-9e35-48de-9f94-3fabbb5a74a1","name":"citations to HTML snippet link","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output.Citations"},{"fieldToAggregate":"output.sectionSubTitle"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1280,768],"id":"5406e61c-5969-4d73-8528-39ab205ee06e","name":"Aggregate3"},{"parameters":{"jsCode":"// Retrieve our arrays from $json\nconst citationsArray = $json.Citations;\nconst subtitlesArray = $json.sectionSubTitle;\n\n// Convert Citations to a comma-separated string\nconst commaSeparatedCitations = citationsArray.join(', ');\n\n// Get the first item from the subtitles array\nconst firstSubTitle = subtitlesArray[0];\n\n// Return both in a single output item\nreturn [\n  {\n    commaSeparatedCitations,\n    firstSubTitle\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1440,832],"id":"2b926a35-a5fd-4bcd-a71d-c66f5716aa2c","name":"Code1"},{"parameters":{"name":"research_tool","description":"Call this tool to send and receive research data.","workflowId":{"__rl":true,"value":"9qx6m1onhTwCWegm","mode":"list","cachedResultName":"Research Model"},"workflowInputs":{"mappingMode":"defineBelow","value":{"topicOfresearch":"={{ $('Aggregate1').item.json.Topic[0] }}","searchQuery":"={{ $('Aggregate1').item.json.researchTasks[0].queries[0] }}","citationCount":"={{ $('Aggregate1').item.json.citationCount[0] }}","currentResearchSection":"={{ $('Aggregate1').item.json.researchTasks[0].sectionTitle }}","sectionOutline":"={{ $fromAI('topicOutline','the topic outline from the aggregation_system_tool on airtable') }}"},"matchingColumns":[],"schema":[{"id":"topicOfresearch","displayName":"topicOfresearch","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"citationCount","displayName":"citationCount","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"searchQuery","displayName":"searchQuery","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"currentResearchSection","displayName":"currentResearchSection","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"sectionOutline","displayName":"sectionOutline","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"previousSection","displayName":"previousSection","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[528,848],"id":"2ca2f069-982c-45e1-984d-f0b311869bdd","name":"research_model"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfnSwc9ad1gcCMf","mode":"list","cachedResultName":"Research Agent","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf"},"table":{"__rl":true,"value":"tblKsXNZo0UYiWW9F","mode":"list","cachedResultName":"PDFs","cachedResultUrl":"https://airtable.com/appfnSwc9ad1gcCMf/tblKsXNZo0UYiWW9F"},"columns":{"mappingMode":"defineBelow","value":{"PDF":"={{ $json.download_url }}"},"matchingColumns":[],"schema":[{"id":"Date Published","displayName":"Date Published","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":true},{"id":"PDF","displayName":"PDF","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1232,208],"id":"0770b75b-c0f3-414d-938f-08e6b77326a6","name":"Airtable","credentials":{"airtableTokenApi":{"id":"EX62c73cYqwajap2","name":"Airtable Personal Access Token account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5-nano","mode":"list","cachedResultName":"gpt-5-nano"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1984,752],"id":"c1fe5cd1-c4f4-40aa-8d6a-f713a7ed2ebb","name":"model 1","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1616,784],"id":"87912132-0743-4b24-b48b-2b2a18a6ccae","name":"model 2","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-848,688],"id":"964c6222-7af5-4332-9a4c-a4f2eb95e544","name":"model 3","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n                    \"topic\": \"Photobiomodulation for shoulder pain\",\n                    \"searchQueries\": [\n                        \"photobiomodulation shoulder pain systematic review\",\n                        \"photobiomodulation therapy rotator cuff injuries RCT\",\n                        \"low-level laser therapy LLLT outcomes for shoulder rehabilitation\",\n                        \"photobiomodulation shoulder pain clinical guidelines\",\n                        \"photobiomodulation shoulder injury pain management case studies\"\n                    ]\n                }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-1824,720],"id":"e55b77b2-6361-4e3a-879a-7ddccf5fded9","name":"s/o 1"},{"parameters":{"jsonSchemaExample":"{\n                  \"topic\": \"iodine effects on the brain\",\n                  \"outline\": [\n                    {\n                      \"sectionTitle\": \"Introduction\",\n                      \"sectionPoints\": [\n                        \"Overview of iodine and its general role in human biology\",\n                        \"Why the brain specifically needs iodine\",\n                        \"Brief statement on significance of iodine in neurological processes\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Background and Historical Context\",\n                      \"sectionPoints\": [\n                        \"Early discoveries linking iodine to brain health\",\n                        \"Historical usage of iodine supplements\",\n                        \"Previous misconceptions or overlooked aspects in research\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Mechanisms of Iodine Action in the Brain\",\n                      \"sectionPoints\": [\n                        \"Physiological processes: how iodine is transported and utilized\",\n                        \"Role in hormone regulation (e.g., thyroid hormones) and neural development\"\n                      ],\n                      \"subSections\": [\n                        {\n                          \"subSectionTitle\": \"Iodine and Brain Development\",\n                          \"subSectionPoints\": [\n                            \"Key developmental stages influenced by iodine\",\n                            \"Potential impact of deficiency on cognitive outcomes\"\n                          ]\n                        }\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"sectionPoints\": [\n                        \"Major studies on iodine deficiency and cognitive function\",\n                        \"Recent findings on iodine supplementation outcomes\",\n                        \"Gaps in current research and conflicting results\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Practical Implications\",\n                      \"sectionPoints\": [\n                        \"Public health recommendations related to iodine intake\",\n                        \"Dietary sources and supplementation guidelines\",\n                        \"Preventive measures against deficiency\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Challenges and Controversies\",\n                      \"sectionPoints\": [\n                        \"Debates over optimal iodine intake levels\",\n                        \"Potential risks of excessive iodine consumption\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Future Directions\",\n                      \"sectionPoints\": [\n                        \"Areas of research that need further exploration\",\n                        \"Innovations in monitoring iodine status\",\n                        \"Potential clinical trials and large-scale studies\"\n                      ],\n                      \"subSections\": []\n                    },\n                    {\n                      \"sectionTitle\": \"Conclusion\",\n                      \"sectionPoints\": [\n                        \"Summary of iodine’s vital role in brain health\",\n                        \"Call to action for continued research or public awareness\"\n                      ],\n                      \"subSections\": []\n                    }\n                  ]\n                }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-1440,784],"id":"953ce8cd-04da-40e5-8347-e5e363912765","name":"s/o 2"},{"parameters":{"jsonSchemaExample":"{\n                  \"topic\": \"effects of ashwagandha on cortisol levels\",\n                  \"researchTasks\": [\n                    {\n                      \"sectionTitle\": \"Introduction\",\n                      \"queries\": [\n                        \"ashwagandha supplementation influence on cortisol response\"\n                      ],\n                      \"instructions\": [\n                        \"Overview of ashwagandha and its traditional use\",\n                        \"Brief introduction to cortisol\",\n                        \"Significance of ashwagandha-cortisol research\"\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"subSectionTitle\": \"Clinical Trials\",\n                      \"queries\": [\n                        \"clinical trials assessing ashwagandha impact on cortisol levels\"\n                      ],\n                      \"instructions\": [\n                        \"Study design, dosage, and statistical outcomes\",\n                        \"Major clinical trial outcomes\"\n                      ]\n                    },\n                    {\n                      \"sectionTitle\": \"Key Research Findings\",\n                      \"subSectionTitle\": \"Meta-analyses\",\n                      \"queries\": [\n                        \"ashwagandha supplementation influence on cortisol response\"\n                      ],\n                      \"instructions\": [\n                        \"Aggregated results and limitations\",\n                        \"Any meta-analyses findings\"\n                      ]\n                    }\n                  ]\n                }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-560,688],"id":"9379ffa2-5888-458e-93d3-ef0510be68f9","name":"s/o 3"},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-416,256],"id":"2dc3e3df-ea8e-43ca-9f1b-8b7fd28ca598","name":"model 4","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[368,832],"id":"dde06e5a-7567-473a-bda5-7998a3edb2a9","name":"model 5","credentials":{"openAiApi":{"id":"H150YmQZWV60PC3D","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n\"Topic\":\"Topic Here\",\n\"topicOutline\":\"Outline of section in nice text block here\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-208,272],"id":"5ea84c55-2ab2-420d-98a1-c51a533265bb","name":"s/o 4"},{"parameters":{"jsonSchemaExample":"{\n  \"HTML Body\": \"<p>Water-only fasting, defined as the consumption of nothing but water for a set period, represents a unique form of dietary intervention that has garnered significant attention in both historical and clinical contexts. Traditionally practiced in various cultures for spiritual and health-related purposes, water-only fasting has evolved into a subject of modern scientific inquiry with particular focus on its extended applications. Extended water-only fasting, which includes fasting durations beyond 20 days, is of particular interest due to its potential to profoundly influence metabolic, cellular, and hormonal processes, while also posing unique challenges and risks [1].</p><p>The purpose of exploring extended water-only fasting is twofold: firstly, to understand its physiological and clinical impacts beyond the widely studied short-term fasting protocols, and secondly, to delineate its benefits and associated hazards in a controlled and medically supervised environment. Clinical research has begun to shed light on the safety, metabolic adaptations, and potential therapeutic effects associated with prolonged fasting periods, offering insights that might be critical in developing standardized fasting protocols for health improvement [2]. Furthermore, ongoing investigations continue to evaluate how extended fasting correlates with systemic detoxification, regeneration, and overall metabolic regulation, thereby fostering a deeper understanding of its comprehensive role in health management [3].</p>\",\n  \"recordID\": \"recordID Here\",\n  \"sectionName\": \"section name here\",\n  \"sectionSubTitle\": \"more info on topic\",\n  \"Citations\": [\n    \"1. https://pubmed.ncbi.nlm.nih.gov/29455546/\",\n    \"2. https://bmccomplementmedtherapies.biomedcentral.com/articles/10.1186/s12906-018-2136-6\",\n    \"3. https://onlinelibrary.wiley.com/doi/pdfdirect/10.1002/ctm2.502\"\n  ]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[960,848],"id":"f85a72b9-34ea-4d63-bf14-52f98daa2763","name":"s/o 5"}],"connections":{"Topic":{"main":[[{"node":"Query Refiner","type":"main","index":0}]]},"Query Refiner":{"main":[[{"node":"Wikistyle","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Wikistyle":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"stringify json","type":"main","index":0}]]},"stringify json":{"main":[[{"node":"Research Manager","type":"main","index":0}]]},"Research Manager":{"main":[[{"node":"Splits Outline","type":"main","index":0},{"node":"RAS","type":"main","index":0}]]},"Splits Outline":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Aggregate2","type":"main","index":0}],[{"node":"search citation #","type":"main","index":0},{"node":"Merge1","type":"main","index":1}]]},"search citation #":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Research Ops","type":"main","index":0}]]},"RAS":{"main":[[{"node":"create topic","type":"main","index":0}]]},"Research Ops":{"main":[[{"node":"create HTML snippet","type":"main","index":0},{"node":"Split Out","type":"main","index":0}]]},"aggregation_system":{"ai_tool":[[{"node":"Research Ops","type":"ai_tool","index":0}]]},"Split Out":{"main":[[{"node":"creates citations","type":"main","index":0},{"node":"Aggregate3","type":"main","index":0}]]},"citation_finder":{"ai_tool":[[{"node":"Research Ops","type":"ai_tool","index":0}]]},"Aggregate2":{"main":[[{"node":"set researchID","type":"main","index":0}]]},"set researchID":{"main":[[{"node":"research","type":"main","index":0}]]},"research":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"creates PDF","type":"main","index":0}]]},"creates PDF":{"main":[[{"node":"downloads PDF1","type":"main","index":0}]]},"citations to HTML snippet link":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"citations to HTML snippet link","type":"main","index":0}]]},"downloads PDF1":{"main":[[{"node":"Airtable","type":"main","index":0}]]},"research_model":{"ai_tool":[[{"node":"Research Ops","type":"ai_tool","index":0}]]},"model 1":{"ai_languageModel":[[{"node":"Query Refiner","type":"ai_languageModel","index":0}]]},"model 2":{"ai_languageModel":[[{"node":"Wikistyle","type":"ai_languageModel","index":0}]]},"model 3":{"ai_languageModel":[[{"node":"Research Manager","type":"ai_languageModel","index":0}]]},"s/o 1":{"ai_outputParser":[[{"node":"Query Refiner","type":"ai_outputParser","index":0}]]},"s/o 2":{"ai_outputParser":[[{"node":"Wikistyle","type":"ai_outputParser","index":0}]]},"s/o 3":{"ai_outputParser":[[{"node":"Research Manager","type":"ai_outputParser","index":0}]]},"model 4":{"ai_languageModel":[[{"node":"RAS","type":"ai_languageModel","index":0}]]},"model 5":{"ai_languageModel":[[{"node":"Research Ops","type":"ai_languageModel","index":0}]]},"s/o 4":{"ai_outputParser":[[{"node":"RAS","type":"ai_outputParser","index":0}]]},"s/o 5":{"ai_outputParser":[[{"node":"Research Ops","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a8ec7cdb-b756-4143-b853-213709bcbba1","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-29T02:58:11.545Z","createdAt":"2025-11-29T02:58:11.545Z","role":"workflow:owner","workflowId":"zEXE0ZbF6tsqFOIB","projectId":"7NnPkzRru2w1cpBr"}],"activeVersion":null,"tags":[{"updatedAt":"2025-11-29T02:58:09.912Z","createdAt":"2025-11-29T02:58:09.912Z","id":"MLxH2KK1oGvMfhGh","name":"Research"}]}]}